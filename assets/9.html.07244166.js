import{_ as p}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as l,c as o,a as n,b as s,d as t,f as a,r as i}from"./app.ca0279c0.js";const c={},u=a(`<h1 id="ansible\u90E8\u7F72rabbitmq\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#ansible\u90E8\u7F72rabbitmq\u96C6\u7FA4" aria-hidden="true">#</a> Ansible\u90E8\u7F72Rabbitmq\u96C6\u7FA4</h1><table><thead><tr><th>\u8282\u70B9</th><th>IP</th><th>\u4E3B\u673A\u540D</th></tr></thead><tbody><tr><td>ansible</td><td>172.25.253.137</td><td>ansible</td></tr><tr><td>node1</td><td>172.25.253.138</td><td>node1</td></tr><tr><td>node2</td><td>172.25.253.139</td><td>node2</td></tr><tr><td>node3</td><td>172.25.253.140</td><td>node3</td></tr></tbody></table><blockquote><h3 id="\u67E5\u770B\u5F53\u524D\u6587\u4EF6\u6811" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770B\u5F53\u524D\u6587\u4EF6\u6811" aria-hidden="true">#</a> \u67E5\u770B\u5F53\u524D\u6587\u4EF6\u6811</h3></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible ansible<span class="token punctuation">]</span><span class="token comment"># tree rabbitmq/ </span>
rabbitmq/
\u251C\u2500\u2500 hosts
\u251C\u2500\u2500 local.repo
\u251C\u2500\u2500 playbook.yaml
\u251C\u2500\u2500 rabbitmq.sh
\u2514\u2500\u2500 scp.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h3 id="\u67E5\u770Bansible\u4E3B\u673A\u6E05\u5355" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770Bansible\u4E3B\u673A\u6E05\u5355" aria-hidden="true">#</a> \u67E5\u770Bansible\u4E3B\u673A\u6E05\u5355</h3></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible rabbitmq<span class="token punctuation">]</span><span class="token comment"># cat /etc/ansible/hosts </span>

<span class="token punctuation">[</span>server<span class="token punctuation">]</span>
<span class="token number">172.25</span>.253.138 <span class="token assign-left variable">hostname</span><span class="token operator">=</span>node1
<span class="token number">172.25</span>.253.140 <span class="token assign-left variable">hostname</span><span class="token operator">=</span>node3
<span class="token number">172.25</span>.253.139 <span class="token assign-left variable">hostname</span><span class="token operator">=</span>node2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h3 id="ansible\u90E8\u7F72rabbitmq\u96C6\u7FA4-1" tabindex="-1"><a class="header-anchor" href="#ansible\u90E8\u7F72rabbitmq\u96C6\u7FA4-1" aria-hidden="true">#</a> ansible\u90E8\u7F72rabbitmq\u96C6\u7FA4</h3></blockquote><ul><li><strong>\u4F7F\u7528playbook\u7F16\u5199\u4E00\u952E\u90E8\u7F72\u96C6\u7FA4</strong></li><li><strong>\u914D\u7F6E\u597D\u6240\u6709\u673A\u5668\u7684ssh\u514D\u5BC6</strong></li><li><strong>\u66F4\u6539\u597Dhosts\u914D\u7F6E\u6587\u4EF6\u3001local.repo\u3001\u4EE5\u53CA\u7F16\u5199\u4E24\u4E2A\u811A\u672C</strong></li><li><strong>\u7F16\u5199playbook</strong></li></ul><h4 id="_1-\u914D\u7F6Ehosts\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_1-\u914D\u7F6Ehosts\u6587\u4EF6" aria-hidden="true">#</a> 1.\u914D\u7F6Ehosts\u6587\u4EF6</h4><ul><li><strong>\u914D\u7F6E\u4E09\u4E2A\u8282\u70B9\u7684\u6620\u5C04\u4EE5\u53CA\u89E3\u6790\u4E3B\u673A\u540D</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible rabbitmq<span class="token punctuation">]</span><span class="token comment"># cat hosts </span>
<span class="token number">127.0</span>.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

<span class="token number">172.25</span>.253.138 node1 
<span class="token number">172.25</span>.253.139 node2
<span class="token number">172.25</span>.253.140 node3 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-\u914D\u7F6Eyum\u6E90" tabindex="-1"><a class="header-anchor" href="#_2-\u914D\u7F6Eyum\u6E90" aria-hidden="true">#</a> 2.\u914D\u7F6Eyum\u6E90</h4><ul><li><strong>\u53EF\u4EE5\u4F7F\u7528file\u672C\u5730yum\u6E90\u4E5F\u53EF\u4EE5\u4F7F\u7528http\u6E90</strong></li><li><strong>\u8FD9\u91CC\u4E3A\u4E86\u65B9\u4FBF\u4F7F\u7528http\u6E90</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible rabbitmq<span class="token punctuation">]</span><span class="token comment"># cat local.repo  </span>
<span class="token punctuation">[</span>rabbitmq-repo<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>rabbitmq-repo
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://172.25.253.144/file/rabbitmq-repo/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,14),r={id:"_3-\u7F16\u5199scp-sh",tabindex:"-1"},d=n("a",{class:"header-anchor",href:"#_3-\u7F16\u5199scp-sh","aria-hidden":"true"},"#",-1),k={href:"http://3.xn--scp-y11em39r.sh",target:"_blank",rel:"noopener noreferrer"},b=a(`<ul><li><strong>scp\u4F20\u9001\u6587\u4EF6\u7684\u65F6\u5019\u7528\u4E3B\u673A\u540D\u4F1A\u9700\u8981\u8F93\u5165\u5BC6\u7801 ip\u5730\u5740\u4E0D\u4F1A\u663E\u793A\u8F93\u5165\u5BC6\u7801</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible rabbitmq<span class="token punctuation">]</span><span class="token comment"># cat scp.sh  </span>
<span class="token comment">#!/bin/bash</span>

<span class="token function">scp</span> /var/lib/rabbitmq/.erlang.cookie root@172.25.253.139:/var/lib/rabbitmq/.erlang.cookie
<span class="token function">scp</span> /var/lib/rabbitmq/.erlang.cookie root@172.25.253.140:/var/lib/rabbitmq/.erlang.cookie
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),v={id:"_4-\u7F16\u5199rabbitmq-sh",tabindex:"-1"},m=n("a",{class:"header-anchor",href:"#_4-\u7F16\u5199rabbitmq-sh","aria-hidden":"true"},"#",-1),h={href:"http://4.xn--rabbitmq-ts6mn078a.sh",target:"_blank",rel:"noopener noreferrer"},g=a(`<ul><li><strong>\u4F7F\u7528shell\u811A\u672C\u81EA\u52A8\u5316\u52A0\u5165\u96C6\u7FA4</strong></li><li><strong>\u505C\u6B62\u96C6\u7FA4\u72B6\u6001</strong></li><li><strong>\u52A0\u5165\u78C1\u76D8\u8282\u70B9node1</strong></li><li><strong>\u542F\u52A8\u96C6\u7FA4\u72B6\u6001</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible rabbitmq<span class="token punctuation">]</span><span class="token comment"># cat rabbitmq.sh </span>
<span class="token comment">#!/bin/bash </span>

rabbitmqctl stop_app
rabbitmqctl join_cluster <span class="token parameter variable">--ram</span> rabbit@node1
rabbitmqctl start_app
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-\u7F16\u5199playbook" tabindex="-1"><a class="header-anchor" href="#_5-\u7F16\u5199playbook" aria-hidden="true">#</a> 5.\u7F16\u5199playbook</h4><ul><li><strong>\u4F7F\u7528copy\u6A21\u5757\u4F20\u8F93\u6587\u4EF6</strong></li><li><strong>\u4F7F\u7528yum\u548Cservice\u6A21\u5757\u5B89\u88C5\u548C\u5F00\u542F\u670D\u52A1\u7684\u72B6\u6001</strong></li><li><strong>\u4F7F\u7528script\u6A21\u5757\u8FD0\u884C\u811A\u672C</strong></li><li><strong>\u6807\u8BB0\u597D\u66F4\u6539\u914D\u7F6E\u6587\u4EF6\u7528notify\uFF0C\u4F7F\u7528handlers\u91CD\u542F\u670D\u52A1 \u5229\u7528\u4E00\u4E2Aitem\u7684\u5FAA\u73AF</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible rabbitmq<span class="token punctuation">]</span><span class="token comment"># cat playbook.yaml  </span>

<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> first tasks 
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server 
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root 

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy hosts 
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=hosts dest=/etc/hosts
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> delete repo 
      <span class="token key atrule">shell</span><span class="token punctuation">:</span> rm <span class="token punctuation">-</span>rf /etc/yum.repos.d/* 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy repo 
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=local.repo dest=/etc/yum.repos.d/local.repo 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install packages
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=rabbitmq<span class="token punctuation">-</span>server state=present 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start rabbitmq
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=rabbitmq<span class="token punctuation">-</span>server state=started 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> run sh 
      <span class="token key atrule">script</span><span class="token punctuation">:</span> scp.sh
      <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_fqdn == &quot;node1&quot;
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install UI
      <span class="token key atrule">shell</span><span class="token punctuation">:</span> rabbitmq<span class="token punctuation">-</span>plugins enable rabbitmq_management
      <span class="token key atrule">notify</span><span class="token punctuation">:</span>  restart service3


  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restart service3
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=rabbitmq<span class="token punctuation">-</span>server state=restarted 


<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> two tasks
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> run rabbitmq.sh 
      <span class="token key atrule">script</span><span class="token punctuation">:</span> rabbitmq.sh 
      <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_fqdn ==  <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token string">&quot;item&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> 
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> node2 
        <span class="token punctuation">-</span> node3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-\u6267\u884C\u811A\u672C" tabindex="-1"><a class="header-anchor" href="#_6-\u6267\u884C\u811A\u672C" aria-hidden="true">#</a> 6.\u6267\u884C\u811A\u672C</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible rabbitmq<span class="token punctuation">]</span><span class="token comment"># ansible-playbook playbook.yaml  </span>

PLAY <span class="token punctuation">[</span>first tasks<span class="token punctuation">]</span> ******************************************************************************************************************************

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> **************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">172.25</span>.253.138<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">172.25</span>.253.139<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">172.25</span>.253.140<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>copy hosts<span class="token punctuation">]</span> *******************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">172.25</span>.253.138<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">172.25</span>.253.140<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">172.25</span>.253.139<span class="token punctuation">]</span>

\xB7
\xB7
\xB7

PLAY RECAP **************************************************************************************************************************************
<span class="token number">172.25</span>.253.138             <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">10</span>   <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">5</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
<span class="token number">172.25</span>.253.139             <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">10</span>   <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">5</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
<span class="token number">172.25</span>.253.140             <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">10</span>   <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">5</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-\u68C0\u67E5\u96C6\u7FA4\u72B6\u6001" tabindex="-1"><a class="header-anchor" href="#_7-\u68C0\u67E5\u96C6\u7FA4\u72B6\u6001" aria-hidden="true">#</a> 7.\u68C0\u67E5\u96C6\u7FA4\u72B6\u6001</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible rabbitmq<span class="token punctuation">]</span><span class="token comment"># ansible server -m shell -a &quot;rabbitmqctl cluster_status&quot;</span>
<span class="token number">172.25</span>.253.138 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
Cluster status of <span class="token function">node</span> rabbit@node1 <span class="token punctuation">..</span>.
<span class="token punctuation">[</span><span class="token punctuation">{</span>nodes,<span class="token punctuation">[</span><span class="token punctuation">{</span>disc,<span class="token punctuation">[</span>rabbit@node1<span class="token punctuation">]</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span>ram,<span class="token punctuation">[</span>rabbit@node3,rabbit@node2<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>running_nodes,<span class="token punctuation">[</span>rabbit@node2,rabbit@node3,rabbit@node1<span class="token punctuation">]</span><span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>cluster_name,<span class="token operator">&lt;&lt;</span><span class="token string">&quot;rabbit@node1&quot;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>partitions,<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">..</span>.done.
<span class="token number">172.25</span>.253.140 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
Cluster status of <span class="token function">node</span> rabbit@node3 <span class="token punctuation">..</span>.
<span class="token punctuation">[</span><span class="token punctuation">{</span>nodes,<span class="token punctuation">[</span><span class="token punctuation">{</span>disc,<span class="token punctuation">[</span>rabbit@node1<span class="token punctuation">]</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span>ram,<span class="token punctuation">[</span>rabbit@node3,rabbit@node2<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>running_nodes,<span class="token punctuation">[</span>rabbit@node1,rabbit@node2,rabbit@node3<span class="token punctuation">]</span><span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>cluster_name,<span class="token operator">&lt;&lt;</span><span class="token string">&quot;rabbit@node1&quot;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>partitions,<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">..</span>.done.
<span class="token number">172.25</span>.253.139 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
Cluster status of <span class="token function">node</span> rabbit@node2 <span class="token punctuation">..</span>.
<span class="token punctuation">[</span><span class="token punctuation">{</span>nodes,<span class="token punctuation">[</span><span class="token punctuation">{</span>disc,<span class="token punctuation">[</span>rabbit@node1<span class="token punctuation">]</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span>ram,<span class="token punctuation">[</span>rabbit@node3,rabbit@node2<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>running_nodes,<span class="token punctuation">[</span>rabbit@node1,rabbit@node3,rabbit@node2<span class="token punctuation">]</span><span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>cluster_name,<span class="token operator">&lt;&lt;</span><span class="token string">&quot;rabbit@node1&quot;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">}</span>,
 <span class="token punctuation">{</span>partitions,<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">..</span>.done.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111251209.png" alt="image-20211013202726146" loading="lazy"></p><h4 id="_8-\u8BB0\u5F55rabbitmq\u96C6\u7FA4\u7684\u66F4\u65B0" tabindex="-1"><a class="header-anchor" href="#_8-\u8BB0\u5F55rabbitmq\u96C6\u7FA4\u7684\u66F4\u65B0" aria-hidden="true">#</a> 8.\u8BB0\u5F55Rabbitmq\u96C6\u7FA4\u7684\u66F4\u65B0\uFF1A</h4><p>\u8FD9\u91CC\u6211\u4F7F\u7528\u7684\u662Ffetch\u548Cfile\u6A21\u5757\u5BF9rabbitmq\u96C6\u7FA4\u7684\u5BC6\u94A5\u8FDB\u884C\u4F20\u8F93</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible rabbit<span class="token punctuation">]</span><span class="token comment"># vim rabbit.yaml  </span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> rabbit
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> rm repofile
    <span class="token key atrule">shell</span><span class="token punctuation">:</span> rm <span class="token punctuation">-</span>rf /etc/yum.repos.d/*
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy repofile
    <span class="token key atrule">copy</span><span class="token punctuation">:</span>
      <span class="token key atrule">src</span><span class="token punctuation">:</span> local.repo
      <span class="token key atrule">dest</span><span class="token punctuation">:</span> /etc/yum.repos.d/
      <span class="token key atrule">backup</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tar repo.tar
    <span class="token key atrule">unarchive</span><span class="token punctuation">:</span>
      <span class="token key atrule">src</span><span class="token punctuation">:</span> rabbitmq<span class="token punctuation">-</span>repo.tar.gz
      <span class="token key atrule">dest</span><span class="token punctuation">:</span> /opt/
      <span class="token key atrule">remote_src</span><span class="token punctuation">:</span> no
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install rabbitmq
    <span class="token key atrule">yum</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> rabbitmq<span class="token punctuation">-</span>server
      <span class="token key atrule">state</span><span class="token punctuation">:</span> latest
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> service
    <span class="token key atrule">service</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> rabbitmq<span class="token punctuation">-</span>server
      <span class="token key atrule">state</span><span class="token punctuation">:</span> started
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> fetch
    <span class="token key atrule">fetch</span><span class="token punctuation">:</span>
      <span class="token key atrule">dest</span><span class="token punctuation">:</span> /root/rabbit/
      <span class="token key atrule">src</span><span class="token punctuation">:</span>  /var/lib/rabbitmq/.erlang.cookie
      <span class="token key atrule">flat</span><span class="token punctuation">:</span> yes
    <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_fqdn == &quot;node<span class="token punctuation">-</span>1&quot;
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy erlang.conf
    <span class="token key atrule">copy</span><span class="token punctuation">:</span>
      <span class="token key atrule">src</span><span class="token punctuation">:</span> /root/rabbit/.erlang.cookie
      <span class="token key atrule">dest</span><span class="token punctuation">:</span> /var/lib/rabbitmq/.erlang.cookie
    <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_fqdn ==  <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token string">&quot;item&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>      
    <span class="token key atrule">with_items</span><span class="token punctuation">:</span>  
      <span class="token punctuation">-</span> node<span class="token punctuation">-</span><span class="token number">2</span> 
      <span class="token punctuation">-</span> node<span class="token punctuation">-</span><span class="token number">3</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> chmod
    <span class="token key atrule">file</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/lib/rabbitmq/.erlang.cookie
      <span class="token key atrule">owner</span><span class="token punctuation">:</span> rabbitmq
      <span class="token key atrule">group</span><span class="token punctuation">:</span> rabbitmq

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,13);function y(f,q){const e=i("ExternalLinkIcon");return l(),o("div",null,[u,n("h4",r,[d,s(),n("a",k,[s("3.\u7F16\u5199scp.sh"),t(e)])]),b,n("h4",v,[m,s(),n("a",h,[s("4.\u7F16\u5199rabbitmq.sh"),t(e)])]),g])}const w=p(c,[["render",y],["__file","9.html.vue"]]);export{w as default};
