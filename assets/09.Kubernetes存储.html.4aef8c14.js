import{_ as p}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as l,c as o,a as n,b as s,d as e,f as t,r as i}from"./app.ca0279c0.js";const c={},u=t(`<h1 id="kubernetes\u5B58\u50A8" tabindex="-1"><a class="header-anchor" href="#kubernetes\u5B58\u50A8" aria-hidden="true">#</a> Kubernetes\u5B58\u50A8</h1><h2 id="\u4E3A\u4EC0\u4E48\u9700\u8981\u5B58\u50A8\u5377" tabindex="-1"><a class="header-anchor" href="#\u4E3A\u4EC0\u4E48\u9700\u8981\u5B58\u50A8\u5377" aria-hidden="true">#</a> \u4E3A\u4EC0\u4E48\u9700\u8981\u5B58\u50A8\u5377\uFF1F</h2><ul><li><p><strong>\u5BB9\u5668\u90E8\u7F72\u8FC7\u7A0B\u4E2D\u4E00\u822C\u6709\u4EE5\u4E0B\u4E09\u79CD\u6570\u636E\uFF1A</strong></p></li><li><p><strong>\u542F\u52A8\u65F6\u9700\u8981\u7684\u521D\u59CB\u6570\u636E\uFF0C\u4F8B\u5982\u914D\u7F6E\u6587\u4EF6</strong></p></li><li><p><strong>\u542F\u52A8\u8FC7\u7A0B\u4E2D\u4EA7\u751F\u7684\u4E34\u65F6\u6570\u636E\uFF0C\u8BE5\u4E34\u65F6\u6570\u636E\u9700\u8981\u591A\u4E2A\u5BB9\u5668\u95F4\u5171\u4EAB</strong></p></li><li><p><strong>\u542F\u52A8\u8FC7\u7A0B\u4E2D\u4EA7\u751F\u7684\u6301\u4E45\u5316\u6570\u636E\uFF0C\u4F8B\u5982MySQL\u7684data\u76EE\u5F55</strong></p><img src="https://pic.imgdb.cn/item/61ebef7f2ab3f51d9116771f.png" style="zoom:67%;"></li></ul><h2 id="\u6570\u636E\u5377\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u5377\u6982\u8FF0" aria-hidden="true">#</a> \u6570\u636E\u5377\u6982\u8FF0</h2><ul><li><p><code>Kubernetes\u4E2D\u7684Volume\u63D0\u4F9B\u4E86\u5728\u5BB9\u5668\u4E2D\u6302\u8F7D\u5916\u90E8\u5B58\u50A8\u7684\u80FD\u529B</code></p></li><li><p>Pod\u9700\u8981\u8BBE\u7F6E\u5377\u6765\u6E90\uFF08spec.volume\uFF09\u548C\u6302\u8F7D\u70B9\uFF08spec.containers.volumeMounts\uFF09\u4E24\u4E2A\u4FE1\u606F\u540E\u624D\u53EF\u4EE5\u4F7F\u7528\u76F8\u5E94\u7684Volume</p></li><li><p>\u4F7F\u7528\u6570\u636E\u5377\u7684\u6D41\u7A0B\uFF1A\u955C\u50CF\u91CC\u7A0B\u5E8F\u5199\u7684\u76EE\u5F55 &gt; mountPath &gt; \u5F15\u7528\u7684volumes\u5BF9\u5E94\u7684name &gt; \u76F8\u5173\u5377\u7684\u914D\u7F6E</p></li><li><p><strong>\u5E38\u7528\u7684\u6570\u636E\u5377\uFF1A</strong></p><ul><li><p>\u672C\u5730\uFF08hostPath\uFF0CemptyDir\uFF09</p></li><li><p>\u7F51\u7EDC\uFF08NFS\uFF0CCeph\uFF0CGlusterFS\uFF09</p></li><li><p>\u516C\u6709\u4E91\uFF08AWS EBS\uFF09</p></li><li><p>K8S\u8D44\u6E90\uFF08configmap\uFF0Csecret\uFF09</p></li></ul></li></ul><h2 id="\u4E34\u65F6\u5B58\u50A8\u5377-emptydir" tabindex="-1"><a class="header-anchor" href="#\u4E34\u65F6\u5B58\u50A8\u5377-emptydir" aria-hidden="true">#</a> \u4E34\u65F6\u5B58\u50A8\u5377\uFF1AemptyDir</h2><ul><li><p><strong>emptyDir\u5377\uFF1A</strong></p><ul><li><strong>\u662F\u4E00\u4E2A\u4E34\u65F6\u5B58\u50A8\u5377\uFF0C\u4E0EPod\u751F\u547D\u5468\u671F\u7ED1\u5B9A\u4E00\u8D77\uFF0C\u5982\u679C Pod\u5220\u9664\u4E86\u5377\u4E5F\u4F1A\u88AB\u5220\u9664\u3002</strong></li><li><strong>\u5171\u4EAB\u76EE\u5F55\u662F\u5728Pod\u7684\u6240\u5728\u8282\u70B9\u521B\u5EFA\u7684\u3002</strong></li></ul></li><li><p><strong>\u5E94\u7528\u573A\u666F\uFF1A</strong></p><ul><li><code>Pod\u4E2D\u5BB9\u5668\u4E4B\u95F4\u6570\u636E\u5171\u4EAB</code></li><li><code>sideacer\uFF08\u8FB9\u8F66\uFF09</code></li><li><code>initcontainer\uFF08\u521D\u59CB\u5BB9\u5668\uFF09</code></li></ul></li></ul><blockquote><p><strong>emptyDir\u7684\u7528\u6CD5</strong></p></blockquote><ul><li><p><strong>\u4F7F\u7528emptyDir\u7684\u4E34\u65F6\u5B58\u50A8\u5377\u6D4B\u8BD5Pod\u4E4B\u95F4</strong></p></li><li><p><strong>\u4E00\u4E2APod\u662F\u5199\u51651\u5230100\u5230hello\u6587\u4EF6\uFF0C\u53E6\u5916\u4E00\u4E2APod\u662F\u8BFB\u53D6\uFF0C\u4ED6\u4EEC\u4E4B\u95F4\u4F7F\u7528\u4E34\u65F6\u5377\u5171\u4EAB</strong></p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> write					<span class="token comment">#\u5BB9\u5668\u4E00\u662F\u5199\u5165														</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;bash&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;for i in {1..100};do echo $i &gt;&gt; /data/hello;sleep 1;done&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> centos
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>				<span class="token comment">#\u6570\u636E\u5377\u7684\u6302\u8F7D</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> data				<span class="token comment">#\u6570\u636E\u5377\u7ED1\u5B9A\u7684\u540D\u79F0</span>
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data		<span class="token comment">#\u4F7F\u7528\u8DEF\u5F84\u6302\u8F7D\u5728\u5BB9\u5668\u5185\u90E8</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> read					<span class="token comment">#\u5BB9\u5668\u4E8C\u662F\u8BFB\u53D6</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;bash&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tail -f /data/hello&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> centos
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> data
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data

  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>						<span class="token comment">#\u6570\u636E\u5377\u5B9A\u4E49</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> data					<span class="token comment">#\u6570\u636E\u5377\u6307\u5B9A\u4E00\u4E2A\u540D\u79F0</span>
    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>				<span class="token comment">#\u6570\u636E\u5377\u7684\u7C7B\u578B</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>\u67E5\u770BPod\u8FD0\u884C\u5728\u54EA\u4E2A\u8282\u70B9\u4E0A\u9762</strong></p></li><li><p><strong>\u8FD9\u91CC\u663E\u793A\u662F\u5728Node1\u8282\u70B9\u4E0A\u9762\uFF0C\u53EF\u4EE5\u53BBNode1\u4E0A\u67E5\u770B</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods  -o wide</span>
NAME     READY   STATUS    RESTARTS   AGE     IP               NODE    NOMINATED NODE   READINESS GATES
my-pod   <span class="token number">2</span>/2     Running   <span class="token number">1</span>          2m42s   <span class="token number">10.244</span>.166.131   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u5728node1\u8282\u70B9\u67E5\u770B\u5BB9\u5668\u8FD0\u884C\u7684\u8FDB\u7A0B</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># docker ps | grep my-pod </span>
4d0d67966468   centos                                               <span class="token string">&quot;bash -c &#39;tail -f /d\u2026&quot;</span>   About a minute ago   Up About a minute             k8s_read_my-pod_default_4a359535-0bea-4231-9ac7-e7b0d91afb74_0 <span class="token comment">#\u8FD9\u91CC\u7684\u540E\u9762\u7684id\u5C31\u662F\u6570\u636E\u5377\u5B58\u50A8\u7684\u76EE\u5F55</span>
60cdb7fa3d29   centos                                               <span class="token string">&quot;bash -c &#39;for i in {\u2026&quot;</span>   About a minute ago   Up About a minute             k8s_writemy-pod_default_4a359535-0bea-4231-9ac7-e7b0d91afb74_0
1c898733272d   registry.aliyuncs.com/google_containers/pause:3.2    <span class="token string">&quot;/pause&quot;</span>                 About a minute ago   Up About a minute             k8s_POD_my-pod_default_4a359535-0bea-4231-9ac7-e7b0d91afb74_0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u67E5\u627E\u6570\u636E\u5377\u6620\u5C04\u7684\u76EE\u5F55</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># cd /var/lib/kubelet/pods/</span>
<span class="token punctuation">[</span>root@node1 pods<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">12</span>
drwxr-x--- <span class="token number">5</span> root root <span class="token number">4096</span> Nov  <span class="token number">5</span> 00:24 4a359535-0bea-4231-9ac7-e7b0d91afb74   <span class="token comment">#\u7B2C\u4E00\u4E2A\u5C31\u662F\u8FD9\u4E2APod</span>
drwxr-x--- <span class="token number">5</span> root root <span class="token number">4096</span> Nov  <span class="token number">4</span> <span class="token number">23</span>:31 b08e29c6-ba4b-4416-89e2-48df0a101535
drwxr-x--- <span class="token number">5</span> root root <span class="token number">4096</span> Nov  <span class="token number">4</span> <span class="token number">23</span>:32 b98cfa42-b9c9-47db-a0d7-2aeb468a24d1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node1 pods<span class="token punctuation">]</span><span class="token comment"># cd 4a359535-0bea-4231-9ac7-e7b0d91afb74/volumes/kubernetes.io~empty-dir/</span>
<span class="token punctuation">[</span>root@node1 kubernetes.io~empty-dir<span class="token punctuation">]</span><span class="token comment"># ls </span>
data															<span class="token comment">#\u8FD9\u4E2Adata\u5C31\u662F\u8BE5Pod\u8FDB\u884C\u7684\u6570\u636E\u5377\u5171\u4EAB\u7684\u76EE\u5F55</span>
<span class="token punctuation">[</span>root@node1 kubernetes.io~empty-dir<span class="token punctuation">]</span><span class="token comment"># cd data/</span>
<span class="token punctuation">[</span>root@node1 data<span class="token punctuation">]</span><span class="token comment"># ls</span>
hello               
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u8282\u70B9\u5B58\u50A8\u5377-hostpath" tabindex="-1"><a class="header-anchor" href="#\u8282\u70B9\u5B58\u50A8\u5377-hostpath" aria-hidden="true">#</a> <strong>\u8282\u70B9\u5B58\u50A8\u5377\uFF1AhostPath</strong></h2><ul><li><p><strong>hostPath\u5377\uFF1A</strong></p><ul><li><strong>\u6302\u8F7DNode\u6587\u4EF6\u7CFB\u7EDF\uFF08Pod\u6240\u5728\u8282\u70B9\uFF09\u4E0A\u6587\u4EF6\u6216\u8005\u76EE \u5F55\u5230Pod\u4E2D\u7684\u5BB9\u5668\u3002</strong></li></ul></li><li><p><strong>\u5E94\u7528\u573A\u666F\uFF1A</strong></p><ul><li><strong>Pod\u4E2D\u5BB9\u5668\u9700\u8981\u8BBF\u95EE\u5BBF\u4E3B\u673A\u6587\u4EF6</strong></li><li><strong>\u6211\u7684\u5E94\u7528\u7A0B\u5E8F\u60F3\u8BFB\u53D6\u7CFB\u7EDF\u7684\u67D0\u4E2A\u6587\u4EF6</strong></li></ul></li></ul><blockquote><p><strong>hostPath\u7684\u7528\u6CD5</strong></p></blockquote><ul><li><p><strong>\u4F7F\u7528\u6302\u8F7D\u5BBF\u4E3B\u673A\u7684/tmp\u7684\u76EE\u5F55</strong></p></li><li><p><strong>\u5BB9\u5668\u6302\u8F7D\u5728/data\u76EE\u5F55\u4E0B</strong></p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat hostpath.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">args</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /bin/sh
    <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
    <span class="token punctuation">-</span> sleep 36000
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>			<span class="token comment">#\u6302\u8F7D\u5728\u5BB9\u5668\u7684\u6570\u636E\u5377</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> data			<span class="token comment">#\u6307\u5B9A\u5B9A\u4E49\u540D\u79F0</span>
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data		<span class="token comment">#\u6302\u8F7D\u5728\u5BB9\u5668\u7684/data\u4F4D\u7F6E</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>					<span class="token comment">#\u6307\u5B9A\u6570\u636E\u5377\u7684\u6765\u6E90</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> data				<span class="token comment">#\u6307\u5B9A\u5B9A\u4E49\u540D\u79F0</span>
    <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /tmp			<span class="token comment">#\u6307\u5B9A\u6570\u636E\u5377\u6E90\u76EE\u5F55</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> Directory		<span class="token comment">#\u6307\u5B9A\u6570\u636E\u5377\u7C7B\u578B</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u8FDB\u5165\u5BB9\u5668\u67E5\u770B/data\u4E0B\u9762\u662F\u5426\u6709\u6570\u636E</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master tmp<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it my-pod  -- sh</span>
/ <span class="token comment"># cd /data/</span>
/data <span class="token comment"># ls</span>
hsperfdata_root
systemd-private-55c453af06944c75a71a7703af924fc9-chronyd.service-re7Kjy
wrapper-619-1-in
wrapper-619-1-out
/data <span class="token comment"># touch  a.tzxt   #\u521B\u5EFA\u4E00\u4E2A\u6587\u4EF6</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>\u67E5\u770B\u8BE5Pod\u662F\u8FD0\u884C\u5728\u54EA\u4E00\u4E2A\u8282\u70B9\u4E0A\u9762</strong></p></li><li><p><strong>\u67E5\u770B\u8BE5\u8282\u70B9\u7684/tmp\u4E0B\u9762\u662F\u5426\u6709\u6211\u521B\u5EFA\u7684\u6587\u4EF6</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master tmp<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide</span>
NAME     READY   STATUS    RESTARTS   AGE   IP               NODE    NOMINATED NODE   READINESS GATES
my-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          14m   <span class="token number">10.244</span>.166.132   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># cd /tmp/</span>
<span class="token punctuation">[</span>root@node1 tmp<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">8</span>
-rw-r--r-- <span class="token number">1</span> root root    <span class="token number">0</span> Nov  <span class="token number">5</span> 00:53 a.tzxt
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Nov  <span class="token number">4</span> <span class="token number">21</span>:39 hsperfdata_root
drwx------ <span class="token number">3</span> root root <span class="token number">4096</span> Nov  <span class="token number">4</span> <span class="token number">21</span>:38 systemd-private-55c453af06944c75a71a7703af924fc9-chronyd.service-re7Kjy
prw-r--r-- <span class="token number">1</span> root root    <span class="token number">0</span> Nov  <span class="token number">5</span> 00:56 wrapper-619-1-in
prw-r--r-- <span class="token number">1</span> root root    <span class="token number">0</span> Nov  <span class="token number">5</span> 00:56 wrapper-619-1-out
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u7F51\u7EDC\u5B58\u50A8\u5377-nfs" tabindex="-1"><a class="header-anchor" href="#\u7F51\u7EDC\u5B58\u50A8\u5377-nfs" aria-hidden="true">#</a> \u7F51\u7EDC\u5B58\u50A8\u5377: NFS</h2><ul><li><p><code>Kubernetes\u7684NFS\u5B58\u50A8\u7528\u4E8E\u5C06\u67D0\u4E8B\u5148\u5B58\u5728\u7684NFS\u670D\u52A1\u5668\u5BFC\u51FAexport\u7684\u5B58\u50A8\u7A7A\u95F4\u6302\u8F7D\u5230Pod\u4E2D\u6765\u4F9BPod\u5BB9\u5668\u4F7F\u7528\u3002</code></p></li><li><p>\u4E0EemptyDir\u4E0D\u540C\u7684\u662F\uFF0CNFS\u5B58\u50A8\u5728Pod\u5BF9\u8C61\u7EC8\u6B62\u540E\u4EC5\u662F\u88AB\u5378\u8F7D\u800C\u975E\u5220\u9664\u3002\u53E6\u5916\uFF0CNFS\u662F\u6587\u4EF6\u7CFB\u7EDF\u53CA\u5171\u4EAB\u670D\u52A1\uFF0C\u5B83\u652F\u6301\u540C\u65F6\u5B58\u5728\u591A\u8DEF\u6302\u8F7D\u8BF7\u6C42\u3002</p></li><li><p><strong>\u4F7F\u7528nfs\u6570\u636E\u5377\u76EE\u6807\uFF1A</strong></p><ul><li>pod\u542F\u52A8\u4E4B\u540E\u4EA7\u751F\u7684\u6570\u636E\u6301\u4E45\u5316\u5230\u8FDC\u7A0B\u5B58\u50A8</li><li>pod\u591A\u526F\u672C\u5171\u4EAB\u6570\u636E</li></ul></li><li><p><strong>\u5B9A\u4E49NFS\u5B58\u50A8\u65F6\uFF0C\u5E38\u7528\u5230\u4EE5\u4E0B\u5B57\u6BB5\u3002</strong></p><ul><li><code>server</code> \uFF1ANFS\u670D\u52A1\u5668\u7684IP\u5730\u5740\u6216\u8005\u4E3B\u673A\u540D\uFF0C\u5FC5\u9009\u5B57\u6BB5\u3002</li><li><code>path</code> \uFF1ANFS\u670D\u52A1\u5668\u5BFC\u51FA(\u5171\u4EAB)\u7684\u6587\u4EF6\u7CFB\u7EDF\u8DEF\u5F84\uFF0C\u5FC5\u9009\u5B57\u6BB5\u3002</li><li><code>readOnly</code> \uFF1A\u662F\u5426\u4EE5\u53EA\u8BFB\u6302\u8F7D\uFF0C\u9ED8\u8BA4\u4E3Afalse\u3002</li></ul></li></ul><blockquote><p><strong>NFS\u6301\u4E45\u5316\u7684\u7528\u6CD5</strong></p></blockquote><ul><li><strong>\u5728node1\u4E0A\u5B89\u88C5NFS\u670D\u52A1\u7AEF</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># yum install -y nfs-utils </span>
<span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># echo &quot;/nfs/kubernetes *(rw,no_root_squash)&quot; &gt; /etc/exports</span>
<span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /nfs/kubernetes</span>
<span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart rpcbind &amp;&amp; systemctl restart nfs </span>
<span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># echo &quot;666&quot; &gt; index.html /nfs/kubernetes</span>
<span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># showmount -e 192.168.1.88</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u914D\u7F6E\u8BF4\u660E\uFF1A</strong></p><p><code>/data/k8s\uFF1A</code> \u662F\u5171\u4EAB\u7684\u6570\u636E\u2F6C\u5F55** <code>* \uFF1A</code> \u8868\u793A\u4EFB\u4F55\u2F08\u90FD\u6709\u6743\u9650\u8FDE\u63A5\uFF0C\u5F53\u7136\u4E5F\u53EF\u4EE5\u662F\u2F00\u4E2A\u2F79\u6BB5\uFF0C\u2F00\u4E2A IP\uFF0C\u4E5F\u53EF\u4EE5\u662F\u57DF\u540D** <code>rw\uFF1A</code> \u8BFB\u5199\u7684\u6743\u9650** <code>sync\uFF1A</code> \u8868\u793A\u2F42\u4EF6\u540C\u65F6\u5199\u2F0A\u786C\u76D8\u548C\u5185\u5B58** <code>no_root_squash\uFF1A</code> \u5F53\u767B\u5F55 NFS \u4E3B\u673A\u4F7F\u2F64\u5171\u4EAB\u2F6C\u5F55\u7684\u4F7F\u2F64\u8005\u662F root \u65F6\uFF0C\u5176\u6743\u9650\u5C06\u88AB\u8F6C\u6362\u6210\u4E3A\u533F\u540D\u4F7F\u2F64\u8005\uFF0C\u901A\u5E38\u5B83\u7684 UID \u4E0E GID\uFF0C\u90FD\u4F1A\u53D8\u6210 nobody \u8EAB\u4EFD</p><ul><li>\u5728master\u8282\u70B9\u4E0A\u5B89\u88C5NFS\u670D\u52A1\u7AEF</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># yum install -y nfs-utils </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart rpcbind &amp;&amp; systemctl restart nfs </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mount -t nfs 192.168.1.88:/nfs/kubernetes /mnt/ </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u521B\u5EFA\u4E00\u4E2Apod\u63A7\u5236\u5668\u4F7F\u7528\u7F51\u7EDC\u5171\u4EABNFS\u5B58\u50A8\u6302\u8F7D</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment nginx --image=nginx --port=80 --dry-run -o yaml &gt; deployment.yaml </span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat deployment.yaml  </span>
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: <span class="token number">1</span>
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - image: nginx
        name: nginx
        ports:
        - containerPort: <span class="token number">80</span>
        volumeMounts: 
        - name: wwwroot 
          mountPath: /usr/share/nginx/html 
      volumes: 
      - name: wwwroot 
        nfs: 
          server: <span class="token number">192.168</span>.1.95
          path: /nfs/kubernetes
          
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f  deployment.yaml  </span>
deployment.apps/nginx created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u68C0\u67E5nfs\u5B58\u50A8\u662F\u5426\u751F\u6548</li><li>\u53D1\u73B0\u5BB9\u5668\u5185\u6302\u8F7D\u5728/usr/share/nginx/html\u4E0B\u9762\u7684index.html\u6B63\u662F\u6240\u5199\u5165\u5F97\u5230\u5185\u5BB9</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it nginx-cfb45c844-8zcqh bash</span>
kubectl <span class="token builtin class-name">exec</span> <span class="token punctuation">[</span>POD<span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> is DEPRECATED and will be removed <span class="token keyword">in</span> a future version. Use kubectl <span class="token builtin class-name">exec</span> <span class="token punctuation">[</span>POD<span class="token punctuation">]</span> -- <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> instead.
root@nginx-cfb45c844-8zcqh:/<span class="token comment"># cd /usr/share/nginx/html/</span>
root@nginx-cfb45c844-8zcqh:/usr/share/nginx/html<span class="token comment"># ls</span>
index.html
root@nginx-cfb45c844-8zcqh:/usr/share/nginx/html<span class="token comment"># cat index.html </span>
<span class="token number">6666</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u66B4\u9732\u8BE5\u7AEF\u53E3\u4F7F\u7528Nodeport\u8BBF\u95EE</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl expose deployment nginx --port=80 --target-port=80 --type=NodePort</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get service </span>
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP        115m
nginx        NodePort    <span class="token number">10.110</span>.18.210   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:30354/TCP   35m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6301\u4E45\u5377-pv\u4E0Epvc" tabindex="-1"><a class="header-anchor" href="#\u6301\u4E45\u5377-pv\u4E0Epvc" aria-hidden="true">#</a> \u6301\u4E45\u5377\uFF1APV\u4E0EPVC</h2><p><strong>\u6301\u4E45\u5377\u7684\u6982\u8FF0\uFF1A</strong></p><ul><li><p><code>PersistentVolume\uFF08PV\uFF09</code>\uFF1A\u5BF9\u5B58\u50A8\u8D44\u6E90\u521B\u5EFA\u548C\u4F7F\u7528\u7684\u62BD\u8C61\uFF0C\u4F7F\u5F97\u5B58\u50A8\u4F5C\u4E3A\u96C6\u7FA4\u4E2D\u7684\u8D44\u6E90\u7BA1\u7406</p></li><li><p><code>PersistentVolumeClaim\uFF08PVC\uFF09</code>\uFF1A\u8BA9\u7528\u6237\u4E0D\u9700\u8981\u5173\u5FC3\u5177\u4F53\u7684Volume\u5B9E\u73B0\u7EC6\u8282</p></li></ul>`,45),r={href:"https://kubernetes.io/zh/docs/concepts/storage/storage-classes/",target:"_blank",rel:"noopener noreferrer"},d=t(`<p>\u200B\u6301\u4E45\u5377\u7533\u9886\uFF08PersistentVolumeClaim\uFF0CPVC\uFF09\u8868\u8FBE\u7684\u662F\u7528\u6237\u5BF9\u5B58\u50A8\u7684\u8BF7\u6C42\u3002\u6982\u5FF5\u4E0A\u4E0E Pod \u7C7B\u4F3C\u3002 Pod \u4F1A\u8017\u7528\u8282\u70B9\u8D44\u6E90\uFF0C\u800C PVC \u7533\u9886\u4F1A\u8017\u7528 PV \u8D44\u6E90\u3002Pod \u53EF\u4EE5\u8BF7\u6C42\u7279\u5B9A\u6570\u91CF\u7684\u8D44\u6E90\uFF08CPU \u548C\u5185\u5B58\uFF09\uFF1B\u540C\u6837 PVC \u7533\u9886\u4E5F\u53EF\u4EE5\u8BF7\u6C42\u7279\u5B9A\u7684\u5927\u5C0F\u548C\u8BBF\u95EE\u6A21\u5F0F \uFF08\u4F8B\u5982\uFF0C\u53EF\u4EE5\u8981\u6C42 PV \u5377\u80FD\u591F\u4EE5 ReadWriteOnce\u3001ReadOnlyMany \u6216 ReadWriteMany \u6A21\u5F0F\u4E4B\u4E00\u6765\u6302\u8F7D</p><h2 id="pv\u751F\u547D\u5468\u671F" tabindex="-1"><a class="header-anchor" href="#pv\u751F\u547D\u5468\u671F" aria-hidden="true">#</a> PV\u751F\u547D\u5468\u671F</h2><img src="https://pic.imgdb.cn/item/61ebf35f2ab3f51d911a4384.png" style="zoom:67%;"><blockquote><p><strong>Capacity\uFF08\u5B58\u50A8\u80FD\u2F12\uFF09</strong></p></blockquote><p>\u2F00\u822C\u6765\u8BF4\uFF0C\u2F00\u4E2A PV \u5BF9\u8C61\u90FD\u8981\u6307\u5B9A\u2F00\u4E2A\u5B58\u50A8\u80FD\u2F12\uFF0C\u901A\u8FC7 PV \u7684 capacity\u5C5E\u6027\u6765\u8BBE\u7F6E\u7684\uFF0C\u2F6C\u524D\u53EA\u2F40\u6301\u5B58\u50A8 \u7A7A\u95F4\u7684\u8BBE\u7F6E\uFF0C\u5C31\u662F\u6211\u4EEC\u8FD9\u2FA5\u7684 storage=1Gi\uFF0C\u4E0D\u8FC7\u672A\u6765\u53EF\u80FD\u4F1A\u52A0\u2F0A IOPS\u3001\u541E\u5410\u91CF\u7B49\u6307\u6807\u7684\u914D\u7F6E\u3002</p><blockquote><p><strong>AccessModes\uFF08\u8BBF\u95EE\u6A21\u5F0F\uFF09</strong></p></blockquote><p>AccessModes \u662F\u2F64\u6765\u5BF9 PV \u8FDB\u2F8F\u8BBF\u95EE\u6A21\u5F0F\u7684\u8BBE\u7F6E\uFF0C\u2F64\u4E8E\u63CF\u8FF0\u2F64\u6237\u5E94\u2F64\u5BF9\u5B58\u50A8\u8D44\u6E90\u7684\u8BBF\u95EE\u6743\u9650\uFF0C\u8BBF\u95EE\u6743 \u9650\u5305\u62EC\u4E0B\u2FAF\u2F0F\u79CD\u2F45\u5F0F\uFF1A*</p><ul><li><code>ReadWriteOnce\uFF08RWO\uFF09</code>\uFF1A\u8BFB\u5199\u6743\u9650\uFF0C\u4F46\u662F\u53EA\u80FD\u88AB\u5355\u4E2A\u8282\u70B9\u6302\u8F7D</li><li><code>ReadOnlyMany\uFF08ROX\uFF09</code>\uFF1A\u53EA\u8BFB\u6743\u9650\uFF0C\u53EF\u4EE5\u88AB\u591A\u4E2A\u8282\u70B9\u6302\u8F7D</li><li><code>ReadWriteMany\uFF08RWX\uFF09</code>\uFF1A\u8BFB\u5199\u6743\u9650\uFF0C\u53EF\u4EE5\u88AB\u591A\u4E2A\u8282\u70B9\u6302\u8F7D</li><li><code>\u6CE8\u610F</code>\uFF1A\u2F00\u4E9B PV \u53EF\u80FD\u2F40\u6301\u591A\u79CD\u8BBF\u95EE\u6A21\u5F0F\uFF0C\u4F46\u662F\u5728\u6302\u8F7D\u7684\u65F6\u5019\u53EA\u80FD\u4F7F\u2F64\u2F00\u79CD\u8BBF\u95EE\u6A21\u5F0F\uFF0C\u591A\u79CD\u8BBF\u95EE\u6A21 \u5F0F\u662F\u4E0D\u4F1A\u2F63\u6548\u7684\u3002</li></ul><blockquote><p><strong>persistentVolumeReclaimPolicy\uFF08\u56DE\u6536\u7B56\u7565\uFF09</strong></p></blockquote><p><strong>\u6211\u8FD9\u2FA5\u6307\u5B9A\u7684 PV \u7684\u56DE\u6536\u7B56\u7565\u4E3A Recycle\uFF0C\u2F6C\u524D PV \u2F40\u6301\u7684\u7B56\u7565\u6709\u4E09\u79CD\uFF1A</strong></p><ul><li><code>Retain\uFF08\u4FDD\u7559\uFF09</code> \u4FDD\u7559\u6570\u636E\uFF0C\u9700\u8981\u7BA1\u7406\u5458\u2F3F\u2F2F\u6E05\u7406\u6570\u636E</li><li><code>Recycle\uFF08\u56DE\u6536\uFF09</code> \u6E05\u9664 PV \u4E2D\u7684\u6570\u636E\uFF0C\u6548\u679C\u76F8\u5F53\u4E8E\u6267\u2F8F <code>rm -rf /thevoluem/* </code></li><li><code>Delete\uFF08\u5220\u9664\uFF09</code> \u4E0E PV \u76F8\u8FDE\u7684\u540E\u7AEF\u5B58\u50A8\u5B8C\u6210 volume \u7684\u5220\u9664\u64CD\u4F5C\uFF0C\u5F53\u7136\u8FD9\u5E38\u2EC5\u4E8E\u4E91\u670D\u52A1\u5546\u7684\u5B58\u50A8 \u670D\u52A1\uFF0C\u2F50\u5982 ASW EBS\u3002</li><li>\u4E0D\u8FC7\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u2F6C\u524D\u53EA\u6709 NFS \u548C HostPath \u4E24\u79CD\u7C7B\u578B\u2F40\u6301\u56DE\u6536\u7B56\u7565\u3002\u5F53\u7136\u2F00\u822C\u6765\u8BF4\u8FD8\u662F\u8BBE\u7F6E\u4E3A Retain \u8FD9\u79CD\u7B56\u7565\u4FDD\u9669\u2F00\u70B9\u3002</li></ul><blockquote><p><strong>PV\u7684\u751F\u547D\u5468\u671F\u72B6\u6001</strong></p></blockquote><p>\u2F00\u4E2A PV \u7684\u2F63\u547D\u5468\u671F\u4E2D\uFF0C\u53EF\u80FD\u4F1A\u5904\u4E8E4\u4E2D\u4E0D\u540C\u7684\u9636\u6BB5\uFF1A</p><ul><li><code>Available\uFF08\u53EF\u2F64\uFF09\uFF1A</code> \u8868\u793A\u53EF\u2F64\u72B6\u6001\uFF0C\u8FD8\u672A\u88AB\u4EFB\u4F55 PVC \u7ED1\u5B9A</li><li><code>Bound\uFF08\u5DF2\u7ED1\u5B9A\uFF09\uFF1A</code> \u8868\u793A PVC \u5DF2\u7ECF\u88AB PVC \u7ED1\u5B9A</li><li><code>Released\uFF08\u5DF2\u91CA\u653E\uFF09\uFF1A</code> PVC \u88AB\u5220\u9664\uFF0C\u4F46\u662F\u8D44\u6E90\u8FD8\u672A\u88AB\u96C6\u7FA4\u91CD\u65B0\u58F0\u660E</li><li><code>Failed\uFF08\u5931\u8D25\uFF09\uFF1A</code> \u8868\u793A\u8BE5 PV \u7684\u2F83\u52A8\u56DE\u6536\u5931\u8D25</li></ul><h2 id="pv\u4E0Epvc\u4F7F\u7528\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#pv\u4E0Epvc\u4F7F\u7528\u6D41\u7A0B" aria-hidden="true">#</a> PV\u4E0EPVC\u4F7F\u7528\u6D41\u7A0B</h2><blockquote><p><strong>Pv\u7684\u4F7F\u7528</strong></p></blockquote><ul><li><p><strong><code>\u6709\u4E86\u4E0A\u2FAF\u7684 NFS \u5171\u4EAB\u5B58\u50A8\uFF0C\u4E0B\u2FAF\u6211\u4EEC\u5C31\u53EF\u4EE5\u6765\u4F7F\u2F64 PV \u548C PVC \u4E86\u3002</code></strong></p></li><li><p>PV \u4F5C\u4E3A\u5B58\u50A8\u8D44\u6E90\uFF0C\u4E3B\u8981\u5305\u62EC\u5B58\u50A8 \u80FD\u2F12\u3001\u8BBF\u95EE\u6A21\u5F0F\u3001\u5B58\u50A8\u7C7B\u578B\u3001\u56DE\u6536\u7B56\u7565\u7B49\u5173\u952E\u4FE1\u606F\uFF0C\u4E0B\u2FAF\u6211\u4EEC\u6765\u65B0\u5EFA\u2F00\u4E2APV\u5BF9\u8C61\uFF0C\u4F7F\u2F64nfs\u7C7B\u578B\u7684\u540E \u7AEF\u5B58\u50A8\uFF0C5G \u7684\u5B58\u50A8\u7A7A\u95F4\uFF0C\u8BBF\u95EE\u6A21\u5F0F\u4E3A ReadWriteOnce\uFF0C\u56DE\u6536\u7B56\u7565\u4E3A Recyle</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat pv.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pvc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>						<span class="token comment">#\u5B58\u50A8\u7A7A\u95F4</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 5Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>					<span class="token comment">#\u8BBF\u95EE\u6A21\u5F0F</span>
    <span class="token punctuation">-</span> ReadWriteOnce				<span class="token comment">#\u5355\u4E2A\u8282\u70B9\u6302\u8F7D\u7684\u8BFB\u5199\u6743\u9650</span>
  <span class="token key atrule">persistentVolumeReclaimPolicy</span><span class="token punctuation">:</span> Recycle
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /nfs/kubernetes
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.1.88
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pv.yaml </span>
persistentvolume/my-pvc created
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pv </span>
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
my-pvc   5Gi        RWO            Recycle          Available                                   4s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>PVC\u7684\u4F7F\u7528</strong></p><p>\u4F46\u662F\u5728\u6211\u4EEC\u771F\u6B63\u4F7F\u2F64\u7684\u65F6\u5019\u662F\u4F7F\u2F64\u7684 PVC\uFF0C\u5C31\u7C7B\u4F3C\u4E8E\u6211\u4EEC\u7684\u670D\u52A1\u662F\u901A \u8FC7 Pod \u6765\u8FD0\u2F8F\u7684\uFF0C\u2F7D\u4E0D\u662F Node\uFF0C\u53EA\u662F Pod \u8DD1\u5728 Node \u4E0A\u2F7D\u5DF2\uFF0C\u6240\u4EE5\u8FD9\u8282\u8BFE\u6211\u4EEC\u5C31\u6765\u7ED9\u2F24\u5BB6\u8BB2\u89E3\u4E0B PVC \u7684\u4F7F\u2F64\u2F45\u6CD5\u3002</p></blockquote><ul><li><strong>\u6211\u4EEC\u6765\u65B0\u5EFA\u2F00\u4E2A\u6570\u636E\u5377\u58F0\u660E\uFF0C\u6211\u4EEC\u6765\u8BF7\u6C42 5Gi \u7684\u5B58\u50A8\u5BB9\u91CF\uFF0C\u8BBF\u95EE\u6A21\u5F0F\u4E5F\u662F ReadWriteOnce</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat pvc.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pvc    
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>			<span class="token comment">#\u8BBE\u7F6E\u8D44\u6E90</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>			<span class="token comment">#\u8BF7\u6C42\u7684\u8D44\u6E90\u4E3A5Gi</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 5Gi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>\u6B64\u65F6\u7684pv\u548Cpvc\u90FD\u5C06\u53D8\u6210bound</code></strong></p></li><li><p><strong>\u56E0\u4E3Apv\u7684\u5B58\u50A8\u7A7A\u95F4\u88ABpvc\u7ED1\u5B9A\u6240\u6709\u663E\u793Abound\u88AB\u4F7F\u7528</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pvc.yaml  </span>
persistentvolumeclaim/my-pvc created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pvc </span>
NAME     STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
my-pvc   Bound    my-pvc   5Gi        RWO                           6s

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pv</span>
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM            STORAGECLASS   REASON   AGE
my-pvc   5Gi        RWO            Recycle          Bound    default/my-pvc                           42m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>\u521B\u5EFA\u4E00\u4E2APod\u4F7F\u7528PVC\u6301\u4E45\u5316</code></strong></p></li><li><p><strong>\u6307\u5B9A\u5BB9\u5668\u6302\u8F7D\u76EE\u5F55\u662F/usr/share/nginx/html</strong></p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span> 
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx 
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> www
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html 
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> www
      <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span> 
        <span class="token key atrule">claimName</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pvc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml  </span>
pod/my-pod created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME     READY   STATUS    RESTARTS   AGE
my-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          63s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>\u9A8C\u8BC1pvc\u662F\u5426\u80FD\u6B63\u5E38\u4F7F\u7528</strong></p></li><li><p><strong>\u8FDB\u5165my-pod\u7684\u5BB9\u5668\uFF0C\u521B\u5EFAindex.html\u7684\u6587\u4EF6</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it my-pod -- bash</span>
root@my-pod:/<span class="token comment"># cd /usr/share/nginx/html/</span>
root@my-pod:/usr/share/nginx/html<span class="token comment"># ls</span>
root@my-pod:/usr/share/nginx/html<span class="token comment"># echo 3333 &gt;&gt; index.html </span>
root@my-pod:/usr/share/nginx/html<span class="token comment"># exit </span>
<span class="token builtin class-name">exit</span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide </span>
NAME     READY   STATUS    RESTARTS   AGE    IP               NODE   NOMINATED NODE   READINESS GATES
my-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m7s   <span class="token number">10.244</span>.167.140   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># curl 10.244.167.140</span>
<span class="token number">3333</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>\u5728nfs\u7684\u670D\u52A1\u7AEF\u4E0A\u67E5\u770B</strong></p></li><li><p><strong>\u9A8C\u8BC1\u6210\u529F\uFF0C pvc\u7684\u6301\u4E45\u5316\u80FD\u591F\u6B63\u5E38\u4F7F\u7528</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># cd /nfs/kubernetes/</span>
<span class="token punctuation">[</span>root@node kubernetes<span class="token punctuation">]</span><span class="token comment"># ls </span>
index.html
<span class="token punctuation">[</span>root@node kubernetes<span class="token punctuation">]</span><span class="token comment"># cat index.html </span>
<span class="token number">3333</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pv\u4E0Epvc\u5E38\u89C1\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#pv\u4E0Epvc\u5E38\u89C1\u95EE\u9898" aria-hidden="true">#</a> PV\u4E0EPVC\u5E38\u89C1\u95EE\u9898</h2><p><strong>pv\u4E0Epvc\u5173\u7CFB\uFF1F</strong></p><ul><li><strong>\u4E00\u5BF9\u4E00\u7684\u5173\u7CFB\u4E92\u8054</strong></li></ul><p><strong>pv\u4E0Epvc\u600E\u4E48\u5339\u914D\u7684\uFF1F</strong></p><ul><li><strong><code>\u5B58\u50A8\u7A7A\u95F4</code></strong></li><li><strong><code>\u8BBF\u95EE\u6A21\u5F0F</code></strong></li></ul><p><strong>\u5BB9\u5668\u5339\u914D\u7B56\u7565\u662F\u600E\u4E48\u6837\u7684\uFF1F</strong></p><ul><li>\u5339\u914D\u6700\u63A5\u8FD1\u7684pv\u5BB9\u91CF</li><li>\u5982\u679C\u6EE1\u8DB3\u4E0D\u4E86\uFF0Cpod\u5904\u4E8Epending</li></ul><p><strong>\u5B58\u50A8\u7A7A\u95F4\u7684\u5B57\u6BB5\u662F\u9650\u5236\u4F7F\u7528\u5BB9\u91CF\uFF1F</strong></p><ul><li><strong><code>\u8FD9\u4E2A\u5B57\u6BB5\u4E3B\u8981\u7528\u4E8E\u505A\u5339\u914D\u7684\uFF0C\u5B9E\u9645\u4F7F\u7528\u9650\u5236\u53D6\u51B3\u4E8E\u540E\u7AEF\u5B58\u50A8</code></strong></li></ul><blockquote><p><strong>\u7B80\u800C\u8A00\u4E4B\uFF0C\u65E0\u72B6\u6001\u53EF\u4EE5\u7406\u89E3\u4E3A\uFF1A\u4E0D\u7528\u8003\u8651\u591A\u526F\u672C\u65F6\u4E4B\u95F4\u7684\u5173\u7CFB\u3001\u662F\u5426\u6709\u72EC\u7ACB\u5B58\u50A8\u7B49</strong></p></blockquote><h2 id="pv-\u52A8\u6001\u4F9B\u7ED9-storageclass" tabindex="-1"><a class="header-anchor" href="#pv-\u52A8\u6001\u4F9B\u7ED9-storageclass" aria-hidden="true">#</a> PV \u52A8\u6001\u4F9B\u7ED9\uFF08StorageClass\uFF09</h2><img src="https://pic.imgdb.cn/item/61ebf37e2ab3f51d911a5fcb.png" style="zoom:67%;"><img src="https://pic.imgdb.cn/item/61ebf3ac2ab3f51d911a8b9d.png" style="zoom:80%;"><p>K8s\u9ED8\u8BA4\u4E0D\u652F\u6301NFS\u52A8\u6001\u4F9B\u7ED9\uFF0C\u9700\u8981\u5355\u72EC\u90E8\u7F72\u793E\u533A\u5F00\u53D1\u7684\u63D2\u4EF6\u3002</p>`,45),k={href:"https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner",target:"_blank",rel:"noopener noreferrer"},m=t(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master nfs-external-provisioner<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">12</span>
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">255</span> Mar <span class="token number">27</span>  <span class="token number">2021</span> class.yaml
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1054</span> Nov  <span class="token number">5</span> <span class="token number">23</span>:16 deployment.yaml
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1819</span> Mar <span class="token number">27</span>  <span class="token number">2021</span> rbac.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>\u90E8\u7F72NFS\u52A8\u6001\u4F9B\u5E94</strong></p></blockquote><ul><li><strong>\u521B\u5EFA\u6388\u6743\u8BBF\u95EEapiserver</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># cat rbac.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token comment"># replace with namespace where provisioner is deployed</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>runner
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;persistentvolumes&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;persistentvolumeclaims&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;storage.k8s.io&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;storageclasses&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;events&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;patch&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> run<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
    <span class="token comment"># replace with namespace where provisioner is deployed</span>
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>runner
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> leader<span class="token punctuation">-</span>locking<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token comment"># replace with namespace where provisioner is deployed</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;endpoints&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;patch&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> leader<span class="token punctuation">-</span>locking<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token comment"># replace with namespace where provisioner is deployed</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
    <span class="token comment"># replace with namespace where provisioner is deployed</span>
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> leader<span class="token punctuation">-</span>locking<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  
<span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f rbac.yaml </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u90E8\u7F72\u63D2\u4EF6\uFF0C\u9700\u4FEE\u6539\u91CC\u9762NFS\u670D\u52A1\u5668\u5730\u5740\u4E0E\u5171\u4EAB\u76EE\u5F55</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># cat deployment.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token comment"># replace with namespace where provisioner is deployed</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Recreate
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
          <span class="token key atrule">image</span><span class="token punctuation">:</span> lizhenliang/nfs<span class="token punctuation">-</span>subdir<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">:</span>v4.0.1
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>root
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /persistentvolumes
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PROVISIONER_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>sigs.io/nfs<span class="token punctuation">-</span>subdir<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NFS_SERVER
              <span class="token key atrule">value</span><span class="token punctuation">:</span> 192.168.1.88					<span class="token comment">#\u4FEE\u6539NFS\u7684\u670D\u52A1\u7AEF\u7684\u5730\u5740</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NFS_PATH			
              <span class="token key atrule">value</span><span class="token punctuation">:</span> /nfs/kubernetes				<span class="token comment">#NFS\u670D\u52A1\u7AEF\u7684\u5B58\u50A8\u8DEF\u5F84</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>root
          <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
            <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.1.88					<span class="token comment">#NFS\u670D\u52A1\u7AEF\u5730\u5740</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /nfs/kubernetes 					<span class="token comment">#NFS\u670D\u52A1\u7AEF\u7684\u5B58\u50A8\u8DEF\u5F84</span>
            
<span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f deployment.yaml </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u521B\u5EFA\u5B58\u50A8\u7C7B</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># cat class.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> managed<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>storage
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>sigs.io/nfs<span class="token punctuation">-</span>subdir<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner <span class="token comment"># or choose another name, must match deployment&#39;s env PROVISIONER_NAME&#39;</span>
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">archiveOnDelete</span><span class="token punctuation">:</span> <span class="token string">&quot;false&quot;</span>
  
<span class="token punctuation">[</span>root@master nfs<span class="token punctuation">-</span>external<span class="token punctuation">-</span>provisioner<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f class.yaml </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u67E5\u770B\u5B58\u50A8\u7C7B</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get sc </span>
NAME                  PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
managed-nfs-storage   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate           <span class="token boolean">false</span>                  18m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>\u4F7F\u7528\u52A8\u6001\u4F9B\u5E94</strong></p></blockquote><ul><li><strong>\u2FB8\u5148\u521B\u5EFA\u2F00 \u4E2APVC\u5BF9\u8C61</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat test-pvc.yaml </span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pvc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Mi 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>\u6211\u4EEC\u8FD9\u2FA5\u58F0\u660E\u4E86\u2F00\u4E2A PVC \u5BF9\u8C61\uFF0C\u91C7\u2F64 ReadWriteMany \u7684\u8BBF\u95EE\u6A21\u5F0F\uFF0C\u8BF7\u6C42 1Mi \u7684\u7A7A\u95F4</code>\uFF0C\u4F46\u662F\u6211\u4EEC\u53EF\u4EE5 \u770B\u5230\u4E0A\u2FAF\u7684 PVC \u2F42\u4EF6\u6211\u4EEC\u6CA1\u6709\u6807\u8BC6\u51FA\u4EFB\u4F55\u548C StorageClass \u76F8\u5173\u8054\u7684\u4FE1\u606F\uFF0C\u90A3\u4E48\u5982\u679C\u6211\u4EEC\u73B0\u5728\u76F4\u63A5\u521B \u5EFA\u8FD9\u4E2A PVC \u5BF9\u8C61\u80FD\u591F\u2F83\u52A8\u7ED1\u5B9A\u4E0A\u5408\u9002\u7684 PV \u5BF9\u8C61\u5417\uFF1F\u663E\u7136\u662F\u4E0D\u80FD\u7684(\u524D\u63D0\u662F\u6CA1\u6709\u5408\u9002\u7684 PV)\uFF0C\u6211\u4EEC\u8FD9\u2FA5 \u6709\u4E24\u79CD\u2F45\u6CD5\u53EF\u4EE5\u6765\u5229\u2F64\u4E0A\u2FAF\u6211\u4EEC\u521B\u5EFA\u7684 StorageClass \u5BF9\u8C61\u6765\u2F83\u52A8\u5E2E\u6211\u4EEC\u521B\u5EFA\u2F00\u4E2A\u5408\u9002\u7684 PV:</p><ul><li><strong>\u7B2C\u2F00\u79CD\u2F45\u6CD5\uFF1A</strong></li></ul><p><strong><code>\u5728\u8FD9\u4E2A PVC \u5BF9\u8C61\u4E2D\u6DFB\u52A0\u2F00\u4E2A\u58F0\u660EstorageName\u5BF9\u8C61\u7684\u6807\u8BC6\uFF0C\u8FD9\u2FA5\u6211\u4EEC\u53EF\u4EE5\u5229\u2F64\u2F00 \u4E2AstorageClassName\u5C5E\u6027\u6765\u6807\u8BC6\uFF0C\u5982\u4E0B\uFF1A</code></strong></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat test-pvc.yaml </span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pvc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> <span class="token string">&quot;managed-nfs-storage&quot;</span>			
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Mi 
  
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f test-pvc.yaml</span>
persistentvolumeclaim/test<span class="token punctuation">-</span>pvc created
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pvc</span>
NAME       STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE
my<span class="token punctuation">-</span>pvc     Bound    my<span class="token punctuation">-</span>pvc                                     5Gi        RWO                                  82m
test<span class="token punctuation">-</span>pvc   Bound    pvc<span class="token punctuation">-</span>24df2e95<span class="token punctuation">-</span>4eb9<span class="token punctuation">-</span>4872<span class="token punctuation">-</span>9aab<span class="token punctuation">-</span>e78a098054cd   1Mi        RWX            managed<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>storage   4s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u7B2C\u2F06\u79CD\u2F45\u6CD5\uFF1A</strong></li></ul><p><code>\u6211\u4EEC\u53EF\u4EE5\u8BBE\u7F6E\u8FD9\u4E2A course-nfs-storage \u7684 StorageClass \u4E3A Kubernetes \u7684\u9ED8\u8BA4\u5B58\u50A8\u540E\u7AEF\uFF0C\u6211\u4EEC\u53EF\u4EE5\u2F64 kubectl patch \u547D\u4EE4\u6765\u66F4\u65B0\uFF1A</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl patch storageclass managed-nfs-storage -p &#39;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#39;</span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get sc </span>
NAME                            PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
managed-nfs-storage <span class="token punctuation">(</span>default<span class="token punctuation">)</span>   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate           <span class="token boolean">false</span>                  58m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pv</span>
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM              STORAGECLASS          REASON   AGE
my-pvc                                     5Gi        RWO            Recycle          Bound    default/my-pvc                                    112m
pvc-24df2e95-4eb9-4872-9aab-e78a098054cd   1Mi        RWX            Delete           Bound    default/test-pvc   managed-nfs-storage            30m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u6D4B\u8BD5\u52A8\u6001\u4F9B\u5E94</p></blockquote><ul><li><p><strong>\u8FD8\u662F\u7EE7\u7EED\u7528nginx\u6D4B\u8BD5pvc\u52A8\u6001\u4F9B\u5E94</strong></p></li><li><p><strong>\u672B\u5C3E\u6307\u5B9AclaimName\u7684pvc\u662Ftest-pvc</strong></p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span> 
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx 
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pvc
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html 
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pvc
      <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span> 
        <span class="token key atrule">claimName</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pvc
        
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml  </span>
pod/my<span class="token punctuation">-</span>pod created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods  -o wide </span>
NAME                                      READY   STATUS    RESTARTS   AGE   IP               NODE   NOMINATED NODE   READINESS GATES
my<span class="token punctuation">-</span>pod                                    1/1     Running   0          52s   10.244.167.142   node   &lt;none<span class="token punctuation">&gt;</span>           &lt;none<span class="token punctuation">&gt;</span>
nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>75549d8b58<span class="token punctuation">-</span>vldpm   1/1     Running   0          63m   10.244.167.141   node   &lt;none<span class="token punctuation">&gt;</span>           &lt;none<span class="token punctuation">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>\u5728nfs\u7684\u670D\u52A1\u7AEF\u9A8C\u8BC1\u52A8\u6001\u4F9B\u5E94\u662F\u5426\u751F\u6548</strong></p></li><li><p><strong>\u521B\u5EFA\u4E00\u4E2Aindex.html\u6D4B\u8BD5</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># cd /nfs/kubernetes/</span>
<span class="token punctuation">[</span>root@node kubernetes<span class="token punctuation">]</span><span class="token comment"># ls </span>
default-test-pvc-pvc-24df2e95-4eb9-4872-9aab-e78a098054cd
<span class="token punctuation">[</span>root@node kubernetes<span class="token punctuation">]</span><span class="token comment"># cd default-test-pvc-pvc-24df2e95-4eb9-4872-9aab-e78a098054cd/</span>
<span class="token punctuation">[</span>root@node default-test-pvc-pvc-24df2e95-4eb9-4872-9aab-e78a098054cd<span class="token punctuation">]</span><span class="token comment"># echo 6666 &gt; index.html </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u56DE\u5230master\u8282\u70B9\u518D\u6B21curl\u67E5\u770Bpod\u662F\u5426\u6210\u529F\u8BBF\u95EEindex.html</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods  -o wide </span>
NAME                                      READY   STATUS    RESTARTS   AGE   IP               NODE   NOMINATED NODE   READINESS GATES
my-pod                                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          96s   <span class="token number">10.244</span>.167.142   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nfs-client-provisioner-75549d8b58-vldpm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          64m   <span class="token number">10.244</span>.167.141   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># curl 10.244.167.142</span>
<span class="token number">6666</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6709\u72B6\u6001\u5E94\u7528\u90E8\u7F72-statefulset\u63A7\u5236\u5668" tabindex="-1"><a class="header-anchor" href="#\u6709\u72B6\u6001\u5E94\u7528\u90E8\u7F72-statefulset\u63A7\u5236\u5668" aria-hidden="true">#</a> \u6709\u72B6\u6001\u5E94\u7528\u90E8\u7F72\uFF1AStatefulSet\u63A7\u5236\u5668</h2><ul><li><strong>\u65E0\u72B6\u6001\u4E0E\u6709\u72B6\u6001\uFF1A</strong><ul><li><code>Deployment\u63A7\u5236\u5668\u8BBE\u8BA1\u539F\u5219\uFF1A\u7BA1\u7406\u7684\u6240\u6709Pod\u4E00\u6A21\u4E00\u6837\uFF0C\u63D0\u4F9B\u540C\u4E00\u4E2A\u670D\u52A1\uFF0C\u4E5F\u4E0D\u8003\u8651\u5728\u54EA\u53F0Node\u8FD0 \u884C\uFF0C\u53EF\u968F\u610F\u6269\u5BB9\u548C\u7F29\u5BB9\u3002\u8FD9\u79CD\u5E94\u7528\u79F0\u4E3A\u201C\u65E0\u72B6\u6001\u201D\uFF0C\u4F8B\u5982Web\u670D\u52A1</code></li><li><code>\u5728\u5B9E\u9645\u7684\u573A\u666F\u4E2D\uFF0C\u8FD9\u5E76\u4E0D\u80FD\u6EE1\u8DB3\u6240\u6709\u5E94\u7528\uFF0C\u5C24\u5176\u662F\u5206\u5E03\u5F0F\u5E94\u7528\uFF0C\u4F1A\u90E8\u7F72\u591A\u4E2A\u5B9E\u4F8B\uFF0C\u8FD9\u4E9B\u5B9E\u4F8B\u4E4B\u95F4\u5F80\u5F80\u6709 \u4F9D\u8D56\u5173\u7CFB\uFF0C\u4F8B\u5982\u4E3B\u4ECE\u5173\u7CFB\u3001\u4E3B\u5907\u5173\u7CFB\uFF0C\u8FD9\u79CD\u5E94\u7528\u79F0\u4E3A\u201C\u6709\u72B6\u6001\u201D\uFF0C\u4F8B\u5982MySQL\u4E3B\u4ECE\u3001Etcd\u96C6\u7FA4</code></li></ul></li></ul><h2 id="statefulset" tabindex="-1"><a class="header-anchor" href="#statefulset" aria-hidden="true">#</a> StatefulSet\uFF1A</h2><blockquote><ul><li><code>StatefulSet</code> \u662F\u7528\u6765\u7BA1\u7406\u6709\u72B6\u6001\u5E94\u7528\u7684\u5DE5\u4F5C\u8D1F\u8F7D API \u5BF9\u8C61\u3002</li><li><code>StatefulSet</code> \u7528\u6765\u7BA1\u7406 Deployment \u548C\u6269\u5C55\u4E00\u7EC4 Pod\uFF0C\u5E76\u4E14\u80FD\u4E3A\u8FD9\u4E9B Pod \u63D0\u4F9B<strong>\u5E8F\u53F7\u548C\u552F\u4E00\u6027\u4FDD\u8BC1</strong>\u3002</li><li>\u548C Deployment \u76F8\u540C\u7684\u662F\uFF0CStatefulSet \u7BA1\u7406\u4E86\u57FA\u4E8E\u76F8\u540C\u5BB9\u5668\u5B9A\u4E49\u7684\u4E00\u7EC4 Pod\u3002\u4F46\u548C Deployment \u4E0D\u540C\u7684\u662F\uFF0CStatefulSet \u4E3A\u5B83\u4EEC\u7684\u6BCF\u4E2A Pod \u7EF4\u62A4\u4E86\u4E00\u4E2A\u56FA\u5B9A\u7684 ID\u3002\u8FD9\u4E9B Pod \u662F\u57FA\u4E8E\u76F8\u540C\u7684\u58F0\u660E\u6765\u521B\u5EFA\u7684\uFF0C\u4F46\u662F\u4E0D\u80FD\u76F8\u4E92\u66FF\u6362\uFF1A\u65E0\u8BBA\u600E\u4E48\u8C03\u5EA6\uFF0C\u6BCF\u4E2A Pod \u90FD\u6709\u4E00\u4E2A\u6C38\u4E45\u4E0D\u53D8\u7684 ID\u3002</li></ul></blockquote><p><strong>\u90E8\u7F72\u6709\u72B6\u6001\u5E94\u7528</strong></p><ul><li><p>\u89E3\u51B3Pod\u72EC\u7ACB\u751F\u547D\u5468\u671F\uFF0C\u4FDD\u6301Pod\u542F\u52A8\u987A\u5E8F\u548C\u552F\u4E00\u6027</p><ul><li>\u7A33\u5B9A\uFF0C\u552F\u4E00\u7684\u7F51\u7EDC\u6807\u8BC6\u7B26\uFF0C\u6301\u4E45\u5B58\u50A8</li><li>\u6709\u5E8F\uFF0C\u4F18\u96C5\u7684\u90E8\u7F72\u548C\u6269\u5C55\u3001\u5220\u9664\u548C\u7EC8\u6B62</li><li>\u6709\u5E8F\uFF0C\u81EA\u52A8\u7684\u6EDA\u52A8\u66F4\u65B0</li><li>\u5E94\u7528\u573A\u666F\uFF1A\u5206\u5E03\u5F0F\u5E94\u7528\u3001\u6570\u636E\u5E93\u96C6\u7FA4</li><li>\u5220\u9664\u6216\u8005\u6536\u7F29 StatefulSet \u5E76\u4E0D\u4F1A\u5220\u9664\u5B83\u5173\u8054\u7684\u5B58\u50A8\u5377\u3002\u8FD9\u6837\u505A\u662F\u4E3A\u4E86\u4FDD\u8BC1\u6570\u636E\u5B89\u5168\uFF0C\u5B83\u901A\u5E38\u6BD4\u81EA\u52A8\u6E05\u9664 StatefulSet \u6240\u6709\u76F8\u5173\u7684\u8D44\u6E90\u66F4\u6709\u4EF7\u503C\u3002</li><li>StatefulSet \u5F53\u524D\u9700\u8981 headless \u670D\u52A1 \u6765\u8D1F\u8D23 Pod \u7684\u7F51\u7EDC\u6807\u8BC6\u3002\u60A8\u9700\u8981\u8D1F\u8D23\u521B\u5EFA\u6B64\u670D\u52A1\u3002</li></ul></li><li><p><strong>StatefulSet\u5C06\u5E94\u7528\u72B6\u6001\u62BD\u8C61\u6210\u4E86\u4E24\u79CD\u60C5\u51B5\uFF1A</strong></p><ul><li><code>\u62D3\u6251\u72B6\u6001</code>\uFF1A\u5E94\u7528\u5B9E\u4F8B\u5FC5\u987B\u6309\u7167\u67D0\u79CD\u987A\u5E8F\u542F\u52A8\u3002\u65B0\u521B\u5EFA\u7684Pod\u5FC5\u987B\u548C\u539F\u6765Pod\u7684\u7F51\u7EDC\u6807\u8BC6\u4E00\u6837</li><li><code>\u5B58\u50A8\u72B6\u6001</code>\uFF1A\u5E94\u7528\u7684\u591A\u4E2A\u5B9E\u4F8B\u5206\u522B\u7ED1\u5B9A\u4E86\u4E0D\u540C\u5B58\u50A8\u6570\u636E\u3002</li></ul></li></ul><blockquote><p><strong>StatefulSet\u7684\u4F7F\u7528</strong></p></blockquote><ul><li><p><code>StatefulSet\u901A\u8FC7Headless Service\u7EF4\u6301Pod\u7684\u62D3\u6251\u72B6\u6001</code></p></li><li><p>\u9996\u5148\u521B\u5EFA\u65E0\u5934\u670D\u52A1Headless service</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># cat service.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> web 
  <span class="token key atrule">clusterIP</span><span class="token punctuation">:</span> None
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    
<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f service.yaml </span>
service/nginx created  
<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl get svc</span>
NAME         TYPE        CLUSTER<span class="token punctuation">-</span>IP   EXTERNAL<span class="token punctuation">-</span>IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1    &lt;none<span class="token punctuation">&gt;</span>        443/TCP   11h
nginx        ClusterIP   None         &lt;none<span class="token punctuation">&gt;</span>        80/TCP    73s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u521B\u5EFA\u4F7F\u7528StatefulSet\u63A7\u5236\u5668\u7684pod</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment web --image=nginx --port=80 --dry-run -o yaml &gt; statefulset.yaml </span>
<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># cat statefulset.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StatefulSet    <span class="token comment">#\u4FEE\u6539\u4E2A\u7C7B\u578B</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> web
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> <span class="token string">&quot;nginx&quot;</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx 
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx 
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> web 
          
<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f statefulset.yaml </span>
statefulset.apps/web created

<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME                                      READY   STATUS    RESTARTS   AGE
nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>75549d8b58<span class="token punctuation">-</span>vldpm   1/1     Running   0          109m
web<span class="token punctuation">-</span>0                                     1/1     Running   0          72s			<span class="token comment">#\u6709\u5E8F</span>
web<span class="token punctuation">-</span>1                                     1/1     Running   0          55s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u53EF\u4EE5\u770B\u51FA\u521B\u5EFA\u4E86\u4E24\u4E2A\u540D\u4E3A<code>web-0</code>\u548C<code>web-1</code>\u7684pod\uFF0Cservice\u4E5F\u4F1A\u7531\u4E24\u4E2Aendpoint\uFF1A</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl describe service nginx </span>
Name:              nginx
Namespace:         default
Labels:            <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
Annotations:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Selector:          <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
Type:              ClusterIP
IP Families:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
IP:                None
IPs:               None
Port:              web  <span class="token number">80</span>/TCP
TargetPort:        <span class="token number">80</span>/TCP
Endpoints:         <span class="token number">10.244</span>.167.145:80,10.244.167.146:80
Session Affinity:  None
Events:            <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>\u521B\u5EFA\u65F6\u662F\u5148\u521B\u5EFAweb-0\u518D\u521B\u5EFAweb-1\uFF0C\u800C\u5220\u9664\u7684\u65F6\u5019\u662F\u5148\u5220\u9664web-1\uFF0C\u518D\u5220\u9664web-0.</strong></p></li><li><p><strong>\u73B0\u5728\u53EF\u4EE5\u76F4\u63A5\u8BBF\u95EE\u670D\u52A1</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide </span>
NAME                                      READY   STATUS    RESTARTS   AGE     IP               NODE   NOMINATED NODE   READINESS GATES
my-pod                                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          49m     <span class="token number">10.244</span>.167.142   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nfs-client-provisioner-75549d8b58-vldpm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          112m    <span class="token number">10.244</span>.167.141   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web-0                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4m15s   <span class="token number">10.244</span>.167.145   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web-1                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m58s   <span class="token number">10.244</span>.167.146   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># curl 10.244.167.145</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
html <span class="token punctuation">{</span> color-scheme: light dark<span class="token punctuation">;</span> <span class="token punctuation">}</span>
body <span class="token punctuation">{</span> width: 35em<span class="token punctuation">;</span> margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>PV\u548CPVC\u7684\u8BBE\u8BA1\uFF0C\u4F7F\u5F97StatefulSet\u5BF9\u5B58\u50A8\u72B6\u6001\u7684\u7BA1\u7406\u6210\u4E3A\u4E86\u53EF\u80FD\uFF0C\u73B0\u5728\u4E3A\u4EE5\u4E0A\u8FD9\u4E9Bpod\u6DFB\u52A0\u5B58\u50A8</code></strong></p></li><li><p><strong>StatefulSet\u7684\u5B58\u50A8\u5377\u4F7F\u7528VolumeClaimTemplate\u521B\u5EFA\uFF0C\u79F0\u4E3A\u5377\u7533\u8BF7\u6A21\u677F\uFF0C\u5F53StatefulSet\u4F7F\u7528 VolumeClaimTemplate\u521B\u5EFA\u4E00\u4E2APersistentVolume\u65F6\uFF0C\u540C\u6837\u4E5F\u4F1A\u4E3A\u6BCF\u4E2APod\u5206\u914D\u5E76\u521B\u5EFA\u4E00\u4E2A\u7F16\u53F7\u7684PVC\u3002</strong></p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># cat statefulset.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StatefulSet 
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> web
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> <span class="token string">&quot;nginx&quot;</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx 
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx 
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> web 
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> 
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> www
            <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html

  <span class="token key atrule">volumeClaimTemplates</span><span class="token punctuation">:</span> 										<span class="token comment">#\u4E13\u95E8\u7684\u7533\u8BF7\u6A21\u677F \u53EA\u5BF9\u4E8EStatefulset</span>
    <span class="token punctuation">-</span> <span class="token key atrule">metadata</span><span class="token punctuation">:</span> 												<span class="token comment">#\u4E3APod\u7533\u8BF7\u4E00\u4E2A\u72EC\u7ACB\u7684PV</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> www
      <span class="token key atrule">spec</span><span class="token punctuation">:</span> 
        <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> managed<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>storage
        <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> 
          <span class="token punctuation">-</span> ReadWriteOnce 
        <span class="token key atrule">resources</span><span class="token punctuation">:</span> 
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">storage</span><span class="token punctuation">:</span> 100Mi 
            
<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl  apply -f statefulset.yaml </span>
statefulset.apps/web created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>\u67E5\u770Bpods\u7684\u72B6\u6001\u548Cpv\u4EE5\u53CApvc\u7684\u72B6\u6001</code></strong></p></li><li><p><strong><code>StatefulSet\u8FD8\u4F1A\u4E3A\u6BCF\u4E00\u4E2APod\u5206\u914D\u5E76\u521B\u5EFA\u4E00\u4E2A\u540C\u6837\u7F16\u53F7\u7684PVC\u3002</code></strong></p></li><li><p><strong>\u8FD9\u6837\uFF0Ckubernetes\u5C31\u53EF\u4EE5\u901A\u8FC7Persistent Volume\u673A\u5236\u4E3A\u8FD9\u4E2APVC\u7ED1\u5B9A\u5BF9\u5E94\u7684PV\uFF0C\u4ECE\u800C\u4FDD\u8BC1\u6BCF\u4E00\u4E2APod\u90FD\u62E5\u6709\u4E00\u4E2A\u72EC\u7ACB\u7684Volume\uFF1A</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME                                      READY   STATUS    RESTARTS   AGE
my-pod                                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          62m
nfs-client-provisioner-75549d8b58-vldpm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          125m
web-0                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          42s
web-1                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23s

<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment"># kubectl get pvc</span>
NAME        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE
my-pvc      Bound    my-pvc                                     5Gi        RWO                                  3h3m
test-pvc    Bound    pvc-24df2e95-4eb9-4872-9aab-e78a098054cd   1Mi        RWX            managed-nfs-storage   101m
www-web-0   Bound    pvc-66727b03-b4f4-47b1-a681-9a9c406ee732   100Mi      RWO            managed-nfs-storage   55s
www-web-1   Bound    pvc-d9df0901-79be-47d2-b8a1-4552213e09d3   100Mi      RWO            managed-nfs-storage   36s

<span class="token punctuation">[</span>root@master statefulset<span class="token punctuation">]</span><span class="token comment">#  kubectl get pv </span>
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM               STORAGECLASS          REASON   AGE
my-pvc                                     5Gi        RWO            Recycle          Bound    default/my-pvc                                     3h5m
pvc-24df2e95-4eb9-4872-9aab-e78a098054cd   1Mi        RWX            Delete           Bound    default/test-pvc    managed-nfs-storage            103m
pvc-66727b03-b4f4-47b1-a681-9a9c406ee732   100Mi      RWO            Delete           Bound    default/www-web-0   managed-nfs-storage            2m46s
pvc-d9df0901-79be-47d2-b8a1-4552213e09d3   100Mi      RWO            Delete           Bound    default/www-web-1   managed-nfs-storage            2m27s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>\u5728nfs\u7684\u670D\u52A1\u7AEF\u5199\u5165index.html\u8FDB\u884C\u8BBF\u95EE\u6D4B\u8BD5</strong></p></li><li><p><strong>\u6211\u5DF2\u7ECF\u5C06nfs\u7684\u670D\u52A1\u7AEF\u6302\u8F7D\u5728master\u8282\u70B9\u4E0A</strong></p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cd /mnt/default-www-web-0-pvc-66727b03-b4f4-47b1-a681-9a9c406ee732/ </span>
<span class="token punctuation">[</span>root@master default-www-web-0-pvc-66727b03-b4f4-47b1-a681-9a9c406ee732<span class="token punctuation">]</span><span class="token comment"># echo web1 &gt; index.html </span>
<span class="token punctuation">[</span>root@master default-www-web-0-pvc-66727b03-b4f4-47b1-a681-9a9c406ee732<span class="token punctuation">]</span><span class="token comment"># cd ..</span>
<span class="token punctuation">[</span>root@master default-www-web-1-pvc-d9df0901-79be-47d2-b8a1-4552213e09d3<span class="token punctuation">]</span><span class="token comment"># echo web2 &gt; index.html </span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl  get pods -o wide </span>
NAME                                      READY   STATUS    RESTARTS   AGE     IP               NODE   NOMINATED NODE   READINESS GATES
my-pod                                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          68m     <span class="token number">10.244</span>.167.142   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nfs-client-provisioner-75549d8b58-vldpm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          131m    <span class="token number">10.244</span>.167.141   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web-0                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m31s   <span class="token number">10.244</span>.167.147   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
web-1                                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m12s   <span class="token number">10.244</span>.167.148   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># curl  10.244.167.147</span>
web1
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># curl  10.244.167.148</span>
web2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5E94\u7528\u7A0B\u5E8F\u914D\u7F6E\u6587\u4EF6\u5B58\u50A8-configmap" tabindex="-1"><a class="header-anchor" href="#\u5E94\u7528\u7A0B\u5E8F\u914D\u7F6E\u6587\u4EF6\u5B58\u50A8-configmap" aria-hidden="true">#</a> \u5E94\u7528\u7A0B\u5E8F\u914D\u7F6E\u6587\u4EF6\u5B58\u50A8\uFF1AConfigMap</h2><ul><li><p>\u8D44\u6E90\u5BF9\u8C61\uFF1A ConfigMap</p><ul><li>\u6211\u4EEC\u77E5\u9053\u8BB8\u591A\u5E94\u2F64\u7ECF\u5E38\u4F1A\u6709\u4ECE\u914D\u7F6E\u2F42\u4EF6\u3001\u547D\u4EE4\u2F8F\u53C2\u6570\u6216\u8005\u73AF\u5883\u53D8\u91CF\u4E2D\u8BFB\u53D6 \u2F00\u4E9B\u914D\u7F6E\u4FE1\u606F\uFF0C\u8FD9\u4E9B\u914D\u7F6E\u4FE1\u606F\u6211\u4EEC\u80AF\u5B9A\u4E0D\u4F1A\u76F4\u63A5\u5199\u6B7B\u5230\u5E94\u2F64\u7A0B\u5E8F\u4E2D\u53BB\u7684\uFF0C\u2F50\u5982\u4F60\u2F00\u4E2A\u5E94\u2F64\u8FDE\u63A5\u2F00 \u4E2A redis \u670D\u52A1\uFF0C\u4E0B\u2F00\u6B21\u60F3\u66F4\u6362\u2F00\u4E2A\u4E86\u7684\uFF0C\u8FD8\u5F97\u91CD\u65B0\u53BB\u4FEE\u6539\u4EE3\u7801\uFF0C\u91CD\u65B0\u5236\u4F5C\u2F00\u4E2A\u955C\u50CF\uFF0C\u8FD9\u80AF\u5B9A\u662F\u4E0D\u53EF\u53D6 \u7684\uFF0C<code>\u2F7D ConfigMap \u5C31\u7ED9\u6211\u4EEC\u63D0\u4F9B\u4E86\u5411\u5BB9\u5668\u4E2D\u6CE8\u2F0A\u914D\u7F6E\u4FE1\u606F\u7684\u80FD\u2F12\uFF0C\u4E0D\u4EC5\u53EF\u4EE5\u2F64\u6765\u4FDD\u5B58\u5355\u4E2A\u5C5E\u6027\uFF0C\u4E5F\u53EF \u4EE5\u2F64\u6765\u4FDD\u5B58\u6574\u4E2A\u914D\u7F6E\u2F42\u4EF6\uFF0C\u2F50\u5982\u6211\u4EEC\u53EF\u4EE5\u2F64\u6765\u914D\u7F6E\u2F00\u4E2A redis \u670D\u52A1\u7684\u8BBF\u95EE\u5730\u5740\uFF0C\u4E5F\u53EF\u4EE5\u2F64\u6765\u4FDD\u5B58\u6574 \u4E2A redis \u7684\u914D\u7F6E\u2F42\u4EF6\u3002</code></li><li>ConfigMap \u8D44\u6E90\u5BF9\u8C61\u4F7F\u2F64 key-value \u5F62\u5F0F\u7684\u952E\u503C\u5BF9\u6765\u914D\u7F6E\u6570\u636E\uFF0C\u8FD9\u4E9B\u6570\u636E\u53EF\u4EE5\u5728 Pod \u2FA5\u2FAF\u4F7F \u2F64\uFF0C ConfigMap \u548C\u6211\u4EEC\u540E\u2FAF\u8981\u8BB2\u5230\u7684 Secrets \u2F50\u8F83\u7C7B\u4F3C\uFF0C\u2F00\u4E2A\u2F50\u8F83\u2F24\u7684\u533A\u522B\u662F ConfigMap \u53EF\u4EE5\u2F50\u8F83\u2F45 \u4FBF\u7684\u5904\u7406\u2F00\u4E9B\u2FAE\u654F\u611F\u7684\u6570\u636E\uFF0C<code>\u2F50\u5982\u5BC6\u7801\u4E4B\u7C7B\u7684\u8FD8\u662F\u9700\u8981\u4F7F\u2F64 Secrets \u6765\u8FDB\u2F8F\u7BA1\u7406\u3002</code></li></ul></li><li><p>\u53EF\u4EE5\u4F7F\u2F64 kubectl create configmap -h \u6765\u67E5\u770B\u5173\u4E8E\u521B\u5EFA ConfigMap \u7684\u5E2E\u52A9\u4FE1\u606F</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Examples:
	<span class="token comment"># Create a new configmap named my-config based on folder bar</span>
	kubectl create configmap my-config --from-file<span class="token operator">=</span>path/to/bar

	<span class="token comment"># Create a new configmap named my-config with specified keys instead of file basenames on disk</span>
	kubectl create configmap my-config --from-file<span class="token operator">=</span>key1<span class="token operator">=</span>/path/to/bar/file1.txt --from-file<span class="token operator">=</span>key2<span class="token operator">=</span>/path/to/bar/file2.txt

	<span class="token comment"># Create a new configmap named my-config with key1=config1 and key2=config2ConfigMap</span>
	kubectl create configmap my-config --from-literal<span class="token operator">=</span>key1<span class="token operator">=</span>config1 --from-literal<span class="token operator">=</span>key2<span class="token operator">=</span>config2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>\u521B\u5EFA\u542B\u6709\u53D8\u91CF\u7684\u6587\u4EF6</code></strong></p></li><li><p>\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\u53EF\u4EE5\u4ECE\u2F00\u4E2A\u7ED9\u5B9A\u7684\u2F6C\u5F55\u6765\u521B\u5EFA\u2F00\u4E2A ConfigMap \u5BF9\u8C61\uFF0C\u2F50\u5982\u6211\u4EEC\u6709\u2F00\u4E2A testcm \u7684\u2F6C\u5F55\uFF0C \u8BE5\u2F6C\u5F55\u4E0B\u2FAF\u5305\u542B\u2F00\u4E9B\u914D\u7F6E\u2F42\u4EF6\uFF0C redis \u548C mysql \u7684\u8FDE\u63A5\u4FE1\u606F</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># ls testcm/</span>
mysql.conf  redis.conf

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat testcm/mysql.conf </span>
<span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span>

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat testcm/redis.conf </span>
<span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>\u4F7F\u2F64 from-file \u5173\u952E\u5B57\u6765\u521B\u5EFA\u5305\u542B\u8FD9\u4E2A\u2F6C\u5F55\u4E0B\u2FAF\u6240\u4EE5\u914D\u7F6E\u2F42\u4EF6\u7684 ConfigMap</code></strong></p></li><li><p>\u5176\u4E2D from-file \u53C2\u6570\u6307\u5B9A\u5728\u8BE5\u2F6C\u5F55\u4E0B\u2FAF\u7684\u6240\u6709\u2F42\u4EF6\u90FD\u4F1A\u88AB\u2F64\u5728 ConfigMap \u2FA5\u2FAF\u521B\u5EFA\u2F00\u4E2A\u952E\u503C\u5BF9\uFF0C\u952E\u7684 \u540D\u5B57\u5C31\u662F\u2F42\u4EF6\u540D\uFF0C\u503C\u5C31\u662F\u2F42\u4EF6\u7684\u5185\u5BB9</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl create configmap cm-demo1 --from-file=testcm</span>
configmap/cm-demo1 created

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get configmaps </span>
NAME               DATA   AGE
cm-demo1           <span class="token number">2</span>      6s
kube-root-ca.crt   <span class="token number">1</span>      27s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u4F7F\u2F64 describe \u547D\u4EE4\u67E5\u770B\u8BE6\u7EC6\u4FE1\u606F</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl describe configmaps cm-demo1 </span>
Name:         cm-demo1
Namespace:    default
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

Data
<span class="token operator">==</span><span class="token operator">==</span>
mysql.conf:
----
<span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span>

redis.conf:
----
<span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>

Events:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u4F7F\u7528yaml\u7684\u65B9\u5F0F\u67E5\u770B\u66F4\u8BE6\u7EC6\u7684\u952E\u503C</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get configmaps cm-demo1 -o yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    host=127.0.0.1
    port=3306</span>
  <span class="token key atrule">redis.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    host=127.0.0.1
    port=6379</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:52:14Z&quot;</span>
  <span class="token key atrule">managedFields</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">fieldsType</span><span class="token punctuation">:</span> FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:data</span><span class="token punctuation">:</span>
        <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:mysql.conf</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:redis.conf</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">manager</span><span class="token punctuation">:</span> kubectl<span class="token punctuation">-</span>create
    <span class="token key atrule">operation</span><span class="token punctuation">:</span> Update
    <span class="token key atrule">time</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:52:14Z&quot;</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo1
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;10516&quot;</span>
  <span class="token key atrule">uid</span><span class="token punctuation">:</span> 9a07b954<span class="token punctuation">-</span>c61a<span class="token punctuation">-</span>4b4d<span class="token punctuation">-</span>a0ec<span class="token punctuation">-</span>5214c3c317ee
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>\u9664\u4E86\u901A\u8FC7\u2F42\u4EF6\u2F6C\u5F55\u8FDB\u2F8F\u521B\u5EFA\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u4F7F\u2F64\u6307\u5B9A\u7684\u2F42\u4EF6\u8FDB\u2F8F\u521B\u5EFA ConfigMap</p></li><li><p>\u6211\u4EEC\u521B\u5EFA\u2F00\u4E2A redis \u7684\u914D\u7F6E\u7684\u2F00\u4E2A\u5355\u72EC ConfigMap \u5BF9\u8C61:</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl create configmap cm-demo2 --from-file=testcm/redis.conf </span>
configmap/cm<span class="token punctuation">-</span>demo2 created
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get configmaps cm-demo2  -o yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    host=127.0.0.1
    port=6379</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:55:37Z&quot;</span>
  <span class="token key atrule">managedFields</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">fieldsType</span><span class="token punctuation">:</span> FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:data</span><span class="token punctuation">:</span>
        <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:redis.conf</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">manager</span><span class="token punctuation">:</span> kubectl<span class="token punctuation">-</span>create
    <span class="token key atrule">operation</span><span class="token punctuation">:</span> Update
    <span class="token key atrule">time</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:55:37Z&quot;</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo2
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;10782&quot;</span>
  <span class="token key atrule">uid</span><span class="token punctuation">:</span> 71c2a77a<span class="token punctuation">-</span>fb21<span class="token punctuation">-</span>44c3<span class="token punctuation">-</span>a293<span class="token punctuation">-</span>064e3d1a2826
  

\u6CE8\uFF1A
\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\u2F00\u4E2A\u5173\u8054 redis.conf \u2F42\u4EF6\u914D\u7F6E\u4FE1\u606F\u7684 ConfigMap \u5BF9\u8C61\u521B\u5EFA\u6210\u529F\u4E86\uFF0C\u53E6\u5916\u503C\u5F97\u6CE8\u610F\u7684\u662F <span class="token punctuation">-</span><span class="token punctuation">-</span>from<span class="token punctuation">-</span>file \u8FD9\u4E2A\u53C2\u6570\u53EF\u4EE5\u4F7F\u2F64\u591A\u6B21\uFF0C\u2F50\u5982\u6211\u4EEC\u8FD9\u2FA5\u4F7F\u2F64\u4E24\u6B21\u5206\u522B\u6307\u5B9A redis.conf \u548C mysql.conf \u2F42\u4EF6\uFF0C\u5C31\u548C\u76F4\u63A5\u6307\u5B9A\u6574\u4E2A\u2F6C\u5F55\u662F\u2F00\u6837\u7684\u6548\u679C\u4E86\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>\u6211\u4EEC\u8FD8\u53EF\u4EE5\u76F4\u63A5\u4F7F\u2F64\u5B57\u7B26\u4E32\u8FDB\u2F8F\u521B\u5EFA\uFF0C\u901A\u8FC7 --from-literal \u53C2\u6570\u4F20\u9012\u914D\u7F6E\u4FE1\u606F</p></li><li><p>\u540C\u6837\u7684\uFF0C\u8FD9\u4E2A\u53C2\u6570\u53EF\u4EE5\u4F7F\u2F64\u591A\u6B21</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl create configmap cm-demo3 --from-literal=db.host=localhost  --from-literal=db.port=3306</span>
configmap/cm<span class="token punctuation">-</span>demo3 created
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get configmaps cm-demo3 -o yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">db.host</span><span class="token punctuation">:</span> localhost
  <span class="token key atrule">db.port</span><span class="token punctuation">:</span> <span class="token string">&quot;3306&quot;</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:58:06Z&quot;</span>
  <span class="token key atrule">managedFields</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">fieldsType</span><span class="token punctuation">:</span> FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:data</span><span class="token punctuation">:</span>
        <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:db.host</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:db.port</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">manager</span><span class="token punctuation">:</span> kubectl<span class="token punctuation">-</span>create
    <span class="token key atrule">operation</span><span class="token punctuation">:</span> Update
    <span class="token key atrule">time</span><span class="token punctuation">:</span> <span class="token string">&quot;2021-11-06T05:58:06Z&quot;</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo3
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;10979&quot;</span>
  <span class="token key atrule">uid</span><span class="token punctuation">:</span> 36bf5bbb<span class="token punctuation">-</span>b43a<span class="token punctuation">-</span>402d<span class="token punctuation">-</span>92c2<span class="token punctuation">-</span>af5f48ae0172
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h2 id="configmap\u7684\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#configmap\u7684\u4F7F\u7528" aria-hidden="true">#</a> configMap\u7684\u4F7F\u7528</h2></blockquote><ul><li><p>ConfigMap \u8FD9\u4E9B\u914D\u7F6E\u6570\u636E\u53EF\u4EE5 \u901A\u8FC7\u5F88\u591A\u79CD\u2F45\u5F0F\u5728 Pod \u2FA5\u4F7F\u2F64\uFF0C\u4E3B\u8981\u6709\u4EE5\u4E0B\u2F0F\u79CD\u2F45\u5F0F\uFF1A</p><ul><li><code>\u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF\u7684\u503C</code></li><li><code>\u5728\u5BB9\u5668\u2FA5\u8BBE\u7F6E\u547D\u4EE4\u2F8F\u53C2\u6570</code></li><li><code>\u5728\u6570\u636E\u5377\u2FA5\u2FAF\u521B\u5EFAconfig\u2F42\u4EF6</code></li></ul></li><li><p>\u4F7F\u2F64 ConfigMap \u6765\u586B\u5145\u6211\u4EEC\u7684\u73AF\u5883\u53D8\u91CF\uFF1A</p></li><li><p>\u4F7F\u7528busybox\u955C\u50CF\u6253\u5370\u6211\u4EEC\u6240\u6CE8\u5165\u7684\u53D8\u91CF</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm1<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm1 
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;env&quot;</span><span class="token punctuation">]</span> 
    <span class="token key atrule">env</span><span class="token punctuation">:</span> 								<span class="token comment">#\u7B2C\u4E00\u79CD\u6CE8\u5165\u53D8\u91CF\u7684\u65B9\u5F0F</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_HOST					
        <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 						<span class="token comment">#\u53D8\u91CF\u7684\u6765\u6E90</span>
          <span class="token key atrule">configMapKeyRef</span><span class="token punctuation">:</span> 				<span class="token comment">#\u4ECEconfigMap\u6765</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo3  			<span class="token comment">#\u4ECEconfigMap\u7684cm-demo3\u6765</span>
            <span class="token key atrule">key</span><span class="token punctuation">:</span> db.host 
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_PORT 
        <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 
          <span class="token key atrule">configMapKeyRef</span><span class="token punctuation">:</span> 
            <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo3 
            <span class="token key atrule">key</span><span class="token punctuation">:</span> db.port
    <span class="token key atrule">envFrom</span><span class="token punctuation">:</span> 							<span class="token comment">#\u7B2C\u4E8C\u79CD\u6CE8\u5165\u53D8\u91CF\u7684\u65B9\u5F0F</span>
      <span class="token punctuation">-</span> <span class="token key atrule">configMapRef</span><span class="token punctuation">:</span>					<span class="token comment">#\u6765\u6E90\u4E8EconfigMap</span>
         <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo1 				<span class="token comment">#configMap\u7684cm-demo1</span>
        
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml </span>
pod/testcm1<span class="token punctuation">-</span>pod created

<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME          READY   STATUS      RESTARTS   AGE
testcm1<span class="token punctuation">-</span>pod   0/1     Completed   0          3m21s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u67E5\u770B\u65E5\u5FD7\u770Bbusybox\u662F\u5426\u6253\u5370\u51FA\u6765\u53D8\u91CF</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl logs testcm1-pod </span>
<span class="token assign-left variable">KUBERNETES_SERVICE_PORT</span><span class="token operator">=</span><span class="token number">443</span>
<span class="token assign-left variable">KUBERNETES_PORT</span><span class="token operator">=</span>tcp://10.96.0.1:443
<span class="token assign-left variable"><span class="token environment constant">HOSTNAME</span></span><span class="token operator">=</span>testcm1-pod
<span class="token assign-left variable">DB_PORT</span><span class="token operator">=</span><span class="token number">3306</span>
<span class="token assign-left variable"><span class="token environment constant">SHLVL</span></span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/root
<span class="token assign-left variable">mysql.conf</span><span class="token operator">=</span>host<span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span>

<span class="token assign-left variable">redis.conf</span><span class="token operator">=</span>host<span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>

<span class="token assign-left variable">KUBERNETES_PORT_443_TCP_ADDR</span><span class="token operator">=</span><span class="token number">10.96</span>.0.1
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
<span class="token assign-left variable">KUBERNETES_PORT_443_TCP_PORT</span><span class="token operator">=</span><span class="token number">443</span>
<span class="token assign-left variable">KUBERNETES_PORT_443_TCP_PROTO</span><span class="token operator">=</span>tcp
<span class="token assign-left variable">KUBERNETES_SERVICE_PORT_HTTPS</span><span class="token operator">=</span><span class="token number">443</span>
<span class="token assign-left variable">KUBERNETES_PORT_443_TCP</span><span class="token operator">=</span>tcp://10.96.0.1:443
<span class="token assign-left variable">KUBERNETES_SERVICE_HOST</span><span class="token operator">=</span><span class="token number">10.96</span>.0.1
<span class="token assign-left variable"><span class="token environment constant">PWD</span></span><span class="token operator">=</span>/
<span class="token assign-left variable">DB_HOST</span><span class="token operator">=</span>localhost

\u6CE8\uFF1A
\u53EF\u4EE5\u770B\u5230 DB_HOST \u548C DB_PORT \u90FD\u5DF2\u7ECF\u6B63\u5E38\u8F93\u51FA\u4E86\uFF0C\u53E6\u5916\u7684\u73AF\u5883\u53D8\u91CF\u662F\u56E0\u4E3A\u6211\u4EEC\u8FD9\u2FA5\u76F4\u63A5\u628A cm-demo1 \u7ED9\u6CE8\u2F0A\u8FDB\u6765\u4E86\uFF0C\u6240\u4EE5\u628A\u4ED6\u4EEC\u7684\u6574\u4E2A\u952E\u503C\u7ED9\u8F93\u51FA\u51FA\u6765\u4E86\uFF0C\u8FD9\u4E5F\u662F\u7B26\u5408\u9884\u671F\u7684\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u4F7F\u2F64 ConfigMap \u6765\u8BBE\u7F6E\u547D\u4EE4\u2F8F\u53C2\u6570\uFF0C ConfigMap \u4E5F\u53EF\u4EE5\u88AB\u2F64\u6765\u8BBE\u7F6E\u5BB9\u5668\u4E2D\u7684\u547D\u4EE4\u6216\u8005\u53C2\u6570\u503C</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm2<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm2
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;echo $(DB_HOST) $(DB_PORT)&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_HOST
        <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 
          <span class="token key atrule">configMapKeyRef</span><span class="token punctuation">:</span> 
            <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo3  
            <span class="token key atrule">key</span><span class="token punctuation">:</span> db.host 
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_PORT 
        <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 
          <span class="token key atrule">configMapKeyRef</span><span class="token punctuation">:</span> 
            <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo3 
            <span class="token key atrule">key</span><span class="token punctuation">:</span> db.port
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml </span>
pod/testcm2<span class="token punctuation">-</span>pod created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl logs testcm2-pod </span>
localhost <span class="token number">3306</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u53E6\u5916\u2F00\u79CD\u662F\u2FAE\u5E38\u5E38\u2EC5\u7684\u4F7F\u2F64 ConfigMap \u7684\u2F45\u5F0F\uFF1A <ul><li>\u901A\u8FC7\u6570\u636E\u5377\u4F7F\u2F64\uFF0C\u5728\u6570\u636E\u5377\u2FA5\u2FAF\u4F7F\u2F64 ConfigMap</li><li>\u5C31\u662F\u5C06\u2F42\u4EF6\u586B\u2F0A\u6570\u636E\u5377\uFF0C\u5728\u8FD9\u4E2A\u2F42\u4EF6\u4E2D\uFF0C\u952E\u5C31\u662F\u2F42\u4EF6\u540D\uFF0C\u952E\u503C\u5C31\u662F\u2F42\u4EF6\u5185\u5BB9\uFF1A</li></ul></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm3<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> testcm3
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cat /etc/config/redis.conf&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>volume 
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/config 

  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>volume 
      <span class="token key atrule">configMap</span><span class="token punctuation">:</span> 
        <span class="token key atrule">name</span><span class="token punctuation">:</span> cm<span class="token punctuation">-</span>demo2
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml </span>
pod/testcm3<span class="token punctuation">-</span>pod created
<span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME          READY   STATUS      RESTARTS   AGE
testcm3<span class="token punctuation">-</span>pod   0/1     Completed   0          5s

\u6CE8\uFF1A
\u53E6\u5916\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u5F53 ConfigMap \u4EE5\u6570\u636E\u5377\u7684\u5F62\u5F0F\u6302\u8F7D\u8FDB Pod \u7684\u65F6\uFF0C\u8FD9\u65F6\u66F4\u65B0 ConfigMap \uFF08\u6216\u5220\u6389\u91CD\u5EFA ConfigMap \uFF09\uFF0C Pod \u5185\u6302\u8F7D\u7684\u914D\u7F6E\u4FE1\u606F\u4F1A\u70ED\u66F4\u65B0\u3002\u8FD9\u65F6\u53EF\u4EE5\u589E\u52A0\u2F00\u4E9B\u76D1\u6D4B\u914D\u7F6E\u2F42\u4EF6\u53D8\u66F4\u7684\u811A\u672C\uFF0C\u7136
\u540E reload \u5BF9\u5E94\u670D\u52A1\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master work<span class="token punctuation">]</span><span class="token comment"># kubectl  logs testcm3-pod </span>
<span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u654F\u611F\u6570\u636E\u5B58\u50A8-secret" tabindex="-1"><a class="header-anchor" href="#\u654F\u611F\u6570\u636E\u5B58\u50A8-secret" aria-hidden="true">#</a> \u654F\u611F\u6570\u636E\u5B58\u50A8\uFF1ASecret</h2><ul><li><p>\u8D44\u6E90\u5BF9\u8C61\uFF1A Secret</p><ul><li>\u5982\u679C\u6D89\u53CA\u5230\u2F00\u4E9B\u5B89\u5168\u76F8\u5173\u7684 \u6570\u636E\u7684\u8BDD\u2F64 ConfigMap \u5C31\u2FAE\u5E38\u4E0D\u59A5\u4E86\uFF0C\u56E0\u4E3A ConfigMap \u662F\u540D\u4E3A\u5B58\u50A8\u7684\uFF0C\u6211\u4EEC\u8BF4\u8FD9\u4E2A\u65F6\u5019\u6211\u4EEC\u5C31\u9700\u8981\u2F64 \u5230\u53E6\u5916\u2F00\u4E2A\u8D44\u6E90\u5BF9\u8C61\u4E86\uFF1A <code>Secret \uFF0C Secret \u2F64\u6765\u4FDD\u5B58\u654F\u611F\u4FE1\u606F\uFF0C\u4F8B\u5982\u5BC6\u7801\u3001OAuth \u4EE4\u724C\u548C ssh key\u7B49 \u7B49\uFF0C\u5C06\u8FD9\u4E9B\u4FE1\u606F\u653E\u5728 Secret \u4E2D\u2F50\u653E\u5728 Pod \u7684\u5B9A\u4E49\u4E2D\u6216\u8005 docker \u955C\u50CF\u4E2D\u6765\u8BF4\u66F4\u52A0\u5B89\u5168\u548C\u7075\u6D3B\u3002</code></li></ul></li><li><p><strong>Secret \u6709\u4E09\u79CD\u7C7B\u578B\uFF1A</strong></p></li><li><p>kubectl create secret \u652F\u6301\u4E09\u79CD\u6570\u636E\u7C7B\u578B\uFF1A</p><ul><li>generic\uFF1A\u4ECE\u6587\u4EF6\u3001\u76EE\u5F55\u6216\u8005\u5B57\u7B26\u4E32\u521B\u5EFA\uFF0C\u4F8B\u5982\u5B58\u50A8\u7528\u6237\u540D\u5BC6\u7801*</li><li>docker-registry\uFF1A\u5B58\u50A8\u955C\u50CF\u4ED3\u5E93\u8BA4\u8BC1\u4FE1\u606F*</li><li>tls\uFF1A\u5B58\u50A8\u8BC1\u4E66\uFF0C\u4F8B\u5982HTTPS\u8BC1\u4E66 <ul><li><code>Opaque</code>\uFF1A base64 \u7F16\u7801\u683C\u5F0F\u7684 Secret\uFF0C\u2F64\u6765\u5B58\u50A8\u5BC6\u7801\u3001\u5BC6\u94A5\u7B49\uFF1B\u4F46\u6570\u636E\u4E5F\u53EF\u4EE5\u901A\u8FC7base64 \u2013 decode\u89E3\u7801\u5F97\u5230\u539F\u59CB\u6570\u636E\uFF0C\u6240\u6709\u52A0\u5BC6\u6027\u5F88\u5F31\u3002</li><li><code>kubernetes.io/dockerconfigjson</code>\uFF1A \u2F64\u6765\u5B58\u50A8\u79C1\u6709docker registry\u7684\u8BA4\u8BC1\u4FE1\u606F\u3002</li><li><code>kubernetes.io/service-account-token</code>\uFF1A \u2F64\u4E8E\u88AB serviceaccount \u5F15\u2F64\uFF0Cserviceaccout \u521B\u5EFA\u65F6 Kubernetes\u4F1A\u9ED8\u8BA4\u521B\u5EFA\u5BF9\u5E94\u7684secret\u3002Pod\u5982\u679C\u4F7F\u2F64\u4E86serviceaccount\uFF0C\u5BF9\u5E94\u7684secret\u4F1A\u2F83\u52A8\u6302\u8F7D\u5230Pod\u2F6C\u5F55 /run/secrets/kubernetes.io/serviceaccount \u4E2D\u3002</li></ul></li></ul></li></ul><blockquote><p><strong>Opaque Secret</strong> Opaque \u7C7B\u578B\u7684\u6570\u636E\u662F\u2F00\u4E2A map \u7C7B\u578B\uFF0C\u8981\u6C42value\u662F base64 \u7F16\u7801\u683C\u5F0F\uFF0C\u2F50\u5982\u6211\u4EEC\u6765\u521B\u5EFA\u2F00\u4E2A\u2F64\u6237\u540D\u4E3A admin\uFF0C\u5BC6\u7801\u4E3A admin321 \u7684 Secret \u5BF9\u8C61\uFF0C\u2FB8\u5148\u6211\u4EEC\u5148\u628A\u8FD9\u2F64\u6237\u540D\u548C\u5BC6\u7801\u505A base64 \u7F16\u7801</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># echo  -n &quot;admin&quot; | base64</span>
<span class="token assign-left variable">YWRtaW4</span><span class="token operator">=</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># echo  -n &quot;admin123&quot; | base64</span>
<span class="token assign-left variable">YWRtaW4xMjM</span><span class="token operator">=</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>Secret\u7684generic\u4F7F\u7528</strong></p></blockquote><ul><li>\u4F7F\u7528\u5FEB\u901F\u90E8\u7F72yaml\u521B\u5EFA\u4E00\u4E2Asecret</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl create secret generic mysecret --type Opaque --from-literal=username=YWRtaW4=  --from-literal=password=YWRtaW4xMjM= --dry-run -o yaml &gt; secret.yaml </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat secret.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">password</span><span class="token punctuation">:</span> YWRtaW4xMjM=
  <span class="token key atrule">username</span><span class="token punctuation">:</span> YWRtaW4=
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mysecret
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u5229\u2F64 get secret \u547D\u4EE4\u67E5\u770B\uFF1A</li><li>\u5176\u4E2D default-token-cty7pdefault-token-n9w2d \u4E3A\u521B\u5EFA\u96C6\u7FA4\u65F6\u9ED8\u8BA4\u521B\u5EFA\u7684 secret\uFF0C\u88AB serviceacount/default \u5F15\u2F64\u3002</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f secret.yaml </span>
secret/mysecret created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get secrets </span>
NAME                  TYPE                                  DATA   AGE
default-token-rmwg8   kubernetes.io/service-account-token   <span class="token number">3</span>      170m
mysecret              Opaque                                <span class="token number">2</span>      11s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u4F7F\u2F64 describe \u547D\u4EE4\uFF0C\u67E5\u770B\u8BE6\u60C5\uFF1A</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl describe secrets mysecret  </span>
Name:         mysecret
Namespace:    default
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

Type:  Opaque

Data
<span class="token operator">==</span><span class="token operator">==</span>
password:  <span class="token number">12</span> bytes
username:  <span class="token number">8</span> bytes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>\u521B\u5EFA\u597D Secret \u5BF9\u8C61\u540E\uFF0C\u6709\u4E24\u79CD\u2F45\u5F0F\u6765\u4F7F\u2F64\u5B83\uFF1A</p><ul><li><strong><code>\u4EE5\u73AF\u5883\u53D8\u91CF\u7684\u5F62\u5F0F</code></strong></li><li><strong><code>\u4EE5Volume\u7684\u5F62\u5F0F\u6302\u8F7D</code></strong></li></ul></li><li><p><strong><code>\u73AF\u5883\u53D8\u91CF</code></strong></p></li><li><p>\u2FB8\u5148\u6211\u4EEC\u6765\u6D4B\u8BD5\u4E0B\u73AF\u5883\u53D8\u91CF\u7684\u2F45\u5F0F\uFF0C\u540C\u6837\u7684\uFF0C\u6211\u4EEC\u6765\u4F7F\u2F64\u2F00\u4E2A\u7B80\u5355\u7684 busybox \u955C\u50CF\u6765\u6D4B\u8BD5\u4E0B:(secret1- pod.yaml)</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat secret1.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret1<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> secret1
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span> 					<span class="token comment">#\u6CE8\u5165\u53D8\u91CF</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> USERNAME 		
      <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 			<span class="token comment">#\u53D8\u91CF\u7684\u6765\u6E90</span>
        <span class="token key atrule">secretKeyRef</span><span class="token punctuation">:</span> 		<span class="token comment">#\u6765\u6E90\u4E8Esecret\u7684mysecret</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> mysecret 	<span class="token comment">#\u540D\u79F0\u662Fmysecret</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> username		<span class="token comment">#\u53D8\u91CF\u662Fusername=admin  \u8F93\u51FAadmin</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PASSWORD  
      <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span> 
        <span class="token key atrule">secretKeyRef</span><span class="token punctuation">:</span> 
          <span class="token key atrule">name</span><span class="token punctuation">:</span> mysecret 
          <span class="token key atrule">key</span><span class="token punctuation">:</span> password 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f secret1.yaml  </span>
pod/secret1-pod created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME          READY   STATUS      RESTARTS   AGE
secret1-pod   <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          18s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u67E5\u770B\u65E5\u5FD7\u72B6\u6001</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl logs secret1-pod </span>
<span class="token assign-left variable">USERNAME</span><span class="token operator">=</span>admin
\xB7\xB7\xB7
<span class="token assign-left variable">PASSWORD</span><span class="token operator">=</span>admin123
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong><code>Volume \u6302\u8F7D</code></strong></p></li><li><p>\u540C\u6837\u7684\u6211\u4EEC\u2F64\u2F00\u4E2A Pod \u6765\u9A8C\u8BC1\u4E0B Volume \u6302\u8F7D\uFF0C\u521B\u5EFA\u2F00\u4E2A Pod \u2F42\u4EF6\uFF1A(secret2-pod.yaml)</p></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat secret2.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret1<span class="token punctuation">-</span>pod 
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> secret1
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ls /etc/secrets&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> secrets
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/secrets
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> secrets 
      <span class="token key atrule">secret</span><span class="token punctuation">:</span> 
        <span class="token key atrule">secretName</span><span class="token punctuation">:</span> mysecret
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f secret2.yaml  </span>
pod/secret1<span class="token punctuation">-</span>pod created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u67E5\u770B\u65E5\u5FD7</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@master ~]# kubectl logs secret1-pod 
password
username
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h2 id="secret\u7684docker-registry\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#secret\u7684docker-registry\u4F7F\u7528" aria-hidden="true">#</a> Secret\u7684docker-registry\u4F7F\u7528</h2></blockquote><ul><li><p><code>kubernetes.io/dockerconfigjson</code></p></li><li><p>\u9664\u4E86\u4E0A\u2FAF\u7684 Opaque \u8FD9\u79CD\u7C7B\u578B\u5916\uFF0C\u6211\u4EEC\u8FD8\u53EF\u4EE5\u6765\u521B\u5EFA\u2F64\u6237 docker registry \u8BA4\u8BC1\u7684 Secret \uFF0C\u76F4\u63A5\u4F7F \u2F64 kubectl create \u547D\u4EE4\u521B\u5EFA\u5373\u53EF</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl create secret docker-registry myregistry  --docker-server=DOCKER_SERVER --docker-username=DOCKER_USER --docker-password=DOCKER_PASSWORD --docker-email=DOCKER_EMAIL</span>
secret/myregistry created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get secret </span>
NAME                  TYPE                                  DATA   AGE
default-token-4wt8g   kubernetes.io/service-account-token   <span class="token number">3</span>      12h
myregistry            kubernetes.io/dockerconfigjson        <span class="token number">1</span>      7s


\u6CE8\uFF1A
\u6CE8\u610F\u770B\u4E0A\u2FAF\u7684 TYPE \u7C7B\u578B\uFF0C myregistry \u662F\u4E0D\u662F\u5BF9\u5E94\u7684 kubernetes.io/dockerconfigjson 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u67E5\u770Byaml\u7684\u8BE6\u7EC6</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get secrets myregistry -o yaml </span>
apiVersion: v1
data:
  .dockerconfigjson: <span class="token assign-left variable">eyJhdXRocyI6eyJET0NLRVJfU0VSVkVSIjp7InVzZXJuYW1lIjoiRE9DS0VSX1VTRVIiLCJwYXNzd29yZCI6IkRPQ0tFUl9QQVNTV09SRCIsImVtYWlsIjoiRE9DS0VSX0VNQUlMIiwiYXV0aCI6IlJFOURTMFZTWDFWVFJWSTZSRTlEUzBWU1gxQkJVMU5YVDFKRSJ9fX0</span><span class="token operator">=</span>
kind: Secret
metadata:
  creationTimestamp: <span class="token string">&quot;2021-11-07T10:24:34Z&quot;</span>
  managedFields:
  - apiVersion: v1
    fieldsType: FieldsV1
    fieldsV1:
      f:data:
        .: <span class="token punctuation">{</span><span class="token punctuation">}</span>
        f:.dockerconfigjson: <span class="token punctuation">{</span><span class="token punctuation">}</span>
      f:type: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    manager: kubectl
    operation: Update
    time: <span class="token string">&quot;2021-11-07T10:24:34Z&quot;</span>
  name: myregistry
  namespace: default
  resourceVersion: <span class="token string">&quot;104658&quot;</span>
  selfLink: /api/v1/namespaces/default/secrets/myregistry
  uid: f57dffb2-4c1a-41e7-9d9f-a5316b343771
type: kubernetes.io/dockerconfigjson
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u53EF\u4EE5\u628A\u4E0A\u2FAF\u7684 data.dockerconfigjson \u4E0B\u2FAF\u7684\u6570\u636E\u505A\u2F00\u4E2A base64 \u89E3\u7801\uFF0C\u770B\u770B\u2FA5\u2FAF\u7684\u6570\u636E\u662F\u600E\u6837\u7684</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># echo eyJhdXRocyI6eyJET0NLRVJfU0VSVkVSIjp7InVzZXJuYW1lIjoiRE9DS0VSX1VTRVIiLCJwYXNzd29yZCI6IkRPQ0tFUl9QQVNTV09SRCIsImVtYWlsIjoiRE9DS0VSX0VNQUlMIiwiYXV0aCI6IlJFOURTMFZTWDFWVFJWSTZSRTlEUzBWU1gxQkJVMU5YVDFKRSJ9fX0= | base64 -d</span>
<span class="token punctuation">{</span><span class="token string">&quot;auths&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;DOCKER_SERVER&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;username&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;DOCKER_USER&quot;</span>,<span class="token string">&quot;password&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;DOCKER_PASSWORD&quot;</span>,<span class="token string">&quot;email&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;DOCKER_EMAIL&quot;</span>,<span class="token string">&quot;auth&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;RE9DS0VSX1VTRVI6RE9DS0VSX1BBU1NXT1JE&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u5982\u679C\u6211\u4EEC\u9700\u8981\u62C9\u53D6\u79C1\u6709\u4ED3\u5E93\u4E2D\u7684 docker \u955C\u50CF\u7684\u8BDD\u5C31\u9700\u8981\u4F7F\u2F64\u5230\u4E0A\u2FAF\u7684 myregistry \u8FD9\u4E2A Secret</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vim pod.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> 172.25.253.19/library/nginx
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myregistrykey
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="secret-\u4E0E-configmap-\u5BF9\u6BD4" tabindex="-1"><a class="header-anchor" href="#secret-\u4E0E-configmap-\u5BF9\u6BD4" aria-hidden="true">#</a> Secret \u4E0E ConfigMap \u5BF9\u2F50</h2><blockquote><p>\u6700\u540E\u6211\u4EEC\u6765\u5BF9\u2F50\u4E0B Secret \u548C ConfigMap \u8FD9\u4E24\u79CD\u8D44\u6E90\u5BF9\u8C61\u7684\u5F02\u540C\u70B9\uFF1A</p></blockquote>`,106),v=n("li",null,[n("p",null,"\u76F8\u540C\u70B9\uFF1A"),n("ul",null,[n("li",null,"key/value\u7684\u5F62\u5F0F"),n("li",null,"\u5C5E\u4E8E\u67D0\u4E2A\u7279\u5B9A\u7684namespace"),n("li",null,"\u53EF\u4EE5\u5BFC\u51FA\u5230\u73AF\u5883\u53D8\u91CF"),n("li",null,"\u53EF\u4EE5\u901A\u8FC7\u2F6C\u5F55/\u2F42\u4EF6\u5F62\u5F0F\u6302\u8F7D"),n("li",null,"\u901A\u8FC7 volume \u6302\u8F7D\u7684\u914D\u7F6E\u4FE1\u606F\u5747\u53EF\u70ED\u66F4\u65B0")])],-1),b=n("p",null,"\u4E0D\u540C\u70B9\uFF1A",-1),g=n("li",null,"Secret \u53EF\u4EE5\u88AB ServerAccount \u5173\u8054",-1),y=n("li",null,"Secret \u53EF\u4EE5\u5B58\u50A8 docker register \u7684\u9274\u6743\u4FE1\u606F\uFF0C\u2F64\u5728 ImagePullSecret \u53C2\u6570\u4E2D\uFF0C\u2F64\u4E8E\u62C9\u53D6\u79C1\u6709\u4ED3\u5E93\u7684\u955C\u50CF",-1),h=n("li",null,"Secret \u2F40\u6301 Base64 \u52A0\u5BC6",-1),f={href:"http://kubernetes.io/service-account-token%E3%80%81kubernetes.io/dockerconfigjson%E3%80%81Opaque",target:"_blank",rel:"noopener noreferrer"};function S(E,P){const a=i("ExternalLinkIcon");return l(),o("div",null,[u,n("p",null,[s("\u200B\u6301\u4E45\u5377\uFF08PersistentVolume\uFF0CPV\uFF09\u662F\u96C6\u7FA4\u4E2D\u7684\u4E00\u5757\u5B58\u50A8\uFF0C\u53EF\u4EE5\u7531\u7BA1\u7406\u5458\u4E8B\u5148\u4F9B\u5E94\uFF0C\u6216\u8005 \u4F7F\u7528"),n("a",r,[s("\u5B58\u50A8\u7C7B\uFF08Storage Class\uFF09"),e(a)]),s("\u6765\u52A8\u6001\u4F9B\u5E94\u3002 \u6301\u4E45\u5377\u662F\u96C6\u7FA4\u8D44\u6E90\uFF0C\u5C31\u50CF\u8282\u70B9\u4E5F\u662F\u96C6\u7FA4\u8D44\u6E90\u4E00\u6837\u3002PV \u6301\u4E45\u5377\u548C\u666E\u901A\u7684 Volume \u4E00\u6837\uFF0C\u4E5F\u662F\u4F7F\u7528 \u5377\u63D2\u4EF6\u6765\u5B9E\u73B0\u7684\uFF0C\u53EA\u662F\u5B83\u4EEC\u62E5\u6709\u72EC\u7ACB\u4E8E\u4EFB\u4F55\u4F7F\u7528 PV \u7684 Pod \u7684\u751F\u547D\u5468\u671F\u3002")]),d,n("p",null,[s("\u9879\u76EE\u5730\u5740\uFF1A"),n("a",k,[s("https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner"),e(a)])]),m,n("ul",null,[v,n("li",null,[b,n("ul",null,[g,y,h,n("li",null,[s("Secret \u5206\u4E3A "),n("a",f,[s("kubernetes.io/service-account-token\u3001kubernetes.io/dockerconfigjson\u3001Opaque"),e(a)]),s(" \u4E09\u79CD\u7C7B\u578B\uFF0C\u2F7D Configmap \u4E0D\u533A\u5206\u7C7B\u578B")])])])])])}const A=p(c,[["render",S],["__file","09.Kubernetes\u5B58\u50A8.html.vue"]]);export{A as default};
