import{_ as a}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as e,f as n}from"./app.ca0279c0.js";const t={},r=n(`<h1 id="iptables" tabindex="-1"><a class="header-anchor" href="#iptables" aria-hidden="true">#</a> Iptables</h1><h2 id="\u5E38\u89C1\u51E0\u79CD\u7C7B\u578B\u9632\u706B\u5899" tabindex="-1"><a class="header-anchor" href="#\u5E38\u89C1\u51E0\u79CD\u7C7B\u578B\u9632\u706B\u5899" aria-hidden="true">#</a> \u5E38\u89C1\u51E0\u79CD\u7C7B\u578B\u9632\u706B\u5899\uFF1F</h2><ul><li><strong><code>\u5305\u8FC7\u6EE4\u9632\u706B\u5899</code>\uFF1A\u5305\u8FC7\u6EE4\u662F IP \u5C42\u5B9E\u73B0\uFF0C\u5305\u8FC7\u6EE4\u6839\u636E\u6570\u636E\u5305\u7684\u6E90 IP\u3001\u76EE\u7684 IP\u3001\u534F\u8BAE\u7C7B\u578B \uFF08TCP/UDP/ICMP\uFF09\u3001\u6E90\u7AEF\u53E3\u3001\u76EE\u7684\u7AEF\u53E3\u7B49\u5305\u5934\u4FE1\u606F\u53CA\u6570\u636E\u5305\u4F20\u8F93\u65B9\u5411\u706F\u4FE1\u606F\u6765\u5224\u65AD\u662F\u5426\u5141\u8BB8\u6570\u636E\u5305 \u901A\u8FC7\u3002</strong></li><li><strong><code>\u5E94\u7528\u5C42\u9632\u706B\u5899</code>\uFF1A\u4E5F\u79F0\u4E3A\u5E94\u7528\u5C42\u4EE3\u7406\u9632\u706B\u5899\uFF0C\u57FA\u4E8E\u5E94\u7528\u5C42\u534F\u8BAE\u7684\u4FE1\u606F\u6D41\u68C0\u6D4B\uFF0C\u53EF\u4EE5\u62E6\u622A\u67D0\u5E94\u7528\u7A0B\u5E8F\u7684 \u6240\u6709\u5C01\u5305\uFF0C\u63D0\u53D6\u5305\u5185\u5BB9\u8FDB\u884C\u5206\u6790\u3002\u6709\u6548\u9632\u6B62 SQL \u6CE8\u5165\u6216\u8005 XSS\uFF08\u8DE8\u7AD9\u811A\u672C\u653B\u51FB\uFF09\u4E4B\u7C7B\u7684\u6076\u610F\u4EE3\u7801\u3002</strong></li><li><strong><code>\u72B6\u6001\u68C0\u6D4B\u9632\u706B\u5899</code>\uFF1A\u7ED3\u5408\u5305\u8FC7\u6EE4\u548C\u5E94\u7528\u5C42\u9632\u706B\u5899\u4F18\u70B9\uFF0C\u57FA\u4E8E\u8FDE\u63A5\u72B6\u6001\u68C0\u6D4B\u673A\u5236\uFF0C\u5C06\u5C5E\u4E8E\u540C\u4E00\u8FDE\u63A5\u7684\u6240 \u6709\u5305\u4F5C\u4E3A\u4E00\u4E2A\u6574\u4F53\u7684\u6570\u636E\u6D41\u770B\u5F85\uFF0C\u6784\u6210\u8FDE\u63A5\u72B6\u6001\u8868\uFF08\u901A\u4FE1\u4FE1\u606F\uFF0C\u5E94\u7528\u7A0B\u5E8F\u4FE1\u606F\u7B49\uFF09\uFF0C\u901A\u8FC7\u89C4\u5219\u8868\u4E0E \u72B6\u6001\u8868\u5171\u540C\u914D\u5408\uFF0C\u5BF9\u8868\u4E2D\u7684\u5404\u4E2A\u8FDE\u63A5\u72B6\u6001\u5224\u65AD\u3002</strong></li></ul><h2 id="\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#\u7B80\u4ECB" aria-hidden="true">#</a> <strong>\u7B80\u4ECB</strong></h2><p><strong><code>iptables \u662F Linux \u4E0B\u7684\u914D\u7F6E\u9632\u706B\u5899\u7684\u5DE5\u5177</code>\uFF0C\u7528\u4E8E\u914D\u7F6E Linux \u5185\u6838\u96C6\u6210\u7684 IP \u4FE1\u606F\u5305\u8FC7\u6EE4\u7CFB\u7EDF\uFF0C\u4F7F\u589E \u5220\u6539\u67E5\u4FE1\u606F\u5305\u8FC7\u6EE4\u8868\u4E2D\u7684\u89C4\u5219\u66F4\u52A0\u7B80\u5355\u3002 iptables \u5206\u4E3A\u56DB\u8868\u4E94\u94FE\uFF0C\u8868\u662F\u94FE\u7684\u5BB9\u5668\uFF0C\u94FE\u662F\u89C4\u5219\u7684\u5BB9\u5668\uFF0C\u89C4\u5219\u6307\u5B9A\u52A8\u4F5C\u3002</strong></p><h2 id="\u56DB\u8868" tabindex="-1"><a class="header-anchor" href="#\u56DB\u8868" aria-hidden="true">#</a> \u56DB\u8868</h2><table><thead><tr><th>filter</th><th>\u7528\u4E8E\u5305\u8FC7\u6EE4</th></tr></thead><tbody><tr><td><strong>nat</strong></td><td><strong>\u7F51\u7EDC\u5730\u5740\u8F6C\u53D1</strong></td></tr><tr><td><strong>mangle</strong></td><td><strong>\u5BF9\u7279\u5B9A\u6570\u636E\u5305\u4FEE\u6539</strong></td></tr><tr><td><strong>raw</strong></td><td><strong>\u4E0D\u505A\u6570\u636E\u5305\u94FE\u63A5\u8DDF\u8E2A</strong></td></tr></tbody></table><h2 id="\u4E94\u94FE" tabindex="-1"><a class="header-anchor" href="#\u4E94\u94FE" aria-hidden="true">#</a> \u4E94\u94FE</h2><table><thead><tr><th><strong>INPUT</strong></th><th><strong>\u672C\u673A\u6570\u636E\u5305\u5165\u53E3</strong></th></tr></thead><tbody><tr><td><strong>OUTPUT</strong></td><td><strong>\u672C\u673A\u6570\u636E\u5305\u51FA\u53E3</strong></td></tr><tr><td><strong>FORWARD</strong></td><td><strong>\u7ECF\u8FC7\u672C\u673A\u8F6C\u53D1\u7684\u6570\u636E\u5305</strong></td></tr><tr><td><strong>PREROUTING</strong></td><td><strong>\u9632\u706B\u5899\u4E4B\u524D\uFF0C\u4FEE\u6539\u76EE\u7684\u5730\u5740\uFF08DNAT\uFF09</strong></td></tr><tr><td><strong>POSTROUTING</strong></td><td><strong>\u9632\u706B\u5899\u4E4B\u540E\uFF0C\u4FEE\u6539\u6E90\u5730\u5740\uFF08SNAT\uFF09</strong></td></tr></tbody></table><h2 id="\u8868\u4E2D\u7684\u94FE" tabindex="-1"><a class="header-anchor" href="#\u8868\u4E2D\u7684\u94FE" aria-hidden="true">#</a> \u8868\u4E2D\u7684\u94FE</h2><p><img src="https://pic.imgdb.cn/item/61ec01582ab3f51d91284675.png" alt="" loading="lazy"></p><h2 id="\u547D\u4EE4\u683C\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u547D\u4EE4\u683C\u5F0F" aria-hidden="true">#</a> \u547D\u4EE4\u683C\u5F0F</h2><p><strong>\u547D\u4EE4\u683C\u5F0F\uFF1Aiptables [-t table] \u547D\u4EE4 [chain] \u5339\u914D\u6761\u4EF6 \u52A8\u4F5C</strong></p><p><strong>\u547D\u4EE4 \u63CF\u8FF0</strong></p><p><strong><code>-A\uFF0Cappend</code> \u8FFD\u52A0\u4E00\u6761\u89C4\u5219</strong></p><p><strong><code>-I\uFF0Cinsert</code> \u63D2\u5165\u4E00\u6761\u89C4\u5219\uFF0C\u9ED8\u8BA4\u94FE\u5934\uFF0C\u540E\u8DDF\u7F16\u53F7\uFF0C\u6307\u5B9A\u7B2C\u51E0\u6761</strong></p><p><strong><code>-D\uFF0Cdelete</code> \u5220\u9664\u4E00\u6761\u89C4\u5219</strong></p><p><strong><code>-F\uFF0Cflush</code> \u6E05\u7A7A\u89C4\u5219</strong></p><p><strong><code>-L\uFF0Clist</code> \u5217\u51FA\u89C4\u5219</strong></p><p><strong><code>-P\uFF0Cpolicy</code> \u8BBE\u7F6E\u94FE\u7F3A\u7701\u89C4\u5219</strong></p><p><strong><code>-m\uFF0Cmodule</code> \u6A21\u5757\uFF0C\u6BD4\u5982 state\u3001multiport</strong></p><p><strong><code>-X</code> \u5220\u9664\u6307\u5B9A\u8868\u4E2D\u7528\u6237\u81EA\u5B9A\u4E49\u7684\u89C4\u5219\u94FE\uFF08delete-chain\uFF09</strong></p><p><strong><code>-Z</code> \u5C06\u6240\u6709\u8868\u7684\u6240\u6709\u94FE\u7684\u5B57\u8282\u548C\u6570\u636E\u5305\u8BA1\u6570\u5668\u6E05\u96F6</strong></p><h2 id="\u5339\u914D\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u5339\u914D\u6761\u4EF6" aria-hidden="true">#</a> \u5339\u914D\u6761\u4EF6</h2><p><img src="https://pic.imgdb.cn/item/61ec01582ab3f51d9128467c.png" alt="" loading="lazy"></p><p><img src="https://pic.imgdb.cn/item/61ec01582ab3f51d91284683.png" alt="" loading="lazy"></p><p><img src="https://pic.imgdb.cn/item/61ec01582ab3f51d91284690.png" alt="" loading="lazy"></p><h2 id="\u5E38\u7528\u7684\u89C4\u5219\u914D\u7F6E\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#\u5E38\u7528\u7684\u89C4\u5219\u914D\u7F6E\u65B9\u6CD5" aria-hidden="true">#</a> \u5E38\u7528\u7684\u89C4\u5219\u914D\u7F6E\u65B9\u6CD5</h2><h4 id="\u67E5\u770Biptables\u7684\u5217\u8868" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770Biptables\u7684\u5217\u8868" aria-hidden="true">#</a> \u67E5\u770BIptables\u7684\u5217\u8868</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ iptables <span class="token parameter variable">--list</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u6E05\u7A7A\u8868\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#\u6E05\u7A7A\u8868\u89C4\u5219" aria-hidden="true">#</a> \u6E05\u7A7A\u8868\u89C4\u5219</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ iptables <span class="token parameter variable">-F</span> 			<span class="token comment"># \u6E05\u7A7A\u8868\u89C4\u5219\uFF0C\u9ED8\u8BA4 filter \u8868</span>
$ iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-F</span> 	<span class="token comment"># \u6E05\u7A7A nat \u8868</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u5141\u8BB8\u7AEF\u53E3\u8BBF\u95EE" tabindex="-1"><a class="header-anchor" href="#\u5141\u8BB8\u7AEF\u53E3\u8BBF\u95EE" aria-hidden="true">#</a> \u5141\u8BB8\u7AEF\u53E3\u8BBF\u95EE</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> ACCEPT 		<span class="token comment"># \u5141\u8BB8 TCP \u7684 22 \u7AEF\u53E3\u8BBF\u95EE</span>
$ iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> udp <span class="token parameter variable">--dport</span> <span class="token number">53</span> <span class="token parameter variable">-j</span> ACCEPT 		<span class="token comment"># \u5141\u8BB8 UDP \u7684 53 \u7AEF\u53E3\u8BBF\u95EE\uFF0C\u63D2\u5165\u5728\u7B2C\u4E00\u6761</span>
$ iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span>:25 <span class="token parameter variable">-j</span> ACCEPT 	<span class="token comment"># \u5141\u8BB8\u7AEF\u53E3\u8303\u56F4\u8BBF\u95EE</span>
$ iptables <span class="token parameter variable">-D</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span>:25 <span class="token parameter variable">-j</span> ACCEPT 	<span class="token comment"># \u5220\u9664\u8FD9\u6761\u89C4\u5219</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u5141\u8BB8\u8303\u56F4" tabindex="-1"><a class="header-anchor" href="#\u5141\u8BB8\u8303\u56F4" aria-hidden="true">#</a> \u5141\u8BB8\u8303\u56F4</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> multiport <span class="token parameter variable">--dports</span> <span class="token number">22,80</span>,8080 <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># \u5141\u8BB8\u591A\u4E2ATCP\u7AEF\u53E3\u8BBF\u95EE</span>
$ iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.1.0/24 <span class="token parameter variable">-j</span> ACCEPT 						<span class="token comment"># \u5141\u8BB8 192.168.1.0 \u6BB5 IP \u8BBF\u95EE</span>
$ iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.1.10 <span class="token parameter variable">-j</span> DROP 							<span class="token comment"># \u5BF9 1.10 \u6570\u636E\u5305\u4E22\u5F03</span>
$ iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-i</span> eth0 <span class="token parameter variable">-p</span> icmp <span class="token parameter variable">-j</span> DROP 							<span class="token comment"># eth0 \u7F51\u5361 ICMP \u6570\u636E\u5305\u4E22\u5F03\uFF0C\u4E5F\u5C31\u662F\u7981 ping</span>

<span class="token comment"># \u5141\u8BB8\u6765\u81EA lo \u63A5\u53E3\uFF0C\u5982\u679C\u6CA1\u6709\u8FD9\u6761\u89C4\u5219\uFF0C\u5C06\u4E0D\u80FD\u901A\u8FC7 127.0.0.1 \u8BBF\u95EE\u672C\u5730\u670D\u52A1</span>
$ iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-i</span> lo <span class="token parameter variable">-j</span> ACCEPT

<span class="token comment"># \u9650\u5236\u5E76\u53D1\u8FDE\u63A5\u6570\uFF0C\u8D85\u8FC7 30 \u4E2A\u62D2\u7EDD</span>
$ iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--syn</span> <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-m</span> connlimit --connlimit-above <span class="token number">30</span> <span class="token parameter variable">-j</span> REJECT
$ iptables <span class="token parameter variable">-A</span> FORWARD <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--syn</span> <span class="token parameter variable">-m</span> limit <span class="token parameter variable">--limit</span> <span class="token number">1</span>/s <span class="token parameter variable">-j</span> ACCEPT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u5176\u4ED6" tabindex="-1"><a class="header-anchor" href="#\u5176\u4ED6" aria-hidden="true">#</a> \u5176\u4ED6</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># iptables \u670D\u52A1\u5668\u4F5C\u4E3A\u7F51\u5173\u65F6\uFF0C\u5185\u7F51\u8BBF\u95EE\u516C\u7F51</span>
$ iptables \u2013t nat <span class="token parameter variable">-A</span> POSTROUTING <span class="token parameter variable">-s</span> <span class="token punctuation">[</span>\u5185\u7F51 IP \u6216\u7F51\u6BB5<span class="token punctuation">]</span> <span class="token parameter variable">-j</span> SNAT <span class="token parameter variable">--to</span> <span class="token punctuation">[</span>\u516C\u7F51 IP<span class="token punctuation">]</span>

<span class="token comment"># \u8BBF\u95EE iptables \u516C\u7F51 IP \u7AEF\u53E3\uFF0C\u8F6C\u53D1\u5230\u5185\u7F51\u670D\u52A1\u5668\u7AEF\u53E3</span>
$ iptables \u2013t nat <span class="token parameter variable">-A</span> PREROUTING <span class="token parameter variable">-d</span> <span class="token punctuation">[</span>\u5BF9\u5916 IP<span class="token punctuation">]</span> <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token punctuation">[</span>\u5BF9\u5916\u7AEF\u53E3<span class="token punctuation">]</span> <span class="token parameter variable">-j</span> DNAT <span class="token parameter variable">--to</span> <span class="token punctuation">[</span>\u5185\u7F51 IP:\u5185\u7F51\u7AEF\u53E3<span class="token punctuation">]</span>

<span class="token comment"># \u672C\u5730 80 \u7AEF\u53E3\u8F6C\u53D1\u5230\u672C\u5730 8080 \u7AEF\u53E3</span>
$ iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> PREROUTING <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> REDIRECT --to-ports <span class="token number">8080</span>

<span class="token comment"># \u5141\u8BB8\u5DF2\u5EFA\u7ACB\u53CA\u8BE5\u94FE\u63A5\u76F8\u5173\u8054\u7684\u6570\u636E\u5305\u901A\u8FC7</span>
$ iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> ESTABLISHED,RELATED <span class="token parameter variable">-j</span> ACCEPT

<span class="token comment"># ASDL \u62E8\u53F7\u4E0A\u7F51</span>
$ iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> POSTROUTING <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.1.0/24 <span class="token parameter variable">-o</span> pppo <span class="token parameter variable">-j</span> MASQUERADE

<span class="token comment"># \u8BBE\u7F6E INPUT \u94FE\u7F3A\u7701\u64CD\u4F5C\u4E22\u5F03\u6240\u6709\u6570\u636E\u5305\uFF0C\u53EA\u8981\u4E0D\u7B26\u5408\u89C4\u5219\u7684\u6570\u636E\u5305\u90FD\u4E22\u5F03\u3002\u6CE8\u610F\u8981\u5728\u6700\u540E\u8BBE\u7F6E\uFF0C\u4EE5\u514D\u628A\u81EA\u5DF1\u5173\u5728\u5916\u9762\uFF01</span>
$ iptables <span class="token parameter variable">-P</span> INPUT DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,38),p=[r];function l(i,o){return s(),e("div",null,p)}const m=a(t,[["render",l],["__file","3.html.vue"]]);export{m as default};
