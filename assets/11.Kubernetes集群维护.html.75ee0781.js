import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,f as e}from"./app.ca0279c0.js";const t={},i=e(`<h1 id="kubernetes\u96C6\u7FA4\u7EF4\u62A4" tabindex="-1"><a class="header-anchor" href="#kubernetes\u96C6\u7FA4\u7EF4\u62A4" aria-hidden="true">#</a> Kubernetes\u96C6\u7FA4\u7EF4\u62A4</h1><h2 id="etcd\u6570\u636E\u5907\u4EFD\u4E0E\u6062\u590D" tabindex="-1"><a class="header-anchor" href="#etcd\u6570\u636E\u5907\u4EFD\u4E0E\u6062\u590D" aria-hidden="true">#</a> Etcd\u6570\u636E\u5907\u4EFD\u4E0E\u6062\u590D</h2><p><strong>kubernetes\u4F7F\u7528Etcd\u6570\u636E\u5E93\u5B9E\u65F6\u5B58\u50A8\u96C6\u7FA4\u4E2D\u7684\u6570\u636E\uFF0C\u5B89\u5168\u8D77\u89C1\uFF0C\u4E00\u5B9A\u8981\u5907\u4EFD\u3002</strong></p><h3 id="\u5B89\u88C5etcd" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5etcd" aria-hidden="true">#</a> \u5B89\u88C5etcd</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master etcd<span class="token punctuation">]</span><span class="token comment"># yum install -y etcd </span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># etcdctl --version </span>
etcdctl version: <span class="token number">3.3</span>.11
API version: <span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5907\u4EFDetcd\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#\u5907\u4EFDetcd\u6570\u636E\u5E93" aria-hidden="true">#</a> \u5907\u4EFDetcd\u6570\u636E\u5E93</h3><p><strong>\u5982\u679C\u5DE5\u5177\u7248\u672C\u662F3\u9ED8\u8BA4API\u7248\u672C\u662F2\u5C31\u8981\u6362\u62103\u7248\u672C</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master etcd<span class="token punctuation">]</span><span class="token comment"># ETCDCTL_API=3 etcdctl \\</span>
snapshot save snap.db <span class="token punctuation">\\</span> 						<span class="token comment">#\u5907\u4EFD\uFF0C\u6307\u5B9A\u4E00\u4E2A\u6587\u4EF6\u540D\uFF0C\u5728\u7EBF\u8FDB\u884C\u5907\u4EFD</span>
<span class="token parameter variable">--endpoints</span><span class="token operator">=</span>https://127.0.0.1:2379 <span class="token punctuation">\\</span>			<span class="token comment">#\u8FDE\u63A5ETCD\u7684\u8282\u70B9  \u4F7F\u7528ss -ntpl |grep 2379,\u9700\u8981\u67E5\u770B\u7F51\u7EDC\u63D2\u4EF6\u662F\u5426\u4F7F\u7528\u5BBF\u4E3B\u673A\u7684\uFF0C\u8BBF\u95EE\u5E26\u4E0Aca\u8BC1\u4E66\u6821\u9A8C</span>
<span class="token parameter variable">--cacert</span><span class="token operator">=</span>/etc/kubernetes/pki/etcd/ca.crt <span class="token punctuation">\\</span>		<span class="token comment">#\u6307\u5B9A\u8BC1\u4E66\u7684\u516C\u5171\u76EE\u5F55\u4E0B\u7684etcd\u76EE\u5F55\u7684ca.crt </span>
<span class="token parameter variable">--cert</span><span class="token operator">=</span>/etc/kubernetes/pki/etcd/server.crt <span class="token punctuation">\\</span> 	<span class="token comment">#\u6307\u5B9A\u6570\u5B57\u8BC1\u4E66</span>
<span class="token parameter variable">--key</span><span class="token operator">=</span>/etc/kubernetes/pki/etcd/server.key  		<span class="token comment">#\u6307\u5B9A\u5BC6\u94A5</span>

Snapshot saved at snap.db

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># du -sh snap.db 				#\u67E5\u770B\u5927\u5C0F</span>
<span class="token number">4</span>.2M    snap.db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5220\u9664\u6570\u636Edeployment" tabindex="-1"><a class="header-anchor" href="#\u5220\u9664\u6570\u636Edeployment" aria-hidden="true">#</a> \u5220\u9664\u6570\u636Edeployment</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deployment </span>
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
web    <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           161m
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete deployment web </span>
deployment.apps <span class="token string">&quot;web&quot;</span> deleted
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deployment </span>
No resources found <span class="token keyword">in</span> default namespace.


\u53EF\u4EE5\u770B\u5230\u5F53\u524D\u662F\u6CA1\u6709deployment\u7684
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6062\u590D\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#\u6062\u590D\u6570\u636E" aria-hidden="true">#</a> \u6062\u590D\u6570\u636E</h3><ul><li><strong>\u5148\u6682\u505Ckube-apiserver\u548Cetcd\u5BB9\u5668</strong></li><li><strong>\u76F8\u5F53\u4E8E\u628A\u4E4B\u524D\u7684\u6587\u4EF6\u5939\u6362\u4E2A\u540D\u5B57\u505A\u5907\u4EFD\u6D4B\u8BD5</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mv /etc/kubernetes/manifests /etc/kubernetes/manifests.bak</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mv /var/lib/etcd/ /var/lib/etcd.back </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6062\u590D" tabindex="-1"><a class="header-anchor" href="#\u6062\u590D" aria-hidden="true">#</a> \u6062\u590D</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># ETCDCTL_API=3 etcdctl snapshot restore snap.db --data-dir=/var/lib/etcd</span>
<span class="token number">2021</span>-11-08 <span class="token number">22</span>:46:35.934598 I <span class="token operator">|</span> mvcc: restore compact to <span class="token number">19609</span>
<span class="token number">2021</span>-11-08 <span class="token number">22</span>:46:35.941164 I <span class="token operator">|</span> etcdserver/membership: added member 8e9e05c52164694d <span class="token punctuation">[</span>http://localhost:2380<span class="token punctuation">]</span> to cluster cdf818194e3a8c32

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mv /etc/kubernetes/manifests.bak/ /etc/kubernetes/manifests</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart kubelet </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u67E5\u770B\u6570\u636E\u6062\u590D\u60C5\u51B5" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770B\u6570\u636E\u6062\u590D\u60C5\u51B5" aria-hidden="true">#</a> \u67E5\u770B\u6570\u636E\u6062\u590D\u60C5\u51B5</h3><ul><li><strong>\u8FD9\u91CC\u9700\u8981\u7A0D\u7B49\u4E00\u4F1A\uFF0C\u7136\u540E\u7B49\u5F85Pods\u91CD\u65B0\u6784\u5EFA\u8D77\u6765</strong></li><li><strong>\u67E5\u770Bdeployment\u662F\u5426\u5B58\u5728\u4E4B\u524D\u7684\u6570\u636E</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -A </span>
NAMESPACE       NAME                                       READY   STATUS    RESTARTS   AGE
default         web-96d5df5c8-w2vvf                        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          172m
ingress-nginx   nginx-ingress-controller-gvfvl             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h29m
kube-system     calico-kube-controllers-659bd7879c-qv5qx   <span class="token number">1</span>/1     Running   <span class="token number">6</span>          4h2m
kube-system     calico-node-df8kn                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4h2m
kube-system     calico-node-xrmnz                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h57m
kube-system     client3                                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          79m
kube-system     coredns-7f89b7bc75-jwxfg                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4h2m
kube-system     coredns-7f89b7bc75-qf8dg                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4h2m
kube-system     etcd-master                                <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4h2m
kube-system     kube-apiserver-master                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4h2m
kube-system     kube-controller-manager-master             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4h
kube-system     kube-proxy-mbhtv                           <span class="token number">1</span>/1     Running   <span class="token number">1</span>          4h2m
kube-system     kube-proxy-n8qc8                           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h57m
kube-system     kube-scheduler-master                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4h2m

root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deployment </span>
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
web    <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           172m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="k8s\u96C6\u7FA4\u7248\u672C\u5347\u7EA7" tabindex="-1"><a class="header-anchor" href="#k8s\u96C6\u7FA4\u7248\u672C\u5347\u7EA7" aria-hidden="true">#</a> K8S\u96C6\u7FA4\u7248\u672C\u5347\u7EA7</h2><p><strong>Kubernetes\u6BCF\u96943\u4E2A\u6708\u53D1\u5E03\u4E00\u4E2A\u5C0F\u7248\u672C\u3002</strong></p><h3 id="\u5347\u7EA7\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#\u5347\u7EA7\u7B56\u7565" aria-hidden="true">#</a> \u5347\u7EA7\u7B56\u7565\uFF1A</h3><ul><li><p><strong>\u59CB\u7EC8\u4FDD\u6301\u6700\u65B0</strong></p></li><li><p><strong>\u6BCF\u534A\u5E74\u5347\u7EA7\u4E00\u6B21\uFF0C\u8FD9\u6837\u4F1A\u843D\u540E\u793E\u533A1-2\u4E2A\u7248\u672C</strong></p></li><li><p><strong>\u4E00\u5E74\u5347\u7EA7\u4E00\u6B21\uFF0C\u6216\u8005\u66F4\u957F\uFF0C\u843D\u540E\u7248\u672C\u592A\u591A</strong></p></li></ul><h3 id="\u5347\u7EA7\u7684\u57FA\u672C\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u5347\u7EA7\u7684\u57FA\u672C\u6D41\u7A0B" aria-hidden="true">#</a> \u5347\u7EA7\u7684\u57FA\u672C\u6D41\u7A0B</h3><ul><li><strong>\u5347\u7EA7\u7BA1\u7406\u8282\u70B9 &gt; \u5347\u7EA7\u5176\u4ED6\u7BA1\u7406\u8282\u70B9 &gt; \u5347\u7EA7\u5DE5\u4F5C\u8282\u70B9</strong></li></ul><h3 id="\u6CE8\u610F\u4E8B\u9879" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u610F\u4E8B\u9879" aria-hidden="true">#</a> \u6CE8\u610F\u4E8B\u9879\uFF1A</h3><ul><li><p><strong>\u5347\u7EA7\u4E4B\u524D\u5FC5\u987B\u5907\u4EFD\u6240\u6709\u7EC4\u4EF6\u4EE5\u53CA\u6570\u636E\uFF0C\u4F8B\u5982etcd</strong></p></li><li><p><strong>\u5343\u4E07\u4E0D\u8981\u8DE8\u591A\u4E2A\u5C0F\u7248\u672C\u8FDB\u884C\u5347\u7EA7\uFF0C\u4F8B\u5982\u4ECE1.16-1.19</strong></p></li></ul><blockquote><h3 id="kubeadm\u5BF9k8s\u96C6\u7FA4\u8FDB\u884C\u7248\u672C\u5347\u7EA7" tabindex="-1"><a class="header-anchor" href="#kubeadm\u5BF9k8s\u96C6\u7FA4\u8FDB\u884C\u7248\u672C\u5347\u7EA7" aria-hidden="true">#</a> Kubeadm\u5BF9K8S\u96C6\u7FA4\u8FDB\u884C\u7248\u672C\u5347\u7EA7</h3></blockquote><h3 id="\u5347\u7EA7\u7BA1\u7406\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#\u5347\u7EA7\u7BA1\u7406\u8282\u70B9" aria-hidden="true">#</a> \u5347\u7EA7\u7BA1\u7406\u8282\u70B9</h3><h4 id="\u67E5\u627E\u6700\u65B0\u7248\u672C\u53F7" tabindex="-1"><a class="header-anchor" href="#\u67E5\u627E\u6700\u65B0\u7248\u672C\u53F7" aria-hidden="true">#</a> \u67E5\u627E\u6700\u65B0\u7248\u672C\u53F7\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># yum list --showduplicates kubeadm </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u5347\u7EA7kubeadm" tabindex="-1"><a class="header-anchor" href="#\u5347\u7EA7kubeadm" aria-hidden="true">#</a> \u5347\u7EA7kubeadm\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># yum install -y kubeadm-1.20.1-0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u9A71\u9010node\u4E0A\u7684pod-\u4E14\u4E0D\u53EF\u8C03\u5EA6" tabindex="-1"><a class="header-anchor" href="#\u9A71\u9010node\u4E0A\u7684pod-\u4E14\u4E0D\u53EF\u8C03\u5EA6" aria-hidden="true">#</a> \u9A71\u9010node\u4E0A\u7684Pod\uFF0C\u4E14\u4E0D\u53EF\u8C03\u5EA6\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl drain master </span>
node/master cordoned
error: unable to drain <span class="token function">node</span> <span class="token string">&quot;master&quot;</span>, aborting command<span class="token punctuation">..</span>.

There are pending nodes to be drained:
 master
error: cannot delete DaemonSet-managed Pods <span class="token punctuation">(</span>use --ignore-daemonsets to ignore<span class="token punctuation">)</span>: kube-system/calico-node-df8kn, kube-system/kube-proxy-mbhtv
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl drain master --ignore-daemonsets</span>
node/master already cordoned
node/master evicted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u68C0\u67E5\u96C6\u7FA4\u662F\u5426\u53EF\u4EE5\u5347\u7EA7-\u5E76\u4E14\u83B7\u53D6\u53EF\u4EE5\u5347\u7EA7\u7684\u7248\u672C" tabindex="-1"><a class="header-anchor" href="#\u68C0\u67E5\u96C6\u7FA4\u662F\u5426\u53EF\u4EE5\u5347\u7EA7-\u5E76\u4E14\u83B7\u53D6\u53EF\u4EE5\u5347\u7EA7\u7684\u7248\u672C" aria-hidden="true">#</a> \u68C0\u67E5\u96C6\u7FA4\u662F\u5426\u53EF\u4EE5\u5347\u7EA7\uFF0C\u5E76\u4E14\u83B7\u53D6\u53EF\u4EE5\u5347\u7EA7\u7684\u7248\u672C\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubeadm upgrade plan </span>
\xB7\xB7\xB7
You can now apply the upgrade by executing the following command:

        kubeadm upgrade apply v1.20.12    <span class="token comment">#\u5C06\u4F1A\u63D0\u793A\u4F60\u66F4\u65B0\u5230\u53EF\u7528\u7684\u6700\u65B0\u7248\u672C</span>

Note: Before you can perform this upgrade, you have to update kubeadm to v1.20.12.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u6267\u884C\u5347\u7EA7" tabindex="-1"><a class="header-anchor" href="#\u6267\u884C\u5347\u7EA7" aria-hidden="true">#</a> \u6267\u884C\u5347\u7EA7\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubeadm upgrade apply v1.20.1</span>
<span class="token punctuation">[</span>upgrade/config<span class="token punctuation">]</span> Making sure the configuration is correct:
<span class="token punctuation">[</span>upgrade/config<span class="token punctuation">]</span> Reading configuration from the cluster<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>upgrade/config<span class="token punctuation">]</span> FYI: You can <span class="token function">look</span> at this config <span class="token function">file</span> with <span class="token string">&#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39;</span>
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks.
<span class="token punctuation">[</span>upgrade<span class="token punctuation">]</span> Running cluster health checks
<span class="token punctuation">[</span>upgrade/version<span class="token punctuation">]</span> You have chosen to change the cluster version to <span class="token string">&quot;v1.20.1&quot;</span>
<span class="token punctuation">[</span>upgrade/versions<span class="token punctuation">]</span> Cluster version: v1.20.0
<span class="token punctuation">[</span>upgrade/versions<span class="token punctuation">]</span> kubeadm version: v1.20.1
<span class="token punctuation">[</span>upgrade/confirm<span class="token punctuation">]</span> Are you sure you want to proceed with the upgrade? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: y
\xB7\xB7\xB7
<span class="token punctuation">[</span>upgrade/successful<span class="token punctuation">]</span> SUCCESS<span class="token operator">!</span> Your cluster was upgraded to <span class="token string">&quot;v1.20.1&quot;</span><span class="token builtin class-name">.</span> Enjoy<span class="token operator">!</span>

<span class="token punctuation">[</span>upgrade/kubelet<span class="token punctuation">]</span> Now that your control plane is upgraded, please proceed with upgrading your kubelets <span class="token keyword">if</span> you haven&#39;t already <span class="token keyword">done</span> so.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u53D6\u6D88\u4E0D\u53EF\u8C03\u5EA6" tabindex="-1"><a class="header-anchor" href="#\u53D6\u6D88\u4E0D\u53EF\u8C03\u5EA6" aria-hidden="true">#</a> \u53D6\u6D88\u4E0D\u53EF\u8C03\u5EA6\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes </span>
NAME     STATUS                     ROLES                  AGE     VERSION
master   Ready,SchedulingDisabled   control-plane,master   4h45m   v1.20.0
<span class="token function">node</span>     Ready                      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 4h40m   v1.20.0

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl uncordon master </span>
node/master uncordoned
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u5347\u7EA7kubelet\u548Ckubectl" tabindex="-1"><a class="header-anchor" href="#\u5347\u7EA7kubelet\u548Ckubectl" aria-hidden="true">#</a> \u5347\u7EA7kubelet\u548Ckubectl\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># yum install -y kubectl-1.20.1-0 kubelet-1.20.1-0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u91CD\u542Fkubelet" tabindex="-1"><a class="header-anchor" href="#\u91CD\u542Fkubelet" aria-hidden="true">#</a> \u91CD\u542Fkubelet\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart kubelet </span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes </span>
NAME     STATUS   ROLES                  AGE     VERSION
master   Ready    control-plane,master   4h49m   v1.20.1
<span class="token function">node</span>     Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 4h44m   v1.20.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5347\u7EA7\u5DE5\u4F5C\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#\u5347\u7EA7\u5DE5\u4F5C\u8282\u70B9" aria-hidden="true">#</a> \u5347\u7EA7\u5DE5\u4F5C\u8282\u70B9</h3><h4 id="\u5347\u7EA7kubeadm-1" tabindex="-1"><a class="header-anchor" href="#\u5347\u7EA7kubeadm-1" aria-hidden="true">#</a> \u5347\u7EA7kubeadm\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># yum install -y kubeadm-1.20.1-0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u9A71\u9010node\u4E0A\u7684pod-\u4E14\u4E0D\u53EF\u8C03\u5EA6-1" tabindex="-1"><a class="header-anchor" href="#\u9A71\u9010node\u4E0A\u7684pod-\u4E14\u4E0D\u53EF\u8C03\u5EA6-1" aria-hidden="true">#</a> \u9A71\u9010node\u4E0A\u7684Pod\uFF0C\u4E14\u4E0D\u53EF\u8C03\u5EA6\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl drain node --ignore-daemonsets --force</span>
node/node already cordoned
node/node evicted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u5347\u7EA7kubelet\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u5347\u7EA7kubelet\u914D\u7F6E" aria-hidden="true">#</a> \u5347\u7EA7kubelet\u914D\u7F6E\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubeadm upgrade node </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u5347\u7EA7kubelet\u548Ckubectl-1" tabindex="-1"><a class="header-anchor" href="#\u5347\u7EA7kubelet\u548Ckubectl-1" aria-hidden="true">#</a> \u5347\u7EA7kubelet\u548Ckubectl:</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># yum install -y kubectl=1.20.1-0 kubelet-1.20.1-0 </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u91CD\u542Fkubelet-1" tabindex="-1"><a class="header-anchor" href="#\u91CD\u542Fkubelet-1" aria-hidden="true">#</a> \u91CD\u542Fkubelet\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload </span>
<span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart kubelet </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u53D6\u6D88\u4E0D\u53EF\u8C03\u5EA6-1" tabindex="-1"><a class="header-anchor" href="#\u53D6\u6D88\u4E0D\u53EF\u8C03\u5EA6-1" aria-hidden="true">#</a> \u53D6\u6D88\u4E0D\u53EF\u8C03\u5EA6\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes </span>
NAME     STATUS                     ROLES                  AGE     VERSION
master   Ready                      control-plane,master   4h59m   v1.20.1
<span class="token function">node</span>     Ready,SchedulingDisabled   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 4h54m   v1.20.1

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl uncordon node</span>
node/node uncordoned

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes </span>
NAME     STATUS   ROLES                  AGE     VERSION
master   Ready    control-plane,master   4h59m   v1.20.1
<span class="token function">node</span>     Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 4h54m   v1.20.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="k8s\u96C6\u7FA4\u8282\u70B9\u6B63\u786E\u4E0B\u7EBF\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#k8s\u96C6\u7FA4\u8282\u70B9\u6B63\u786E\u4E0B\u7EBF\u6D41\u7A0B" aria-hidden="true">#</a> K8s\u96C6\u7FA4\u8282\u70B9\u6B63\u786E\u4E0B\u7EBF\u6D41\u7A0B</h2><p>\u5982\u679C\u4F60\u60F3\u7EF4\u62A4\u6216\u8005\u5220\u9664\u67D0\u4E2A\u8282\u70B9\uFF0C\u6B63\u786E\u6D41\u7A0B\u5982\u4E0B\uFF1A</p><h4 id="\u83B7\u53D6\u8282\u70B9\u5217\u8868" tabindex="-1"><a class="header-anchor" href="#\u83B7\u53D6\u8282\u70B9\u5217\u8868" aria-hidden="true">#</a> \u83B7\u53D6\u8282\u70B9\u5217\u8868\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes </span>
NAME     STATUS   ROLES                  AGE     VERSION
master   Ready    control-plane,master   5h3m    v1.20.1
<span class="token function">node</span>     Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 4h57m   v1.20.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u8BBE\u7F6E\u4E0D\u53EF\u8C03\u5EA6" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u7F6E\u4E0D\u53EF\u8C03\u5EA6" aria-hidden="true">#</a> \u8BBE\u7F6E\u4E0D\u53EF\u8C03\u5EA6\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl cordon node </span>
node/node cordoned
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u9A71\u9010\u8282\u70B9\u4E0A\u7684pod" tabindex="-1"><a class="header-anchor" href="#\u9A71\u9010\u8282\u70B9\u4E0A\u7684pod" aria-hidden="true">#</a> \u9A71\u9010\u8282\u70B9\u4E0A\u7684Pod\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl drain node --ignore-daemonsets</span>
node/node already cordoned
node/node evicted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u79FB\u9664\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#\u79FB\u9664\u8282\u70B9" aria-hidden="true">#</a> \u79FB\u9664\u8282\u70B9\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete node node </span>
<span class="token function">node</span> <span class="token string">&quot;node&quot;</span> deleted

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get node </span>
NAME     STATUS   ROLES                  AGE    VERSION
master   Ready    control-plane,master   5h4m   v1.20.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u91CD\u65B0\u52A0\u5165\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#\u91CD\u65B0\u52A0\u5165\u8282\u70B9" aria-hidden="true">#</a> \u91CD\u65B0\u52A0\u5165\u8282\u70B9</h3><h4 id="\u4F7F\u7528kubeadm\u91CD\u7F6E\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528kubeadm\u91CD\u7F6E\u8282\u70B9" aria-hidden="true">#</a> \u4F7F\u7528kubeadm\u91CD\u7F6E\u8282\u70B9\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># kubeadm reset </span>
<span class="token punctuation">[</span>reset<span class="token punctuation">]</span> WARNING: Changes made to this <span class="token function">host</span> by <span class="token string">&#39;kubeadm init&#39;</span> or <span class="token string">&#39;kubeadm join&#39;</span> will be reverted.
<span class="token punctuation">[</span>reset<span class="token punctuation">]</span> Are you sure you want to proceed? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: y
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u5728master\u8282\u70B9\u751F\u6210\u65B0\u7684token" tabindex="-1"><a class="header-anchor" href="#\u5728master\u8282\u70B9\u751F\u6210\u65B0\u7684token" aria-hidden="true">#</a> \u5728master\u8282\u70B9\u751F\u6210\u65B0\u7684token\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubeadm  token create  </span>
mmvxlw.lgpb891ml8g7q9oq
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed &#39;s/^.* //&#39;</span>
0026319b035eef72f40ba1545358f75113756c7b97e9925f4dd3105a01fbdb01
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="node\u91CD\u65B0\u52A0\u5165\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#node\u91CD\u65B0\u52A0\u5165\u8282\u70B9" aria-hidden="true">#</a> node\u91CD\u65B0\u52A0\u5165\u8282\u70B9\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># kubeadm join 192.168.1.18:6443 --token mmvxlw.lgpb891ml8g7q9oq --discovery-token-ca-cert-hash sha256:0026319b035eef72f40ba1545358f75113756c7b97e9925f4dd3105a01fbdb01</span>
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks
        <span class="token punctuation">[</span>WARNING SystemVerification<span class="token punctuation">]</span>: this Docker version is not on the list of validated versions: <span class="token number">20.10</span>.10. Latest validated version: <span class="token number">19.03</span>
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Reading configuration from the cluster<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> FYI: You can <span class="token function">look</span> at this config <span class="token function">file</span> with <span class="token string">&#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet configuration to <span class="token function">file</span> <span class="token string">&quot;/var/lib/kubelet/config.yaml&quot;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet environment <span class="token function">file</span> with flags to <span class="token function">file</span> <span class="token string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Starting the kubelet
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the kubelet to perform the TLS Bootstrap<span class="token punctuation">..</span>.

This <span class="token function">node</span> has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run <span class="token string">&#39;kubectl get nodes&#39;</span> on the control-plane to see this <span class="token function">node</span> <span class="token function">join</span> the cluster.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u67E5\u770B\u8282\u70B9\u5217\u8868" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770B\u8282\u70B9\u5217\u8868" aria-hidden="true">#</a> \u67E5\u770B\u8282\u70B9\u5217\u8868\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes </span>
NAME     STATUS   ROLES                  AGE     VERSION
master   Ready    control-plane,master   5h13m   v1.20.1
<span class="token function">node</span>     Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 32s     v1.20.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,76),o=[i];function c(l,d){return s(),a("div",null,o)}const u=n(t,[["render",c],["__file","11.Kubernetes\u96C6\u7FA4\u7EF4\u62A4.html.vue"]]);export{u as default};
