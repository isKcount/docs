import{_ as l}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as c,c as i,a as n,b as s,d as t,f as a,r as o}from"./app.ca0279c0.js";const p={},r=a(`<h1 id="kubernetes-k8s-helm-v3-\u90E8\u7F72-efk-\u65E5\u5FD7\u7CFB\u7EDF" tabindex="-1"><a class="header-anchor" href="#kubernetes-k8s-helm-v3-\u90E8\u7F72-efk-\u65E5\u5FD7\u7CFB\u7EDF" aria-hidden="true">#</a> Kubernetes\uFF08k8s\uFF09Helm v3 \u90E8\u7F72 EFK \u65E5\u5FD7\u7CFB\u7EDF</h1><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204111213092.jpeg" alt="Kubernetes\uFF08k8s\uFF09Helm \u90E8\u7F72 EFK \u96C6\u7FA4" loading="lazy"></p><h3 id="\u67E5\u770Bk8s\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770Bk8s\u96C6\u7FA4" aria-hidden="true">#</a> \u67E5\u770BK8S\u96C6\u7FA4</h3><p>\u5728\u8FD9\u91CC\u4F7F\u7528\u7684\u662Fkubernetes v1.21.1\u7684\u7248\u672C\u90E8\u7F72\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get node </span>
NAME               STATUS   ROLES                         AGE   VERSION
k8s-master-node1   Ready    control-plane,master,worker   15h   v1.21.1
k8s-worker-node1   Ready    worker                        15h   v1.21.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5B89\u88C5helm3" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5helm3" aria-hidden="true">#</a> \u5B89\u88C5Helm3</h3><p>\u901A\u8FC7tar\u5305\u5B89\u88C5helm3 \uFF0C\u67E5\u770B\u5F53\u524D\u7684helm\u7248\u672C\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master-node1 ~<span class="token punctuation">]</span><span class="token comment"># wget https://get.helm.sh/helm-v3.5.4-linux-amd64.tar.gz</span>
<span class="token punctuation">[</span>root@k8s-master-node1 ~<span class="token punctuation">]</span><span class="token comment"># tar xf helm-v3.5.4-linux-amd64.tar.gz</span>
<span class="token punctuation">[</span>root@k8s-master-node1 ~<span class="token punctuation">]</span><span class="token comment"># mv linux-amd64/helm /usr/local/sbin/helm</span>
<span class="token punctuation">[</span>root@k8s-master-node1 ~<span class="token punctuation">]</span><span class="token comment"># helm  version </span>
version.BuildInfo<span class="token punctuation">{</span>Version:<span class="token string">&quot;v3.7.1&quot;</span>, GitCommit:<span class="token string">&quot;1d11fcb5d3f3bf00dbe6fe31b8412839a96b3dc4&quot;</span>, GitTreeState:<span class="token string">&quot;clean&quot;</span>, GoVersion:<span class="token string">&quot;go1.16.9&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6DFB\u52A0\u516C\u7528\u7684\u4ED3\u5E93" tabindex="-1"><a class="header-anchor" href="#\u6DFB\u52A0\u516C\u7528\u7684\u4ED3\u5E93" aria-hidden="true">#</a> \u6DFB\u52A0\u516C\u7528\u7684\u4ED3\u5E93</h3><p>\u914D\u7F6Ehelm\u5FAE\u8F6F\u6E90\u5730\u5740</p><p>\u914D\u7F6Ehelm\u963F\u91CC\u6E90\u5730\u5740</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master-node1 ~<span class="token punctuation">]</span><span class="token comment"># helm repo add stable http://mirror.azure.cn/kubernetes/charts</span>
<span class="token punctuation">[</span>root@k8s-master-node1 ~<span class="token punctuation">]</span><span class="token comment"># helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts             </span>
<span class="token string">&quot;aliyun&quot;</span> has been added to your repositories

<span class="token punctuation">[</span>root@k8s-master-node1 ~<span class="token punctuation">]</span><span class="token comment"># helm repo list </span>
NAME    URL                                                   
stable  http://mirror.azure.cn/kubernetes/charts/             
aliyun  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u90E8\u7F72elasticsearch" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72elasticsearch" aria-hidden="true">#</a> \u90E8\u7F72Elasticsearch</h3><p><strong>ES \u96C6\u7FA4\u73AF\u5883</strong></p><ul><li>es-master \u642D\u5EFA\u4E00\u4E2A elasticsearch \u81F3\u5C11\u9700\u8981 3 \u4E2A Pod \u4EE5\u9632\u6B62\u96C6\u7FA4\u8111\u88C2</li><li>es-data \u6570\u636E\u8282\u70B9\u81F3\u5C11\u9700\u8981 2 \u4E2A Pod \u3002\u6570\u636E\u8282\u70B9\u5C06\u4FDD\u7559\u6570\u636E\u3001\u63A5\u6536\u67E5\u8BE2\u548C\u7D22\u5F15\u8BF7\u6C42</li><li>es-client \u505A\u4E3A\u534F\u8C03 elasticsearch \u96C6\u7FA4\u3002\u81F3\u5C11\u9700\u8981 2 \u4E2A\u3002\u7528\u4E8E\u96C6\u7FA4\u8FDE\u63A5\uFF0C\u5E76\u5145\u5F53 HTTP \u4EE3\u7406\u3002\u5982\u679C\u4E0D\u4F7F\u7528 es-clinet \u90A3\u4E48 es-data \u5145\u5F53\u534F\u8C03\uFF0C\u5C3D\u91CF\u907F\u514D\u5728\u8F83\u5927\u7684\u96C6\u7FA4\u4E0A\u8FD9\u6837\u505A\u3002</li><li>\u8FD9\u91CC\u6211\u6CA1\u6709\u4F7F\u7528NFS \u7C7B\u578B\u7684 StorageClass \u6765\u505A\u6301\u4E45\u5316\u5B58\u50A8\uFF0C\u5F53\u7136\u5982\u679C\u4F60\u662F\u7EBF\u4E0A\u73AF\u5883\u5EFA\u8BAE\u4F7F\u7528 Local PV \u6216\u8005 Ceph RBD \u4E4B\u7C7B\u7684\u5B58\u50A8\u6765\u6301\u4E45\u5316 Elasticsearch \u7684\u6570\u636E</li></ul><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204111213350.webp" alt="\u56FE\u7247" loading="lazy"></p><p>\u4ECE\u5B98\u65B9\u7684\u4ED3\u5E93\u62C9\u53D6elasticsearch\u7684chart\u5305\u3002</p><ul><li>\u5982\u679C\u4E3B\u673A\u5185\u5B58\u5C0F\u53EF\u4EE5\u5C06replicas\u7684\u526F\u672C\u8BBE\u7F6E\u4E3A1\uFF0C\u5219\u9ED8\u8BA4</li><li>\u8FD9\u91CC\u5173\u95EDpvc\u5B58\u50A8\u3002</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master-node1 opt<span class="token punctuation">]</span><span class="token comment"># mkdir efk &amp;&amp; cd  efk </span>
<span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># kubectl  create namespace efk      </span>
<span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># helm fetch stable/elasticsearch </span>
<span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># tar zxvf elasticsearch-1.32.5.tgz  </span>
<span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># cd elasticsearch/</span>
<span class="token punctuation">[</span>root@k8s-master-node1 elasticsearch<span class="token punctuation">]</span><span class="token comment"># ls</span>
Chart.yaml  ci  README.md  templates  values.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C06persistence\u7684enabled\u9009\u9879\u8BBE\u7F6E\u4E3Afalse\uFF0C\u6709\u5219\u7528true\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">-</span>node1 elasticsearch<span class="token punctuation">]</span><span class="token comment"># vim values.yaml  </span>
  <span class="token key atrule">persistence</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">accessMode</span><span class="token punctuation">:</span> ReadWriteOnce
    <span class="token key atrule">name</span><span class="token punctuation">:</span> data
    <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token string">&quot;4Gi&quot;</span>
    <span class="token comment"># storageClass: &quot;ssd&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>helm\u5B89\u88C5elasticsearch\u6307\u5B9A\u547D\u540D\u7A7A\u95F4\u6307\u5B9Avalue\u6587\u4EF6\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master-node1 elasticsearch<span class="token punctuation">]</span><span class="token comment"># helm install els1 --namespace=efk -f  values.yaml stable/elasticsearch </span>
<span class="token punctuation">[</span>root@k8s-master-node1 elasticsearch<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n efk  </span>
NAME                                         READY   STATUS    RESTARTS   AGE
els1-elasticsearch-client-69bd9656b4-hhtr5   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          176m
els1-elasticsearch-client-69bd9656b4-qq89w   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          176m
els1-elasticsearch-data-0                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          176m
els1-elasticsearch-data-1                    <span class="token number">1</span>/1     Running   <span class="token number">2</span>          175m
els1-elasticsearch-master-0                  <span class="token number">1</span>/1     Running   <span class="token number">2</span>          176m
els1-elasticsearch-master-1                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>          175m
els1-elasticsearch-master-2                  <span class="token number">1</span>/1     Running   <span class="token number">2</span>          174m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u90E8\u7F72fluentd" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72fluentd" aria-hidden="true">#</a> \u90E8\u7F72Fluentd</h3><p>\u8981\u6536\u96C6 Kubernetes \u96C6\u7FA4\u7684\u65E5\u5FD7\uFF0C\u76F4\u63A5\u7528 DasemonSet \u63A7\u5236\u5668\u6765\u90E8\u7F72 Fluentd \u5E94\u7528\uFF0C\u8FD9\u6837\uFF0C\u5B83\u5C31\u53EF\u4EE5\u4ECE Kubernetes \u8282\u70B9\u4E0A\u91C7\u96C6\u65E5\u5FD7\uFF0C\u786E\u4FDD\u5728\u96C6\u7FA4\u4E2D\u7684\u6BCF\u4E2A\u8282\u70B9\u4E0A\u59CB\u7EC8\u8FD0\u884C\u4E00\u4E2A Fluentd \u5BB9\u5668\u3002</p><p>\u4ECE\u5B98\u65B9\u7684\u4ED3\u5E93\u62C9\u53D6fluentd\u7684chart\u5305\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># helm  fetch stable/fluentd-elasticsearch </span>
<span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># tar  zxvf fluentd-elasticsearch-2.0.7.tgz </span>
<span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># cd fluentd-elasticsearch/</span>
<span class="token punctuation">[</span>root@k8s-master-node1 fluentd-elasticsearch<span class="token punctuation">]</span><span class="token comment"># ls</span>
Chart.yaml  OWNERS  README.md  templates  values.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4FEE\u6539elasticsearch\u7684\u8FDE\u63A5\u5730\u5740\uFF0C\u53EF\u4EE5\u901A\u8FC7\u67E5\u770Befk\u547D\u540D\u7A7A\u95F4\u7684svc\uFF0C\u627E\u5230elasticsearch\u7684\u5730\u5740\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">-</span>node1 fluentd<span class="token punctuation">-</span>elasticsearch<span class="token punctuation">]</span><span class="token comment"># kubectl get svc -n efk  </span>
NAME                           TYPE        CLUSTER<span class="token punctuation">-</span>IP      EXTERNAL<span class="token punctuation">-</span>IP   PORT(S)         AGE
els1<span class="token punctuation">-</span>elasticsearch<span class="token punctuation">-</span>client      ClusterIP   10.96.188.11    &lt;none<span class="token punctuation">&gt;</span>        9200/TCP        3h4m
els1<span class="token punctuation">-</span>elasticsearch<span class="token punctuation">-</span>discovery   ClusterIP   None            &lt;none<span class="token punctuation">&gt;</span>        9300/TCP        3h4m


<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">-</span>node1 fluentd<span class="token punctuation">-</span>elasticsearch<span class="token punctuation">]</span><span class="token comment"># vim values.yaml </span>
<span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">&#39;10.96.188.11&#39;</span>     <span class="token comment">#\u5C06\u8FD9\u91CC\u7684\u9ED8\u8BA4\u4FEE\u6539\u6210elasticsearch\u7684ip</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
  <span class="token key atrule">scheme</span><span class="token punctuation">:</span> <span class="token string">&#39;http&#39;</span>
  <span class="token key atrule">ssl_version</span><span class="token punctuation">:</span> TLSv1_2
  <span class="token key atrule">buffer_chunk_limit</span><span class="token punctuation">:</span> 2M
  <span class="token key atrule">buffer_queue_limit</span><span class="token punctuation">:</span> <span class="token number">8</span>
  <span class="token key atrule">logstash_prefix</span><span class="token punctuation">:</span> <span class="token string">&#39;logstash&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>helm\u5B89\u88C5fluentd\u6307\u5B9A\u547D\u540D\u7A7A\u95F4\u6307\u5B9Avalue\u6587\u4EF6\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master-node1 fluentd-elasticsearch<span class="token punctuation">]</span><span class="token comment"># helm install flu1 --namespace=efk -f values.yaml stable/fluentd-elasticsearch </span>
<span class="token punctuation">[</span>root@k8s-master-node1 fluentd-elasticsearch<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n efk  </span>
NAME                                         READY   STATUS    RESTARTS   AGE
els1-elasticsearch-client-69bd9656b4-hhtr5   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h6m
els1-elasticsearch-client-69bd9656b4-qq89w   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3h6m
els1-elasticsearch-data-0                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h6m
els1-elasticsearch-data-1                    <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3h5m
els1-elasticsearch-master-0                  <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3h6m
els1-elasticsearch-master-1                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h5m
els1-elasticsearch-master-2                  <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3h4m
flu1-fluentd-elasticsearch-4vbcv             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          56m
flu1-fluentd-elasticsearch-mbpd4             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          56m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,31),u=n("p",null,"\u6CE8\u610F\uFF1A",-1),d={href:"http://xn--gcr-p18dohm4ms0cyve287fyy3d3qe3ymisg.io/google-containers/fluentd-elasticsearch:v2.3.2%EF%BC%8C%E5%9B%BD%E5%86%85%E7%BD%91%E7%BB%9C%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E5%8F%AF%E4%BB%A5%E6%8B%89%E5%8F%96%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E9%95%9C%E5%83%8F%E7%84%B6%E5%90%8E%E4%BF%AE%E6%94%B9%EF%BC%8C%E5%8C%85%E6%8B%AC%E5%90%8E%E9%9D%A2%E7%9A%84kibana%E9%95%9C%E5%83%8F%E4%B9%9F%E4%B8%80%E6%A0%B7%E7%9A%84%E6%93%8D%E4%BD%9C%E3%80%82",target:"_blank",rel:"noopener noreferrer"},m=n("code",null,"\u7136\u540E\u9700\u8981\u4F7F\u7528save -o \u5BFC\u51FA\u6765\u5206\u53D1\u5230\u5176\u4ED6\u8282\u70B9\u4E0A\u4F20\u955C\u50CF\u3002",-1),k=a(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master-node1 fluentd-elasticsearch<span class="token punctuation">]</span><span class="token comment"># docker pull registry.aliyuncs.com/google_containers/fluentd-elasticsearch:v2.3.2</span>
<span class="token punctuation">[</span>root@k8s-master-node1 fluentd-elasticsearch<span class="token punctuation">]</span><span class="token comment"># docker tag registry.aliyuncs.com/google_containers/fluentd-elasticsearch:v2.3.2    gcr.io/google-containers/fluentd-elasticsearch:v2.3.2</span>
<span class="token punctuation">[</span>root@k8s-master-node1 ~<span class="token punctuation">]</span><span class="token comment"># docker save -o fluentd-elasticsearch.tar gcr.io/google-containers/fluentd-elasticsearch:v2.3.2</span>
<span class="token punctuation">[</span>root@k8s-master-node1 ~<span class="token punctuation">]</span><span class="token comment"># scp  fluentd-elasticsearch.tar k8s-worker-node1:/root/ </span>
<span class="token punctuation">[</span>root@k8s-worker-node1 ~<span class="token punctuation">]</span><span class="token comment"># docker load -i fluentd-elasticsearch.tar </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),v=a(`<h3 id="\u90E8\u7F72kibana" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72kibana" aria-hidden="true">#</a> \u90E8\u7F72Kibana</h3><p>\u4FEE\u6539kibana\u6587\u4EF6(\u6CE8\u610Fkibana\u7684\u7248\u672C\u4E00\u5B9A\u8981<strong>\u4E0Eelasticsearch\u4E00\u81F4)</strong></p><p>Kibana \u662FElastic Search \u7684\u6570\u636E\u5206\u6790\u53CA\u53EF\u89C6\u5316\u5E73\u53F0\uFF0C \u80FD\u591F\u7528\u6765\u641C\u7D22\u3001\u67E5\u770B\u5B58\u50A8\u5728ElasticSearch\u7D22\u5F15\u4E2D\u7684\u6570\u636E\u3002</p><p>\u5B83\u53EF\u4EE5\u901A\u8FC7\u5404\u79CD\u56FE\u8868\u8FDB\u884C\u9AD8\u7EA7\u6570\u636E\u5206\u6790\u53CA\u5C55\u793A\uFF0C\u7528\u6237\u57FA\u4E8EWeb GUI\u53EF\u4EE5\u5FEB\u901F\u521B\u5EFA\u4EEA\u8868\u677F\uFF08 dashboard \uFF09\u5B9E\u65F6\u663E\u793AElasticSearch \u7684\u67E5\u8BE2\u7ED3\u679C\u3002</p><p>\u4ECE\u5B98\u65B9\u7684\u4ED3\u5E93\u62C9\u53D6kibana\u7684chart\u5305\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># helm fetch stable/kibana</span>
<span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># tar zxvf kibana-3.2.8.tgz </span>
<span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># cd kibana/</span>
<span class="token punctuation">[</span>root@k8s-master-node1 kibana<span class="token punctuation">]</span><span class="token comment"># ls</span>
Chart.yaml  ci  OWNERS  README.md  templates  values.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7\u67E5\u770Bk8s\u96C6\u7FA4\u7684clusterip\uFF0C\u8DDFelasticsearch\u4E00\u6837\u7684clusterip\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">-</span>node1 kibana<span class="token punctuation">]</span><span class="token comment"># vim values.yaml </span>
<span class="token key atrule">files</span><span class="token punctuation">:</span>
  <span class="token key atrule">kibana.yml</span><span class="token punctuation">:</span>
    <span class="token comment">## Default Kibana configuration from kibana-docker.</span>
    <span class="token key atrule">server.name</span><span class="token punctuation">:</span> kibana
    <span class="token key atrule">server.host</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
    <span class="token comment">## For kibana &lt; 6.6, use elasticsearch.url instead</span>
    <span class="token key atrule">elasticsearch.hosts</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//10.96.188.11<span class="token punctuation">:</span><span class="token number">9200</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>helm\u5B89\u88C5kibana\u6307\u5B9A\u547D\u540D\u7A7A\u95F4\u6307\u5B9Avalue\u6587\u4EF6\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master-node1 kibana<span class="token punctuation">]</span><span class="token comment"># helm  install kibana --namespace=efk -f  values.yaml stable/kibana </span>
<span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n efk </span>
NAME                                         READY   STATUS    RESTARTS   AGE
els1-elasticsearch-client-69bd9656b4-hhtr5   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h24m
els1-elasticsearch-client-69bd9656b4-qq89w   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3h24m
els1-elasticsearch-data-0                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h24m
els1-elasticsearch-data-1                    <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3h23m
els1-elasticsearch-master-0                  <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3h24m
els1-elasticsearch-master-1                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h23m
els1-elasticsearch-master-2                  <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3h22m
flu1-fluentd-elasticsearch-4vbcv             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          74m
flu1-fluentd-elasticsearch-mbpd4             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          74m
kibana-56fdd4b5c-57hzr                       <span class="token number">1</span>/1     Running   <span class="token number">0</span>          64m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C06kibana\u7684services\u66B4\u9732\u7AEF\u53E3\u670D\u52A1\u4FEE\u6539ClusterIP\u4E3ANodePort\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master-node1 efk<span class="token punctuation">]</span><span class="token comment"># kubectl get svc -n efk </span>
NAME                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>         AGE
els1-elasticsearch-client      ClusterIP   <span class="token number">10.96</span>.188.11    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">9200</span>/TCP        3h24m
els1-elasticsearch-discovery   ClusterIP   None            <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">9300</span>/TCP        3h24m
kibana                         NodePort    <span class="token number">10.96</span>.214.238   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>:59247/TCP   65m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,12),b={href:"http://192.168.1.3:59247",target:"_blank",rel:"noopener noreferrer"},h=a('<p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204111213979.png" alt="image-20220307150613417" loading="lazy"></p><h3 id="\u521B\u5EFA\u7D22\u5F15" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u7D22\u5F15" aria-hidden="true">#</a> \u521B\u5EFA\u7D22\u5F15</h3><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204111214856.png" alt="image-20220307150728270" loading="lazy"></p><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204111214439.png" alt="image-20220307150841897" loading="lazy"></p><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204111214096.png" alt="image-20220307150851578" loading="lazy"></p><p>\u521B\u5EFA\u597D\u7D22\u5F15\u6A21\u5F0F\u4E4B\u540E\uFF0C\u5373\u53EF\u901A\u8FC7\u201C Discover \u201D\u641C\u7D22\u6570\u636E\uFF0C\u6216\u8005\u5728\u201C Visualize \u201D\u754C\u9762\u4E2D\u5B9A\u4E49\u53EF\u89C6\u5316\u56FE\u5F62\uFF0C\u5E76\u5C06\u5B83\u4EEC\u96C6\u6210\u4E8E\u53EF\u5728\u201C Dashboard \u201D\u4E2D\u521B\u5EFA\u7684\u4EEA\u8868\u677F\u91CC\u3002</p><p>\u4EE5\u4E0B\u5C31\u662F2022\u5E743\u670806\u53F7\u7684\u65E5\u5FD7\u3002</p><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204111214818.png" alt="image-20220307150941899" loading="lazy"></p>',8);function g(f,E){const e=o("ExternalLinkIcon");return c(),i("div",null,[r,n("blockquote",null,[u,n("p",null,[n("a",d,[s("\u8FD9\u91CC\u9762\u6D89\u53CA\u5230\u4E00\u4E2A\u955C\u50CFgcr.io/google-containers/fluentd-elasticsearch:v2.3.2\uFF0C\u56FD\u5185\u7F51\u7EDC\u65E0\u6CD5\u8BBF\u95EE\u53EF\u4EE5\u62C9\u53D6\u963F\u91CC\u4E91\u7684\u955C\u50CF\u7136\u540E\u4FEE\u6539\uFF0C\u5305\u62EC\u540E\u9762\u7684kibana\u955C\u50CF\u4E5F\u4E00\u6837\u7684\u64CD\u4F5C\u3002"),t(e)]),m]),k]),v,n("p",null,[s("\u901A\u8FC7\u754C\u9762\u8BBF\u95EE"),n("a",b,[s("http://192.168.1.3:59247"),t(e)]),s("\u3002")]),h])}const x=l(p,[["render",g],["__file","21.Helm\u642D\u5EFAEFK\u65E5\u5FD7\u7CFB\u7EDF.html.vue"]]);export{x as default};
