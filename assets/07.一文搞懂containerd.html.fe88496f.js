import{_ as t}from"./_plugin-vue_export-helper.cdc0426e.js";import{o,c,a as s,b as n,d as e,f as i,r as l}from"./app.ca0279c0.js";const p={},r=i('<p>\u5728\u5B66\u4E60 Containerd \u4E4B\u524D\u6211\u4EEC\u6709\u5FC5\u8981\u5BF9 Docker \u7684\u53D1\u5C55\u5386\u53F2\u505A\u4E00\u4E2A\u7B80\u5355\u7684\u56DE\u987E\uFF0C\u56E0\u4E3A\u8FD9\u91CC\u9762\u7275\u6D89\u5230\u7684\u7EC4\u4EF6\u5B9E\u6218\u662F\u6709\u70B9\u591A\uFF0C\u6709\u5F88\u591A\u6211\u4EEC\u4F1A\u7ECF\u5E38\u542C\u5230\uFF0C\u4F46\u662F\u4E0D\u6E05\u695A\u8FD9\u4E9B\u7EC4\u4EF6\u5230\u5E95\u662F\u5E72\u4EC0\u4E48\u7528\u7684\uFF0C\u6BD4\u5982 <code>libcontainer</code>\u3001<code>runc</code>\u3001<code>containerd</code>\u3001<code>CRI</code>\u3001<code>OCI</code> \u7B49\u7B49\u3002</p><h2 id="docker" tabindex="-1"><a class="header-anchor" href="#docker" aria-hidden="true">#</a> Docker</h2><p>\u4ECE Docker 1.11 \u7248\u672C\u5F00\u59CB\uFF0CDocker \u5BB9\u5668\u8FD0\u884C\u5C31\u4E0D\u662F\u7B80\u5355\u901A\u8FC7 Docker Daemon \u6765\u542F\u52A8\u4E86\uFF0C\u800C\u662F\u901A\u8FC7\u96C6\u6210 containerd\u3001runc \u7B49\u591A\u4E2A\u7EC4\u4EF6\u6765\u5B8C\u6210\u7684\u3002\u867D\u7136 Docker Daemon \u5B88\u62A4\u8FDB\u7A0B\u6A21\u5757\u5728\u4E0D\u505C\u7684\u91CD\u6784\uFF0C\u4F46\u662F\u57FA\u672C\u529F\u80FD\u548C\u5B9A\u4F4D\u6CA1\u6709\u592A\u5927\u7684\u53D8\u5316\uFF0C\u4E00\u76F4\u90FD\u662F CS \u67B6\u6784\uFF0C\u5B88\u62A4\u8FDB\u7A0B\u8D1F\u8D23\u548C Docker Client \u7AEF\u4EA4\u4E92\uFF0C\u5E76\u7BA1\u7406 Docker \u955C\u50CF\u548C\u5BB9\u5668\u3002\u73B0\u5728\u7684\u67B6\u6784\u4E2D\u7EC4\u4EF6 containerd \u5C31\u4F1A\u8D1F\u8D23\u96C6\u7FA4\u8282\u70B9\u4E0A\u5BB9\u5668\u7684\u751F\u547D\u5468\u671F\u7BA1\u7406\uFF0C\u5E76\u5411\u4E0A\u4E3A Docker Daemon \u63D0\u4F9B gRPC \u63A5\u53E3\u3002</p><p><img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20210809154608.png" alt="docker \u67B6\u6784" loading="lazy">docker \u67B6\u6784</p><p>\u5F53\u6211\u4EEC\u8981\u521B\u5EFA\u4E00\u4E2A\u5BB9\u5668\u7684\u65F6\u5019\uFF0C\u73B0\u5728 Docker Daemon \u5E76\u4E0D\u80FD\u76F4\u63A5\u5E2E\u6211\u4EEC\u521B\u5EFA\u4E86\uFF0C\u800C\u662F\u8BF7\u6C42 <code>containerd</code> \u6765\u521B\u5EFA\u4E00\u4E2A\u5BB9\u5668\uFF0Ccontainerd \u6536\u5230\u8BF7\u6C42\u540E\uFF0C\u4E5F\u5E76\u4E0D\u4F1A\u76F4\u63A5\u53BB\u64CD\u4F5C\u5BB9\u5668\uFF0C\u800C\u662F\u521B\u5EFA\u4E00\u4E2A\u53EB\u505A <code>containerd-shim</code> \u7684\u8FDB\u7A0B\uFF0C\u8BA9\u8FD9\u4E2A\u8FDB\u7A0B\u53BB\u64CD\u4F5C\u5BB9\u5668\uFF0C\u6211\u4EEC\u6307\u5B9A\u5BB9\u5668\u8FDB\u7A0B\u662F\u9700\u8981\u4E00\u4E2A\u7236\u8FDB\u7A0B\u6765\u505A\u72B6\u6001\u6536\u96C6\u3001\u7EF4\u6301 stdin \u7B49 fd \u6253\u5F00\u7B49\u5DE5\u4F5C\u7684\uFF0C\u5047\u5982\u8FD9\u4E2A\u7236\u8FDB\u7A0B\u5C31\u662F containerd\uFF0C\u90A3\u5982\u679C containerd \u6302\u6389\u7684\u8BDD\uFF0C\u6574\u4E2A\u5BBF\u4E3B\u673A\u4E0A\u6240\u6709\u7684\u5BB9\u5668\u90FD\u5F97\u9000\u51FA\u4E86\uFF0C\u800C\u5F15\u5165 <code>containerd-shim</code> \u8FD9\u4E2A\u57AB\u7247\u5C31\u53EF\u4EE5\u6765\u89C4\u907F\u8FD9\u4E2A\u95EE\u9898\u4E86\u3002</p><p>\u7136\u540E\u521B\u5EFA\u5BB9\u5668\u9700\u8981\u505A\u4E00\u4E9B namespaces \u548C cgroups \u7684\u914D\u7F6E\uFF0C\u4EE5\u53CA\u6302\u8F7D root \u6587\u4EF6\u7CFB\u7EDF\u7B49\u64CD\u4F5C\uFF0C\u8FD9\u4E9B\u64CD\u4F5C\u5176\u5B9E\u5DF2\u7ECF\u6709\u4E86\u6807\u51C6\u7684\u89C4\u8303\uFF0C\u90A3\u5C31\u662F OCI\uFF08\u5F00\u653E\u5BB9\u5668\u6807\u51C6\uFF09\uFF0C<code>runc</code> \u5C31\u662F\u5B83\u7684\u4E00\u4E2A\u53C2\u8003\u5B9E\u73B0\uFF08Docker \u88AB\u903C\u65E0\u8010\u5C06 <code>libcontainer</code> \u6350\u732E\u51FA\u6765\u6539\u540D\u4E3A <code>runc</code> \u7684\uFF09\uFF0C\u8FD9\u4E2A\u6807\u51C6\u5176\u5B9E\u5C31\u662F\u4E00\u4E2A\u6587\u6863\uFF0C\u4E3B\u8981\u89C4\u5B9A\u4E86\u5BB9\u5668\u955C\u50CF\u7684\u7ED3\u6784\u3001\u4EE5\u53CA\u5BB9\u5668\u9700\u8981\u63A5\u6536\u54EA\u4E9B\u64CD\u4F5C\u6307\u4EE4\uFF0C\u6BD4\u5982 create\u3001start\u3001stop\u3001delete \u7B49\u8FD9\u4E9B\u547D\u4EE4\u3002<code>runc</code> \u5C31\u53EF\u4EE5\u6309\u7167\u8FD9\u4E2A OCI \u6587\u6863\u6765\u521B\u5EFA\u4E00\u4E2A\u7B26\u5408\u89C4\u8303\u7684\u5BB9\u5668\uFF0C\u65E2\u7136\u662F\u6807\u51C6\u80AF\u5B9A\u5C31\u6709\u5176\u4ED6 OCI \u5B9E\u73B0\uFF0C\u6BD4\u5982 Kata\u3001gVisor \u8FD9\u4E9B\u5BB9\u5668\u8FD0\u884C\u65F6\u90FD\u662F\u7B26\u5408 OCI \u6807\u51C6\u7684\u3002</p><p>\u6240\u4EE5\u771F\u6B63\u542F\u52A8\u5BB9\u5668\u662F\u901A\u8FC7 <code>containerd-shim</code> \u53BB\u8C03\u7528 <code>runc</code> \u6765\u542F\u52A8\u5BB9\u5668\u7684\uFF0C<code>runc</code> \u542F\u52A8\u5B8C\u5BB9\u5668\u540E\u672C\u8EAB\u4F1A\u76F4\u63A5\u9000\u51FA\uFF0C<code>containerd-shim</code> \u5219\u4F1A\u6210\u4E3A\u5BB9\u5668\u8FDB\u7A0B\u7684\u7236\u8FDB\u7A0B, \u8D1F\u8D23\u6536\u96C6\u5BB9\u5668\u8FDB\u7A0B\u7684\u72B6\u6001, \u4E0A\u62A5\u7ED9 containerd, \u5E76\u5728\u5BB9\u5668\u4E2D pid \u4E3A 1 \u7684\u8FDB\u7A0B\u9000\u51FA\u540E\u63A5\u7BA1\u5BB9\u5668\u4E2D\u7684\u5B50\u8FDB\u7A0B\u8FDB\u884C\u6E05\u7406, \u786E\u4FDD\u4E0D\u4F1A\u51FA\u73B0\u50F5\u5C38\u8FDB\u7A0B\u3002</p><p>\u800C Docker \u5C06\u5BB9\u5668\u64CD\u4F5C\u90FD\u8FC1\u79FB\u5230 <code>containerd</code> \u4E2D\u53BB\u662F\u56E0\u4E3A\u5F53\u524D\u505A Swarm\uFF0C\u60F3\u8981\u8FDB\u519B PaaS \u5E02\u573A\uFF0C\u505A\u4E86\u8FD9\u4E2A\u67B6\u6784\u5207\u5206\uFF0C\u8BA9 Docker Daemon \u4E13\u95E8\u53BB\u8D1F\u8D23\u4E0A\u5C42\u7684\u5C01\u88C5\u7F16\u6392\uFF0C\u5F53\u7136\u540E\u9762\u7684\u7ED3\u679C\u6211\u4EEC\u77E5\u9053 Swarm \u5728 Kubernetes \u9762\u524D\u662F\u60E8\u8D25\uFF0C\u7136\u540E Docker \u516C\u53F8\u5C31\u628A <code>containerd</code> \u9879\u76EE\u6350\u732E\u7ED9\u4E86 CNCF \u57FA\u91D1\u4F1A\uFF0C\u8FD9\u4E2A\u4E5F\u662F\u73B0\u5728\u7684 Docker \u67B6\u6784\u3002</p><h2 id="cri" tabindex="-1"><a class="header-anchor" href="#cri" aria-hidden="true">#</a> CRI</h2><p>\u6211\u4EEC\u77E5\u9053 Kubernetes \u63D0\u4F9B\u4E86\u4E00\u4E2A CRI \u7684\u5BB9\u5668\u8FD0\u884C\u65F6\u63A5\u53E3\uFF0C\u90A3\u4E48\u8FD9\u4E2A CRI \u5230\u5E95\u662F\u4EC0\u4E48\u5462\uFF1F\u8FD9\u4E2A\u5176\u5B9E\u4E5F\u548C Docker \u7684\u53D1\u5C55\u5BC6\u5207\u76F8\u5173\u7684\u3002</p><p>\u5728 Kubernetes \u65E9\u671F\u7684\u65F6\u5019\uFF0C\u5F53\u65F6 Docker \u5B9E\u5728\u662F\u592A\u706B\u4E86\uFF0CKubernetes \u5F53\u7136\u4F1A\u5148\u9009\u62E9\u652F\u6301 Docker\uFF0C\u800C\u4E14\u662F\u901A\u8FC7\u786C\u7F16\u7801\u7684\u65B9\u5F0F\u76F4\u63A5\u8C03\u7528 Docker API\uFF0C\u540E\u9762\u968F\u7740 Docker \u7684\u4E0D\u65AD\u53D1\u5C55\u4EE5\u53CA Google \u7684\u4E3B\u5BFC\uFF0C\u51FA\u73B0\u4E86\u66F4\u591A\u5BB9\u5668\u8FD0\u884C\u65F6\uFF0CKubernetes \u4E3A\u4E86\u652F\u6301\u66F4\u591A\u66F4\u7CBE\u7B80\u7684\u5BB9\u5668\u8FD0\u884C\u65F6\uFF0CGoogle \u5C31\u548C\u7EA2\u5E3D\u4E3B\u5BFC\u63A8\u51FA\u4E86 CRI \u6807\u51C6\uFF0C\u7528\u4E8E\u5C06 Kubernetes \u5E73\u53F0\u548C\u7279\u5B9A\u7684\u5BB9\u5668\u8FD0\u884C\u65F6\uFF08\u5F53\u7136\u4E3B\u8981\u662F\u4E3A\u4E86\u5E72\u6389 Docker\uFF09\u89E3\u8026\u3002</p><p><code>CRI</code>\uFF08Container Runtime Interface \u5BB9\u5668\u8FD0\u884C\u65F6\u63A5\u53E3\uFF09\u672C\u8D28\u4E0A\u5C31\u662F Kubernetes \u5B9A\u4E49\u7684\u4E00\u7EC4\u4E0E\u5BB9\u5668\u8FD0\u884C\u65F6\u8FDB\u884C\u4EA4\u4E92\u7684\u63A5\u53E3\uFF0C\u6240\u4EE5\u53EA\u8981\u5B9E\u73B0\u4E86\u8FD9\u5957\u63A5\u53E3\u7684\u5BB9\u5668\u8FD0\u884C\u65F6\u90FD\u53EF\u4EE5\u5BF9\u63A5\u5230 Kubernetes \u5E73\u53F0\u4E0A\u6765\u3002\u4E0D\u8FC7 Kubernetes \u63A8\u51FA CRI \u8FD9\u5957\u6807\u51C6\u7684\u65F6\u5019\u8FD8\u6CA1\u6709\u73B0\u5728\u7684\u7EDF\u6CBB\u5730\u4F4D\uFF0C\u6240\u4EE5\u6709\u4E00\u4E9B\u5BB9\u5668\u8FD0\u884C\u65F6\u53EF\u80FD\u4E0D\u4F1A\u81EA\u8EAB\u5C31\u53BB\u5B9E\u73B0 CRI \u63A5\u53E3\uFF0C\u4E8E\u662F\u5C31\u6709\u4E86 <code>shim\uFF08\u57AB\u7247\uFF09</code>\uFF0C \u4E00\u4E2A shim \u7684\u804C\u8D23\u5C31\u662F\u4F5C\u4E3A\u9002\u914D\u5668\u5C06\u5404\u79CD\u5BB9\u5668\u8FD0\u884C\u65F6\u672C\u8EAB\u7684\u63A5\u53E3\u9002\u914D\u5230 Kubernetes \u7684 CRI \u63A5\u53E3\u4E0A\uFF0C\u5176\u4E2D <code>dockershim</code> \u5C31\u662F Kubernetes \u5BF9\u63A5 Docker \u5230 CRI \u63A5\u53E3\u4E0A\u7684\u4E00\u4E2A\u57AB\u7247\u5B9E\u73B0\u3002</p><p><img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20210809172030.png" alt="cri shim" loading="lazy">cri shim</p><p>Kubelet \u901A\u8FC7 gRPC \u6846\u67B6\u4E0E\u5BB9\u5668\u8FD0\u884C\u65F6\u6216 shim \u8FDB\u884C\u901A\u4FE1\uFF0C\u5176\u4E2D kubelet \u4F5C\u4E3A\u5BA2\u6237\u7AEF\uFF0CCRI shim\uFF08\u4E5F\u53EF\u80FD\u662F\u5BB9\u5668\u8FD0\u884C\u65F6\u672C\u8EAB\uFF09\u4F5C\u4E3A\u670D\u52A1\u5668\u3002</p>',14),d={href:"https://github.com/kubernetes/kubernetes/blob/release-1.5/pkg/kubelet/api/v1alpha1/runtime/api.proto",target:"_blank",rel:"noopener noreferrer"},u=s("code",null,"ImageService",-1),v=s("code",null,"RuntimeService",-1),k=s("code",null,"ImageService",-1),m=s("code",null,"RuntimeService",-1),b=s("code",null,"--container-runtime-endpoint",-1),g=s("code",null,"--image-service-endpoint",-1),h=i('<p><img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20210809173134.png" alt="kubelet cri" loading="lazy">kubelet cri</p><p>\u4E0D\u8FC7\u8FD9\u91CC\u540C\u6837\u4E5F\u6709\u4E00\u4E2A\u4F8B\u5916\uFF0C\u90A3\u5C31\u662F Docker\uFF0C\u7531\u4E8E Docker \u5F53\u65F6\u7684\u6C5F\u6E56\u5730\u4F4D\u5F88\u9AD8\uFF0CKubernetes \u662F\u76F4\u63A5\u5185\u7F6E\u4E86 <code>dockershim</code> \u5728 kubelet \u4E2D\u7684\uFF0C\u6240\u4EE5\u5982\u679C\u4F60\u4F7F\u7528\u7684\u662F Docker \u8FD9\u79CD\u5BB9\u5668\u8FD0\u884C\u65F6\u7684\u8BDD\u662F\u4E0D\u9700\u8981\u5355\u72EC\u53BB\u5B89\u88C5\u914D\u7F6E\u9002\u914D\u5668\u4E4B\u7C7B\u7684\uFF0C\u5F53\u7136\u8FD9\u4E2A\u4E3E\u52A8\u4F3C\u4E4E\u4E5F\u9EBB\u75F9\u4E86 Docker \u516C\u53F8\u3002</p><p><img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20210809173555.png" alt="dockershim" loading="lazy">dockershim</p><p>\u73B0\u5728\u5982\u679C\u6211\u4EEC\u4F7F\u7528\u7684\u662F Docker \u7684\u8BDD\uFF0C\u5F53\u6211\u4EEC\u5728 Kubernetes \u4E2D\u521B\u5EFA\u4E00\u4E2A Pod \u7684\u65F6\u5019\uFF0C\u9996\u5148\u5C31\u662F kubelet \u901A\u8FC7 CRI \u63A5\u53E3\u8C03\u7528 <code>dockershim</code>\uFF0C\u8BF7\u6C42\u521B\u5EFA\u4E00\u4E2A\u5BB9\u5668\uFF0Ckubelet \u53EF\u4EE5\u89C6\u4F5C\u4E00\u4E2A\u7B80\u5355\u7684 CRI Client, \u800C dockershim \u5C31\u662F\u63A5\u6536\u8BF7\u6C42\u7684 Server\uFF0C\u4E0D\u8FC7\u4ED6\u4EEC\u90FD\u662F\u5728 kubelet \u5185\u7F6E\u7684\u3002</p><p><code>dockershim</code> \u6536\u5230\u8BF7\u6C42\u540E, \u8F6C\u5316\u6210 Docker Daemon \u80FD\u8BC6\u522B\u7684\u8BF7\u6C42, \u53D1\u5230 Docker Daemon \u4E0A\u8BF7\u6C42\u521B\u5EFA\u4E00\u4E2A\u5BB9\u5668\uFF0C\u8BF7\u6C42\u5230\u4E86 Docker Daemon \u540E\u7EED\u5C31\u662F Docker \u521B\u5EFA\u5BB9\u5668\u7684\u6D41\u7A0B\u4E86\uFF0C\u53BB\u8C03\u7528 <code>containerd</code>\uFF0C\u7136\u540E\u521B\u5EFA <code>containerd-shim</code> \u8FDB\u7A0B\uFF0C\u901A\u8FC7\u8BE5\u8FDB\u7A0B\u53BB\u8C03\u7528 <code>runc</code> \u53BB\u771F\u6B63\u521B\u5EFA\u5BB9\u5668\u3002</p><p>\u5176\u5B9E\u6211\u4EEC\u4ED4\u7EC6\u89C2\u5BDF\u4E5F\u4E0D\u96BE\u53D1\u73B0\u4F7F\u7528 Docker \u7684\u8BDD\u5176\u5B9E\u662F\u8C03\u7528\u94FE\u6BD4\u8F83\u957F\u7684\uFF0C\u771F\u6B63\u5BB9\u5668\u76F8\u5173\u7684\u64CD\u4F5C\u5176\u5B9E containerd \u5C31\u5B8C\u5168\u8DB3\u591F\u4E86\uFF0CDocker \u592A\u8FC7\u4E8E\u590D\u6742\u7B28\u91CD\u4E86\uFF0C\u5F53\u7136 Docker \u6DF1\u53D7\u6B22\u8FCE\u7684\u5F88\u5927\u4E00\u4E2A\u539F\u56E0\u5C31\u662F\u63D0\u4F9B\u4E86\u5F88\u591A\u5BF9\u7528\u6237\u64CD\u4F5C\u6BD4\u8F83\u53CB\u597D\u7684\u529F\u80FD\uFF0C\u4F46\u662F\u5BF9\u4E8E Kubernetes \u6765\u8BF4\u538B\u6839\u4E0D\u9700\u8981\u8FD9\u4E9B\u529F\u80FD\uFF0C\u56E0\u4E3A\u90FD\u662F\u901A\u8FC7\u63A5\u53E3\u53BB\u64CD\u4F5C\u5BB9\u5668\u7684\uFF0C\u6240\u4EE5\u81EA\u7136\u4E5F\u5C31\u53EF\u4EE5\u5C06\u5BB9\u5668\u8FD0\u884C\u65F6\u5207\u6362\u5230 containerd \u6765\u3002</p><p><img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20210810094948.png" alt="\u5207\u6362\u5230containerd" loading="lazy">\u5207\u6362\u5230containerd</p><p>\u5207\u6362\u5230 containerd \u53EF\u4EE5\u6D88\u9664\u6389\u4E2D\u95F4\u73AF\u8282\uFF0C\u64CD\u4F5C\u4F53\u9A8C\u4E5F\u548C\u4EE5\u524D\u4E00\u6837\uFF0C\u4F46\u662F\u7531\u4E8E\u76F4\u63A5\u7528\u5BB9\u5668\u8FD0\u884C\u65F6\u8C03\u5EA6\u5BB9\u5668\uFF0C\u6240\u4EE5\u5B83\u4EEC\u5BF9 Docker \u6765\u8BF4\u662F\u4E0D\u53EF\u89C1\u7684\u3002 \u56E0\u6B64\uFF0C\u4F60\u4EE5\u524D\u7528\u6765\u68C0\u67E5\u8FD9\u4E9B\u5BB9\u5668\u7684 Docker \u5DE5\u5177\u5C31\u4E0D\u80FD\u4F7F\u7528\u4E86\u3002</p><p>\u4F60\u4E0D\u80FD\u518D\u4F7F\u7528 <code>docker ps</code> \u6216 <code>docker inspect</code> \u547D\u4EE4\u6765\u83B7\u53D6\u5BB9\u5668\u4FE1\u606F\u3002\u7531\u4E8E\u4E0D\u80FD\u5217\u51FA\u5BB9\u5668\uFF0C\u56E0\u6B64\u4E5F\u4E0D\u80FD\u83B7\u53D6\u65E5\u5FD7\u3001\u505C\u6B62\u5BB9\u5668\uFF0C\u751A\u81F3\u4E0D\u80FD\u901A\u8FC7 <code>docker exec</code> \u5728\u5BB9\u5668\u4E2D\u6267\u884C\u547D\u4EE4\u3002</p><p>\u5F53\u7136\u6211\u4EEC\u4ECD\u7136\u53EF\u4EE5\u4E0B\u8F7D\u955C\u50CF\uFF0C\u6216\u8005\u7528 <code>docker build</code> \u547D\u4EE4\u6784\u5EFA\u955C\u50CF\uFF0C\u4F46\u7528 Docker \u6784\u5EFA\u3001\u4E0B\u8F7D\u7684\u955C\u50CF\uFF0C\u5BF9\u4E8E\u5BB9\u5668\u8FD0\u884C\u65F6\u548C Kubernetes\uFF0C\u5747\u4E0D\u53EF\u89C1\u3002\u4E3A\u4E86\u5728 Kubernetes \u4E2D\u4F7F\u7528\uFF0C\u9700\u8981\u628A\u955C\u50CF\u63A8\u9001\u5230\u955C\u50CF\u4ED3\u5E93\u4E2D\u53BB\u3002</p><p>\u4ECE\u4E0A\u56FE\u53EF\u4EE5\u770B\u51FA\u5728 containerd 1.0 \u4E2D\uFF0C\u5BF9 CRI \u7684\u9002\u914D\u662F\u901A\u8FC7\u4E00\u4E2A\u5355\u72EC\u7684 <code>CRI-Containerd</code> \u8FDB\u7A0B\u6765\u5B8C\u6210\u7684\uFF0C\u8FD9\u662F\u56E0\u4E3A\u6700\u5F00\u59CB containerd \u8FD8\u4F1A\u53BB\u9002\u914D\u5176\u4ED6\u7684\u7CFB\u7EDF\uFF08\u6BD4\u5982 swarm\uFF09\uFF0C\u6240\u4EE5\u6CA1\u6709\u76F4\u63A5\u5B9E\u73B0 CRI\uFF0C\u6240\u4EE5\u8FD9\u4E2A\u5BF9\u63A5\u5DE5\u4F5C\u5C31\u4EA4\u7ED9 <code>CRI-Containerd</code> \u8FD9\u4E2A shim \u4E86\u3002</p><p>\u7136\u540E\u5230\u4E86 containerd 1.1 \u7248\u672C\u540E\u5C31\u53BB\u6389\u4E86 <code>CRI-Containerd</code> \u8FD9\u4E2A shim\uFF0C\u76F4\u63A5\u628A\u9002\u914D\u903B\u8F91\u4F5C\u4E3A\u63D2\u4EF6\u7684\u65B9\u5F0F\u96C6\u6210\u5230\u4E86 containerd \u4E3B\u8FDB\u7A0B\u4E2D\uFF0C\u73B0\u5728\u8FD9\u6837\u7684\u8C03\u7528\u5C31\u66F4\u52A0\u7B80\u6D01\u4E86\u3002</p><p><img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20210810095546.png" alt="containerd cri" loading="lazy">containerd cri</p>',13),y={href:"https://cri-o.io/",target:"_blank",rel:"noopener noreferrer"},q=s("p",null,[s("img",{src:"https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20210810100752.png",alt:"cri-o",loading:"lazy"}),n("cri-o")],-1),_=s("p",null,[n("\u8FD9\u4E2A\u65B9\u6848\u548C containerd \u7684\u65B9\u6848\u663E\u7136\u6BD4\u9ED8\u8BA4\u7684 dockershim \u7B80\u6D01\u5F88\u591A\uFF0C\u4E0D\u8FC7\u7531\u4E8E\u5927\u90E8\u5206\u7528\u6237\u90FD\u6BD4\u8F83\u4E60\u60EF\u4F7F\u7528 Docker\uFF0C\u6240\u4EE5\u5927\u5BB6\u8FD8\u662F\u66F4\u559C\u6B22\u4F7F\u7528 "),s("code",null,"dockershim"),n(" \u65B9\u6848\u3002")],-1),f={href:"https://github.com/kubernetes/enhancements/tree/master/keps/sig-node/2221-remove-dockershim%EF%BC%8C%E7%8E%B0%E5%9C%A8%E7%9A%84%E7%A7%BB%E9%99%A4%E8%AE%A1%E5%88%92%E6%98%AF%E5%9C%A8",target:"_blank",rel:"noopener noreferrer"},x=s("code",null,"\u7EF4\u62A4\u6A21\u5F0F",-1),I=s("code",null,"dockershim",-1),C=s("code",null,"cri-dockerd",-1),D=s("code",null,"CRI-Containerd",-1),S=i(`<p>\u4F46\u662F\u6211\u4EEC\u4E5F\u6E05\u695A Dockerd \u4E5F\u662F\u53BB\u76F4\u63A5\u8C03\u7528\u7684 Containerd\uFF0C\u800C containerd 1.1 \u7248\u672C\u540E\u5C31\u5185\u7F6E\u5B9E\u73B0\u4E86 CRI\uFF0C\u6240\u4EE5 Docker \u4E5F\u6CA1\u5FC5\u8981\u518D\u53BB\u5355\u72EC\u5B9E\u73B0 CRI \u4E86\uFF0C\u5F53 Kubernetes \u4E0D\u518D\u5185\u7F6E\u652F\u6301\u5F00\u7BB1\u5373\u7528\u7684 Docker \u7684\u4EE5\u540E\uFF0C\u6700\u597D\u7684\u65B9\u5F0F\u5F53\u7136\u4E5F\u5C31\u662F\u76F4\u63A5\u4F7F\u7528 Containerd \u8FD9\u79CD\u5BB9\u5668\u8FD0\u884C\u65F6\uFF0C\u800C\u4E14\u8BE5\u5BB9\u5668\u8FD0\u884C\u65F6\u4E5F\u5DF2\u7ECF\u7ECF\u8FC7\u4E86\u751F\u4EA7\u73AF\u5883\u5B9E\u8DF5\u7684\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u5C31\u6765\u5B66\u4E60\u4E0B Containerd \u7684\u4F7F\u7528\u3002</p><h2 id="containerd" tabindex="-1"><a class="header-anchor" href="#containerd" aria-hidden="true">#</a> Containerd</h2><p>\u6211\u4EEC\u77E5\u9053\u5F88\u65E9\u4E4B\u524D\u7684 Docker Engine \u4E2D\u5C31\u6709\u4E86 containerd\uFF0C\u53EA\u4E0D\u8FC7\u73B0\u5728\u662F\u5C06 containerd \u4ECE Docker Engine \u91CC\u5206\u79BB\u51FA\u6765\uFF0C\u4F5C\u4E3A\u4E00\u4E2A\u72EC\u7ACB\u7684\u5F00\u6E90\u9879\u76EE\uFF0C\u76EE\u6807\u662F\u63D0\u4F9B\u4E00\u4E2A\u66F4\u52A0\u5F00\u653E\u3001\u7A33\u5B9A\u7684\u5BB9\u5668\u8FD0\u884C\u57FA\u7840\u8BBE\u65BD\u3002\u5206\u79BB\u51FA\u6765\u7684 containerd \u5C06\u5177\u6709\u66F4\u591A\u7684\u529F\u80FD\uFF0C\u6DB5\u76D6\u6574\u4E2A\u5BB9\u5668\u8FD0\u884C\u65F6\u7BA1\u7406\u7684\u6240\u6709\u9700\u6C42\uFF0C\u63D0\u4F9B\u66F4\u5F3A\u5927\u7684\u652F\u6301\u3002</p><p>containerd \u662F\u4E00\u4E2A\u5DE5\u4E1A\u7EA7\u6807\u51C6\u7684\u5BB9\u5668\u8FD0\u884C\u65F6\uFF0C\u5B83\u5F3A\u8C03<strong>\u7B80\u5355\u6027</strong>\u3001<strong>\u5065\u58EE\u6027</strong>\u548C<strong>\u53EF\u79FB\u690D\u6027</strong>\uFF0Ccontainerd \u53EF\u4EE5\u8D1F\u8D23\u5E72\u4E0B\u9762\u8FD9\u4E9B\u4E8B\u60C5\uFF1A</p><ul><li>\u7BA1\u7406\u5BB9\u5668\u7684\u751F\u547D\u5468\u671F\uFF08\u4ECE\u521B\u5EFA\u5BB9\u5668\u5230\u9500\u6BC1\u5BB9\u5668\uFF09</li><li>\u62C9\u53D6/\u63A8\u9001\u5BB9\u5668\u955C\u50CF</li><li>\u5B58\u50A8\u7BA1\u7406\uFF08\u7BA1\u7406\u955C\u50CF\u53CA\u5BB9\u5668\u6570\u636E\u7684\u5B58\u50A8\uFF09</li><li>\u8C03\u7528 runc \u8FD0\u884C\u5BB9\u5668\uFF08\u4E0E runc \u7B49\u5BB9\u5668\u8FD0\u884C\u65F6\u4EA4\u4E92\uFF09</li><li>\u7BA1\u7406\u5BB9\u5668\u7F51\u7EDC\u63A5\u53E3\u53CA\u7F51\u7EDC</li></ul><h3 id="\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#\u67B6\u6784" aria-hidden="true">#</a> \u67B6\u6784</h3><p>containerd \u53EF\u7528\u4F5C Linux \u548C Windows \u7684\u5B88\u62A4\u7A0B\u5E8F\uFF0C\u5B83\u7BA1\u7406\u5176\u4E3B\u673A\u7CFB\u7EDF\u5B8C\u6574\u7684\u5BB9\u5668\u751F\u547D\u5468\u671F\uFF0C\u4ECE\u955C\u50CF\u4F20\u8F93\u548C\u5B58\u50A8\u5230\u5BB9\u5668\u6267\u884C\u548C\u76D1\u6D4B\uFF0C\u518D\u5230\u5E95\u5C42\u5B58\u50A8\u5230\u7F51\u7EDC\u9644\u4EF6\u7B49\u7B49\u3002</p><p><img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20210810134700.png" alt="containerd \u67B6\u6784" loading="lazy">containerd \u67B6\u6784</p><p>\u4E0A\u56FE\u662F containerd \u5B98\u65B9\u63D0\u4F9B\u7684\u67B6\u6784\u56FE\uFF0C\u53EF\u4EE5\u770B\u51FA containerd \u91C7\u7528\u7684\u4E5F\u662F C/S \u67B6\u6784\uFF0C\u670D\u52A1\u7AEF\u901A\u8FC7 unix domain socket \u66B4\u9732\u4F4E\u5C42\u7684 gRPC API \u63A5\u53E3\u51FA\u53BB\uFF0C\u5BA2\u6237\u7AEF\u901A\u8FC7\u8FD9\u4E9B API \u7BA1\u7406\u8282\u70B9\u4E0A\u7684\u5BB9\u5668\uFF0C\u6BCF\u4E2A containerd \u53EA\u8D1F\u8D23\u4E00\u53F0\u673A\u5668\uFF0CPull \u955C\u50CF\uFF0C\u5BF9\u5BB9\u5668\u7684\u64CD\u4F5C\uFF08\u542F\u52A8\u3001\u505C\u6B62\u7B49\uFF09\uFF0C\u7F51\u7EDC\uFF0C\u5B58\u50A8\u90FD\u662F\u7531 containerd \u5B8C\u6210\u3002\u5177\u4F53\u8FD0\u884C\u5BB9\u5668\u7531 runc \u8D1F\u8D23\uFF0C\u5B9E\u9645\u4E0A\u53EA\u8981\u662F\u7B26\u5408 OCI \u89C4\u8303\u7684\u5BB9\u5668\u90FD\u53EF\u4EE5\u652F\u6301\u3002</p><p>\u4E3A\u4E86\u89E3\u8026\uFF0Ccontainerd \u5C06\u7CFB\u7EDF\u5212\u5206\u6210\u4E86\u4E0D\u540C\u7684\u7EC4\u4EF6\uFF0C\u6BCF\u4E2A\u7EC4\u4EF6\u90FD\u7531\u4E00\u4E2A\u6216\u591A\u4E2A\u6A21\u5757\u534F\u4F5C\u5B8C\u6210\uFF08Core \u90E8\u5206\uFF09\uFF0C\u6BCF\u4E00\u79CD\u7C7B\u578B\u7684\u6A21\u5757\u90FD\u4EE5\u63D2\u4EF6\u7684\u5F62\u5F0F\u96C6\u6210\u5230 Containerd \u4E2D\uFF0C\u800C\u4E14\u63D2\u4EF6\u4E4B\u95F4\u662F\u76F8\u4E92\u4F9D\u8D56\u7684\uFF0C\u4F8B\u5982\uFF0C\u4E0A\u56FE\u4E2D\u7684\u6BCF\u4E00\u4E2A\u957F\u865A\u7EBF\u7684\u65B9\u6846\u90FD\u8868\u793A\u4E00\u79CD\u7C7B\u578B\u7684\u63D2\u4EF6\uFF0C\u5305\u62EC Service Plugin\u3001Metadata Plugin\u3001GC Plugin\u3001Runtime Plugin \u7B49\uFF0C\u5176\u4E2D Service Plugin \u53C8\u4F1A\u4F9D\u8D56 Metadata Plugin\u3001GC Plugin \u548C Runtime Plugin\u3002\u6BCF\u4E00\u4E2A\u5C0F\u65B9\u6846\u90FD\u8868\u793A\u4E00\u4E2A\u7EC6\u5206\u7684\u63D2\u4EF6\uFF0C\u4F8B\u5982 Metadata Plugin \u4F9D\u8D56 Containers Plugin\u3001Content Plugin \u7B49\u3002\u6BD4\u5982:</p><ul><li><code>Content Plugin</code>: \u63D0\u4F9B\u5BF9\u955C\u50CF\u4E2D\u53EF\u5BFB\u5740\u5185\u5BB9\u7684\u8BBF\u95EE\uFF0C\u6240\u6709\u4E0D\u53EF\u53D8\u7684\u5185\u5BB9\u90FD\u88AB\u5B58\u50A8\u5728\u8FD9\u91CC\u3002</li><li><code>Snapshot Plugin</code>: \u7528\u6765\u7BA1\u7406\u5BB9\u5668\u955C\u50CF\u7684\u6587\u4EF6\u7CFB\u7EDF\u5FEB\u7167\uFF0C\u955C\u50CF\u4E2D\u7684\u6BCF\u4E00\u5C42\u90FD\u4F1A\u88AB\u89E3\u538B\u6210\u6587\u4EF6\u7CFB\u7EDF\u5FEB\u7167\uFF0C\u7C7B\u4F3C\u4E8E Docker \u4E2D\u7684 graphdriver\u3002</li></ul><p>\u603B\u4F53\u6765\u770B containerd \u53EF\u4EE5\u5206\u4E3A\u4E09\u4E2A\u5927\u5757\uFF1AStorage\u3001Metadata \u548C Runtime\u3002</p><p><img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20210810145929.png" alt="containerd \u67B6\u67842" loading="lazy">containerd \u67B6\u67842</p><h3 id="\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5" aria-hidden="true">#</a> \u5B89\u88C5</h3><p>\u8FD9\u91CC\u6211\u4F7F\u7528\u7684\u7CFB\u7EDF\u662F <code>Linux Mint 20.2</code>\uFF0C\u9996\u5148\u9700\u8981\u5B89\u88C5 <code>seccomp</code> \u4F9D\u8D56\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ <span class="token function">apt-get</span> update
\u279C  ~ <span class="token function">apt-get</span> <span class="token function">install</span> libseccomp2 <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,16),R=s("code",null,"cri-containerd-cni-${VERSION}.${OS}-${ARCH}.tar.gz",-1),E={href:"https://github.com/containerd/containerd/releases",target:"_blank",rel:"noopener noreferrer"},P=i(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ <span class="token function">wget</span> https://github.com/containerd/containerd/releases/download/v1.5.5/cri-containerd-cni-1.5.5-linux-amd64.tar.gz
<span class="token comment"># \u5982\u679C\u6709\u9650\u5236\uFF0C\u4E5F\u53EF\u4EE5\u66FF\u6362\u6210\u4E0B\u9762\u7684 URL \u52A0\u901F\u4E0B\u8F7D</span>
<span class="token comment"># wget https://download.fastgit.org/containerd/containerd/releases/download/v1.5.5/cri-containerd-cni-1.5.5-linux-amd64.tar.gz</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u901A\u8FC7 tar \u7684 <code>-t</code> \u9009\u9879\u76F4\u63A5\u770B\u5230\u538B\u7F29\u5305\u4E2D\u5305\u542B\u54EA\u4E9B\u6587\u4EF6\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ <span class="token function">tar</span> <span class="token parameter variable">-tf</span> cri-containerd-cni-1.4.3-linux-amd64.tar.gz
etc/
etc/cni/
etc/cni/net.d/
etc/cni/net.d/10-containerd-net.conflist
etc/crictl.yaml
etc/systemd/
etc/systemd/system/
etc/systemd/system/containerd.service
usr/
usr/local/
usr/local/bin/
usr/local/bin/containerd-shim-runc-v2
usr/local/bin/ctr
usr/local/bin/containerd-shim
usr/local/bin/containerd-shim-runc-v1
usr/local/bin/crictl
usr/local/bin/critest
usr/local/bin/containerd
usr/local/sbin/
usr/local/sbin/runc
opt/
opt/cni/
opt/cni/bin/
opt/cni/bin/vlan
opt/cni/bin/host-local
opt/cni/bin/flannel
opt/cni/bin/bridge
opt/cni/bin/host-device
opt/cni/bin/tuning
opt/cni/bin/firewall
opt/cni/bin/bandwidth
opt/cni/bin/ipvlan
opt/cni/bin/sbr
opt/cni/bin/dhcp
opt/cni/bin/portmap
opt/cni/bin/ptp
opt/cni/bin/static
opt/cni/bin/macvlan
opt/cni/bin/loopback
opt/containerd/
opt/containerd/cluster/
opt/containerd/cluster/version
opt/containerd/cluster/gce/
opt/containerd/cluster/gce/cni.template
opt/containerd/cluster/gce/configure.sh
opt/containerd/cluster/gce/cloud-init/
opt/containerd/cluster/gce/cloud-init/master.yaml
opt/containerd/cluster/gce/cloud-init/node.yaml
opt/containerd/cluster/gce/env
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u76F4\u63A5\u5C06\u538B\u7F29\u5305\u89E3\u538B\u5230\u7CFB\u7EDF\u7684\u5404\u4E2A\u76EE\u5F55\u4E2D\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ <span class="token function">tar</span> <span class="token parameter variable">-C</span> / <span class="token parameter variable">-xzf</span> cri-containerd-cni-1.5.5-linux-amd64.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5F53\u7136\u8981\u8BB0\u5F97\u5C06 <code>/usr/local/bin</code> \u548C <code>/usr/local/sbin</code> \u8FFD\u52A0\u5230 <code>~/.bashrc</code> \u6587\u4EF6\u7684 <code>PATH</code> \u73AF\u5883\u53D8\u91CF\u4E2D\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/bin:/usr/local/sbin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u7136\u540E\u6267\u884C\u4E0B\u9762\u7684\u547D\u4EE4\u4F7F\u5176\u7ACB\u5373\u751F\u6548\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ <span class="token builtin class-name">source</span> ~/.bashrc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>containerd \u7684\u9ED8\u8BA4\u914D\u7F6E\u6587\u4EF6\u4E3A <code>/etc/containerd/config.toml</code>\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u5982\u4E0B\u6240\u793A\u7684\u547D\u4EE4\u751F\u6210\u4E00\u4E2A\u9ED8\u8BA4\u7684\u914D\u7F6E\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ <span class="token function">mkdir</span> /etc/containerd
\u279C  ~ containerd config default <span class="token operator">&gt;</span> /etc/containerd/config.toml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7531\u4E8E\u4E0A\u9762\u6211\u4EEC\u4E0B\u5728\u7684 containerd \u538B\u7F29\u5305\u4E2D\u5305\u542B\u4E00\u4E2A <code>etc/systemd/system/containerd.service</code> \u7684\u6587\u4EF6\uFF0C\u8FD9\u6837\u6211\u4EEC\u5C31\u53EF\u4EE5\u901A\u8FC7 systemd \u6765\u914D\u7F6E containerd \u4F5C\u4E3A\u5B88\u62A4\u8FDB\u7A0B\u8FD0\u884C\u4E86\uFF0C\u5185\u5BB9\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ <span class="token function">cat</span> /etc/systemd/system/containerd.service
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>containerd container runtime
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://containerd.io
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target local-fs.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>-/sbin/modprobe overlay
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/bin/containerd

<span class="token assign-left variable">Type</span><span class="token operator">=</span>notify
<span class="token assign-left variable">Delegate</span><span class="token operator">=</span>yes
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>always
<span class="token assign-left variable">RestartSec</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span>
<span class="token comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span>
<span class="token assign-left variable">LimitNPROC</span><span class="token operator">=</span>infinity
<span class="token assign-left variable">LimitCORE</span><span class="token operator">=</span>infinity
<span class="token assign-left variable">LimitNOFILE</span><span class="token operator">=</span><span class="token number">1048576</span>
<span class="token comment"># Comment TasksMax if your systemd version does not supports it.</span>
<span class="token comment"># Only systemd 226 and above support this version.</span>
<span class="token assign-left variable">TasksMax</span><span class="token operator">=</span>infinity
<span class="token assign-left variable">OOMScoreAdjust</span><span class="token operator">=</span>-999

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u6709\u4E24\u4E2A\u91CD\u8981\u7684\u53C2\u6570\uFF1A</p><ul><li><code>Delegate</code>: \u8FD9\u4E2A\u9009\u9879\u5141\u8BB8 containerd \u4EE5\u53CA\u8FD0\u884C\u65F6\u81EA\u5DF1\u7BA1\u7406\u81EA\u5DF1\u521B\u5EFA\u5BB9\u5668\u7684 cgroups\u3002\u5982\u679C\u4E0D\u8BBE\u7F6E\u8FD9\u4E2A\u9009\u9879\uFF0Csystemd \u5C31\u4F1A\u5C06\u8FDB\u7A0B\u79FB\u5230\u81EA\u5DF1\u7684 cgroups \u4E2D\uFF0C\u4ECE\u800C\u5BFC\u81F4 containerd \u65E0\u6CD5\u6B63\u786E\u83B7\u53D6\u5BB9\u5668\u7684\u8D44\u6E90\u4F7F\u7528\u60C5\u51B5\u3002</li><li><code>KillMode</code>: \u8FD9\u4E2A\u9009\u9879\u7528\u6765\u5904\u7406 containerd \u8FDB\u7A0B\u88AB\u6740\u6B7B\u7684\u65B9\u5F0F\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Csystemd \u4F1A\u5728\u8FDB\u7A0B\u7684 cgroup \u4E2D\u67E5\u627E\u5E76\u6740\u6B7B containerd \u7684\u6240\u6709\u5B50\u8FDB\u7A0B\u3002KillMode \u5B57\u6BB5\u53EF\u4EE5\u8BBE\u7F6E\u7684\u503C\u5982\u4E0B\u3002 <ul><li><code>control-group</code>\uFF08\u9ED8\u8BA4\u503C\uFF09\uFF1A\u5F53\u524D\u63A7\u5236\u7EC4\u91CC\u9762\u7684\u6240\u6709\u5B50\u8FDB\u7A0B\uFF0C\u90FD\u4F1A\u88AB\u6740\u6389</li><li><code>process</code>\uFF1A\u53EA\u6740\u4E3B\u8FDB\u7A0B</li><li><code>mixed</code>\uFF1A\u4E3B\u8FDB\u7A0B\u5C06\u6536\u5230 SIGTERM \u4FE1\u53F7\uFF0C\u5B50\u8FDB\u7A0B\u6536\u5230 SIGKILL \u4FE1\u53F7</li><li><code>none</code>\uFF1A\u6CA1\u6709\u8FDB\u7A0B\u4F1A\u88AB\u6740\u6389\uFF0C\u53EA\u662F\u6267\u884C\u670D\u52A1\u7684 stop \u547D\u4EE4</li></ul></li></ul><p>\u6211\u4EEC\u9700\u8981\u5C06 KillMode \u7684\u503C\u8BBE\u7F6E\u4E3A process\uFF0C\u8FD9\u6837\u53EF\u4EE5\u786E\u4FDD\u5347\u7EA7\u6216\u91CD\u542F containerd \u65F6\u4E0D\u6740\u6B7B\u73B0\u6709\u7684\u5BB9\u5668\u3002</p><p>\u73B0\u5728\u6211\u4EEC\u5C31\u53EF\u4EE5\u542F\u52A8 containerd \u4E86\uFF0C\u76F4\u63A5\u6267\u884C\u4E0B\u9762\u7684\u547D\u4EE4\u5373\u53EF\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ systemctl <span class="token builtin class-name">enable</span> containerd <span class="token parameter variable">--now</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u542F\u52A8\u5B8C\u6210\u540E\u5C31\u53EF\u4EE5\u4F7F\u7528 containerd \u7684\u672C\u5730 CLI \u5DE5\u5177 <code>ctr</code> \u4E86\uFF0C\u6BD4\u5982\u67E5\u770B\u7248\u672C\uFF1A</p><p><img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20210810164519.png" alt="ctr version" loading="lazy">ctr version</p><h3 id="\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E" aria-hidden="true">#</a> \u914D\u7F6E</h3><p>\u6211\u4EEC\u9996\u5148\u6765\u67E5\u770B\u4E0B\u4E0A\u9762\u9ED8\u8BA4\u751F\u6210\u7684\u914D\u7F6E\u6587\u4EF6 <code>/etc/containerd/config.toml</code>\uFF1A</p><div class="language-toml ext-toml line-numbers-mode"><pre class="language-toml"><code><span class="token key property">disabled_plugins</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token key property">imports</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token key property">oom_score</span> <span class="token punctuation">=</span> <span class="token number">0</span>
<span class="token key property">plugin_dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
<span class="token key property">required_plugins</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token key property">root</span> <span class="token punctuation">=</span> <span class="token string">&quot;/var/lib/containerd&quot;</span>
<span class="token key property">state</span> <span class="token punctuation">=</span> <span class="token string">&quot;/run/containerd&quot;</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token number">2</span>

<span class="token punctuation">[</span><span class="token table class-name">cgroup</span><span class="token punctuation">]</span>
  <span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">debug</span><span class="token punctuation">]</span>
  <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token key property">format</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token key property">gid</span> <span class="token punctuation">=</span> <span class="token number">0</span>
  <span class="token key property">level</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token key property">uid</span> <span class="token punctuation">=</span> <span class="token number">0</span>

<span class="token punctuation">[</span><span class="token table class-name">grpc</span><span class="token punctuation">]</span>
  <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">&quot;/run/containerd/containerd.sock&quot;</span>
  <span class="token key property">gid</span> <span class="token punctuation">=</span> <span class="token number">0</span>
  <span class="token key property">max_recv_message_size</span> <span class="token punctuation">=</span> <span class="token number">16777216</span>
  <span class="token key property">max_send_message_size</span> <span class="token punctuation">=</span> <span class="token number">16777216</span>
  <span class="token key property">tcp_address</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token key property">tcp_tls_cert</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token key property">tcp_tls_key</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token key property">uid</span> <span class="token punctuation">=</span> <span class="token number">0</span>

<span class="token punctuation">[</span><span class="token table class-name">metrics</span><span class="token punctuation">]</span>
  <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token key property">grpc_histogram</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>

<span class="token punctuation">[</span><span class="token table class-name">plugins</span><span class="token punctuation">]</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.gc.v1.scheduler&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">deletion_threshold</span> <span class="token punctuation">=</span> <span class="token number">0</span>
    <span class="token key property">mutation_threshold</span> <span class="token punctuation">=</span> <span class="token number">100</span>
    <span class="token key property">pause_threshold</span> <span class="token punctuation">=</span> <span class="token number">0.02</span>
    <span class="token key property">schedule_delay</span> <span class="token punctuation">=</span> <span class="token string">&quot;0s&quot;</span>
    <span class="token key property">startup_delay</span> <span class="token punctuation">=</span> <span class="token string">&quot;100ms&quot;</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">disable_apparmor</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token key property">disable_cgroup</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token key property">disable_hugetlb_controller</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token key property">disable_proc_mount</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token key property">disable_tcp_service</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token key property">enable_selinux</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token key property">enable_tls_streaming</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token key property">ignore_image_defined_volumes</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token key property">max_concurrent_downloads</span> <span class="token punctuation">=</span> <span class="token number">3</span>
    <span class="token key property">max_container_log_line_size</span> <span class="token punctuation">=</span> <span class="token number">16384</span>
    <span class="token key property">netns_mounts_under_state_dir</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token key property">restrict_oom_score_adj</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token key property">sandbox_image</span> <span class="token punctuation">=</span> <span class="token string">&quot;k8s.gcr.io/pause:3.5&quot;</span>
    <span class="token key property">selinux_category_range</span> <span class="token punctuation">=</span> <span class="token number">1024</span>
    <span class="token key property">stats_collect_period</span> <span class="token punctuation">=</span> <span class="token number">10</span>
    <span class="token key property">stream_idle_timeout</span> <span class="token punctuation">=</span> <span class="token string">&quot;4h0m0s&quot;</span>
    <span class="token key property">stream_server_address</span> <span class="token punctuation">=</span> <span class="token string">&quot;127.0.0.1&quot;</span>
    <span class="token key property">stream_server_port</span> <span class="token punctuation">=</span> <span class="token string">&quot;0&quot;</span>
    <span class="token key property">systemd_cgroup</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token key property">tolerate_missing_hugetlb_controller</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token key property">unset_seccomp_profile</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

    <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.cni</span><span class="token punctuation">]</span>
      <span class="token key property">bin_dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/opt/cni/bin&quot;</span>
      <span class="token key property">conf_dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/etc/cni/net.d&quot;</span>
      <span class="token key property">conf_template</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
      <span class="token key property">max_conf_num</span> <span class="token punctuation">=</span> <span class="token number">1</span>

    <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd</span><span class="token punctuation">]</span>
      <span class="token key property">default_runtime_name</span> <span class="token punctuation">=</span> <span class="token string">&quot;runc&quot;</span>
      <span class="token key property">disable_snapshot_annotations</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
      <span class="token key property">discard_unpacked_layers</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
      <span class="token key property">no_pivot</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
      <span class="token key property">snapshotter</span> <span class="token punctuation">=</span> <span class="token string">&quot;overlayfs&quot;</span>

      <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime</span><span class="token punctuation">]</span>
        <span class="token key property">base_runtime_spec</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
        <span class="token key property">container_annotations</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token key property">pod_annotations</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token key property">privileged_without_host_devices</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
        <span class="token key property">runtime_engine</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
        <span class="token key property">runtime_root</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
        <span class="token key property">runtime_type</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

        <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime.options</span><span class="token punctuation">]</span>

      <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes</span><span class="token punctuation">]</span>

        <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc</span><span class="token punctuation">]</span>
          <span class="token key property">base_runtime_spec</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
          <span class="token key property">container_annotations</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token key property">pod_annotations</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token key property">privileged_without_host_devices</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
          <span class="token key property">runtime_engine</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
          <span class="token key property">runtime_root</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
          <span class="token key property">runtime_type</span> <span class="token punctuation">=</span> <span class="token string">&quot;io.containerd.runc.v2&quot;</span>

          <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options</span><span class="token punctuation">]</span>
            <span class="token key property">BinaryName</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
            <span class="token key property">CriuImagePath</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
            <span class="token key property">CriuPath</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
            <span class="token key property">CriuWorkPath</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
            <span class="token key property">IoGid</span> <span class="token punctuation">=</span> <span class="token number">0</span>
            <span class="token key property">IoUid</span> <span class="token punctuation">=</span> <span class="token number">0</span>
            <span class="token key property">NoNewKeyring</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
            <span class="token key property">NoPivotRoot</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
            <span class="token key property">Root</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
            <span class="token key property">ShimCgroup</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
            <span class="token key property">SystemdCgroup</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>

      <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.untrusted_workload_runtime</span><span class="token punctuation">]</span>
        <span class="token key property">base_runtime_spec</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
        <span class="token key property">container_annotations</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token key property">pod_annotations</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token key property">privileged_without_host_devices</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
        <span class="token key property">runtime_engine</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
        <span class="token key property">runtime_root</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
        <span class="token key property">runtime_type</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

        <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.untrusted_workload_runtime.options</span><span class="token punctuation">]</span>

    <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.image_decryption</span><span class="token punctuation">]</span>
      <span class="token key property">key_model</span> <span class="token punctuation">=</span> <span class="token string">&quot;node&quot;</span>

    <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry</span><span class="token punctuation">]</span>
      <span class="token key property">config_path</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

      <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.auths</span><span class="token punctuation">]</span>

      <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs</span><span class="token punctuation">]</span>

      <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.headers</span><span class="token punctuation">]</span>

      <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors</span><span class="token punctuation">]</span>

    <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.x509_key_pair_streaming</span><span class="token punctuation">]</span>
      <span class="token key property">tls_cert_file</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
      <span class="token key property">tls_key_file</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.internal.v1.opt&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/opt/containerd&quot;</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.internal.v1.restart&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">interval</span> <span class="token punctuation">=</span> <span class="token string">&quot;10s&quot;</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.metadata.v1.bolt&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">content_sharing_policy</span> <span class="token punctuation">=</span> <span class="token string">&quot;shared&quot;</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.monitor.v1.cgroups&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">no_prometheus</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.runtime.v1.linux&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">no_shim</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token key property">runtime</span> <span class="token punctuation">=</span> <span class="token string">&quot;runc&quot;</span>
    <span class="token key property">runtime_root</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
    <span class="token key property">shim</span> <span class="token punctuation">=</span> <span class="token string">&quot;containerd-shim&quot;</span>
    <span class="token key property">shim_debug</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.runtime.v2.task&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">platforms</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;linux/amd64&quot;</span><span class="token punctuation">]</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.service.v1.diff-service&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;walking&quot;</span><span class="token punctuation">]</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.snapshotter.v1.aufs&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">root_path</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.snapshotter.v1.btrfs&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">root_path</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.snapshotter.v1.devmapper&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">async_remove</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token key property">base_image_size</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
    <span class="token key property">pool_name</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
    <span class="token key property">root_path</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.snapshotter.v1.native&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">root_path</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.snapshotter.v1.overlayfs&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">root_path</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.snapshotter.v1.zfs&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">root_path</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">proxy_plugins</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span><span class="token table class-name">stream_processors</span><span class="token punctuation">]</span>

  <span class="token punctuation">[</span><span class="token table class-name">stream_processors.&quot;io.containerd.ocicrypt.decoder.v1.tar&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">accepts</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;application/vnd.oci.image.layer.v1.tar+encrypted&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">args</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;--decryption-keys-path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/etc/containerd/ocicrypt/keys&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">env</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;ctd-decoder&quot;</span>
    <span class="token key property">returns</span> <span class="token punctuation">=</span> <span class="token string">&quot;application/vnd.oci.image.layer.v1.tar&quot;</span>

  <span class="token punctuation">[</span><span class="token table class-name">stream_processors.&quot;io.containerd.ocicrypt.decoder.v1.tar.gzip&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">accepts</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;application/vnd.oci.image.layer.v1.tar+gzip+encrypted&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">args</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;--decryption-keys-path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/etc/containerd/ocicrypt/keys&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">env</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf&quot;</span><span class="token punctuation">]</span>
    <span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;ctd-decoder&quot;</span>
    <span class="token key property">returns</span> <span class="token punctuation">=</span> <span class="token string">&quot;application/vnd.oci.image.layer.v1.tar+gzip&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">timeouts</span><span class="token punctuation">]</span>
  <span class="token key property">&quot;io.containerd.timeout.shim.cleanup&quot;</span> <span class="token punctuation">=</span> <span class="token string">&quot;5s&quot;</span>
  <span class="token key property">&quot;io.containerd.timeout.shim.load&quot;</span> <span class="token punctuation">=</span> <span class="token string">&quot;5s&quot;</span>
  <span class="token key property">&quot;io.containerd.timeout.shim.shutdown&quot;</span> <span class="token punctuation">=</span> <span class="token string">&quot;3s&quot;</span>
  <span class="token key property">&quot;io.containerd.timeout.task.state&quot;</span> <span class="token punctuation">=</span> <span class="token string">&quot;2s&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">ttrpc</span><span class="token punctuation">]</span>
  <span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token key property">gid</span> <span class="token punctuation">=</span> <span class="token number">0</span>
  <span class="token key property">uid</span> <span class="token punctuation">=</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4E2A\u914D\u7F6E\u6587\u4EF6\u6BD4\u8F83\u590D\u6742\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5C06\u91CD\u70B9\u653E\u5728\u5176\u4E2D\u7684 <code>plugins</code> \u914D\u7F6E\u4E0A\u9762\uFF0C\u4ED4\u7EC6\u89C2\u5BDF\u6211\u4EEC\u53EF\u4EE5\u53D1\u73B0\u6BCF\u4E00\u4E2A\u9876\u7EA7\u914D\u7F6E\u5757\u7684\u547D\u540D\u90FD\u662F <code>plugins.&quot;io.containerd.xxx.vx.xxx&quot;</code> \u8FD9\u79CD\u5F62\u5F0F\uFF0C\u6BCF\u4E00\u4E2A\u9876\u7EA7\u914D\u7F6E\u5757\u90FD\u8868\u793A\u4E00\u4E2A\u63D2\u4EF6\uFF0C\u5176\u4E2D <code>io.containerd.xxx.vx</code> \u8868\u793A\u63D2\u4EF6\u7684\u7C7B\u578B\uFF0C<code>vx</code> \u540E\u9762\u7684 <code>xxx</code> \u8868\u793A\u63D2\u4EF6\u7684 ID\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7 <code>ctr</code> \u67E5\u770B\u63D2\u4EF6\u5217\u8868\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr plugin <span class="token function">ls</span>
ctr plugin <span class="token function">ls</span>
TYPE                            ID                       PLATFORMS      STATUS
io.containerd.content.v1        content                  -              ok
io.containerd.snapshotter.v1    aufs                     linux/amd64    ok
io.containerd.snapshotter.v1    btrfs                    linux/amd64    skip
io.containerd.snapshotter.v1    devmapper                linux/amd64    error
io.containerd.snapshotter.v1    native                   linux/amd64    ok
io.containerd.snapshotter.v1    overlayfs                linux/amd64    ok
io.containerd.snapshotter.v1    zfs                      linux/amd64    skip
io.containerd.metadata.v1       bolt                     -              ok
io.containerd.differ.v1         walking                  linux/amd64    ok
io.containerd.gc.v1             scheduler                -              ok
io.containerd.service.v1        introspection-service    -              ok
io.containerd.service.v1        containers-service       -              ok
io.containerd.service.v1        content-service          -              ok
io.containerd.service.v1        diff-service             -              ok
io.containerd.service.v1        images-service           -              ok
io.containerd.service.v1        leases-service           -              ok
io.containerd.service.v1        namespaces-service       -              ok
io.containerd.service.v1        snapshots-service        -              ok
io.containerd.runtime.v1        linux                    linux/amd64    ok
io.containerd.runtime.v2        task                     linux/amd64    ok
io.containerd.monitor.v1        cgroups                  linux/amd64    ok
io.containerd.service.v1        tasks-service            -              ok
io.containerd.internal.v1       restart                  -              ok
io.containerd.grpc.v1           containers               -              ok
io.containerd.grpc.v1           content                  -              ok
io.containerd.grpc.v1           <span class="token function">diff</span>                     -              ok
io.containerd.grpc.v1           events                   -              ok
io.containerd.grpc.v1           healthcheck              -              ok
io.containerd.grpc.v1           images                   -              ok
io.containerd.grpc.v1           leases                   -              ok
io.containerd.grpc.v1           namespaces               -              ok
io.containerd.internal.v1       opt                      -              ok
io.containerd.grpc.v1           snapshots                -              ok
io.containerd.grpc.v1           tasks                    -              ok
io.containerd.grpc.v1           version                  -              ok
io.containerd.grpc.v1           cri                      linux/amd64    ok
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9876\u7EA7\u914D\u7F6E\u5757\u4E0B\u9762\u7684\u5B50\u914D\u7F6E\u5757\u8868\u793A\u8BE5\u63D2\u4EF6\u7684\u5404\u79CD\u914D\u7F6E\uFF0C\u6BD4\u5982 cri \u63D2\u4EF6\u4E0B\u9762\u5C31\u5206\u4E3A containerd\u3001cni \u548C registry \u7684\u914D\u7F6E\uFF0C\u800C containerd \u4E0B\u9762\u53C8\u53EF\u4EE5\u914D\u7F6E\u5404\u79CD runtime\uFF0C\u8FD8\u53EF\u4EE5\u914D\u7F6E\u9ED8\u8BA4\u7684 runtime\u3002\u6BD4\u5982\u73B0\u5728\u6211\u4EEC\u8981\u4E3A\u955C\u50CF\u914D\u7F6E\u4E00\u4E2A\u52A0\u901F\u5668\uFF0C\u90A3\u4E48\u5C31\u9700\u8981\u5728 cri \u914D\u7F6E\u5757\u4E0B\u9762\u7684 <code>registry</code> \u914D\u7F6E\u5757\u4E0B\u9762\u8FDB\u884C\u914D\u7F6E <code>registry.mirrors</code>\uFF1A</p><div class="language-toml ext-toml line-numbers-mode"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;docker.io&quot;</span><span class="token punctuation">]</span>
      <span class="token key property">endpoint</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://bqr1dr1n.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;k8s.gcr.io&quot;</span><span class="token punctuation">]</span>
      <span class="token key property">endpoint</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://registry.aliyuncs.com/k8sxio&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,27),T=s("code",null,'registry.mirrors."xxx"',-1),A=s("code",null,'registry.mirrors."docker.io"',-1),w={href:"http://docker.io",target:"_blank",rel:"noopener noreferrer"},N=s("code",null,"endpoint",-1),K={href:"http://docker.io",target:"_blank",rel:"noopener noreferrer"},O=i(`<p>\u53E6\u5916\u5728\u9ED8\u8BA4\u914D\u7F6E\u4E2D\u8FD8\u6709\u4E24\u4E2A\u5173\u4E8E\u5B58\u50A8\u7684\u914D\u7F6E\u8DEF\u5F84\uFF1A</p><div class="language-toml ext-toml line-numbers-mode"><pre class="language-toml"><code><span class="token key property">root</span> <span class="token punctuation">=</span> <span class="token string">&quot;/var/lib/containerd&quot;</span>
<span class="token key property">state</span> <span class="token punctuation">=</span> <span class="token string">&quot;/run/containerd&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u4E2D <code>root</code> \u662F\u7528\u6765\u4FDD\u5B58\u6301\u4E45\u5316\u6570\u636E\uFF0C\u5305\u62EC Snapshots, Content, Metadata \u4EE5\u53CA\u5404\u79CD\u63D2\u4EF6\u7684\u6570\u636E\uFF0C\u6BCF\u4E00\u4E2A\u63D2\u4EF6\u90FD\u6709\u81EA\u5DF1\u5355\u72EC\u7684\u76EE\u5F55\uFF0CContainerd \u672C\u8EAB\u4E0D\u5B58\u50A8\u4EFB\u4F55\u6570\u636E\uFF0C\u5B83\u7684\u6240\u6709\u529F\u80FD\u90FD\u6765\u81EA\u4E8E\u5DF2\u52A0\u8F7D\u7684\u63D2\u4EF6\u3002\u800C\u53E6\u5916\u7684 <code>state</code> \u662F\u7528\u6765\u4FDD\u5B58\u8FD0\u884C\u65F6\u7684\u4E34\u65F6\u6570\u636E\u7684\uFF0C\u5305\u62EC sockets\u3001pid\u3001\u6302\u8F7D\u70B9\u3001\u8FD0\u884C\u65F6\u72B6\u6001\u4EE5\u53CA\u4E0D\u9700\u8981\u6301\u4E45\u5316\u7684\u63D2\u4EF6\u6570\u636E\u3002</p><h3 id="\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528" aria-hidden="true">#</a> \u4F7F\u7528</h3><p>\u6211\u4EEC\u77E5\u9053 Docker CLI \u5DE5\u5177\u63D0\u4F9B\u4E86\u9700\u8981\u589E\u5F3A\u7528\u6237\u4F53\u9A8C\u7684\u529F\u80FD\uFF0Ccontainerd \u540C\u6837\u4E5F\u63D0\u4F9B\u4E00\u4E2A\u5BF9\u5E94\u7684 CLI \u5DE5\u5177\uFF1A<code>ctr</code>\uFF0C\u4E0D\u8FC7 ctr \u7684\u529F\u80FD\u6CA1\u6709 docker \u5B8C\u5584\uFF0C\u4F46\u662F\u5173\u4E8E\u955C\u50CF\u548C\u5BB9\u5668\u7684\u57FA\u672C\u529F\u80FD\u90FD\u662F\u6709\u7684\u3002\u63A5\u4E0B\u6765\u6211\u4EEC\u5C31\u5148\u7B80\u5355\u4ECB\u7ECD\u4E0B <code>ctr</code> \u7684\u4F7F\u7528\u3002</p><p><strong>\u5E2E\u52A9</strong></p><p>\u76F4\u63A5\u8F93\u5165 <code>ctr</code> \u547D\u4EE4\u5373\u53EF\u83B7\u5F97\u6240\u6709\u76F8\u5173\u7684\u64CD\u4F5C\u547D\u4EE4\u4F7F\u7528\u65B9\u5F0F\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr
NAME:
   ctr -
        __
  _____/ /______
 / ___/ __/ ___/
/ /__/ /_/ /
<span class="token punctuation">\\</span>___/<span class="token punctuation">\\</span>__/_/

containerd CLI


USAGE:
   ctr <span class="token punctuation">[</span>global options<span class="token punctuation">]</span> <span class="token builtin class-name">command</span> <span class="token punctuation">[</span>command options<span class="token punctuation">]</span> <span class="token punctuation">[</span>arguments<span class="token punctuation">..</span>.<span class="token punctuation">]</span>

VERSION:
   v1.5.5

DESCRIPTION:

ctr is an unsupported debug and administrative client <span class="token keyword">for</span> interacting
with the containerd daemon. Because it is unsupported, the commands,
options, and operations are not guaranteed to be backward compatible or
stable from release to release of the containerd project.

COMMANDS:
   plugins, plugin            provides information about containerd plugins
   version                    print the client and server versions
   containers, c, container   manage containers
   content                    manage content
   events, event              display containerd events
   images, image, i           manage images
   leases                     manage leases
   namespaces, namespace, ns  manage namespaces
   pprof                      provide golang pprof outputs <span class="token keyword">for</span> containerd
   run                        run a container
   snapshots, snapshot        manage snapshots
   tasks, t, task             manage tasks
   <span class="token function">install</span>                    <span class="token function">install</span> a new package
   oci                        OCI tools
   shim                       interact with a shim directly
   help, h                    Shows a list of commands or <span class="token builtin class-name">help</span> <span class="token keyword">for</span> one <span class="token builtin class-name">command</span>

GLOBAL OPTIONS:
   <span class="token parameter variable">--debug</span>                      <span class="token builtin class-name">enable</span> debug output <span class="token keyword">in</span> logs
   <span class="token parameter variable">--address</span> value, <span class="token parameter variable">-a</span> value    address <span class="token keyword">for</span> containerd&#39;s GRPC server <span class="token punctuation">(</span>default: <span class="token string">&quot;/run/containerd/containerd.sock&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token variable">$CONTAINERD_ADDRESS</span><span class="token punctuation">]</span>
   <span class="token parameter variable">--timeout</span> value              total <span class="token function">timeout</span> <span class="token keyword">for</span> ctr commands <span class="token punctuation">(</span>default: 0s<span class="token punctuation">)</span>
   --connect-timeout value      <span class="token function">timeout</span> <span class="token keyword">for</span> connecting to containerd <span class="token punctuation">(</span>default: 0s<span class="token punctuation">)</span>
   <span class="token parameter variable">--namespace</span> value, <span class="token parameter variable">-n</span> value  namespace to use with commands <span class="token punctuation">(</span>default: <span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token variable">$CONTAINERD_NAMESPACE</span><span class="token punctuation">]</span>
   --help, <span class="token parameter variable">-h</span>                   show <span class="token builtin class-name">help</span>
   --version, <span class="token parameter variable">-v</span>                print the version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u955C\u50CF\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#\u955C\u50CF\u64CD\u4F5C" aria-hidden="true">#</a> \u955C\u50CF\u64CD\u4F5C</h4><p><strong>\u62C9\u53D6\u955C\u50CF</strong></p><p>\u62C9\u53D6\u955C\u50CF\u53EF\u4EE5\u4F7F\u7528 <code>ctr image pull</code> \u6765\u5B8C\u6210\uFF0C\u6BD4\u5982\u62C9\u53D6 Docker Hub \u5B98\u65B9\u955C\u50CF <code>nginx:alpine</code>\uFF0C\u9700\u8981\u6CE8\u610F\u7684\u662F\u955C\u50CF\u5730\u5740\u9700\u8981\u52A0\u4E0A <code>docker.io</code> Host \u5730\u5740\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr image pull docker.io/library/nginx:alpine
docker.io/library/nginx:alpine:                                                   resolved       <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span>
index-sha256:bead42240255ae1485653a956ef41c9e458eb077fcb6dc664cbc3aa9701a05ce:    exists         <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span>
manifest-sha256:ce6ca11a3fa7e0e6b44813901e3289212fc2f327ee8b1366176666e8fb470f24: <span class="token keyword">done</span>           <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span>
layer-sha256:9a6ac07b84eb50935293bb185d0a8696d03247f74fd7d43ea6161dc0f293f81f:    <span class="token keyword">done</span>           <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span>
layer-sha256:e82f830de071ebcda58148003698f32205b7970b01c58a197ac60d6bb79241b0:    <span class="token keyword">done</span>           <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span>
layer-sha256:d7c9fa7589ae28cd3306b204d5dd9a539612593e35df70f7a1d69ff7548e74cf:    <span class="token keyword">done</span>           <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span>
layer-sha256:bf2b3ee132db5b4c65432e53aca69da4e609c6cb154e0d0e14b2b02259e9c1e3:    <span class="token keyword">done</span>           <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span>
config-sha256:7ce0143dee376bfd2937b499a46fb110bda3c629c195b84b1cf6e19be1a9e23b:   <span class="token keyword">done</span>           <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span>
layer-sha256:3c1eaf69ff492177c34bdbf1735b6f2e5400e417f8f11b98b0da878f4ecad5fb:    <span class="token keyword">done</span>           <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span>
layer-sha256:29291e31a76a7e560b9b7ad3cada56e8c18d50a96cca8a2573e4f4689d7aca77:    <span class="token keyword">done</span>           <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span>
elapsed: <span class="token number">11</span>.9s                                                                    total:  <span class="token number">8.7</span> Mi <span class="token punctuation">(</span><span class="token number">748.1</span> KiB/s<span class="token punctuation">)</span>
unpacking linux/amd64 sha256:bead42240255ae1485653a956ef41c9e458eb077fcb6dc664cbc3aa9701a05ce<span class="token punctuation">..</span>.
done: <span class="token number">410</span>.86624ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E5F\u53EF\u4EE5\u4F7F\u7528 <code>--platform</code> \u9009\u9879\u6307\u5B9A\u5BF9\u5E94\u5E73\u53F0\u7684\u955C\u50CF\u3002\u5F53\u7136\u5BF9\u5E94\u7684\u4E5F\u6709\u63A8\u9001\u955C\u50CF\u7684\u547D\u4EE4 <code>ctr image push</code>\uFF0C\u5982\u679C\u662F\u79C1\u6709\u955C\u50CF\u5219\u5728\u63A8\u9001\u7684\u65F6\u5019\u53EF\u4EE5\u901A\u8FC7 <code>--user</code> \u6765\u81EA\u5B9A\u4E49\u4ED3\u5E93\u7684\u7528\u6237\u540D\u548C\u5BC6\u7801\u3002</p><p><strong>\u5217\u51FA\u672C\u5730\u955C\u50CF</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr image <span class="token function">ls</span>
REF                            TYPE                                                      DIGEST                                                                  SIZE    PLATFORMS                                                                                LABELS
docker.io/library/nginx:alpine application/vnd.docker.distribution.manifest.list.v2+json sha256:bead42240255ae1485653a956ef41c9e458eb077fcb6dc664cbc3aa9701a05ce <span class="token number">9.5</span> MiB linux/386,linux/amd64,linux/arm/v6,linux/arm/v7,linux/arm64/v8,linux/ppc64le,linux/s390x -
\u279C  ~ ctr image <span class="token function">ls</span> <span class="token parameter variable">-q</span>
docker.io/library/nginx:alpine
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528 <code>-q\uFF08--quiet\uFF09</code> \u9009\u9879\u53EF\u4EE5\u53EA\u6253\u5370\u955C\u50CF\u540D\u79F0\u3002</p><p><strong>\u68C0\u6D4B\u672C\u5730\u955C\u50CF</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr image check
REF                            TYPE                                                      DIGEST                                                                  STATUS         SIZE            UNPACKED
docker.io/library/nginx:alpine application/vnd.docker.distribution.manifest.list.v2+json sha256:bead42240255ae1485653a956ef41c9e458eb077fcb6dc664cbc3aa9701a05ce complete <span class="token punctuation">(</span><span class="token number">7</span>/7<span class="token punctuation">)</span> <span class="token number">9.5</span> MiB/9.5 MiB <span class="token boolean">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3B\u8981\u67E5\u770B\u5176\u4E2D\u7684 <code>STATUS</code>\uFF0C<code>complete</code> \u8868\u793A\u955C\u50CF\u662F\u5B8C\u6574\u53EF\u7528\u7684\u72B6\u6001\u3002</p><p><strong>\u91CD\u65B0\u6253\u6807\u7B7E</strong></p><p>\u540C\u6837\u7684\u6211\u4EEC\u4E5F\u53EF\u4EE5\u91CD\u65B0\u7ED9\u6307\u5B9A\u7684\u955C\u50CF\u6253\u4E00\u4E2A Tag\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr image tag docker.io/library/nginx:alpine harbor.k8s.local/course/nginx:alpine
harbor.k8s.local/course/nginx:alpine
\u279C  ~ ctr image <span class="token function">ls</span> <span class="token parameter variable">-q</span>
docker.io/library/nginx:alpine
harbor.k8s.local/course/nginx:alpine
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5220\u9664\u955C\u50CF</strong></p><p>\u4E0D\u9700\u8981\u4F7F\u7528\u7684\u955C\u50CF\u4E5F\u53EF\u4EE5\u4F7F\u7528 <code>ctr image rm</code> \u8FDB\u884C\u5220\u9664\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr image <span class="token function">rm</span> harbor.k8s.local/course/nginx:alpine
harbor.k8s.local/course/nginx:alpine
\u279C  ~ ctr image <span class="token function">ls</span> <span class="token parameter variable">-q</span>
docker.io/library/nginx:alpine
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u52A0\u4E0A <code>--sync</code> \u9009\u9879\u53EF\u4EE5\u540C\u6B65\u5220\u9664\u955C\u50CF\u548C\u6240\u6709\u76F8\u5173\u7684\u8D44\u6E90\u3002</p><p><strong>\u5C06\u955C\u50CF\u6302\u8F7D\u5230\u4E3B\u673A\u76EE\u5F55</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr image <span class="token function">mount</span> docker.io/library/nginx:alpine /mnt
sha256:c3554b2d61e3c1cffcaba4b4fa7651c644a3354efaafa2f22cb53542f6c600dc
/mnt
\u279C  ~ tree <span class="token parameter variable">-L</span> <span class="token number">1</span> /mnt
/mnt
\u251C\u2500\u2500 bin
\u251C\u2500\u2500 dev
\u251C\u2500\u2500 docker-entrypoint.d
\u251C\u2500\u2500 docker-entrypoint.sh
\u251C\u2500\u2500 etc
\u251C\u2500\u2500 home
\u251C\u2500\u2500 lib
\u251C\u2500\u2500 media
\u251C\u2500\u2500 mnt
\u251C\u2500\u2500 opt
\u251C\u2500\u2500 proc
\u251C\u2500\u2500 root
\u251C\u2500\u2500 run
\u251C\u2500\u2500 sbin
\u251C\u2500\u2500 srv
\u251C\u2500\u2500 sys
\u251C\u2500\u2500 tmp
\u251C\u2500\u2500 usr
\u2514\u2500\u2500 var

<span class="token number">18</span> directories, <span class="token number">1</span> <span class="token function">file</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5C06\u955C\u50CF\u4ECE\u4E3B\u673A\u76EE\u5F55\u4E0A\u5378\u8F7D</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr image unmount /mnt
/mnt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5C06\u955C\u50CF\u5BFC\u51FA\u4E3A\u538B\u7F29\u5305</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr image <span class="token builtin class-name">export</span> nginx.tar.gz docker.io/library/nginx:alpine
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u4ECE\u538B\u7F29\u5305\u5BFC\u5165\u955C\u50CF</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr image <span class="token function">import</span> nginx.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u5BB9\u5668\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#\u5BB9\u5668\u64CD\u4F5C" aria-hidden="true">#</a> \u5BB9\u5668\u64CD\u4F5C</h4><p>\u5BB9\u5668\u76F8\u5173\u64CD\u4F5C\u53EF\u4EE5\u901A\u8FC7 <code>ctr container</code> \u83B7\u53D6\u3002</p><p><strong>\u521B\u5EFA\u5BB9\u5668</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr container create docker.io/library/nginx:alpine nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u5217\u51FA\u5BB9\u5668</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr container <span class="token function">ls</span>
CONTAINER    IMAGE                             RUNTIME
nginx        docker.io/library/nginx:alpine    io.containerd.runc.v2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u540C\u6837\u53EF\u4EE5\u52A0\u4E0A <code>-q</code> \u9009\u9879\u7CBE\u7B80\u5217\u8868\u5185\u5BB9\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr container <span class="token function">ls</span> <span class="token parameter variable">-q</span>
nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u67E5\u770B\u5BB9\u5668\u8BE6\u7EC6\u914D\u7F6E</strong></p><p>\u7C7B\u4F3C\u4E8E <code>docker inspect</code> \u529F\u80FD\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr container info nginx
<span class="token punctuation">{</span>
    <span class="token string">&quot;ID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nginx&quot;</span>,
    <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;io.containerd.image.config.stop-signal&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;SIGQUIT&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;Image&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;docker.io/library/nginx:alpine&quot;</span>,
    <span class="token string">&quot;Runtime&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;io.containerd.runc.v2&quot;</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type_url&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;containerd.runc.v1.Options&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;SnapshotKey&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nginx&quot;</span>,
    <span class="token string">&quot;Snapshotter&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;overlayfs&quot;</span>,
    <span class="token string">&quot;CreatedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2021-08-12T08:23:13.792871558Z&quot;</span>,
    <span class="token string">&quot;UpdatedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2021-08-12T08:23:13.792871558Z&quot;</span>,
    <span class="token string">&quot;Extensions&quot;</span><span class="token builtin class-name">:</span> null,
    <span class="token string">&quot;Spec&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5220\u9664\u5BB9\u5668</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr container <span class="token function">rm</span> nginx
\u279C  ~ ctr container <span class="token function">ls</span>
CONTAINER    IMAGE    RUNTIME
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9664\u4E86\u4F7F\u7528 <code>rm</code> \u5B50\u547D\u4EE4\u4E4B\u5916\u4E5F\u53EF\u4EE5\u4F7F\u7528 <code>delete</code> \u6216\u8005 <code>del</code> \u5220\u9664\u5BB9\u5668\u3002</p><h4 id="\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#\u4EFB\u52A1" aria-hidden="true">#</a> \u4EFB\u52A1</h4><p>\u4E0A\u9762\u6211\u4EEC\u901A\u8FC7 <code>container create</code> \u547D\u4EE4\u521B\u5EFA\u7684\u5BB9\u5668\uFF0C\u5E76\u6CA1\u6709\u5904\u4E8E\u8FD0\u884C\u72B6\u6001\uFF0C\u53EA\u662F\u4E00\u4E2A\u9759\u6001\u7684\u5BB9\u5668\u3002\u4E00\u4E2A container \u5BF9\u8C61\u53EA\u662F\u5305\u542B\u4E86\u8FD0\u884C\u4E00\u4E2A\u5BB9\u5668\u6240\u9700\u7684\u8D44\u6E90\u53CA\u76F8\u5173\u914D\u7F6E\u6570\u636E\uFF0C\u8868\u793A namespaces\u3001rootfs \u548C\u5BB9\u5668\u7684\u914D\u7F6E\u90FD\u5DF2\u7ECF\u521D\u59CB\u5316\u6210\u529F\u4E86\uFF0C\u53EA\u662F\u7528\u6237\u8FDB\u7A0B\u8FD8\u6CA1\u6709\u542F\u52A8\u3002</p><p>\u4E00\u4E2A\u5BB9\u5668\u771F\u6B63\u8FD0\u884C\u8D77\u6765\u662F\u7531 Task \u4EFB\u52A1\u5B9E\u73B0\u7684\uFF0CTask \u53EF\u4EE5\u4E3A\u5BB9\u5668\u8BBE\u7F6E\u7F51\u5361\uFF0C\u8FD8\u53EF\u4EE5\u914D\u7F6E\u5DE5\u5177\u6765\u5BF9\u5BB9\u5668\u8FDB\u884C\u76D1\u63A7\u7B49\u3002</p><p>Task \u76F8\u5173\u64CD\u4F5C\u53EF\u4EE5\u901A\u8FC7 <code>ctr task</code> \u83B7\u53D6\uFF0C\u5982\u4E0B\u6211\u4EEC\u901A\u8FC7 Task \u6765\u542F\u52A8\u5BB9\u5668\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr task start <span class="token parameter variable">-d</span> nginx
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking <span class="token keyword">for</span> shell scripts <span class="token keyword">in</span> /docker-entrypoint.d/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u52A8\u5BB9\u5668\u540E\u53EF\u4EE5\u901A\u8FC7 <code>task ls</code> \u67E5\u770B\u6B63\u5728\u8FD0\u884C\u7684\u5BB9\u5668\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr task <span class="token function">ls</span>
TASK     PID     STATUS
nginx    <span class="token number">3630</span>    RUNNING
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u540C\u6837\u4E5F\u53EF\u4EE5\u4F7F\u7528 <code>exec</code> \u547D\u4EE4\u8FDB\u5165\u5BB9\u5668\u8FDB\u884C\u64CD\u4F5C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr task <span class="token builtin class-name">exec</span> --exec-id <span class="token number">0</span> <span class="token parameter variable">-t</span> nginx <span class="token function">sh</span>
/ <span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0D\u8FC7\u8FD9\u91CC\u9700\u8981\u6CE8\u610F\u5FC5\u987B\u8981\u6307\u5B9A <code>--exec-id</code> \u53C2\u6570\uFF0C\u8FD9\u4E2A id \u53EF\u4EE5\u968F\u4FBF\u5199\uFF0C\u53EA\u8981\u552F\u4E00\u5C31\u884C\u3002</p><p>\u6682\u505C\u5BB9\u5668\uFF0C\u548C <code>docker pause</code> \u7C7B\u4F3C\u7684\u529F\u80FD\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr task pause nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6682\u505C\u540E\u5BB9\u5668\u72B6\u6001\u53D8\u6210\u4E86 <code>PAUSED</code>\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr task <span class="token function">ls</span>
TASK     PID     STATUS
nginx    <span class="token number">3630</span>    PAUSED
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u540C\u6837\u4E5F\u53EF\u4EE5\u4F7F\u7528 <code>resume</code> \u547D\u4EE4\u6765\u6062\u590D\u5BB9\u5668\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr task resume nginx
\u279C  ~ ctr task <span class="token function">ls</span>
TASK     PID     STATUS
nginx    <span class="token number">3630</span>    RUNNING
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0D\u8FC7\u9700\u8981\u6CE8\u610F ctr \u6CA1\u6709 stop \u5BB9\u5668\u7684\u529F\u80FD\uFF0C\u53EA\u80FD\u6682\u505C\u6216\u8005\u6740\u6B7B\u5BB9\u5668\u3002\u6740\u6B7B\u5BB9\u5668\u53EF\u4EE5\u4F7F\u7528 <code>task kill</code> \u547D\u4EE4:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr task <span class="token function">kill</span> nginx
\u279C  ~ ctr task <span class="token function">ls</span>
TASK     PID     STATUS
nginx    <span class="token number">3630</span>    STOPPED
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6740\u6389\u5BB9\u5668\u540E\u53EF\u4EE5\u770B\u5230\u5BB9\u5668\u7684\u72B6\u6001\u53D8\u6210\u4E86 <code>STOPPED</code>\u3002\u540C\u6837\u4E5F\u53EF\u4EE5\u901A\u8FC7 <code>task rm</code> \u547D\u4EE4\u5220\u9664 Task\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr task <span class="token function">rm</span> nginx
\u279C  ~ ctr task <span class="token function">ls</span>
TASK    PID    STATUS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9664\u6B64\u4E4B\u5916\u6211\u4EEC\u8FD8\u53EF\u4EE5\u83B7\u53D6\u5BB9\u5668\u7684 cgroup \u76F8\u5173\u4FE1\u606F\uFF0C\u53EF\u4EE5\u4F7F\u7528 <code>task metrics</code> \u547D\u4EE4\u7528\u6765\u83B7\u53D6\u5BB9\u5668\u7684\u5185\u5B58\u3001CPU \u548C PID \u7684\u9650\u989D\u4E0E\u4F7F\u7528\u91CF\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u91CD\u65B0\u542F\u52A8\u5BB9\u5668</span>
\u279C  ~ ctr task metrics nginx
ID       TIMESTAMP
nginx    <span class="token number">2021</span>-08-12 08:50:46.952769941 +0000 UTC

METRIC                   VALUE
memory.usage_in_bytes    <span class="token number">8855552</span>
memory.limit_in_bytes    <span class="token number">9223372036854771712</span>
memory.stat.cache        <span class="token number">0</span>
cpuacct.usage            <span class="token number">22467106</span>
cpuacct.usage_percpu     <span class="token punctuation">[</span><span class="token number">2962708</span> <span class="token number">860891</span> <span class="token number">1163413</span> <span class="token number">1915748</span> <span class="token number">1058868</span> <span class="token number">2888139</span> <span class="token number">6159277</span> <span class="token number">5458062</span><span class="token punctuation">]</span>
pids.current             <span class="token number">9</span>
pids.limit               <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD8\u53EF\u4EE5\u4F7F\u7528 <code>task ps</code> \u547D\u4EE4\u67E5\u770B\u5BB9\u5668\u4E2D\u6240\u6709\u8FDB\u7A0B\u5728\u5BBF\u4E3B\u673A\u4E2D\u7684 PID\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr task <span class="token function">ps</span> nginx
PID     INFO
<span class="token number">3984</span>    -
<span class="token number">4029</span>    -
<span class="token number">4030</span>    -
<span class="token number">4031</span>    -
<span class="token number">4032</span>    -
<span class="token number">4033</span>    -
<span class="token number">4034</span>    -
<span class="token number">4035</span>    -
<span class="token number">4036</span>    -
\u279C  ~ ctr task <span class="token function">ls</span>
TASK     PID     STATUS
nginx    <span class="token number">3984</span>    RUNNING
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u4E2D\u7B2C\u4E00\u4E2A PID <code>3984</code> \u5C31\u662F\u6211\u4EEC\u5BB9\u5668\u4E2D\u76841\u53F7\u8FDB\u7A0B\u3002</p><h4 id="\u547D\u540D\u7A7A\u95F4" tabindex="-1"><a class="header-anchor" href="#\u547D\u540D\u7A7A\u95F4" aria-hidden="true">#</a> \u547D\u540D\u7A7A\u95F4</h4><p>\u53E6\u5916 Containerd \u4E2D\u4E5F\u652F\u6301\u547D\u540D\u7A7A\u95F4\u7684\u6982\u5FF5\uFF0C\u6BD4\u5982\u67E5\u770B\u547D\u540D\u7A7A\u95F4\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr ns <span class="token function">ls</span>
NAME    LABELS
default
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u679C\u4E0D\u6307\u5B9A\uFF0Cctr \u9ED8\u8BA4\u4F7F\u7528\u7684\u662F <code>default</code> \u7A7A\u95F4\u3002\u540C\u6837\u4E5F\u53EF\u4EE5\u4F7F\u7528 <code>ns create</code> \u547D\u4EE4\u521B\u5EFA\u4E00\u4E2A\u547D\u540D\u7A7A\u95F4\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr ns create <span class="token builtin class-name">test</span>
\u279C  ~ ctr ns <span class="token function">ls</span>
NAME    LABELS
default
<span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528 <code>remove</code> \u6216\u8005 <code>rm</code> \u53EF\u4EE5\u5220\u9664 namespace\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr ns <span class="token function">rm</span> <span class="token builtin class-name">test</span>
<span class="token builtin class-name">test</span>
\u279C  ~ ctr ns <span class="token function">ls</span>
NAME    LABELS
default
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6709\u4E86\u547D\u540D\u7A7A\u95F4\u540E\u5C31\u53EF\u4EE5\u5728\u64CD\u4F5C\u8D44\u6E90\u7684\u65F6\u5019\u6307\u5B9A namespace\uFF0C\u6BD4\u5982\u67E5\u770B test \u547D\u540D\u7A7A\u95F4\u7684\u955C\u50CF\uFF0C\u53EF\u4EE5\u5728\u64CD\u4F5C\u547D\u4EE4\u540E\u9762\u52A0\u4E0A <code>-n test</code> \u9009\u9879\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr <span class="token parameter variable">-n</span> <span class="token builtin class-name">test</span> image <span class="token function">ls</span>
REF TYPE DIGEST SIZE PLATFORMS LABELS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u77E5\u9053 Docker \u5176\u5B9E\u4E5F\u662F\u9ED8\u8BA4\u8C03\u7528\u7684 containerd\uFF0C\u4E8B\u5B9E\u4E0A Docker \u4F7F\u7528\u7684 containerd \u4E0B\u9762\u7684\u547D\u540D\u7A7A\u95F4\u9ED8\u8BA4\u662F <code>moby</code>\uFF0C\u800C\u4E0D\u662F <code>default</code>\uFF0C\u6240\u4EE5\u5047\u5982\u6211\u4EEC\u6709\u7528 docker \u542F\u52A8\u5BB9\u5668\uFF0C\u90A3\u4E48\u6211\u4EEC\u4E5F\u53EF\u4EE5\u901A\u8FC7 <code>ctr -n moby</code> \u6765\u5B9A\u4F4D\u4E0B\u9762\u7684\u5BB9\u5668\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u279C  ~ ctr <span class="token parameter variable">-n</span> moby container <span class="token function">ls</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u540C\u6837 Kubernetes \u4E0B\u4F7F\u7528\u7684 containerd \u9ED8\u8BA4\u547D\u540D\u7A7A\u95F4\u662F <code>k8s.io</code>\uFF0C\u6240\u4EE5\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 <code>ctr -n k8s.io</code> \u6765\u67E5\u770B Kubernetes \u4E0B\u9762\u521B\u5EFA\u7684\u5BB9\u5668\u3002\u540E\u7EED\u6211\u4EEC\u518D\u4ECB\u7ECD\u5982\u4F55\u5C06 Kubernetes \u96C6\u7FA4\u7684\u5BB9\u5668\u8FD0\u884C\u65F6\u5207\u6362\u5230 <code>containerd</code>\u3002</p>`,85);function L(M,z){const a=l("ExternalLinkIcon");return o(),c("div",null,[r,s("p",null,[n("CRI \u5B9A\u4E49\u7684 API("),s("a",d,[n("https://github.com/kubernetes/kubernetes/blob/release-1.5/pkg/kubelet/api/v1alpha1/runtime/api.proto"),e(a)]),n(") \u4E3B\u8981\u5305\u62EC\u4E24\u4E2A gRPC \u670D\u52A1\uFF0C"),u,n(" \u548C "),v,n("\uFF0C"),k,n(" \u670D\u52A1\u4E3B\u8981\u662F\u62C9\u53D6\u955C\u50CF\u3001\u67E5\u770B\u548C\u5220\u9664\u955C\u50CF\u7B49\u64CD\u4F5C\uFF0C"),m,n(" \u5219\u662F\u7528\u6765\u7BA1\u7406 Pod \u548C\u5BB9\u5668\u7684\u751F\u547D\u5468\u671F\uFF0C\u4EE5\u53CA\u4E0E\u5BB9\u5668\u4EA4\u4E92\u7684\u8C03\u7528\uFF08exec/attach/port-forward\uFF09\u7B49\u64CD\u4F5C\uFF0C\u53EF\u4EE5\u901A\u8FC7 kubelet \u4E2D\u7684\u6807\u5FD7 "),b,n(" \u548C "),g,n(" \u6765\u914D\u7F6E\u8FD9\u4E24\u4E2A\u670D\u52A1\u7684\u5957\u63A5\u5B57\u3002")]),h,s("p",null,[n("\u4E0E\u6B64\u540C\u65F6 Kubernetes \u793E\u533A\u4E5F\u505A\u4E86\u4E00\u4E2A\u4E13\u95E8\u7528\u4E8E Kubernetes \u7684 CRI \u8FD0\u884C\u65F6 "),s("a",y,[n("CRI-O"),e(a)]),n("\uFF0C\u76F4\u63A5\u517C\u5BB9 CRI \u548C OCI \u89C4\u8303\u3002")]),q,_,s("p",null,[n("\u4F46\u662F\u968F\u7740 CRI \u65B9\u6848\u7684\u53D1\u5C55\uFF0C\u4EE5\u53CA\u5176\u4ED6\u5BB9\u5668\u8FD0\u884C\u65F6\u5BF9 CRI \u7684\u652F\u6301\u8D8A\u6765\u8D8A\u5B8C\u5584\uFF0CKubernetes \u793E\u533A\u57282020\u5E747\u6708\u4EFD\u5C31\u5F00\u59CB\u7740\u624B\u79FB\u9664 dockershim \u65B9\u6848\u4E86\uFF1A"),s("a",f,[n("https://github.com/kubernetes/enhancements/tree/master/keps/sig-node/2221-remove-dockershim\uFF0C\u73B0\u5728\u7684\u79FB\u9664\u8BA1\u5212\u662F\u5728"),e(a)]),n(" 1.20 \u7248\u672C\u4E2D\u5C06 kubelet \u4E2D\u5185\u7F6E\u7684 dockershim \u4EE3\u7801\u5206\u79BB\uFF0C\u5C06\u5185\u7F6E\u7684 dockershim \u6807\u8BB0\u4E3A"),x,n("\uFF0C\u5F53\u7136\u8FD9\u4E2A\u65F6\u5019\u4ECD\u7136\u8FD8\u53EF\u4EE5\u4F7F\u7528 dockershim\uFF0C\u76EE\u6807\u662F\u5728 1.23\u20441.24 \u7248\u672C\u53D1\u5E03\u6CA1\u6709 dockershim \u7684\u7248\u672C\uFF08\u4EE3\u7801\u8FD8\u5728\uFF0C\u4F46\u662F\u8981\u9ED8\u8BA4\u652F\u6301\u5F00\u7BB1\u5373\u7528\u7684 docker \u9700\u8981\u81EA\u5DF1\u6784\u5EFA kubelet\uFF0C\u4F1A\u5728\u67D0\u4E2A\u5BBD\u9650\u671F\u8FC7\u540E\u4ECE kubelet \u4E2D\u5220\u9664\u5185\u7F6E\u7684 dockershim \u4EE3\u7801\uFF09\u3002\u90A3\u4E48\u8FD9\u662F\u5426\u5C31\u610F\u5473\u8FD9 Kubernetes \u4E0D\u518D\u652F\u6301 Docker \u4E86\u5462\uFF1F\u5F53\u7136\u4E0D\u662F\u7684\uFF0C\u8FD9\u53EA\u662F\u5E9F\u5F03\u4E86\u5185\u7F6E\u7684 "),I,n(" \u529F\u80FD\u800C\u5DF2\uFF0CDocker \u548C\u5176\u4ED6\u5BB9\u5668\u8FD0\u884C\u65F6\u5C06\u4E00\u89C6\u540C\u4EC1\uFF0C\u4E0D\u4F1A\u5355\u72EC\u5BF9\u5F85\u5185\u7F6E\u652F\u6301\uFF0C\u5982\u679C\u6211\u4EEC\u8FD8\u60F3\u76F4\u63A5\u4F7F\u7528 Docker \u8FD9\u79CD\u5BB9\u5668\u8FD0\u884C\u65F6\u5E94\u8BE5\u600E\u4E48\u529E\u5462\uFF1F\u53EF\u4EE5\u5C06 dockershim \u7684\u529F\u80FD\u5355\u72EC\u63D0\u53D6\u51FA\u6765\u72EC\u7ACB\u7EF4\u62A4\u4E00\u4E2A "),C,n(" \u5373\u53EF\uFF0C\u5C31\u7C7B\u4F3C\u4E8E containerd 1.0 \u7248\u672C\u4E2D\u63D0\u4F9B\u7684 "),D,n("\uFF0C\u5F53\u7136\u8FD8\u6709\u4E00\u79CD\u529E\u6CD5\u5C31\u662F Docker \u5B98\u65B9\u793E\u533A\u5C06 CRI \u63A5\u53E3\u5185\u7F6E\u5230 Dockerd \u4E2D\u53BB\u5B9E\u73B0\u3002")]),S,s("p",null,[n("\u7531\u4E8E containerd \u9700\u8981\u8C03\u7528 runc\uFF0C\u6240\u4EE5\u6211\u4EEC\u4E5F\u9700\u8981\u5148\u5B89\u88C5 runc\uFF0C\u4E0D\u8FC7 containerd \u63D0\u4F9B\u4E86\u4E00\u4E2A\u5305\u542B\u76F8\u5173\u4F9D\u8D56\u7684\u538B\u7F29\u5305 "),R,n("\uFF0C\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u8FD9\u4E2A\u5305\u6765\u8FDB\u884C\u5B89\u88C5\u3002\u9996\u5148\u4ECE "),s("a",E,[n("release \u9875\u9762"),e(a)]),n("\u4E0B\u8F7D\u6700\u65B0\u7248\u672C\u7684\u538B\u7F29\u5305\uFF0C\u5F53\u524D\u4E3A 1.5.5 \u7248\u672C\uFF1A")]),P,s("ul",null,[s("li",null,[T,n(": \u8868\u793A\u9700\u8981\u914D\u7F6E mirror \u7684\u955C\u50CF\u4ED3\u5E93\uFF0C\u4F8B\u5982 "),A,n(" \u8868\u793A\u914D\u7F6E "),s("a",w,[n("docker.io"),e(a)]),n(" \u7684 mirror\u3002")]),s("li",null,[N,n(": \u8868\u793A\u63D0\u4F9B mirror \u7684\u955C\u50CF\u52A0\u901F\u670D\u52A1\uFF0C\u6BD4\u5982\u6211\u4EEC\u53EF\u4EE5\u6CE8\u518C\u4E00\u4E2A\u963F\u91CC\u4E91\u7684\u955C\u50CF\u670D\u52A1\u6765\u4F5C\u4E3A "),s("a",K,[n("docker.io"),e(a)]),n(" \u7684 mirror\u3002")])]),O])}const B=t(p,[["render",L],["__file","07.\u4E00\u6587\u641E\u61C2containerd.html.vue"]]);export{B as default};
