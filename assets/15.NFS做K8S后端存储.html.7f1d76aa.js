import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,f as e}from"./app.ca0279c0.js";const t={},p=e(`<h1 id="nfs\u505Akubernetes\u7684\u540E\u7AEF\u5B58\u50A8" tabindex="-1"><a class="header-anchor" href="#nfs\u505Akubernetes\u7684\u540E\u7AEF\u5B58\u50A8" aria-hidden="true">#</a> NFS\u505AKubernetes\u7684\u540E\u7AEF\u5B58\u50A8</h1><h2 id="\u4F7F\u7528nfs\u4F5C\u4E3A\u9ED8\u8BA4sc" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528nfs\u4F5C\u4E3A\u9ED8\u8BA4sc" aria-hidden="true">#</a> \u4F7F\u7528NFS\u4F5C\u4E3A\u9ED8\u8BA4SC\uFF1A</h2><ul><li><strong>\u5B89\u88C5NFS\u670D\u52A1</strong></li><li><strong>\u914D\u7F6E\u5171\u4EAB\u5B58\u50A8\u8DEF\u5F84\u5F00\u653E\u6743\u9650</strong></li><li><strong>\u642D\u5EFANFS\u670D\u52A1\u5668\u548CNFS-Client</strong></li><li><strong>\u5728Master\u8282\u70B9\u4E0A\u9762\u6267\u884C\u547D\u4EE4 vi /etc/exports\uFF0C\u521B\u5EFA exports \u6587\u4EF6\uFF0C\u542F\u52A8 nfs \u670D\u52A1\uFF0C\u521B\u5EFA\u5171\u4EAB\u76EE\u5F55\u3002\u5728\u5176\u4ED6\u7684node\u8282\u70B9\u4E0A\u5B89\u88C5nfs\u670D\u52A1\u5E76\u4E14\u5F00\u542F\u670D\u52A1</strong></li></ul><h3 id="\u5B89\u88C5nfs\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5nfs\u670D\u52A1" aria-hidden="true">#</a> \u5B89\u88C5NFS\u670D\u52A1</h3><p>\u5728\u6240\u6709\u8282\u70B9\u5B89\u88C5NFS\u670D\u52A1\u914D\u7F6E\u5171\u4EAB\u76EE\u5F55\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum <span class="token function">install</span> <span class="token parameter variable">-y</span> nfs-utils
$ <span class="token builtin class-name">echo</span> <span class="token string">&quot;/nfs/data/ *(insecure,rw,sync,no_root_squash)&quot;</span> <span class="token operator">&gt;</span> /etc/exports
$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /nfs/data
$ systemctl <span class="token builtin class-name">enable</span> rpcbind <span class="token operator">&amp;&amp;</span> systemctl start rpcbind
$ systemctl <span class="token builtin class-name">enable</span> nfs-server <span class="token operator">&amp;&amp;</span> systemctl start nfs-server

<span class="token comment">#\u68C0\u67E5\u914D\u7F6E\u662F\u5426\u751F\u6548</span>
exportfs

<span class="token comment"># \u8F93\u51FA\u7ED3\u679C\u5982\u4E0B\u6240\u793A</span>
/nfs/data  <span class="token operator">&lt;</span>work<span class="token operator">&gt;</span>
$ showmount <span class="token parameter variable">-e</span> <span class="token number">10.10</span>.10.128
  Export list <span class="token keyword">for</span> <span class="token number">10.10</span>.10.128
  /nfs/data *
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u5728Node\u8282\u70B9\u4E0A\u914D\u7F6ENFS-Client(node1\u548Cnode2\u64CD\u4F5C)</strong></li><li><strong>\u5B89\u88C5\u5BA2\u6237\u7AEF\u5DE5\u5177,\u6302\u8F7D nfs \u670D\u52A1\u5668\u4E0A\u7684\u5171\u4EAB\u76EE\u5F55\u5230\u672C\u673A\u8DEF\u5F84 /root/nfsmount\u3002</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum <span class="token function">install</span> <span class="token parameter variable">-y</span> nfs-utils
$ <span class="token function">mkdir</span> /root/nfsmount
$ systemctl <span class="token builtin class-name">enable</span> rpcbind <span class="token operator">&amp;&amp;</span> systemctl start rpcbind
$ systemctl <span class="token builtin class-name">enable</span> nfs-server <span class="token operator">&amp;&amp;</span> systemctl start nfs-server
$ <span class="token function">mount</span> <span class="token parameter variable">-t</span> nfs <span class="token number">10.10</span>.10.128:/nfs/data /root/nfsmount
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u6D4B\u8BD5Pod\u76F4\u63A5\u6302\u8F7D\u4E86</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>$ vim pod.yaml 
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> vol<span class="token punctuation">-</span>nfs
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> html
    <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /nfs/data   <span class="token comment">#1000G</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span> \u81EA\u5DF1\u7684nfs\u670D\u52A1\u5668\u5730\u5740
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> html
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html/
$ kubectl apply <span class="token punctuation">-</span>f pod.yaml 
$ echo  ABCD <span class="token punctuation">&gt;</span> /nfs/data/index.html 
$ curl 
ABCD
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u8BBE\u7F6E\u52A8\u6001\u4F9B\u5E94" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u7F6E\u52A8\u6001\u4F9B\u5E94" aria-hidden="true">#</a> \u8BBE\u7F6E\u52A8\u6001\u4F9B\u5E94</h3><img src="https://pic.imgdb.cn/item/61ebecb52ab3f51d9113a1dd.png" alt="img" style="zoom:50%;"><p><strong>\u521B\u5EFAprovisioner\uFF08NFS\u73AF\u5883\u524D\u9762\u5DF2\u7ECF\u642D\u597D\uFF09</strong></p><table><thead><tr><th>\u5B57\u6BB5\u540D\u79F0</th><th>\u586B\u5165\u5185\u5BB9</th><th>\u5907\u6CE8</th></tr></thead><tbody><tr><td>\u540D\u79F0</td><td>nfs-storage</td><td>\u81EA\u5B9A\u4E49\u5B58\u50A8\u7C7B\u540D\u79F0</td></tr><tr><td>NFS Server</td><td>10.10.10.128</td><td>NFS\u670D\u52A1\u7684IP\u5730\u5740</td></tr><tr><td>NFS Path</td><td>/nfs/data</td><td>NFS\u670D\u52A1\u6240\u5171\u4EAB\u7684\u8DEF\u5F84</td></tr></tbody></table><ul><li><strong>\u5728Master\u8282\u70B9\u4E0A\u9762\u64CD\u4F5C</strong></li><li><strong>\u5148\u521B\u5EFA\u6388\u6743</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>provisioner
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>runner
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span>  <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;persistentvolumes&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span>
   <span class="token punctuation">-</span>  <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;persistentvolumeclaims&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">]</span>
   <span class="token punctuation">-</span>  <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;storage.k8s.io&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;storageclasses&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">]</span>
   <span class="token punctuation">-</span>  <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;events&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;patch&quot;</span><span class="token punctuation">]</span>
   <span class="token punctuation">-</span>  <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;services&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;endpoints&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">]</span>
   <span class="token punctuation">-</span>  <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;extensions&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;podsecuritypolicies&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;nfs-provisioner&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;use&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> run<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>provisioner
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>provisioner
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>runner
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
<span class="token punctuation">---</span>
<span class="token comment">#\u521B\u5EFAnfs-client\u7684\u6388\u6743</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
   <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
   <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
     <span class="token key atrule">type</span><span class="token punctuation">:</span> Recreate
   <span class="token key atrule">selector</span><span class="token punctuation">:</span>
     <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
   <span class="token key atrule">template</span><span class="token punctuation">:</span>
      <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
         <span class="token key atrule">labels</span><span class="token punctuation">:</span>
            <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
      <span class="token key atrule">spec</span><span class="token punctuation">:</span>
         <span class="token key atrule">serviceAccount</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>provisioner
         <span class="token key atrule">containers</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
               <span class="token key atrule">image</span><span class="token punctuation">:</span> lizhenliang/nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner
               <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
                 <span class="token punctuation">-</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>root
                    <span class="token key atrule">mountPath</span><span class="token punctuation">:</span>  /persistentvolumes
               <span class="token key atrule">env</span><span class="token punctuation">:</span>
                 <span class="token punctuation">-</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> PROVISIONER_NAME <span class="token comment">#\u4F9B\u5E94\u8005\u7684\u540D\u5B57</span>
                    <span class="token key atrule">value</span><span class="token punctuation">:</span> storage.pri/nfs <span class="token comment">#\u540D\u5B57\u867D\u7136\u53EF\u4EE5\u968F\u4FBF\u8D77\uFF0C\u4EE5\u540E\u5F15\u7528\u8981\u4E00\u81F4</span>
                 <span class="token punctuation">-</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> NFS_SERVER
                    <span class="token key atrule">value</span><span class="token punctuation">:</span> ip
                 <span class="token punctuation">-</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> NFS_PATH
                    <span class="token key atrule">value</span><span class="token punctuation">:</span> /nfs/data
         <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>root
             <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
               <span class="token key atrule">server</span><span class="token punctuation">:</span> ip
               <span class="token key atrule">path</span><span class="token punctuation">:</span> /nfs/data
<span class="token comment">##\u8FD9\u4E2A\u955C\u50CF\u4E2Dvolume\u7684mountPath\u9ED8\u8BA4\u4E3A/persistentvolumes\uFF0C\u4E0D\u80FD\u4FEE\u6539\uFF0C\u5426\u5219\u8FD0\u884C\u65F6\u4F1A\u62A5\u9519</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5728master\u4E0A\u521B\u5EFAprovisioner" tabindex="-1"><a class="header-anchor" href="#\u5728master\u4E0A\u521B\u5EFAprovisioner" aria-hidden="true">#</a> \u5728Master\u4E0A\u521B\u5EFAprovisioner</h3><ul><li>\u521B\u5EFA\u5B58\u50A8\u7C7B</li><li>\u6539\u53D8\u9ED8\u8BA4sc</li></ul><blockquote><p><strong>\u201Creclaim policy\u201D\u6709\u4E09\u79CD\u65B9\u5F0F\uFF1ARetain\u3001Recycle\u3001Deleted\u3002</strong></p></blockquote><p><strong><code>Retain</code></strong></p><ul><li>\u4FDD\u62A4\u88ABPVC\u91CA\u653E\u7684PV\u53CA\u5176\u4E0A\u6570\u636E\uFF0C\u5E76\u5C06PV\u72B6\u6001\u6539\u6210\u201Dreleased\u201D\uFF0C\u4E0D\u5C06\u88AB\u5176\u5B83PVC\u7ED1\u5B9A\u3002\u96C6\u7FA4\u7BA1\u7406\u5458\u624B\u52A8\u901A\u8FC7\u5982\u4E0B\u6B65\u9AA4\u91CA\u653E\u5B58\u50A8\u8D44\u6E90</li><li>\u624B\u52A8\u5220\u9664PV\uFF0C\u4F46\u4E0E\u5176\u76F8\u5173\u7684\u540E\u7AEF\u5B58\u50A8\u8D44\u6E90\u5982(AWS EBS, GCE PD, Azure Disk, or Cinder volume)\u4ECD\u7136\u5B58\u5728\u3002</li><li>\u624B\u52A8\u6E05\u7A7A\u540E\u7AEF\u5B58\u50A8volume\u4E0A\u7684\u6570\u636E\u3002</li><li>\u624B\u52A8\u5220\u9664\u540E\u7AEF\u5B58\u50A8volume\uFF0C\u6216\u8005\u91CD\u590D\u4F7F\u7528\u540E\u7AEFvolume\uFF0C\u4E3A\u5176\u521B\u5EFA\u65B0\u7684PV\u3002</li></ul><p><strong><code>Delete</code></strong></p><ul><li>\u5220\u9664\u88ABPVC\u91CA\u653E\u7684PV\u53CA\u5176\u540E\u7AEF\u5B58\u50A8volume\u3002\u5BF9\u4E8E\u52A8\u6001PV\u5176\u201Dreclaim policy\u201D\u7EE7\u627F\u81EA\u5176\u201Dstorage class\u201D\uFF0C</li><li>\u9ED8\u8BA4\u662FDelete\u3002\u96C6\u7FA4\u7BA1\u7406\u5458\u8D1F\u8D23\u5C06\u201Dstorage class\u201D\u7684\u201Dreclaim policy\u201D\u8BBE\u7F6E\u6210\u7528\u6237\u671F\u671B\u7684\u5F62\u5F0F\uFF0C\u5426\u5219\u9700\u8981\u7528\u6237\u624B\u52A8\u4E3A\u521B\u5EFA\u540E\u7684\u52A8\u6001PV\u7F16\u8F91\u201Dreclaim policy\u201D</li></ul><p><strong><code>Recycle</code></strong></p><ul><li>\u4FDD\u7559PV\uFF0C\u4F46\u6E05\u7A7A\u5176\u4E0A\u6570\u636E\uFF0C\u5DF2\u5E9F\u5F03</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>$  vi storageclass<span class="token punctuation">-</span>nfs.yaml
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> storage<span class="token punctuation">-</span>nfs
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> storage.pri/nfs
<span class="token key atrule">reclaimPolicy</span><span class="token punctuation">:</span> Delete

$ kubectl apply <span class="token punctuation">-</span>f storageclass<span class="token punctuation">-</span>nfs.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u6539\u53D8\u7CFB\u7EDF\u9ED8\u8BA4sc</span>
https://kubernetes.io/zh/docs/tasks/administer-cluster/change-default-storage-class/<span class="token comment">#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e6%94%b9%e5%8f%98%e9%bb%98%e8%ae%a4-storage-class</span>

$ kubectl patch storageclass storage-nfs <span class="token parameter variable">-p</span> <span class="token string">&#39;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u9A8C\u8BC1nfs\u52A8\u6001\u4F9B\u5E94" tabindex="-1"><a class="header-anchor" href="#\u9A8C\u8BC1nfs\u52A8\u6001\u4F9B\u5E94" aria-hidden="true">#</a> \u9A8C\u8BC1nfs\u52A8\u6001\u4F9B\u5E94</h3><p>\u521B\u5EFAPVC</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>$ vi  pvc.yaml
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pvc<span class="token punctuation">-</span>claim<span class="token punctuation">-</span><span class="token number">01</span>
 <span class="token comment"># annotations:</span>
 <span class="token comment">#   volume.beta.kubernetes.io/storage-class: &quot;storage-nfs&quot;</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> storage<span class="token punctuation">-</span>nfs  <span class="token comment">#\u8FD9\u4E2Aclass\u4E00\u5B9A\u6CE8\u610F\u8981\u548Csc\u7684\u540D\u5B57\u4E00\u6837</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Mi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528PVC</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>$ vi testpod.yaml
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pod
    <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/bin/sh&quot;</span>
    <span class="token key atrule">args</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;-c&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;touch /mnt/SUCCESS &amp;&amp; exit 0 || exit 1&quot;</span>
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pvc
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mnt&quot;</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> <span class="token string">&quot;Never&quot;</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pvc
      <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
        <span class="token key atrule">claimName</span><span class="token punctuation">:</span> pvc<span class="token punctuation">-</span>claim<span class="token punctuation">-</span><span class="token number">01</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="k8s-1-20x\u7248\u672Cnfs\u52A8\u6001\u5B58\u50A8\u62A5\u9519" tabindex="-1"><a class="header-anchor" href="#k8s-1-20x\u7248\u672Cnfs\u52A8\u6001\u5B58\u50A8\u62A5\u9519" aria-hidden="true">#</a> K8s 1.20x\u7248\u672Cnfs\u52A8\u6001\u5B58\u50A8\u62A5\u9519</h3><p><code>persistentvolume-controller waiting for a volume to be created, either by external provisioner &quot;qgg-nfs-storage&quot; or manually created by system administrator</code><code>waiting for a volume to be created, either by external provisioner &quot;storage.</code></p><ul><li><code>\u4FEE\u6539apiserver\u7684\u914D\u7F6E</code></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">cat</span> /etc/kubernetes/manifests/kube-apiserver.yaml
apiVersion: v1
\xB7\xB7\xB7
    - --tls-private-key-file<span class="token operator">=</span>/etc/kubernetes/pki/apiserver.key
    - --feature-gates<span class="token operator">=</span>RemoveSelfLink<span class="token operator">=</span>false <span class="token comment"># \u6DFB\u52A0\u8FD9\u4E2A\u914D\u7F6E</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>\u91CD\u542Fapiserver</code></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ systemctl  restart kubelet 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,38),l=[p];function i(o,c){return s(),a("div",null,l)}const k=n(t,[["render",i],["__file","15.NFS\u505AK8S\u540E\u7AEF\u5B58\u50A8.html.vue"]]);export{k as default};
