import{_ as e}from"./_plugin-vue_export-helper.cdc0426e.js";import{o,c as p,a as n,b as s,d as t,f as l,r as i}from"./app.ca0279c0.js";const r={},c=l(`<h1 id="\u4E91\u539F\u751F\u5B58\u50A8\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#\u4E91\u539F\u751F\u5B58\u50A8\u6982\u8FF0" aria-hidden="true">#</a> \u4E91\u539F\u751F\u5B58\u50A8\u6982\u8FF0</h1><h2 id="k8s\u6570\u636E\u6301\u4E45\u5316" tabindex="-1"><a class="header-anchor" href="#k8s\u6570\u636E\u6301\u4E45\u5316" aria-hidden="true">#</a> k8s\u6570\u636E\u6301\u4E45\u5316</h2><p><strong>\u677E\u8026\u5408\u7684\u65B9\u5F0F\uFF0CPod\u4E0E\u5B58\u50A8\u5206\u79BB\uFF0C\u4E09\u79CD\u65B9\u5F0F</strong></p><ul><li>volume\uFF0C\u9700\u8981\u77E5\u9053\u540E\u7AEF\u5B58\u50A8\u7684\u7EC6\u8282</li><li>PV/PVC \u7BA1\u7406\u5458\u5B9A\u4E49PV\uFF0CPersistentVolume\u3002\u7528\u6237\u901A\u8FC7PVC\u7684\u4F7F\u7528PersistentVolumeClaim\u3002</li><li>storageclass\uFF1A \u9759\u6001+\u52A8\u6001\uFF0C\u901A\u8FC7PVC\u58F0\u660E\u4F7F\u7528\u7684\u7A7A\u95F4\uFF0C\u81EA\u52A8\u521B\u5EFAPV\u548C\u540E\u7AEF\u9A71\u52A8\u7684\u5BF9\u63A5\u3002</li></ul><p><strong>\u666E\u901A\u5B58\u50A8\u5377</strong></p><p><strong><code>configmap\u548Csecret\u4EE5\u53CAsecret\u90FD\u662F\u5BB9\u5668\u542F\u52A8\u65F6\u4F9D\u8D56\u7684\u6570\u636E\uFF0CemptyDir\u548ChostPath\u90FD\u662F\u4E34\u65F6\u6570\u636E\u5B58\u50A8\uFF0Cnfs\uFF0Ccephfs\uFF0CGlutserFS\uFF0Ccloud\u90FD\u662F\u6301\u4E45\u5316\u6570\u636E\u5B58\u50A8\u3002</code></strong></p><p>\u5B58\u50A8\u6CA1\u6709\u5355\u72EC\u7684\u8D44\u6E90\u5BF9\u8C61\uFF0C\u4E0EPod\u7684\u751F\u547D\u5468\u671F\u4E00\u8D77\u3002</p><ul><li>configmap</li><li>secret</li><li>\u200B emptyDir</li><li>hostPath</li><li>nfs</li><li>cephfs</li><li>ClutserFS</li><li>Cloud</li></ul><h2 id="\u63ED\u5F00rook\u795E\u79D8\u9762\u7EB1" tabindex="-1"><a class="header-anchor" href="#\u63ED\u5F00rook\u795E\u79D8\u9762\u7EB1" aria-hidden="true">#</a> \u63ED\u5F00rook\u795E\u79D8\u9762\u7EB1</h2><h3 id="ceph\u90E8\u7F72\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#ceph\u90E8\u7F72\u65B9\u6CD5" aria-hidden="true">#</a> Ceph\u90E8\u7F72\u65B9\u6CD5</h3><p>Ceph\u5E38\u89C1\u7684\u90E8\u7F72\u65B9\u6CD5\u6709\uFF1A</p><ul><li>ceph-deploy</li><li>cephadm</li><li>\u624B\u5DE5\u90E8\u7F72</li><li>Rook</li></ul><h3 id="\u4EC0\u4E48\u662Frook" tabindex="-1"><a class="header-anchor" href="#\u4EC0\u4E48\u662Frook" aria-hidden="true">#</a> \u4EC0\u4E48\u662FRook</h3><p>Rook \u5C06\u5206\u5E03\u5F0F\u5B58\u50A8\u7CFB\u7EDF\u8F6C\u53D8\u4E3A\u81EA\u6211\u7BA1\u7406\u3001\u81EA\u6211\u6269\u5C55\u3001\u81EA\u6211\u4FEE\u590D\u7684\u5B58\u50A8\u670D\u52A1\u3002\u5B83\u53EF\u4EE5\u81EA\u52A8\u6267\u884C\u5B58\u50A8\u7BA1\u7406\u5458\u7684\u4EFB\u52A1\uFF1A\u90E8\u7F72\u3001\u5F15\u5BFC\u3001\u914D\u7F6E\u3001\u4F9B\u5E94\u3001\u6269\u5C55\u3001\u5347\u7EA7\u3001\u8FC1\u79FB\u3001\u707E\u96BE\u6062\u590D\u3001\u76D1\u63A7\u548C\u8D44\u6E90\u7BA1\u7406\u3002</p><p>\u5B9A\u4E49\uFF1A \u5F00\u6E90\uFF0C\u4E3AKubernetes\u800C\u670D\u52A1\u7684\u4E91\u539F\u751F\u5B58\u50A8,\u5373\u4E3AKubernetes</p><h3 id="rook\u5B58\u50A8\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#rook\u5B58\u50A8\u7C7B\u578B" aria-hidden="true">#</a> Rook\u5B58\u50A8\u7C7B\u578B</h3><ul><li>Ceph</li><li>NFS</li><li>Cassandra</li><li>CockroachDB</li><li>Yugabyte DB</li><li>EdgeFS</li></ul><h3 id="rook\u4E0Ek8s\u7ED3\u5408" tabindex="-1"><a class="header-anchor" href="#rook\u4E0Ek8s\u7ED3\u5408" aria-hidden="true">#</a> Rook\u4E0EK8S\u7ED3\u5408</h3><p><img src="https://i.bmp.ovh/imgs/2022/02/1a3bd1c65ecffd28.png" alt="" loading="lazy"></p><p><strong>rook\u8D1F\u8D23\u521D\u59CB\u5316\u548C\u7BA1\u7406Ceph\u96C6\u7FA4</strong></p><ul><li>monitor\u96C6\u7FA4</li><li>mgr\u96C6\u7FA4</li><li>osd\u96C6\u7FA4</li><li>pool\u7BA1\u7406</li><li>\u5BF9\u8C61\u5B58\u50A8</li><li>\u6587\u4EF6\u5B58\u50A8</li></ul><p><strong>rook\u8D1F\u8D23\u63D0\u4F9B\u8BBF\u95EE\u5B58\u50A8\u6240\u9700\u7684\u9A71\u52A8</strong></p><ul><li>Flex\u9A71\u52A8\uFF08\u65E7\u9A71\u52A8\uFF0C\u4E0D\u5EFA\u8BAE\u4F7F\u7528\uFF09</li><li>CSI\u9A71\u52A8</li><li>RBD\u5757\u5B58\u50A8</li><li>CephFS\u6587\u4EF6\u5B58\u50A8</li><li>S3/Swift\u98CE\u683C\u5BF9\u8C61\u5B58\u50A8</li></ul><h3 id="rook\u67B6\u6784\u89E3\u6790" tabindex="-1"><a class="header-anchor" href="#rook\u67B6\u6784\u89E3\u6790" aria-hidden="true">#</a> Rook\u67B6\u6784\u89E3\u6790</h3><p><img src="https://i.bmp.ovh/imgs/2022/02/2fdd5db7892f536c.png" alt="" loading="lazy"></p><p><strong>\u6240\u6709\u5BF9\u8C61\u4F9D\u6258\u4E8EKubernetes\u96C6\u7FA4</strong></p><ul><li>mon</li><li>rgw</li><li>mds</li><li>mgr</li><li>osd</li><li>Agent <ul><li>csi-rbdplugin</li><li>csi-cephfsplugi</li></ul></li></ul><p><strong>\u62BD\u8C61\u5316\u7BA1\u7406\uFF0C\u9690\u85CF\u7EC6\u8282</strong></p><ul><li>pool</li><li>volumes</li><li>filesystems</li><li>buckets</li></ul><h2 id="rook\u5FEB\u901F\u5165\u95E8" tabindex="-1"><a class="header-anchor" href="#rook\u5FEB\u901F\u5165\u95E8" aria-hidden="true">#</a> Rook\u5FEB\u901F\u5165\u95E8</h2><h3 id="\u90E8\u7F72rook\u7684\u524D\u63D0" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72rook\u7684\u524D\u63D0" aria-hidden="true">#</a> \u90E8\u7F72Rook\u7684\u524D\u63D0</h3><p>\u96C6\u7FA4\u73AF\u5883\u4ECB\u7ECD</p><blockquote><p><strong>\u64CD\u4F5C\u7CFB\u7EDF\u7248\u672C\uFF1A CentOS Linux release 8.3.2011</strong></p><p><strong>kubenetes\u7248\u672C\uFF1A kubernetes v1.20.2</strong></p></blockquote><table><thead><tr><th>\u8282\u70B9\u540D\u79F0</th><th>IP\u5730\u5740</th><th>k8s\u89D2\u8272</th><th>\u7EC4\u4EF6\u540D\u79F0</th><th>\u78C1\u76D8-50G</th></tr></thead><tbody><tr><td>node1</td><td></td><td>master</td><td>ceph-mon<br> ceph-mgr<br> ceph-osd<br> csi-cephfsplugin<br> csi-cephfsplugin</td><td>/dev/vdb</td></tr><tr><td>node2</td><td></td><td>node</td><td>ceph-mon<br> ceph-mgr<br> ceph-osd<br> csi-cephfsplugin<br> csi-cephfsplugin</td><td>/dev/vdb</td></tr><tr><td>node3</td><td></td><td>node</td><td>ceph-mon<br> ceph-osd<br> csi-cephfsplugin<br> csi-cephfsplugin</td><td>/dev/vdb</td></tr><tr><td>node4</td><td></td><td>node</td><td>ceph-osd<br> csi-cephfsplugin<br> csi-cephfsplugin</td><td>/dev/vdb</td></tr><tr><td>node5</td><td></td><td>node</td><td>ceph-osd<br> csi-cephfsplugin<br> csi-cephfsplugin</td><td>/dev/vdb</td></tr></tbody></table><h3 id="\u83B7\u53D6\u6E90\u7801" tabindex="-1"><a class="header-anchor" href="#\u83B7\u53D6\u6E90\u7801" aria-hidden="true">#</a> \u83B7\u53D6\u6E90\u7801</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">git</span> clone --single-branch <span class="token parameter variable">--branch</span> v1.8.3 https://github.com/rook/rook.git
$ <span class="token builtin class-name">cd</span> rook/deploy/examples
$ kubectl create <span class="token parameter variable">-f</span> crds.yaml <span class="token parameter variable">-f</span> common.yaml <span class="token parameter variable">-f</span> operator.yaml
$ kubectl create <span class="token parameter variable">-f</span> cluster.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u62C9\u53D6ceph\u955C\u50CF" tabindex="-1"><a class="header-anchor" href="#\u62C9\u53D6ceph\u955C\u50CF" aria-hidden="true">#</a> \u62C9\u53D6Ceph\u955C\u50CF</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># docker pull rook/ceph:v1.8.3</span>

v1.8.3: Pulling from rook/ceph
Digest: sha256:d3b03079b6e055f5a436611fb06f3eaa3991fe222ff066765491d66e4cd5f401
Status: Image is up to <span class="token function">date</span> <span class="token keyword">for</span> rook/ceph:v1.8.3
docker.io/rook/ceph:v1.8.3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u62C9\u53D6csi\u955C\u50CF" tabindex="-1"><a class="header-anchor" href="#\u62C9\u53D6csi\u955C\u50CF" aria-hidden="true">#</a> \u62C9\u53D6Csi\u955C\u50CF</h3><p>\u627E\u51FA\u9700\u8981\u62C9\u53D6\u7684\u955C\u50CF</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># for i in \`kubectl get pods -n rook-ceph -o jsonpath=&#39;{.items[*].spec.containers[*].image}&#39;\`;do echo \${i} | grep gcr.io;done</span>
k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0
k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0
k8s.gcr.io/sig-storage/csi-attacher:v3.4.0
k8s.gcr.io/sig-storage/csi-snapshotter:v4.2.0
k8s.gcr.io/sig-storage/csi-resizer:v1.3.0
k8s.gcr.io/sig-storage/csi-provisioner:v3.1.0
k8s.gcr.io/sig-storage/csi-attacher:v3.4.0
k8s.gcr.io/sig-storage/csi-snapshotter:v4.2.0
k8s.gcr.io/sig-storage/csi-resizer:v1.3.0
k8s.gcr.io/sig-storage/csi-provisioner:v3.1.0
k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0
k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0
k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0
k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0
k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0
k8s.gcr.io/sig-storage/csi-provisioner:v3.1.0
k8s.gcr.io/sig-storage/csi-resizer:v1.3.0
k8s.gcr.io/sig-storage/csi-attacher:v3.4.0
k8s.gcr.io/sig-storage/csi-snapshotter:v4.2.0
k8s.gcr.io/sig-storage/csi-provisioner:v3.1.0
k8s.gcr.io/sig-storage/csi-resizer:v1.3.0
k8s.gcr.io/sig-storage/csi-attacher:v3.4.0
k8s.gcr.io/sig-storage/csi-snapshotter:v4.2.0
k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\u7F16\u5199\u4E00\u4E2A\u811A\u672C\u62C9\u53D6\u955C\u50CF</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash </span>

<span class="token assign-left variable">image_list</span><span class="token operator">=</span><span class="token punctuation">(</span>
        csi-provisioner:v3.1.0
        csi-node-driver-registrar:v2.4.0
        csi-attacher:v3.4.0
        csi-snapshotter:v4.2.0
        csi-resizer:v1.3.0
<span class="token punctuation">)</span>

<span class="token assign-left variable">aliyuncs</span><span class="token operator">=</span><span class="token string">&quot;registry.aliyuncs.com/it00021hot&quot;</span> \u6216\u8005 registry.aliyuncs.com/google_containers
<span class="token assign-left variable">google_gcr</span><span class="token operator">=</span><span class="token string">&quot;k8s.gcr.io/sig-storage&quot;</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">image</span> <span class="token keyword">in</span> <span class="token variable">\${image_list<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>
<span class="token keyword">do</span> 
  <span class="token function">docker</span> image pull <span class="token variable">\${aliyuncs}</span>/<span class="token variable">\${image}</span>
  <span class="token function">docker</span> image tag  <span class="token variable">\${aliyuncs}</span>/<span class="token variable">\${image}</span> <span class="token variable">\${google_gcr}</span>/<span class="token variable">\${image}</span>
  <span class="token function">docker</span> image <span class="token function">rm</span> <span class="token variable">\${aliyuncs}</span>/<span class="token variable">\${image}</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${aliyuncs}</span>/<span class="token variable">\${image}</span> <span class="token variable">\${google_gcr}</span>/<span class="token variable">\${image}</span> downloaded&quot;</span>
<span class="token keyword">done</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u67E5\u770B\u72B6\u6001" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770B\u72B6\u6001" aria-hidden="true">#</a> \u67E5\u770B\u72B6\u6001</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide -n rook-ceph </span>
NAME                                              READY   STATUS      RESTARTS   AGE   IP               NODE    NOMINATED NODE   READINESS GATES
csi-cephfsplugin-6cmc9                            <span class="token number">3</span>/3     Running     <span class="token number">0</span>          26m   <span class="token number">192.168</span>.0.121    node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
csi-cephfsplugin-kpk9h                            <span class="token number">3</span>/3     Running     <span class="token number">0</span>          27m   <span class="token number">192.168</span>.0.133    node4   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
csi-cephfsplugin-n87jf                            <span class="token number">3</span>/3     Running     <span class="token number">0</span>          26m   <span class="token number">192.168</span>.0.42     node3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
csi-cephfsplugin-provisioner-57fdf9cc88-6c57f     <span class="token number">6</span>/6     Running     <span class="token number">0</span>          27m   <span class="token number">10.244</span>.104.10    node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
csi-cephfsplugin-provisioner-57fdf9cc88-dqhf8     <span class="token number">6</span>/6     Running     <span class="token number">0</span>          27m   <span class="token number">10.244</span>.135.11    node3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
csi-cephfsplugin-zck7h                            <span class="token number">3</span>/3     Running     <span class="token number">0</span>          27m   <span class="token number">192.168</span>.0.177    node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
csi-rbdplugin-btjpc                               <span class="token number">3</span>/3     Running     <span class="token number">0</span>          26m   <span class="token number">192.168</span>.0.42     node3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
csi-rbdplugin-jb864                               <span class="token number">3</span>/3     Running     <span class="token number">0</span>          26m   <span class="token number">192.168</span>.0.133    node4   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
csi-rbdplugin-lpj4t                               <span class="token number">3</span>/3     Running     <span class="token number">0</span>          27m   <span class="token number">192.168</span>.0.177    node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
csi-rbdplugin-provisioner-865f84ff48-bwwvw        <span class="token number">6</span>/6     Running     <span class="token number">0</span>          27m   <span class="token number">10.244</span>.166.143   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
csi-rbdplugin-provisioner-865f84ff48-ls2jv        <span class="token number">6</span>/6     Running     <span class="token number">0</span>          27m   <span class="token number">10.244</span>.3.75      node4   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
csi-rbdplugin-w9wb5                               <span class="token number">3</span>/3     Running     <span class="token number">0</span>          27m   <span class="token number">192.168</span>.0.121    node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-crashcollector-node1-7bdf8cf7d-8fvfw    <span class="token number">1</span>/1     Running     <span class="token number">0</span>          60m   <span class="token number">10.244</span>.166.138   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-crashcollector-node2-5d87c47d67-qqgzw   <span class="token number">1</span>/1     Running     <span class="token number">0</span>          62m   <span class="token number">10.244</span>.104.4     node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-crashcollector-node3-5999b78949-rqm6d   <span class="token number">1</span>/1     Running     <span class="token number">0</span>          51m   <span class="token number">10.244</span>.135.8     node3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-crashcollector-node4-69d99c8b7c-v6rbq   <span class="token number">1</span>/1     Running     <span class="token number">0</span>          61m   <span class="token number">10.244</span>.3.69      node4   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-mgr-a-9bfd675fc-pblwn                   <span class="token number">1</span>/1     Running     <span class="token number">0</span>          62m   <span class="token number">10.244</span>.166.134   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-mon-a-6985594f74-55hdt                  <span class="token number">1</span>/1     Running     <span class="token number">0</span>          70m   <span class="token number">10.244</span>.3.68      node4   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-mon-b-d7b47d9c6-ptv5n                   <span class="token number">1</span>/1     Running     <span class="token number">0</span>          65m   <span class="token number">10.244</span>.104.3     node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-mon-c-58dfcdfd8f-87svf                  <span class="token number">1</span>/1     Running     <span class="token number">0</span>          62m   <span class="token number">10.244</span>.166.133   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-operator-6b5c6b5dcf-dwfhp               <span class="token number">1</span>/1     Running     <span class="token number">0</span>          87m   <span class="token number">10.244</span>.104.1     node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-osd-0-65d46bb8d8-p6cdm                  <span class="token number">1</span>/1     Running     <span class="token number">0</span>          55m   <span class="token number">10.244</span>.3.73      node4   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-osd-1-7887c44f8d-8qdmr                  <span class="token number">1</span>/1     Running     <span class="token number">0</span>          55m   <span class="token number">10.244</span>.104.8     node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-osd-2-55c6df6466-slxrf                  <span class="token number">1</span>/1     Running     <span class="token number">0</span>          53m   <span class="token number">10.244</span>.166.140   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-osd-3-6648dc584-mjtbv                   <span class="token number">1</span>/1     Running     <span class="token number">0</span>          51m   <span class="token number">10.244</span>.135.7     node3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-osd-prepare-node1-bx4bw                 <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          49m   <span class="token number">10.244</span>.166.142   node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-osd-prepare-node2-kcbrv                 <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          49m   <span class="token number">10.244</span>.104.9     node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-osd-prepare-node3-9t666                 <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          49m   <span class="token number">10.244</span>.135.10    node3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
rook-ceph-osd-prepare-node4-rcrfc                 <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          49m   <span class="token number">10.244</span>.3.74      node4   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="master\u52A0\u5165osd" tabindex="-1"><a class="header-anchor" href="#master\u52A0\u5165osd" aria-hidden="true">#</a> Master\u52A0\u5165OSD</h3><p>\u56E0\u4E3AMaster\u8282\u70B9\u662F\u88AB\u7981\u6B62\u8C03\u5EA6\uFF0C\u5C31\u662F\u6C61\u70B9\uFF0C\u9700\u8981\u8BBE\u7F6E\u53D6\u6D88\u7981\u6B62\u8C03\u5EA6\u548C\u6C61\u70B9\u3002\u7136\u540E\u8BA9Master\u52A0\u5165OSD\u8282\u70B9\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl taint node master  node-role.kubernetes.io/master:NoSchedule-</span>
node/master untainted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u90E8\u7F72rook-ceph-\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72rook-ceph-\u5DE5\u5177" aria-hidden="true">#</a> \u90E8\u7F72Rook Ceph \u5DE5\u5177</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master examples<span class="token punctuation">]</span><span class="token comment"># kubectl create -f toolbox.yaml </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u901A\u8FC7ceph-tool\u5DE5\u5177pod\u67E5\u770Bceph\u96C6\u7FA4\u72B6\u6001</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it pod/rook-ceph-tools-7bbd566fd9-smchn -n rook-ceph -- bash</span>
<span class="token punctuation">[</span>rook@rook-ceph-tools-7bbd566fd9-smchn /<span class="token punctuation">]</span>$ ceph <span class="token parameter variable">-s</span> 
  cluster:
    id:     9790e7f4-cfa3-44de-a411-5926d3034cb7
    health: HEALTH_OK
 
  services:
    mon: <span class="token number">3</span> daemons, quorum a,c,b <span class="token punctuation">(</span>age 106m<span class="token punctuation">)</span>
    mgr: a<span class="token punctuation">(</span>active, since 104m<span class="token punctuation">)</span>
    osd: <span class="token number">5</span> osds: <span class="token number">5</span> up <span class="token punctuation">(</span>since 29m<span class="token punctuation">)</span>, <span class="token number">5</span> <span class="token keyword">in</span> <span class="token punctuation">(</span>since 29m<span class="token punctuation">)</span>
 
  data:
    pools:   <span class="token number">1</span> pools, <span class="token number">1</span> pgs
    objects: <span class="token number">0</span> objects, <span class="token number">0</span> B
    usage:   <span class="token number">28</span> MiB used, <span class="token number">250</span> GiB / <span class="token number">250</span> GiB avail
    pgs:     <span class="token number">1</span> active+clean


<span class="token punctuation">[</span>rook@rook-ceph-tools-7bbd566fd9-smchn /<span class="token punctuation">]</span>$ ceph <span class="token function">df</span> 
--- RAW STORAGE ---
CLASS     SIZE    AVAIL    USED  RAW USED  %RAW USED
hdd    <span class="token number">250</span> GiB  <span class="token number">250</span> GiB  <span class="token number">28</span> MiB    <span class="token number">28</span> MiB       <span class="token number">0.01</span>
TOTAL  <span class="token number">250</span> GiB  <span class="token number">250</span> GiB  <span class="token number">28</span> MiB    <span class="token number">28</span> MiB       <span class="token number">0.01</span>
 
--- POOLS ---
POOL                   ID  PGS  STORED  OBJECTS  USED  %USED  MAX AVAIL
device_health_metrics   <span class="token number">1</span>    <span class="token number">1</span>     <span class="token number">0</span> B        <span class="token number">0</span>   <span class="token number">0</span> B      <span class="token number">0</span>     <span class="token number">79</span> GiB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u90E8\u7F72ceph-dashboard" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72ceph-dashboard" aria-hidden="true">#</a> \u90E8\u7F72Ceph Dashboard</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master examples<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f dashboard-external-https.yaml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u83B7\u53D6dashboard\u7684admin\u5BC6\u7801</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master examples<span class="token punctuation">]</span><span class="token comment"># kubectl -n rook-ceph get secret rook-ceph-dashboard-password -o \\</span>
<span class="token operator">&gt;</span> <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&quot;{[&#39;data&#39;][&#39;password&#39;]}&quot;</span> <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span>
drX3<span class="token punctuation">{</span>d2D<span class="token comment">#dU,Z,_#z6kn</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7NodePort\u53BB\u8BBF\u95EE</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master examples<span class="token punctuation">]</span><span class="token comment"># kubectl get svc -n rook-ceph</span>
NAME                                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>             AGE
csi-cephfsplugin-metrics                 ClusterIP   <span class="token number">10.103</span>.81.126    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span>/TCP,8081/TCP   110m
csi-rbdplugin-metrics                    ClusterIP   <span class="token number">10.105</span>.224.132   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span>/TCP,8081/TCP   110m
rook-ceph-mgr                            ClusterIP   <span class="token number">10.104</span>.54.196    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">9283</span>/TCP            98m
rook-ceph-mgr-dashboard                  ClusterIP   <span class="token number">10.109</span>.104.68    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8443</span>/TCP            98m
rook-ceph-mgr-dashboard-external-https   NodePort    <span class="token number">10.104</span>.174.92    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8443</span>:32349/TCP      32m     <span class="token comment">#\u8FD9\u4E2A\u5C31\u662Fdashboard\u7684\u5730\u5740</span>
rook-ceph-mon-a                          ClusterIP   <span class="token number">10.100</span>.122.20    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">6789</span>/TCP,3300/TCP   108m
rook-ceph-mon-b                          ClusterIP   <span class="token number">10.97</span>.200.54     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">6789</span>/TCP,3300/TCP   103m
rook-ceph-mon-c                          ClusterIP   <span class="token number">10.101</span>.245.217   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">6789</span>/TCP,3300/TCP   100m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://i.bmp.ovh/imgs/2022/02/a86d7dc906dc25a6.png" style="zoom:80%;"><h2 id="ceph\u96C6\u7FA4\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#ceph\u96C6\u7FA4\u7BA1\u7406" aria-hidden="true">#</a> Ceph\u96C6\u7FA4\u7BA1\u7406</h2><h3 id="ceph\u8D44\u6E90\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#ceph\u8D44\u6E90\u5BF9\u8C61" aria-hidden="true">#</a> Ceph\u8D44\u6E90\u5BF9\u8C61</h3><p>Ceph\u5305\u542B\u7684\u7EC4\u4EF6\uFF1A</p><ul><li>mon monitor \u7BA1\u7406\u96C6\u7FA4</li><li>mgr manager \u76D1\u63A7\u7BA1\u7406</li><li>mds CephFS \u5143\u6570\u636E\u7BA1\u7406</li><li>rgw \u5BF9\u8C61\u5B58\u50A8</li><li>osd \u5B58\u50A8</li></ul><h3 id="k8s\u96C6\u7FA4\u8BBF\u95EEceph" tabindex="-1"><a class="header-anchor" href="#k8s\u96C6\u7FA4\u8BBF\u95EEceph" aria-hidden="true">#</a> K8S\u96C6\u7FA4\u8BBF\u95EECeph</h3><p>\u67E5\u770B\u5BB9\u5668\u5185\u90E8\u7684Ceph\u914D\u7F6E\u6587\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>rook@rook-ceph-tools-7bbd566fd9-smchn /<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/ceph/ceph.conf 
<span class="token punctuation">[</span>global<span class="token punctuation">]</span>
mon_host <span class="token operator">=</span> <span class="token number">10.101</span>.245.217:6789,10.100.122.20:6789,10.97.200.54:6789

<span class="token punctuation">[</span>client.admin<span class="token punctuation">]</span>
keyring <span class="token operator">=</span> /etc/ceph/keyring
<span class="token punctuation">[</span>rook@rook-ceph-tools-7bbd566fd9-smchn /<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/ceph/keyring 
<span class="token punctuation">[</span>client.admin<span class="token punctuation">]</span>
key <span class="token operator">=</span> <span class="token assign-left variable">AQAZOPph2QMBMxAAqepptucmmM6eM5gG5ZbKHg</span><span class="token operator">==</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u62F7\u8D1D\u5BB9\u5668\u5185\u7684\u914D\u7F6E\u6587\u4EF6\u5230\u672C\u5730\u96C6\u7FA4</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mkdir /etc/ceph </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/ceph/ceph.conf </span>
<span class="token punctuation">[</span>global<span class="token punctuation">]</span>
mon_host <span class="token operator">=</span> <span class="token number">10.101</span>.245.217:6789,10.100.122.20:6789,10.97.200.54:6789

<span class="token punctuation">[</span>client.admin<span class="token punctuation">]</span>
keyring <span class="token operator">=</span> /etc/ceph/keyring

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vim  /etc/ceph/keyring </span>
<span class="token punctuation">[</span>client.admin<span class="token punctuation">]</span>
key <span class="token operator">=</span> <span class="token assign-left variable">AQAZOPph2QMBMxAAqepptucmmM6eM5gG5ZbKHg</span><span class="token operator">==</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B89\u88C5Ceph\u5BA2\u6237\u7AEF</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat &gt; /etc/yum.repos.d/ceph.repo &lt;&lt; EOF </span>
<span class="token operator">&gt;</span> <span class="token punctuation">[</span>ceph<span class="token punctuation">]</span>
<span class="token operator">&gt;</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>ceph
<span class="token operator">&gt;</span> <span class="token assign-left variable">baseurl</span><span class="token operator">=</span>https://mirrors.aliyun.com/ceph/rpm-pacific/el8/x86_64/
<span class="token operator">&gt;</span> <span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token operator">&gt;</span> EOF

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># yum install -y ceph-common </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># ceph -s </span>
  cluster:
    id:     9790e7f4-cfa3-44de-a411-5926d3034cb7
    health: HEALTH_OK
 
  services:
    mon: <span class="token number">3</span> daemons, quorum a,c,b <span class="token punctuation">(</span>age 106m<span class="token punctuation">)</span>
    mgr: a<span class="token punctuation">(</span>active, since 104m<span class="token punctuation">)</span>
    osd: <span class="token number">5</span> osds: <span class="token number">5</span> up <span class="token punctuation">(</span>since 29m<span class="token punctuation">)</span>, <span class="token number">5</span> <span class="token keyword">in</span> <span class="token punctuation">(</span>since 29m<span class="token punctuation">)</span>
 
  data:
    pools:   <span class="token number">1</span> pools, <span class="token number">1</span> pgs
    objects: <span class="token number">0</span> objects, <span class="token number">0</span> B
    usage:   <span class="token number">28</span> MiB used, <span class="token number">250</span> GiB / <span class="token number">250</span> GiB avail
    pgs:     <span class="token number">1</span> active+clean
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u8BBF\u95EErbd\u5757\u5B58\u50A8" tabindex="-1"><a class="header-anchor" href="#\u8BBF\u95EErbd\u5757\u5B58\u50A8" aria-hidden="true">#</a> \u8BBF\u95EERBD\u5757\u5B58\u50A8</h3><p>1\u3001\u521B\u5EFApool</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># ceph osd  pool  create rook 16 16 </span>
pool <span class="token string">&#39;rook&#39;</span> created
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># ceph osd lspools </span>
<span class="token number">1</span> device_health_metrics
<span class="token number">2</span> rook
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2\u3001\u5728pool\u521B\u5EFARBD\u5757\u8BBE\u5907</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># rbd create -p rook --image  rook-rbd.img --size 10G</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># rbd ls -p rook</span>
rook-rbd.img
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># rbd info rook/rook-rbd.img</span>
rbd image <span class="token string">&#39;rook-rbd.img&#39;</span><span class="token builtin class-name">:</span>
        size <span class="token number">10</span> GiB <span class="token keyword">in</span> <span class="token number">2560</span> objects
        order <span class="token number">22</span> <span class="token punctuation">(</span><span class="token number">4</span> MiB objects<span class="token punctuation">)</span>
        snapshot_count: <span class="token number">0</span>
        id: 4a802aa59f38
        block_name_prefix: rbd_data.4a802aa59f38
        format: <span class="token number">2</span>
        features: layering
        op_features: 
        flags: 
        create_timestamp: Wed Feb  <span class="token number">2</span> <span class="token number">10</span>:21:34 <span class="token number">2022</span>
        access_timestamp: Wed Feb  <span class="token number">2</span> <span class="token number">10</span>:21:34 <span class="token number">2022</span>
        modify_timestamp: Wed Feb  <span class="token number">2</span> <span class="token number">10</span>:21:34 <span class="token number">2022</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3\u3001\u5BA2\u6237\u7AEF\u6302\u8F7D</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># rbd map rook/rook-rbd.img </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># rbd showmapped </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mkfs.xfs /dev/rbd0</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/rbd0 /media/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rook\u63D0\u4F9Brbd\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#rook\u63D0\u4F9Brbd\u670D\u52A1" aria-hidden="true">#</a> rook\u63D0\u4F9BRBD\u670D\u52A1</h3><p>rook\u53EF\u4EE5\u63D0\u4F9B\u4EE5\u4E0B3\u7C7B\u578B\u7684\u5B58\u50A8\uFF1A</p><ul><li>Block: Create block storage to be consumed by a pod</li><li>Object: Create an object store that is accessible inside or outside the Kubernetes cluster</li><li>Shared File System: Create a file system to be shared across multiple pods</li></ul><h3 id="\u4F7F\u7528rook-ceph\u7684\u5757\u5B58\u50A8" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528rook-ceph\u7684\u5757\u5B58\u50A8" aria-hidden="true">#</a> \u4F7F\u7528rook-ceph\u7684\u5757\u5B58\u50A8</h3><blockquote><p>1\u3001\u57FA\u4E8E CSI \u9A71\u52A8\u7A0B\u5E8F\u521B\u5EFA\u5377 2\u3001\u57FA\u4E8E flex \u9A71\u52A8\u7A0B\u5E8F\u521B\u5EFA\u5377 1\u3001<code>\u6B64\u793A\u4F8B\u4F7F\u7528 CSI \u9A71\u52A8\u7A0B\u5E8F\uFF0C\u5B83\u662F K8s 1.13 \u548C\u66F4\u65B0\u7248\u672C\u7684\u9996\u9009\u9A71\u52A8\u7A0B\u5E8F\u3002</code> 2\u3001flex \u9A71\u52A8\u7A0B\u5E8F\uFF08K8s 1.12 \u6216\u66F4\u65E9\u7248\u672C\u9700\u8981\uFF09\u7684\u5B58\u50A8\u7C7B</p><p>\u8981\u57FA\u4E8E flex \u9A71\u52A8\u7A0B\u5E8F\u521B\u5EFA\u5377\uFF0C\u786E\u4FDD\u901A\u8FC7 Ceph CSI \u542F\u7528\u4E86 flex \u9A71\u52A8\u7A0B\u5E8F\u3002\u4E3A\u6B64\uFF0C\u60A8\u9700\u8981\u5728\u60A8\u7684\u64CD\u4F5C\u5458\u90E8\u7F72\u6587\u4EF6 operator.yaml \u4E2D\u8BBE\u7F6E ROOK_ENABLE_FLEX_DRIVER \u4E3A true \uFF0C\u4E0E CSI \u9A71\u52A8\u7A0B\u5E8F\u76F8\u540C\u3002</p><p>\u6CE8\u610F\uFF1ACSI \u9A71\u52A8\u7A0B\u5E8F\uFF0C\u6B64\u793A\u4F8B\u8981\u6C42\u6BCF\u4E2A\u8282\u70B9\u81F3\u5C11\u6709 1 \u4E2A OSD\uFF0C\u6BCF\u4E2A OSD \u4F4D\u4E8E3 \u4E2A\u4E0D\u540C\u7684\u8282\u70B9\u4E0A\u3002\u56E0\u4E3A failureDomain \u8BBE\u7F6E\u4E3A host \u5E76\u4E14 replicated.size \u8BBE\u7F6E\u4E3A 3 \u3002</p></blockquote><p><code>\u8FD9\u91CC\u4F7F\u7528 CSI \u9A71\u52A8\u7A0B\u5E8F\uFF0C\u521B\u5EFA\u4E86\u4E00\u4E2A\u793A\u4F8B\u5E94\u7528\u7A0B\u5E8F\u6765\u4F7F\u7528 Rook \u63D0\u4F9B\u7684\u5757\u5B58\u50A8\u548C\u7ECF\u5178\u7684 wordpress \u548C mysql \u5E94\u7528\u7A0B\u5E8F\uFF0C\u8FD9\u4E24\u4E2A\u5E94\u7528\u7A0B\u5E8F\u90FD\u5C06\u4F7F\u7528 Rook \u63D0\u4F9B\u7684\u5757\u5377</code></p><p>\u5728\u63D0\u4F9B\u5757\u5B58\u50A8\u4E4B\u524D\uFF0C\u9700\u8981\u5148\u521B\u5EFA StorageClass \u548C\u5B58\u50A8\u6C60pool\uFF0Ck8s\u9700\u8981\u8FD9\u4E24\u7C7B\u8D44\u6E90\uFF0C\u624D\u80FD\u548C Rook \u4EA4\u4E92\uFF0C\u8FDB\u800C\u5206\u914D\u6301\u4E45\u5377\uFF08PV\uFF09\u3002</p><p><strong>\u5728kubernetes\u96C6\u7FA4\u91CC\uFF0C\u8981\u63D0\u4F9Brbd\u5757\u8BBE\u5907\u670D\u52A1\uFF0C\u9700\u8981\u6709\u5982\u4E0B\u6B65\u9AA4\uFF1A</strong></p><ol><li>\u521B\u5EFA rbd-provisione</li><li>\u521B\u5EFA pool</li><li>\u521B\u5EFA\u5BF9\u5E94\u7684 storageclass</li><li>\u4F7F\u7528rbd\u5BF9\u5E94\u7684storageclass\u521B\u5EFApvc\uFF0C\u7136\u540E\u52A8\u6001\u7533\u8BF7pv</li><li>\u521B\u5EFApod\u4F7F\u7528pv\uFF08 \u4F7F\u7528\u5B58\u50A8 \uFF09</li></ol><blockquote><p>\u901A\u8FC7rook\u521B\u5EFACeph Cluster\u96C6\u7FA4\u4E4B\u540E\uFF0Crook\u81EA\u8EAB\u63D0\u4F9B\u4E86rbd-provisioner\u670D\u52A1\uFF0C\u6240\u4EE5\u4E0D\u9700\u8981\u518D\u90E8\u7F72 \u5176provisioner\uFF08\u4F9B\u5E94\u5546\uFF0C\u5C31\u662F\u63D0\u4F9B\u5B58\u50A8\u7684\uFF09\u3002</p></blockquote><p>1\u3001\u8FD9\u91CC\u4F7F\u7528CSI \u9A71\u52A8\u7A0B\u5E8F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>\u3001CSI \u9A71\u52A8\u7A0B\u5E8F <span class="token punctuation">(</span><span class="token number">2</span>\u30013\u6B65\u9AA4\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u4E0B\u9762\u547D\u4EE4\u6267\u884C<span class="token punctuation">)</span>
<span class="token comment"># kubectl create -f /rook/cluster/examples/kubernetes/ceph/csi/rbd/storageclass.yaml</span>

<span class="token number">2</span>\u3001flex \u9A71\u52A8\u7A0B\u5E8F
<span class="token comment"># kubectl create -f cluster/examples/kubernetes/ceph/flex/storageclass.yaml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2\u3001\u521B\u5EFApool\uFF0C\u521B\u5EFA\u4E00\u4E2A\u81EA\u5DF1\u7684\u5DE5\u4F5C\u76EE\u5F55</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cd /root/rook/cluster/examples/kubernetes/ceph</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mkdir my_yaml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat &gt; pool.yaml &lt;&lt; EOF</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> ceph.rook.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CephBlockPool
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> replicapool <span class="token comment"># operator\u4F1A\u76D1\u542C\u5E76\u521B\u5EFA\u4E00\u4E2Apool</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> rook<span class="token punctuation">-</span>ceph
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">failureDomain</span><span class="token punctuation">:</span> host
  <span class="token key atrule">replicated</span><span class="token punctuation">:</span>
    <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token key atrule">requireSafeReplicaSize</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
EOF

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pool.yaml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u521B\u5EFA\u4E86\u4E00\u4E2A\u540D\u4E3A replicapool \u7684\u5B58\u50A8\u6C60</p><p>apply\u6267\u884C\u5B8C\u540E\uFF0C\u767B\u5F55 ceph dashboard \u754C\u9762\u4E0A\u80FD\u770B\u5230\u5BF9\u5E94\u7684pool</p></blockquote><p>3\u3001\u521B\u5EFA\u5BF9\u5E94\u7684 storageclass</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat &gt; storageclass.yaml &lt;&lt; EOF</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> rook<span class="token punctuation">-</span>ceph<span class="token punctuation">-</span>block 			<span class="token comment"># \u8FD9\u91CC\u521B\u5EFA\u4E00\u4E2Astorage class, \u5728pvc\u4E2D\u6307\u5B9A\u8FD9\u4E2Astorage class\u5373\u53EF\u5B9E\u73B0\u52A8\u6001\u521B\u5EFAPV</span>
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> rook<span class="token punctuation">-</span>ceph.rbd.csi.ceph.com
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">clusterID</span><span class="token punctuation">:</span> rook<span class="token punctuation">-</span>ceph
  <span class="token key atrule">Pool</span><span class="token punctuation">:</span> replicapool
  <span class="token key atrule">imageFormat</span><span class="token punctuation">:</span> <span class="token string">&quot;2&quot;</span>
  <span class="token key atrule">imageFeatures</span><span class="token punctuation">:</span> layering
  <span class="token key atrule">csi.storage.k8s.io/provisioner-secret-name</span><span class="token punctuation">:</span> rook<span class="token punctuation">-</span>csi<span class="token punctuation">-</span>rbd<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">csi.storage.k8s.io/provisioner-secret-namespace</span><span class="token punctuation">:</span> rook<span class="token punctuation">-</span>ceph 		<span class="token comment"># \u5FC5\u987B\u4E0Erook-ceph\u96C6\u7FA4ns\u76F8\u540C</span>
  <span class="token key atrule">csi.storage.k8s.io/controller-expand-secret-name</span><span class="token punctuation">:</span> rook<span class="token punctuation">-</span>csi<span class="token punctuation">-</span>rbd<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">csi.storage.k8s.io/controller-expand-secret-namespace</span><span class="token punctuation">:</span> rook<span class="token punctuation">-</span>ceph
  <span class="token key atrule">csi.storage.k8s.io/node-stage-secret-namespace</span><span class="token punctuation">:</span> rook<span class="token punctuation">-</span>ceph
  <span class="token key atrule">csi.storage.k8s.io/fstype</span><span class="token punctuation">:</span> ext4 	<span class="token comment"># \u6307\u5B9A\u5377\u7684\u6587\u4EF6\u7CFB\u7EDF\u7C7B\u578B\u3002\u5982\u679C\u6CA1\u6709\u6307\u5B9A\uFF0C\u5B83\u5C06\u4F7F\u7528ext4</span>
<span class="token key atrule">allowVolumeExpansion</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">reclaimPolicy</span><span class="token punctuation">:</span> Delete 				<span class="token comment"># \u4E0D\u5199\u9ED8\u8BA4\u503C\u4E3ADelete,\u5176\u4ED6\u9009\u9879\u5305\u62EC\u201C\u4FDD\u7559(Retain)\u201D\u3001\u201C\u56DE\u6536(Recycle)\u201D</span>
EOF


<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f storageclass.yaml  #\u521B\u5EFA\u4E86\u4E00\u4E2A\u540D\u4E3A rook-ceph-block \u7684storageClass</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get storageclass    </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,95),d={href:"http://my-namespace.rbd.csi.ceph.com",target:"_blank",rel:"noopener noreferrer"};function u(k,m){const a=i("ExternalLinkIcon");return o(),p("div",null,[c,n("blockquote",null,[n("p",null,[s("\u5982\u679C\u60A8\u5728\u201Crook-ceph\u201D\u4EE5\u5916\u7684\u547D\u540D\u7A7A\u95F4\u4E2D\u90E8\u7F72\u4E86 Rook operator \uFF0C\u8BF7\u66F4\u6539\u914D\u7F6E\u5668\u4E2D\u7684\u524D\u7F00\u4EE5\u5339\u914D\u60A8 \u4F7F\u7528\u7684\u547D\u540D\u7A7A\u95F4\u3002\u4F8B\u5982\uFF0C\u5982\u679C Rook operator \u5728\u540D\u79F0\u7A7A\u95F4\u201Cmy-namespace\u201D\u4E2D\u8FD0\u884C\uFF0C\u5219\u4F9B\u5E94\u5546\u503C\u5E94 \u4E3A\u201C"),n("a",d,[s("my-namespace.rbd.csi.ceph.com"),t(a)]),s("\u201D\u3002")])])])}const h=e(r,[["render",u],["__file","18.Rook\u6784\u5EFACeph\u4E91\u539F\u751F\u5B58\u50A8.html.vue"]]);export{h as default};
