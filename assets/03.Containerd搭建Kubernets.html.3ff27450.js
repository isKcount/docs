import{_ as t}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as i,c,a as n,b as s,d as o,f as a,r as l}from"./app.ca0279c0.js";const p={},r=a(`<h1 id="containerd\u90E8\u7F72kubernetes-v1-23-5" tabindex="-1"><a class="header-anchor" href="#containerd\u90E8\u7F72kubernetes-v1-23-5" aria-hidden="true">#</a> Containerd\u90E8\u7F72Kubernetes v1.23.5</h1><h2 id="containerd\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#containerd\u7B80\u4ECB" aria-hidden="true">#</a> Containerd\u7B80\u4ECB</h2><p>containerd \u662F\u4E00\u4E2A\u5DE5\u4E1A\u7EA7\u6807\u51C6\u7684\u5BB9\u5668\u8FD0\u884C\u65F6\uFF0C\u5B83\u5F3A\u8C03\u7B80\u5355\u6027\u3001\u5065\u58EE\u6027\u548C\u53EF\u79FB\u690D\u6027\u3002\u5176\u8BDE\u751F\u4E8EDocker\uFF0C\u63D0\u4F9B\u5982\u4E0B\u529F\u80FD\uFF1A</p><ul><li><code>\u7BA1\u7406\u5BB9\u5668\u7684\u751F\u547D\u5468\u671F\uFF08\u4ECE\u521B\u5EFA\u5BB9\u5668\u5230\u9500\u6BC1\u5BB9\u5668\uFF09</code></li><li><code>\u62C9\u53D6/\u63A8\u9001\u5BB9\u5668\u955C\u50CF</code></li><li><code>\u5B58\u50A8\u7BA1\u7406\uFF08\u7BA1\u7406\u955C\u50CF\u53CA\u5BB9\u5668\u6570\u636E\u7684\u5B58\u50A8\uFF09</code></li><li><code>\u8C03\u7528 runc \u8FD0\u884C\u5BB9\u5668\uFF08\u4E0E runc \u7B49\u5BB9\u5668\u8FD0\u884C\u65F6\u4EA4\u4E92\uFF09</code></li><li><code>\u7BA1\u7406\u5BB9\u5668\u7F51\u7EDC\u63A5\u53E3\u53CA\u7F51\u7EDC</code></li></ul><h2 id="containerd\u67B6\u6784\u56FE" tabindex="-1"><a class="header-anchor" href="#containerd\u67B6\u6784\u56FE" aria-hidden="true">#</a> containerd\u67B6\u6784\u56FE</h2><p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204181109068.png" alt="\u5728\u8FD9\u91CC\u63D2\u5165\u56FE\u7247\u63CF\u8FF0" loading="lazy"></p><h2 id="\u96C6\u7FA4\u8981\u6C42" tabindex="-1"><a class="header-anchor" href="#\u96C6\u7FA4\u8981\u6C42" aria-hidden="true">#</a> \u96C6\u7FA4\u8981\u6C42</h2><ul><li>\u4E00\u53F0\u6216\u8005\u591A\u53F0\u670D\u52A1\u5668\uFF0C\u64CD\u4F5C\u7CFB\u7EDF<code>Centos7.9</code></li><li>\u96C6\u7FA4\u4E4B\u95F4\u6240\u6709\u673A\u5668\u8981\u4E92\u901A \u9700\u8981<code>\u5173\u95ED\u9632\u706B\u5899</code></li><li>\u53EF\u4EE5<code>\u8BBF\u95EE\u5916\u7F51</code>\uFF0C\u9700\u8981\u62C9\u53D6\u955C\u50CF</li><li><code>\u7981\u6B62swap</code>\u5206\u533A</li><li>\u914D\u7F6E<code>Ipvs\u4EE5\u53CAiptables</code>\u8DEF\u7531\u8F6C\u53D1</li><li>\u4F7F\u7528<code>kubeadm</code>\u642D\u5EFA\u96C6\u7FA4\uFF1A apiserver\u3001etcd\u3001controller-manager\u3001scheduler\u3001kubelet\uFF08systemd\u5B88\u62A4\u8FDB\u7A0B\u7BA1\u7406\uFF0C\u5176\u4ED6\u7EC4\u4EF6\u90FD\u662F\u91C7\u7528\u5BB9\u5668\u90E8\u7F72\uFF09\u3001kube-proxy</li></ul><table><thead><tr><th style="text-align:center;">IP\u5730\u5740</th><th style="text-align:center;">\u4E3B\u673A\u540D\u79F0</th><th style="text-align:center;">\u64CD\u4F5C\u7CFB\u7EDF</th><th style="text-align:center;">\u5E95\u5C42\u5BB9\u5668</th></tr></thead><tbody><tr><td style="text-align:center;">10.11.121.111</td><td style="text-align:center;">k8s-master</td><td style="text-align:center;">CentOS-7.9</td><td style="text-align:center;">containerd</td></tr><tr><td style="text-align:center;">10.11.121.112</td><td style="text-align:center;">k8s-node1</td><td style="text-align:center;">CentOS-7.9</td><td style="text-align:center;">containerd</td></tr><tr><td style="text-align:center;">10.11.121.113</td><td style="text-align:center;">k8s-node2</td><td style="text-align:center;">CentOS-7.9</td><td style="text-align:center;">containerd</td></tr></tbody></table><h2 id="\u642D\u5EFAkubernetes-\u51C6\u5907\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#\u642D\u5EFAkubernetes-\u51C6\u5907\u73AF\u5883" aria-hidden="true">#</a> \u642D\u5EFAKubernetes\uFF08\u51C6\u5907\u73AF\u5883\uFF09</h2><blockquote><p><strong>\u51C6\u5907\u73AF\u5883\uFF1A</strong> <code>\u8BF7\u5728\u6240\u6709\u7684\u8282\u70B9\u4E0A\u8FDB\u884C\u64CD\u4F5C</code></p></blockquote><h3 id="_1-\u67E5\u770B\u5F53\u524D\u7684\u4E3B\u673A\u5185\u6838" tabindex="-1"><a class="header-anchor" href="#_1-\u67E5\u770B\u5F53\u524D\u7684\u4E3B\u673A\u5185\u6838" aria-hidden="true">#</a> 1.\u67E5\u770B\u5F53\u524D\u7684\u4E3B\u673A\u5185\u6838</h3><p>\u5F53\u524D\u4F7F\u7528\u7684\u662FCentOS7.9\u7684\u5185\u6838\uFF0C\u5982\u679C\u9700\u8981\u5347\u7EA7\u52305.17+\u5219\u9700\u8981\u4E09\u4E2A\u8282\u70B9\u66F4\u65B0\u5185\u6838\uFF0C\u8FD9\u91CC\u6682\u65F6\u4E0D\u66F4\u65B0</p><p>\u4FEE\u6539\u6BCF\u4E2A\u8282\u70B9\u7684\u4E3B\u673A\u540D\u79F0</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># uname -r </span>
<span class="token number">3.10</span>.0-1160.el7.x86_64
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl </span>
   Static hostname: k8s-master
         Icon name: computer-vm
           Chassis: vm
        Machine ID: 6a4d2edbefd14658af278cd43366c8c2
           Boot ID: a25edbef987a42bb8e5757ab42278501
    Virtualization: vmware
  Operating System: CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
       CPE OS Name: cpe:/o:centos:centos:7
            Kernel: Linux <span class="token number">3.10</span>.0-1160.el7.x86_64
      Architecture: x86-64
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u914D\u7F6Ehost" tabindex="-1"><a class="header-anchor" href="#_2-\u914D\u7F6Ehost" aria-hidden="true">#</a> 2.\u914D\u7F6Ehost</h3><p>\u914D\u7F6E\u4E09\u4E2A\u8282\u70B9\u7684\u4E3B\u673A\u6620\u5C04\uFF0C\u4E5F\u53EF\u4EE5\u65B9\u4FBF\u540E\u7EED\u4F7F\u7528NTP\u65F6\u95F4\u670D\u52A1\u5668</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/hosts </span>

<span class="token number">10.11</span>.121.111 k8s-master
<span class="token number">10.11</span>.121.112 k8s-node1
<span class="token number">10.11</span>.121.113 k8s-node2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-\u914D\u7F6Eyum\u6E90" tabindex="-1"><a class="header-anchor" href="#_3-\u914D\u7F6Eyum\u6E90" aria-hidden="true">#</a> 3.\u914D\u7F6Eyum\u6E90</h3><p>\u8FD9\u91CC\u4F7F\u7528\u963F\u91CC\u7684CentOS7\u7684YUM\u6E90</p><p>\u8981\u5148\u5220\u9664\u672C\u5730\u7684\u6240\u6709repo\u6587\u4EF6\u4E4B\u540E\uFF0C\u62C9\u53D6\u65B0\u7684\u955C\u50CF\u6E90\uFF0C\u7136\u540E\u6267\u884C <code>yum makecache fast</code>\u6E05\u9664\u7F13\u5B58</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-o</span> /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
\u6216\u8005
<span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-\u5173\u95ED\u9632\u706B\u5899" tabindex="-1"><a class="header-anchor" href="#_4-\u5173\u95ED\u9632\u706B\u5899" aria-hidden="true">#</a> 4.\u5173\u95ED\u9632\u706B\u5899</h3><p>\u8FD9\u91CC\u4E0D\u9700\u8981\u5F00\u542F\u9632\u706B\u5899\uFF0C\u5305\u62ECseLinux\u6240\u4EE5\u9700\u8981\u5173\u95ED\u6C38\u4E45\u5173\u95ED\u9632\u706B\u5899\u4EE5\u53CAseLinux\uFF0C\u7136\u540E\u91CD\u542F\u7CFB\u7EDF</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span>
Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.
Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment">#  setenforce 0</span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment">#  sed -i &quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot; /etc/selinux/config</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-\u5173\u95EDswap" tabindex="-1"><a class="header-anchor" href="#_5-\u5173\u95EDswap" aria-hidden="true">#</a> 5.\u5173\u95EDswap</h3><p>\u5173\u95ED\u7CFB\u7EDF\u4EA4\u6362\u5206\u533Aswap\uFF08k8s\u8981\u6C42\u5173\u95EDswap\uFF09</p><p>\u53EF\u4EE5\u4F7F\u7528<code>swapoff -a</code>\u6682\u65F6\u5173\u95ED\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6\u6CE8\u91CA\u6389<code>/etc/fstab\u4E2D\u7684swap</code>\u8FDB\u884C\u6C38\u4E45\u5173\u95ED\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># swapoff -a</span>

<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/fstab</span>
<span class="token comment">#/dev/mapper/centos-swap     swap      swap     defaults     0     0</span>
<span class="token comment">#\u786E\u8BA4swap\u662F\u5426\u88AB\u7981\u7528\uFF08\u8F93\u51FA\u7A7A\u503C\u5373\u4E3A\u7981\u7528\uFF09</span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># cat /proc/swaps</span>
Filename                                Type            Size    Used    Priority
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-\u52A0\u8F7D\u6240\u9700\u5185\u6838\u6A21\u5757" tabindex="-1"><a class="header-anchor" href="#_6-\u52A0\u8F7D\u6240\u9700\u5185\u6838\u6A21\u5757" aria-hidden="true">#</a> 6.\u52A0\u8F7D\u6240\u9700\u5185\u6838\u6A21\u5757</h3><p>\u8FD9\u91CC\u662FKubernetes V1.20+\u4EE5\u4E0A\u9700\u8981\u5F00\u542F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf</span>
overlay
br_netfilter
EOF

<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># modprobe overlay</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># modprobe br_netfilter</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-\u914D\u7F6E\u65F6\u95F4\u540C\u6B65" tabindex="-1"><a class="header-anchor" href="#_7-\u914D\u7F6E\u65F6\u95F4\u540C\u6B65" aria-hidden="true">#</a> 7.\u914D\u7F6E\u65F6\u95F4\u540C\u6B65</h3><p>\u4F7F\u7528ntp\u540C\u6B65\u963F\u91CC\u4E91\u7684\u65F6\u95F4\u8FD9\u91CC\u4E0D\u505A\u8BE6\u7EC6\u8BF4\u660E</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># yum install -y ntpdate </span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># ntpdate ntp.aliyun.com</span>
<span class="token number">18</span> Apr 09:48:20 ntpdate<span class="token punctuation">[</span><span class="token number">1745</span><span class="token punctuation">]</span>: step <span class="token function">time</span> server <span class="token number">203.107</span>.6.88 offset <span class="token number">1.334239</span> sec
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-\u4F7F\u7528ipvs\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_8-\u4F7F\u7528ipvs\u6A21\u5F0F" aria-hidden="true">#</a> 8.\u4F7F\u7528IPvs\u6A21\u5F0F</h3><p>\u52A0\u8F7D<code>ipvs\u6A21\u5757</code>\uFF08\u53EF\u9009\u9879\uFF0C\u9ED8\u8BA4\u4E3Aiptables\u6A21\u5F0F\uFF09</p><ul><li><p>kuber-proxy\u4EE3\u7406\u652F\u6301iptables\u548Cipvs\u4E24\u79CD\u6A21\u5F0F\uFF0C\u5982\u679C\u4F7F\u7528ipvs\u6A21\u5F0F\u9700\u8981\u5728\u521D\u59CB\u5316\u96C6\u7FA4\u524D\u6240\u6709\u8282\u70B9\u52A0\u8F7Dipvs\u6A21\u5757\u5E76\u5B89\u88C5ipset\u5DE5\u5177\uFF0CLinux kernel 4.19\u4EE5\u4E0A\u7684\u5185\u6838\u7248\u672C\u4F7F\u7528nf_conntrack\u4EE3\u66FFnf_conntrack_ipv4</p></li><li><p>\u6B64\u5916\u8FD8\u9700\u8981\u5B89\u88C5ipset\u3001ipvsadm\u76F8\u5173\u7684\u8F6F\u4EF6\u5305</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/modules-load.d/ipvs.modules </span>
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4


<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># chmod 755 /etc/modules-load.d/ipvs.modules </span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># bash /etc/modules-load.d/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span>
nf_conntrack_ipv4      <span class="token number">15053</span>  <span class="token number">0</span> 
nf_defrag_ipv4         <span class="token number">12729</span>  <span class="token number">1</span> nf_conntrack_ipv4
ip_vs_sh               <span class="token number">12688</span>  <span class="token number">0</span> 
ip_vs_wrr              <span class="token number">12697</span>  <span class="token number">0</span> 
ip_vs_rr               <span class="token number">12600</span>  <span class="token number">0</span> 
ip_vs                 <span class="token number">145458</span>  <span class="token number">6</span> ip_vs_rr,ip_vs_sh,ip_vs_wrr
nf_conntrack          <span class="token number">139264</span>  <span class="token number">2</span> ip_vs,nf_conntrack_ipv4
libcrc32c              <span class="token number">12644</span>  <span class="token number">3</span> xfs,ip_vs,nf_conntrack

<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment">#  yum install -y ipset ipvsadm</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-\u914D\u7F6Eiptables\u8DEF\u7531\u8F6C\u53D1" tabindex="-1"><a class="header-anchor" href="#_9-\u914D\u7F6Eiptables\u8DEF\u7531\u8F6C\u53D1" aria-hidden="true">#</a> 9.\u914D\u7F6EIptables\u8DEF\u7531\u8F6C\u53D1</h3><p>\u8BBE\u7F6Esysctl \u53C2\u6570\uFF0C\u5141\u8BB8iptables\u68C0\u67E5\u6865\u63A5\u6D41\u91CF\uFF0C\u8FD9\u4E9B\u53C2\u6570\u5728\u91CD\u65B0\u542F\u52A8\u540E\u4ECD\u7136\u5B58\u5728</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/sysctl.d/k8s.conf </span>
net.bridge.bridge-nf-call-iptables  <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.ip_forward                 <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>

<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># sysctl --system </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-\u914D\u7F6Ekubernetes\u7684\u6E90" tabindex="-1"><a class="header-anchor" href="#_10-\u914D\u7F6Ekubernetes\u7684\u6E90" aria-hidden="true">#</a> 10.\u914D\u7F6EKubernetes\u7684\u6E90</h3><p>\u6240\u6709\u8282\u70B9\u914D\u7F6Ekubernetes\u8F6F\u4EF6\u6E90\uFF08\u4F7F\u7528\u6E05\u534E\u5927\u5B66\u955C\u50CF\u6E90\uFF09</p><p>\u5F53\u524D\u7684\u963F\u91CC\u4E91\u7684Kubernetes\u7684\u6E90\u4EE5\u53CA\u534E\u4E3A\u7684Kubernetes\u6E90\u7ECF\u5E38\u6027\u51FA\u73B0\u95EE\u9898\uFF0C\u6240\u4EE5\u4F7F\u7528\u6E05\u534E\u5927\u5B66\u7684\u3002</p><p>\u914D\u7F6EKubernetes\u7684yum\u6E90</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># vim  /etc/yum.repos.d/kubernetes.repo </span>
<span class="token punctuation">[</span>kubernetes<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>Kubernetes
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>https://mirrors.tuna.tsinghua.edu.cn/kubernetes/yum/repos/kubernetes-el7-x86_64/
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B89\u88C5kubernetes\u76F8\u5173\u7684\u8F6F\u4EF6</p><p>\u4E0D\u6307\u5B9A\u9ED8\u8BA4\u7248\u672C\u5C31\u662F\u6700\u65B0\uFF0C\u53EF\u4EE5\u6307\u5B9A\u76F8\u5BF9\u5E94\u7684\u7248\u672C\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># yum install -y  kubeadm kubelet kubectl </span>

<span class="token comment">#\u6307\u5B9A\u7248\u672C\u53F7\u5B89\u88C5</span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># yum install -y kubelet-1.23.1 kubeadm-1.23.1 kubectl-1.23.1</span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable kubelet &amp;&amp; systemctl start kubelet </span>
Created symlink from /etc/systemd/system/multi-user.target.wants/kubelet.service to /usr/lib/systemd/system/kubelet.service.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u914D\u7F6Econtainerd\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6Econtainerd\u73AF\u5883" aria-hidden="true">#</a> \u914D\u7F6EContainerd\u73AF\u5883</h2><p>\u914D\u7F6Ekubelet\u4F7F\u7528containerd\u4F5C\u4E3A\u5BB9\u5668\u8FD0\u884C\u65F6\uFF0C\u6307\u5B9AcgroupDriver\u4E3Asystemd\u6A21\u5F0F\uFF08\u4E24\u79CD\u65B9\u6CD5\u5B9E\u73B0\uFF09</p><h3 id="\u65B9\u6CD5\u4E00" tabindex="-1"><a class="header-anchor" href="#\u65B9\u6CD5\u4E00" aria-hidden="true">#</a> \u65B9\u6CD5\u4E00</h3><blockquote><p><code>\u5728Master\u8282\u70B9\u4E0A\u914D\u7F6E</code></p></blockquote><p>\u914D\u7F6Ekubelet\u4F7F\u7528containerd\uFF08\u6240\u6709\u8282\u70B9\u90FD\u8981\u914D\u7F6E<code>cgroup-driver=systemd</code>\u53C2\u6570\uFF0C\u5426\u5219node\u8282\u70B9\u65E0\u6CD5\u81EA\u52A8\u4E0B\u8F7D\u548C\u521B\u5EFApod\uFF09</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment">#cat &gt; /etc/sysconfig/kubelet &lt;&lt;EOF</span>
<span class="token assign-left variable">KUBELET_EXTRA_ARGS</span><span class="token operator">=</span>--container-runtime<span class="token operator">=</span>remote --container-runtime-endpoint<span class="token operator">=</span>unix:///run/containerd/containerd.sock --cgroup-driver<span class="token operator">=</span>systemd
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u65B9\u6CD5\u4E8C" tabindex="-1"><a class="header-anchor" href="#\u65B9\u6CD5\u4E8C" aria-hidden="true">#</a> \u65B9\u6CD5\u4E8C</h3><blockquote><p><code>\u5728Master\u8282\u70B9\u4E0A\u914D\u7F6E</code></p></blockquote><p>\u5982\u679C\u4E0D\u60F3\u4FEE\u6539<code>/etc/sysconfig/kubelet</code>\u914D\u7F6E\uFF0C<code>kubeadm init\u5FC5\u987B\u4F7F\u7528yaml</code>\u6587\u4EF6\u6765\u521D\u59CB\u5316\u4F20\u9012<code>cgroupDriver</code>\u53C2\u6570\uFF0C\u53EF\u4EE5\u901A\u8FC7\u5982\u4E0B\u547D\u4EE4\u5BFC\u51FA\u9ED8\u8BA4\u7684\u521D\u59CB\u5316\u914D\u7F6E</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@k8s-master ~]# kubeadm config print init-defaults &gt; kubeadm-config.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u7136\u540E\u6839\u636E\u81EA\u5DF1\u7684\u9700\u6C42\u4FEE\u6539\u914D\u7F6E\uFF1A</p><ol><li>\u914D\u7F6E<code>advertiseAddress</code>\u53C2\u6570\u4E3Amaster\u7684\u8282\u70B9IP\u5730\u5740</li><li>\u914D\u7F6E<code>criSocket</code>\u53C2\u6570\u4E3A<code>/run/containerd/containerd.sock</code></li><li>\u914D\u7F6E<code>taints</code>\u53C2\u6570\u7ED9\u5F53\u524Dmaster\u8282\u70B9\u6DFB\u52A0\u6C61\u70B9</li><li>\u914D\u7F6E<code>imageRepository</code>\u7684\u53C2\u6570\u4E3A<code>registry.aliyuncs.com/google_containers</code> \uFF0C\u5F53\u524D\u4E3A\u963F\u91CC\u7684\u4ED3\u5E93</li><li>\u914D\u7F6E<code>kube-proxy</code>\u7684\u6A21\u5F0F\u4E3Aipvs</li><li>\u6DFB\u52A0<code>podSubnet</code>\u4E3A10.244.0.0/16</li><li>\u4F7F\u7528containerd\u4F5C\u4E3A\u8FD0\u884C\u65F6\uFF0C\u6240\u4EE5\u5728\u521D\u59CB\u5316\u8282\u70B9\u7684\u65F6\u5019\u9700\u8981\u6307\u5B9AcgroupDriver\u4E3Asystemd\u6A21\u5F0F</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master ~<span class="token punctuation">]</span><span class="token comment"># cat  kubeadm-config.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeadm.k8s.io/v1beta3
<span class="token key atrule">bootstrapTokens</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">groups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> system<span class="token punctuation">:</span>bootstrappers<span class="token punctuation">:</span>kubeadm<span class="token punctuation">:</span>default<span class="token punctuation">-</span>node<span class="token punctuation">-</span>token
  <span class="token key atrule">token</span><span class="token punctuation">:</span> abcdef.0123456789abcdef
  <span class="token key atrule">ttl</span><span class="token punctuation">:</span> 24h0m0s
  <span class="token key atrule">usages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> signing
  <span class="token punctuation">-</span> authentication
<span class="token key atrule">kind</span><span class="token punctuation">:</span> InitConfiguration
<span class="token key atrule">localAPIEndpoint</span><span class="token punctuation">:</span>
  <span class="token comment"># \u6DFB\u52A0IP\u5730\u5740</span>
  <span class="token key atrule">advertiseAddress</span><span class="token punctuation">:</span> 10.11.121.111
  <span class="token key atrule">bindPort</span><span class="token punctuation">:</span> <span class="token number">6443</span>
<span class="token key atrule">nodeRegistration</span><span class="token punctuation">:</span>
  <span class="token comment"># \u4FEE\u6539\u4E3Acontainerd\u7684\u5BB9\u5668\u5E95\u5C42</span>
  <span class="token key atrule">criSocket</span><span class="token punctuation">:</span> /run/containerd/containerd.sock 
  <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
  <span class="token key atrule">name</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>master 
  <span class="token comment"># \u6DFB\u52A0Master\u7684\u6C61\u70B9</span>
  <span class="token key atrule">taints</span><span class="token punctuation">:</span> 
  <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
    <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master 
<span class="token punctuation">---</span>
<span class="token key atrule">apiServer</span><span class="token punctuation">:</span>
  <span class="token key atrule">timeoutForControlPlane</span><span class="token punctuation">:</span> 4m0s
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeadm.k8s.io/v1beta3
<span class="token key atrule">certificatesDir</span><span class="token punctuation">:</span> /etc/kubernetes/pki
<span class="token key atrule">clusterName</span><span class="token punctuation">:</span> kubernetes
<span class="token key atrule">controllerManager</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token key atrule">dns</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token key atrule">etcd</span><span class="token punctuation">:</span>
  <span class="token key atrule">local</span><span class="token punctuation">:</span>
    <span class="token key atrule">dataDir</span><span class="token punctuation">:</span> /var/lib/etcd
<span class="token comment"># \u4FEE\u6539\u4E3A\u963F\u91CC\u4E91\u7684\u955C\u50CF\u5730\u5740</span>
<span class="token key atrule">imageRepository</span><span class="token punctuation">:</span> registry.aliyuncs.com/google_containers
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterConfiguration
<span class="token key atrule">kubernetesVersion</span><span class="token punctuation">:</span> 1.23.0
<span class="token key atrule">networking</span><span class="token punctuation">:</span>
  <span class="token key atrule">dnsDomain</span><span class="token punctuation">:</span> cluster.local
  <span class="token comment"># \u6DFB\u52A0Pod\u7684\u7F51\u6BB5</span>
  <span class="token key atrule">podSubnet</span><span class="token punctuation">:</span> 10.244.0.0/16
  <span class="token key atrule">serviceSubnet</span><span class="token punctuation">:</span> 10.96.0.0/12
<span class="token key atrule">scheduler</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> 
<span class="token punctuation">---</span>    
<span class="token comment"># \u6DFB\u52A0kube-proxy\u7684\u6A21\u5F0F\u4E3AIPvs</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeproxy.config.k8s.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> KubeProxyConfiguration
<span class="token key atrule">mode</span><span class="token punctuation">:</span> ipvs
<span class="token punctuation">---</span> 
<span class="token comment"># \u6DFB\u52A0containerd\u7684\u9A71\u52A8</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubelet.config.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> KubeletConfiguration
<span class="token key atrule">cgroupDriver</span><span class="token punctuation">:</span> systemd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u90E8\u7F72containerd" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72containerd" aria-hidden="true">#</a> \u90E8\u7F72Containerd</h2><blockquote><p><strong>Containerd\uFF1A</strong> <code>\u8BF7\u5728\u6240\u6709\u8282\u70B9\u4E0A\u90E8\u7F72</code></p></blockquote><h3 id="_1-\u5B89\u88C5containerd" tabindex="-1"><a class="header-anchor" href="#_1-\u5B89\u88C5containerd" aria-hidden="true">#</a> 1.\u5B89\u88C5containerd</h3><p>\u6240\u6709\u8282\u70B9\u914D\u7F6Econtainerd\u8F6F\u4EF6\u6E90\uFF08containerd\u7EC4\u4EF6\u9ED8\u8BA4\u5728docker-ce\u6E90\u4E2D\uFF09</p><p>\u4F7F\u7528yum search\u53EF\u4EE5\u67E5\u770B\u5F53\u524D\u7684containerd\u7684\u7248\u672C\u6709\u54EA\u4E9B</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># yum install -y yum-utils device-mapper-persistent-data lvm2 </span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span>

<span class="token comment"># \u67E5\u770Bcontainerd.io\u53EF\u7528\u7248\u672C</span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># yum search containerd.io --showduplicates</span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># yum -y install containerd.io</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_2-\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> 2.\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6</h3><ol><li>pause\u955C\u50CF\u5730\u5740</li><li>Cgroup\u9A71\u52A8\u6539\u4E3Asystemd</li><li>\u589E\u52A0runsc\u5BB9\u5668\u8FD0\u884C\u65F6</li><li>\u914D\u7F6Edocker\u955C\u50CF\u52A0\u901F\u5668</li></ol><p>\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6\u9ED8\u8BA4\u7684containerd\u7684\u914D\u7F6E\u6587\u4EF6\u662F\u7A7A\u7684\uFF0C\u6240\u4EE5\u9700\u8981\u91CD\u65B0\u751F\u6210\u4E00\u4E2A\u5B8C\u6574\u7684\u914D\u7F6E\u6587\u4EF6\u3002</p><p>containerd\u7684\u76EE\u5F55\u662F\u5728 <code>/etc/containerd</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master01 ~<span class="token punctuation">]</span><span class="token comment"># cd /etc/containerd/</span>
<span class="token punctuation">[</span>root@master01 containerd<span class="token punctuation">]</span><span class="token comment"># containerd config  default &gt; config.toml</span>
<span class="token punctuation">[</span>root@master01 containerd<span class="token punctuation">]</span><span class="token comment"># vim config.toml</span>
 <span class="token number">43</span>   <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span><span class="token punctuation">]</span>
 		\xB7\xB7\xB7\xB7
 		<span class="token comment"># \u4FEE\u6539\u955C\u50CF\u4E3A\u56FD\u5185\u7684\u955C\u50CF</span>
 <span class="token number">56</span>     sandbox_image <span class="token operator">=</span> <span class="token string">&quot;registry.aliyuncs.com/google_containers/pause:3.2&quot;</span>   
 		\xB7\xB7\xB7\xB7 
 			<span class="token comment"># \u6DFB\u52A0\u4E00\u4E2Arunsc,\u6307\u5B9A\u7C7B\u578B\u4E3Arunsc\uFF0C\u8FD9\u91CC\u662F\u8DDFrunc\u540C\u7EA7</span>
 <span class="token number">90</span>        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runsc<span class="token punctuation">]</span>  
 <span class="token number">91</span>           runtime_type <span class="token operator">=</span> <span class="token string">&quot;io.containerd.runsc.v1&quot;</span>   				  

			<span class="token comment"># \u4FEE\u6539systemd\u9A71\u52A8\u4E3Atrue</span>
 <span class="token number">94</span>        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc<span class="token punctuation">]</span>
 <span class="token number">103</span>          <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc.options<span class="token punctuation">]</span>
				\xB7\xB7\xB7
 <span class="token number">114</span>            SystemdCgroup <span class="token operator">=</span> <span class="token boolean">true</span>	
 		
 			<span class="token comment"># \u6DFB\u52A0docker\u4ED3\u5E93\u7684\u955C\u50CF\u6E90\uFF0C\u914D\u7F6E\u963F\u91CC\u955C\u50CF\u52A0\u901F</span>
 <span class="token number">139</span>       <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors<span class="token punctuation">]</span>
 <span class="token number">140</span>        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="token string">&quot;docker.io&quot;</span><span class="token punctuation">]</span>  
 <span class="token number">141</span>          endpoint <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://b9pmyelo.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-cri\u5BA2\u6237\u7AEF\u5DE5\u5177crictl" tabindex="-1"><a class="header-anchor" href="#_3-cri\u5BA2\u6237\u7AEF\u5DE5\u5177crictl" aria-hidden="true">#</a> 3.CRI\u5BA2\u6237\u7AEF\u5DE5\u5177crictl</h3>`,75),u={href:"https://github.com/kubernetes-sigs/cri-tools/releases/",target:"_blank",rel:"noopener noreferrer"},d=a(`<p><img src="https://pic1.xuehuaimg.com/proxy/raw.githubusercontent.com/2756864799zhang/image/main/img/202204181219630.png" alt="image-20220418121928718" loading="lazy"></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># wget https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.23.0/crictl-v1.23.0-linux-amd64.tar.gz</span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># tar zxvf crictl-v1.23.0-linux-amd64.tar.gz  -C /usr/local/bin/ </span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># crictl --version </span>
crictl version v1.23.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6DFB\u52A0crictl\u8FDE\u63A5containerd\u7684\u914D\u7F6E\u6587\u4EF6</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/crictl.yaml </span>
<span class="token key atrule">runtime-endpoint</span><span class="token punctuation">:</span> unix<span class="token punctuation">:</span>///run/containerd/containerd.sock
<span class="token key atrule">image-endpoint</span><span class="token punctuation">:</span> unix<span class="token punctuation">:</span>///run/containerd/containerd.sock
<span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">10</span> 
<span class="token key atrule">debug</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> 

<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload </span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable containerd &amp;&amp; systemctl restart containerd </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6216\u6267\u884C\u4EE5\u4E0B\u8BED\u53E5\u6DFB\u52A0\u53C2\u6570</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># crictl config runtime-endpoint unix:/run/containerd/containerd.sock</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u62C9\u53D6\u955C\u50CF\u9A8C\u8BC1\u662F\u5426\u6210\u529F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># crictl pull nginx </span>
Image is up to <span class="token function">date</span> <span class="token keyword">for</span> sha256:605c77e624ddb75e6110f997c58876baa13f8754486b461117934b24a9dc3a85
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># crictl images</span>
IMAGE                		TAG                 IMAGE ID            SIZE
docker.io/library/nginx      latest              605c77e624ddb       <span class="token number">56</span>.7MB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5728master\u8282\u70B9\u542F\u52A8\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#\u5728master\u8282\u70B9\u542F\u52A8\u96C6\u7FA4" aria-hidden="true">#</a> \u5728master\u8282\u70B9\u542F\u52A8\u96C6\u7FA4</h2><h3 id="_1-1\u4F7F\u7528kubeadm\u547D\u4EE4\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#_1-1\u4F7F\u7528kubeadm\u547D\u4EE4\u90E8\u7F72" aria-hidden="true">#</a> 1-1\u4F7F\u7528kubeadm\u547D\u4EE4\u90E8\u7F72</h3><ul><li><code>\u2013-apiserver-advertise-address</code> \u96C6\u7FA4\u901A\u544A\u5730\u5740</li><li><code>\u2013-image-repository</code> \u7531\u4E8E\u9ED8\u8BA4\u7684\u62C9\u53D6\u955C\u50CF\u5730\u5740k8s.gcr.io\u56FD\u5185\u65E0\u6CD5\u8BBF\u95EE\uFF0C\u8FD9\u91CC\u4F7F\u7528\u963F\u91CC\u4E91\u955C\u50CF\u4ED3\u5E93\u5730\u5740</li><li><code>\u2013-kubernetes-version</code> k8s\u7684\u7248\u672C</li><li><code>\u2013-service-cidr</code> \u96C6\u7FA4\u5185\u90E8\u865A\u62DF\u7F51\u7EDC\uFF0CPod\u7684\u7EDF\u4E00\u8BBF\u95EE\u5165\u53E3</li><li><code>\u2013-pod-network-cidr</code> Pod\u7684\u7F51\u7EDC\uFF0C\u4E0E\u4E0B\u9762\u90E8\u7F72\u7684CNI\u7F51\u7EDC\u7EC4\u4EF6yaml\u4E2D\u4FDD\u6301\u4E00\u81F4</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubeadm init \\</span>
--apiserver-advertise-address<span class="token operator">=</span><span class="token number">10.10</span>.10.128 <span class="token punctuation">\\</span>
--image-repository registry.aliyuncs.com/google_containers <span class="token punctuation">\\</span>
--kubernetes-version v1.23.1 <span class="token punctuation">\\</span>
--service-cidr<span class="token operator">=</span><span class="token number">10.96</span>.0.0/12 <span class="token punctuation">\\</span>
--pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16 <span class="token punctuation">\\</span>
--ignore-preflight-errors<span class="token operator">=</span>all 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2\u4F7F\u7528\u914D\u7F6E\u6587\u4EF6\u542F\u52A8\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#_1-2\u4F7F\u7528\u914D\u7F6E\u6587\u4EF6\u542F\u52A8\u96C6\u7FA4" aria-hidden="true">#</a> 1-2\u4F7F\u7528\u914D\u7F6E\u6587\u4EF6\u542F\u52A8\u96C6\u7FA4</h3><p>\u8FD9\u91CC\u6211\u4F7F\u7528\u914D\u7F6E\u6587\u4EF6\u521D\u59CB\u5316Kubernetes\u96C6\u7FA4</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubeadm init --config=kubeadm-config.yaml</span>
\xB7\xB7\xB7
Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span>

To start using your cluster, you need to run the following as a regular user:

  <span class="token comment">#\u975Eroot\u7528\u6237</span>
  <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

Alternatively, <span class="token keyword">if</span> you are the root user, you can run:
  <span class="token comment">#root\u7528\u6237</span>
  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run <span class="token string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:

kubeadm <span class="token function">join</span> <span class="token number">10.11</span>.121.111:6443 <span class="token parameter variable">--token</span> abcdef.0123456789abcdef <span class="token punctuation">\\</span>
	--discovery-token-ca-cert-hash sha256:637d4427138d3ca87f32bf57e3a16e85cc806cbbf2dc25b475cf0bec9504a95f 


$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
$ <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
$ <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u90E8\u7F72\u5BB9\u5668\u7F51\u7EDCcni" tabindex="-1"><a class="header-anchor" href="#_2-\u90E8\u7F72\u5BB9\u5668\u7F51\u7EDCcni" aria-hidden="true">#</a> 2.\u90E8\u7F72\u5BB9\u5668\u7F51\u7EDCCNI</h3><p><code>Calico\u662F\u4E00\u4E2A\u7EAF\u4E09\u5C42\u7684\u6570\u636E\u4E2D\u5FC3\u7F51\u7EDC\u65B9\u6848</code>\uFF0CCalico\u652F\u6301\u5E7F\u6CDB\u7684\u5E73\u53F0\uFF0C\u5305\u62ECKubernetes\u3001OpenStack\u7B49\u3002</p><p>Calico \u5728\u6BCF\u4E00\u4E2A\u8BA1\u7B97\u8282\u70B9\u5229\u7528 Linux Kernel \u5B9E\u73B0\u4E86\u4E00\u4E2A\u9AD8\u6548\u7684\u865A\u62DF\u8DEF\u7531\u5668\uFF08 vRouter\uFF09 \u6765\u8D1F\u8D23\u6570\u636E\u8F6C\u53D1\uFF0C\u800C\u6BCF\u4E2A vRouter \u901A\u8FC7 BGP \u534F\u8BAE\u8D1F\u8D23\u628A\u81EA\u5DF1\u4E0A\u8FD0\u884C\u7684 workload \u7684\u8DEF\u7531\u4FE1\u606F\u5411\u6574\u4E2A Calico \u7F51\u7EDC\u5185\u4F20\u64AD\u3002</p><p>\u6B64\u5916\uFF0CCalico \u9879\u76EE\u8FD8\u5B9E\u73B0\u4E86 Kubernetes \u7F51\u7EDC\u7B56\u7565\uFF0C\u63D0\u4F9BACL\u529F\u80FD\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token string">&#39;\u62C9\u53D6Pod\u7F51\u7EDC\u63D2\u4EF6&#39;</span>
<span class="token string">&#39;\u539F\u56E0\uFF1Acoredns\u4E00\u76F4\u505C\u6EDE\u5728Pending\uFF0C\u9700\u8981\u624B\u52A8\u62C9\u53D6, \u6700\u540E\u9009\u62E9\u7684\u7F51\u7EDC\u63D2\u4EF6\u662F\uFF1Acalico\u3002&#39;</span>

<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get  pods -A </span>
NAMESPACE     NAME                                 READY   STATUS    RESTARTS   AGE
kube-system   coredns-6d8c4cb4d-44wlk              <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          16s
kube-system   coredns-6d8c4cb4d-dvjms              <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          16s
kube-system   etcd-k8s-master                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          36s
kube-system   kube-apiserver-k8s-master            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          28s
kube-system   kube-controller-manager-k8s-master   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          27s
kube-system   kube-proxy-qtmsd                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          17s
kube-system   kube-scheduler-k8s-master            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          33s

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u90E8\u7F72calico\u7F51\u7EDC\u7EC4\u4EF6\uFF08\u9ED8\u8BA4\u6A21\u5F0F\uFF09</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml</span>
configmap/calico-config created
customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/caliconodestatuses.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipreservations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/kubecontrollersconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created
clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created
clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created
clusterrole.rbac.authorization.k8s.io/calico-node created
clusterrolebinding.rbac.authorization.k8s.io/calico-node created
daemonset.apps/calico-node created
serviceaccount/calico-node created
deployment.apps/calico-kube-controllers created
serviceaccount/calico-kube-controllers created
Warning: policy/v1beta1 PodDisruptionBudget is deprecated <span class="token keyword">in</span> v1.21+, unavailable <span class="token keyword">in</span> v1.25+<span class="token punctuation">;</span> use policy/v1 PodDisruptionBudget
poddisruptionbudget.policy/calico-kube-controllers created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u518D\u6B21\u67E5\u770B\u5F53\u524D\u7684Pod\u542F\u52A8\u60C5\u51B5\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -A </span>
NAMESPACE     NAME                                      READY   STATUS    RESTARTS   AGE
kube-system   calico-kube-controllers-7c845d499-qr7cw   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          99m
kube-system   calico-node-288zk                         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          99m
kube-system   calico-node-7dhnc                         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          97m
kube-system   calico-node-z78p4                         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          97m
kube-system   coredns-6d8c4cb4d-44wlk                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          100m
kube-system   coredns-6d8c4cb4d-dvjms                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          100m
kube-system   etcd-k8s-master                           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          100m
kube-system   kube-apiserver-k8s-master                 <span class="token number">1</span>/1     Running   <span class="token number">0</span>          100m
kube-system   kube-controller-manager-k8s-master        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          100m
kube-system   kube-proxy-qtmsd                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          100m
kube-system   kube-proxy-whjpj                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          97m
kube-system   kube-proxy-xnjs9                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          97m
kube-system   kube-scheduler-k8s-master                 <span class="token number">1</span>/1     Running   <span class="token number">0</span>          100m

<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get cs </span>
Warning: v1 ComponentStatus is deprecated <span class="token keyword">in</span> v1.19+
NAME                 STATUS    MESSAGE                         ERROR
scheduler            Healthy   ok                              
controller-manager   Healthy   ok                              
etcd-0               Healthy   <span class="token punctuation">{</span><span class="token string">&quot;health&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;true&quot;</span>,<span class="token string">&quot;reason&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-\u52A0\u5165\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#_3-\u52A0\u5165\u96C6\u7FA4" aria-hidden="true">#</a> 3.\u52A0\u5165\u96C6\u7FA4</h3><p>\u5728master\u521D\u59CB\u5316\u96C6\u7FA4\u4E4B\u540E,\u590D\u5236kubeadm join\u5B57\u6BB5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubeadm join 10.11.121.111:6443 --token abcdef.0123456789abcdef \\</span>
<span class="token operator">&gt;</span> --discovery-token-ca-cert-hash sha256:637d4427138d3ca87f32bf57e3a16e85cc806cbbf2dc25b475cf0bec9504a95f
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Reading configuration from the cluster<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> FYI: You can <span class="token function">look</span> at this config <span class="token function">file</span> with <span class="token string">&#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet configuration to <span class="token function">file</span> <span class="token string">&quot;/var/lib/kubelet/config.yaml&quot;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet environment <span class="token function">file</span> with flags to <span class="token function">file</span> <span class="token string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Starting the kubelet
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the kubelet to perform the TLS Bootstrap<span class="token punctuation">..</span>.

This <span class="token function">node</span> has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run <span class="token string">&#39;kubectl get nodes&#39;</span> on the control-plane to see this <span class="token function">node</span> <span class="token function">join</span> the cluster.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-\u9A8C\u8BC1\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#_4-\u9A8C\u8BC1\u96C6\u7FA4" aria-hidden="true">#</a> 4.\u9A8C\u8BC1\u96C6\u7FA4</h3><ol><li>\u67E5\u770B\u5F53\u524D\u5BB9\u5668\u7684\u5E95\u5C42\u662F\u5426\u4E3Acontainerd</li><li>\u67E5\u770B\u5F53\u524D\u96C6\u7FA4\u662F\u5426\u4F7F\u7528ipvs\u7684\u6A21\u5F0F</li><li>\u67E5\u770Bipvs\u8F6C\u53D1\u72B6\u6001</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get node -o wide </span>
NAME         STATUS   ROLES                  AGE    VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION           CONTAINER-RUNTIME
k8s-master   Ready    control-plane,master   120m   v1.23.5   <span class="token number">10.11</span>.121.111   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-1160.el7.x86_64   containerd://1.5.11
k8s-node1    Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 117m   v1.23.5   <span class="token number">10.11</span>.121.112   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-1160.el7.x86_64   containerd://1.5.11
k8s-node2    Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 117m   v1.23.5   <span class="token number">10.11</span>.121.113   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-1160.el7.x86_64   containerd://1.5.11


<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment">#  kubectl -n kube-system get cm kube-proxy -o yaml | grep mode</span>
    mode: ipvs
    
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># ipvsadm -ln </span>
IP Virtual Server version <span class="token number">1.2</span>.1 <span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">)</span>
Prot LocalAddress:Port Scheduler Flags
  -<span class="token operator">&gt;</span> RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  <span class="token number">10.96</span>.0.1:443 rr
  -<span class="token operator">&gt;</span> <span class="token number">10.11</span>.121.111:6443           Masq    <span class="token number">1</span>      <span class="token number">7</span>          <span class="token number">0</span>         
TCP  <span class="token number">10.96</span>.0.10:53 rr
  -<span class="token operator">&gt;</span> <span class="token number">10.244</span>.235.194:53            Masq    <span class="token number">1</span>      <span class="token number">0</span>          <span class="token number">0</span>         
  -<span class="token operator">&gt;</span> <span class="token number">10.244</span>.235.195:53            Masq    <span class="token number">1</span>      <span class="token number">0</span>          <span class="token number">0</span>         
TCP  <span class="token number">10.96</span>.0.10:9153 rr
  -<span class="token operator">&gt;</span> <span class="token number">10.244</span>.235.194:9153          Masq    <span class="token number">1</span>      <span class="token number">0</span>          <span class="token number">0</span>         
  -<span class="token operator">&gt;</span> <span class="token number">10.244</span>.235.195:9153          Masq    <span class="token number">1</span>      <span class="token number">0</span>          <span class="token number">0</span>         
UDP  <span class="token number">10.96</span>.0.10:53 rr
  -<span class="token operator">&gt;</span> <span class="token number">10.244</span>.235.194:53            Masq    <span class="token number">1</span>      <span class="token number">0</span>          <span class="token number">0</span>         
  -<span class="token operator">&gt;</span> <span class="token number">10.244</span>.235.195:53            Masq    <span class="token number">1</span>      <span class="token number">0</span>          <span class="token number">0</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,30);function m(k,v){const e=l("ExternalLinkIcon");return i(),c("div",null,[r,n("p",null,[s("\u5DE5\u5177\u4E0B\u8F7D\u5730\u5740\uFF1A"),n("a",u,[s("https://github.com/kubernetes-sigs/cri-tools/releases/"),o(e)])]),d])}const h=t(p,[["render",m],["__file","03.Containerd\u642D\u5EFAKubernets.html.vue"]]);export{h as default};
