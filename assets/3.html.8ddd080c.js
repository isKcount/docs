import{_ as t}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as p,c as l,a as n,b as a,t as i,f as s}from"./app.ca0279c0.js";const o={},c=s('<h1 id="playbook" tabindex="-1"><a class="header-anchor" href="#playbook" aria-hidden="true">#</a> <strong>Playbook</strong></h1><h2 id="playbook\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#playbook\u4ECB\u7ECD" aria-hidden="true">#</a> playbook\u4ECB\u7ECD</h2><h3 id="\u4E00-\u4E3A\u4EC0\u4E48\u5F15\u5165playbook" tabindex="-1"><a class="header-anchor" href="#\u4E00-\u4E3A\u4EC0\u4E48\u5F15\u5165playbook" aria-hidden="true">#</a> \u4E00. \u4E3A\u4EC0\u4E48\u5F15\u5165playbook</h3><p>\u6211\u4EEC\u5B8C\u6210\u4E00\u4E2A\u4EFB\u52A1\uFF0C\u4F8B\u5982\u5B89\u88C5\u90E8\u7F72\u4E00\u4E2Ahttpd\u670D\u52A1\uFF0C\u6211\u4EEC\u9700\u8981\u591A\u4E2A\u6A21\u5757\uFF08\u4E00\u4E2A\u6A21\u5757\u4E5F\u53EF\u4EE5\u79F0\u4E4B\u4E3Atask\uFF09\u63D0\u4F9B\u529F\u80FD\u6765\u5B8C\u6210\u3002\u800Cplaybook\u5C31\u662F\u7EC4\u7EC7\u591A\u4E2Atask\u7684\u5BB9\u5668\uFF0C\u4ED6\u7684\u5B9E\u8D28\u5C31\u662F\u4E00\u4E2A\u6587\u4EF6\uFF0C\u6709\u7740\u7279\u5B9A\u7684\u7EC4\u7EC7\u683C\u5F0F\uFF0C\u5B83\u91C7\u7528\u7684\u8BED\u6CD5\u683C\u5F0F\u662FYAML\uFF08Yet Another Markup Language\uFF09\u3002YAML\u8BED\u6CD5\u80FD\u591F\u7B80\u5355\u7684\u8868\u793A\u6563\u5217\u8868\uFF0C\u5B57\u5178\u7B49\u6570\u636E\u7ED3\u6784\u3002\u5177\u4F53\u8BF7\u53C2\u8003YAML\u8BE6\u7EC6\u8BED\u6CD5</p><blockquote><p>playbook\u662F\u7531\u4E00\u4E2A\u6216\u591A\u4E2A&quot;play&quot;\u7EC4\u6210\u7684\u5217\u8868 play\u7684\u4E3B\u8981\u529F\u80FD\u5728\u4E8E\u5C06\u9884\u5B9A\u4E49\u7684\u4E00\u7EC4\u4E3B\u673A\uFF0C\u88C5\u626E\u6210\u4E8B\u5148\u901A\u8FC7ansible\u4E2D\u7684task\u5B9A\u4E49\u597D\u7684\u89D2\u8272\u3002 Task\u5B9E\u9645\u662F\u8C03\u7528ansible\u7684\u4E00\u4E2Amodule\uFF0C\u5C06\u591A\u4E2Aplay\u7EC4\u7EC7\u5728\u4E00\u4E2Aplaybook\u4E2D\uFF0C \u5373\u53EF\u4EE5\u8BA9\u5B83\u4EEC\u8054\u5408\u8D77\u6765\uFF0C\u6309\u4E8B\u5148\u7F16\u6392\u7684\u673A\u5236\u6267\u884C\u9884\u5B9A\u4E49\u7684\u52A8\u4F5C Playbook\u91C7\u7528YAML\u8BED\u8A00\u7F16\u5199</p></blockquote><h3 id="\u4E8C-playbook\u57FA\u7840\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u4E8C-playbook\u57FA\u7840\u7EC4\u4EF6" aria-hidden="true">#</a> \u4E8C. playbook\u57FA\u7840\u7EC4\u4EF6</h3>',6),u=s("<li><p><code>Hosts</code>\uFF1A\u8FD0\u884C\u6267\u884C\u4EFB\u52A1\uFF08task\uFF09\u7684\u76EE\u6807\u4E3B\u673A</p></li><li><p><code>remote_user</code>\uFF1A\u5728\u8FDC\u7A0B\u4E3B\u673A\u4E0A\u6267\u884C\u4EFB\u52A1\u7684\u7528\u6237</p></li><li><p><code>tasks</code>\uFF1A\u4EFB\u52A1\u5217\u8868</p></li><li><p><code>handlers</code>\uFF1A\u4EFB\u52A1\uFF0C\u4E0Etasks\u4E0D\u540C\u7684\u662F\u53EA\u6709\u5728\u63A5\u53D7\u5230\u901A\u77E5\u65F6\u624D\u4F1A\u88AB\u89E6\u53D1</p></li><li><p><code>templates</code>\uFF1A\u4F7F\u7528\u6A21\u677F\u8BED\u8A00\u7684\u6587\u672C\u6587\u4EF6\uFF0C\u4F7F\u7528jinja2\u8BED\u6CD5\u3002</p></li>",5),r=n("code",null,"variables",-1),d=n("li",null,[n("p",null,[n("code",null,"tags\u6807\u7B7E"),a("\uFF1A \u6307\u5B9A\u67D0\u6761\u4EFB\u52A1\u6267\u884C\uFF0C\u7528\u4E8E\u9009\u62E9\u8FD0\u884Cplaybook\u4E2D\u7684\u90E8\u5206\u4EE3\u7801\u3002 ansible\u5177\u6709\u5E42\u7B49\u6027\uFF0C\u56E0\u6B64\u4F1A\u81EA\u52A8\u8DF3\u8FC7\u6CA1\u6709\u53D8\u5316\u7684\u90E8\u5206\uFF0C \u5373\u4FBF\u5982\u6B64\uFF0C\u6709\u4E9B\u4EE3\u7801\u4E3A\u6D4B\u8BD5\u5176\u786E\u5B9E\u6CA1\u6709\u53D1\u751F\u53D8\u5316\u7684\u65F6\u95F4\u4F9D\u7136\u4F1A\u975E\u5E38\u5730\u957F\u3002 \u6B64\u65F6\uFF0C\u5982\u679C\u786E\u4FE1\u5176\u6CA1\u6709\u53D8\u5316\uFF0C\u5C31\u53EF\u4EE5\u901A\u8FC7tags\u8DF3\u8FC7\u6B64\u4E9B\u4EE3\u7801\u7247\u65AD ansible-playbook -t tagsname useradd.yml")])],-1),k=s(`<p><code>\u6574\u4E2Aplaybook\u662F\u4EE5task\u4E3A\u4E2D\u5FC3\uFF0C\u8868\u660E\u8981\u6267\u884C\u7684\u4EFB\u52A1\u3002hosts\u548Cremote_user\u8868\u660E\u5728\u54EA\u4E9B\u8FDC\u7A0B\u4E3B\u673A\u4EE5\u4F55\u79CD\u8EAB\u4EFD\u6267\u884C\u3002\u5176\u4ED6\u7EC4\u4EF6\u8BA9\u5176\u80FD\u591F\u66F4\u52A0\u7075\u6D3B\u3002</code></p><p>\u4E0B\u9762\u8BE6\u7EC6\u4ECB\u7ECD\u67D0\u4E9B\u7EC4\u4EF6</p><h3 id="playbook\u57FA\u7840\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#playbook\u57FA\u7840\u7EC4\u4EF6" aria-hidden="true">#</a> playbook\u57FA\u7840\u7EC4\u4EF6</h3><h3 id="hosts" tabindex="-1"><a class="header-anchor" href="#hosts" aria-hidden="true">#</a> Hosts\uFF1A</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>    <span class="token operator">&gt;</span> playbook\u4E2D\u7684\u6BCF\u4E00\u4E2Aplay\u7684\u76EE\u7684\u90FD\u662F\u4E3A\u4E86\u8BA9\u7279\u5B9A\u4E3B\u673A\u4EE5\u67D0\u4E2A\u6307\u5B9A\u7684\u7528\u6237\u8EAB\u4EFD\u6267\u884C\u4EFB\u52A1\u3002
      hosts\u7528\u4E8E\u6307\u5B9A\u8981\u6267\u884C\u6307\u5B9A\u4EFB\u52A1\u7684\u4E3B\u673A\uFF0C\u987B\u4E8B\u5148\u5B9A\u4E49\u5728\u4E3B\u673A\u6E05\u5355\u4E2D

    <span class="token operator">&gt;</span> \u53EF\u4EE5\u662F\u5982\u4E0B\u5F62\u5F0F\uFF1A
        one.example.com
        one.example.com:two.example.com
        <span class="token number">192.168</span>.1.50
        <span class="token number">192.168</span>.1.*
    <span class="token operator">&gt;</span> Websrvs:dbsrvs       \u6216\u8005\uFF0C\u4E24\u4E2A\u7EC4\u7684\u5E76\u96C6
    <span class="token operator">&gt;</span> Websrvs:<span class="token operator">&amp;</span>dbsrvs      \u4E0E\uFF0C\u4E24\u4E2A\u7EC4\u7684\u4EA4\u96C6
    <span class="token operator">&gt;</span> webservers:<span class="token operator">!</span>phoenix  \u5728websrvs\u7EC4\uFF0C\u4F46\u4E0D\u5728dbsrvs\u7EC4
    \u793A\u4F8B: - hosts: websrvs\uFF1Adbsrvs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="remote-user" tabindex="-1"><a class="header-anchor" href="#remote-user" aria-hidden="true">#</a> remote_user:</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>    \u53EF\u7528\u4E8EHost\u548Ctask\u4E2D\u3002
    \u4E5F\u53EF\u4EE5\u901A\u8FC7\u6307\u5B9A\u5176\u901A\u8FC7sudo\u7684\u65B9\u5F0F\u5728\u8FDC\u7A0B\u4E3B\u673A\u4E0A\u6267\u884C\u4EFB\u52A1\uFF0C\u5176\u53EF\u7528\u4E8Eplay\u5168\u5C40\u6216\u67D0\u4EFB\u52A1\uFF1B
    \u6B64\u5916\uFF0C\u751A\u81F3\u53EF\u4EE5\u5728sudo\u65F6\u4F7F\u7528sudo_user\u6307\u5B9Asudo\u65F6\u5207\u6362\u7684\u7528\u6237
    - hosts: websrvs
        remote_user: root   <span class="token punctuation">(</span>\u53EF\u7701\u7565,\u9ED8\u8BA4\u4E3Aroot<span class="token punctuation">)</span>  \u4EE5root\u8EAB\u4EFD\u8FDE\u63A5
      tasks:    \u6307\u5B9A\u4EFB\u52A1
    - name: <span class="token builtin class-name">test</span> connection
        ping:
        remote_user: magedu
        sudo: <span class="token function">yes</span>           \u9ED8\u8BA4sudo\u4E3Aroot
        sudo_user:wang      sudo\u4E3Awang
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="task\u5217\u8868\u548Caction" tabindex="-1"><a class="header-anchor" href="#task\u5217\u8868\u548Caction" aria-hidden="true">#</a> task\u5217\u8868\u548Caction\uFF1A</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>    \u53EF\u7528\u4E8EHost\u548Ctask\u4E2D\u3002
    \u4E5F\u53EF\u4EE5\u901A\u8FC7\u6307\u5B9A\u5176\u901A\u8FC7sudo\u7684\u65B9\u5F0F\u5728\u8FDC\u7A0B\u4E3B\u673A\u4E0A\u6267\u884C\u4EFB\u52A1\uFF0C\u5176\u53EF\u7528\u4E8Eplay\u5168\u5C40\u6216\u67D0\u4EFB\u52A1\uFF1B
    \u6B64\u5916\uFF0C\u751A\u81F3\u53EF\u4EE5\u5728sudo\u65F6\u4F7F\u7528sudo_user\u6307\u5B9Asudo\u65F6\u5207\u6362\u7684\u7528\u6237
    - hosts: websrvs
        remote_user: root   <span class="token punctuation">(</span>\u53EF\u7701\u7565,\u9ED8\u8BA4\u4E3Aroot<span class="token punctuation">)</span>  \u4EE5root\u8EAB\u4EFD\u8FDE\u63A5
      tasks:    \u6307\u5B9A\u4EFB\u52A1
    - name: <span class="token builtin class-name">test</span> connection
        ping:
        remote_user: magedu
        sudo: <span class="token function">yes</span>           \u9ED8\u8BA4sudo\u4E3Aroot
        sudo_user:wang      sudo\u4E3Awang
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tasks-\u4EFB\u52A1\u5217\u8868" tabindex="-1"><a class="header-anchor" href="#tasks-\u4EFB\u52A1\u5217\u8868" aria-hidden="true">#</a> tasks\uFF1A\u4EFB\u52A1\u5217\u8868</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u4E24\u79CD\u683C\u5F0F\uFF1A
    <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> action: module arguments
    <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> module: arguments \u5EFA\u8BAE\u4F7F\u7528  \u6A21\u5757: \u53C2\u6570
    \u6CE8\u610F\uFF1Ashell\u548Ccommand\u6A21\u5757\u540E\u9762\u8DDF\u547D\u4EE4\uFF0C\u800C\u975Ekey<span class="token operator">=</span>value

\u67D0\u4EFB\u52A1\u7684\u72B6\u6001\u5728\u8FD0\u884C\u540E\u4E3Achanged\u65F6\uFF0C\u53EF\u901A\u8FC7<span class="token string">&quot;notify&quot;</span>\u901A\u77E5\u7ED9\u76F8\u5E94\u7684handlers

\u4EFB\u52A1\u53EF\u4EE5\u901A\u8FC7<span class="token string">&quot;tags&quot;</span>\u6253\u6807\u7B7E\uFF0C\u53EF\u5728ansible-playbook\u547D\u4EE4\u4E0A\u4F7F\u7528-t\u6307\u5B9A\u8FDB\u884C\u8C03\u7528
\u793A\u4F8B\uFF1A
tasks:
  - name: disable selinux   \u63CF\u8FF0
    command: /sbin/setenforce <span class="token number">0</span>   \u6A21\u5757\u540D: \u6A21\u5757\u5BF9\u5E94\u7684\u53C2\u6570
    
\u5982\u679C\u547D\u4EE4\u6216\u811A\u672C\u7684\u9000\u51FA\u7801\u4E0D\u4E3A\u96F6\uFF0C\u53EF\u4EE5\u4F7F\u7528\u5982\u4E0B\u65B9\u5F0F\u66FF\u4EE3
tasks:
  - name: run this <span class="token builtin class-name">command</span> and ignore the result
    shell: /usr/bin/somecommand <span class="token operator">||</span> /bin/true  
    \u8F6C\u9519\u4E3A\u6B63  \u5982\u679C\u547D\u4EE4\u5931\u8D25\u5219\u6267\u884C <span class="token boolean">true</span>

\u6216\u8005\u4F7F\u7528ignore_errors\u6765\u5FFD\u7565\u9519\u8BEF\u4FE1\u606F
tasks:
  - name: run this <span class="token builtin class-name">command</span> and ignore the result
    shell: /usr/bin/somecommand
    ignore_errors: True  \u5FFD\u7565\u9519\u8BEF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="variable" tabindex="-1"><a class="header-anchor" href="#variable" aria-hidden="true">#</a> variable</h3><p>\u53D8\u91CF\u5B9A\u4E49\u5728\u8D44\u4EA7\uFF08inventory\uFF09\u4E2D\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u4E3B\u673A\u53D8\u91CF\uFF1A
<span class="token number">192.168</span>.200.136 <span class="token assign-left variable">http_port</span><span class="token operator">=</span><span class="token number">808</span> <span class="token assign-left variable">maxRequestsPerChild</span><span class="token operator">=</span><span class="token number">808</span>
<span class="token number">192.168</span>.200.137 <span class="token assign-left variable">http_port</span><span class="token operator">=</span><span class="token number">8080</span> <span class="token assign-left variable">maxRequestsPerChild</span><span class="token operator">=</span><span class="token number">909</span>

\u4E3B\u673A\u7EC4\u53D8\u91CF:
<span class="token punctuation">[</span>websers<span class="token punctuation">]</span>
<span class="token number">192.168</span>.200.136
<span class="token number">192.168</span>.200.137

<span class="token punctuation">[</span>websers:vars<span class="token punctuation">]</span>  
<span class="token assign-left variable">ntp_server</span><span class="token operator">=</span>ntp.exampl.com
<span class="token assign-left variable">proxy</span><span class="token operator">=</span>proxy.exampl.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B9A\u4E49\u5728playbook\u4E2D</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> webservers   
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>     
    <span class="token key atrule">http_port</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u8FD0\u884Cplaybook" tabindex="-1"><a class="header-anchor" href="#\u8FD0\u884Cplaybook" aria-hidden="true">#</a> \u8FD0\u884Cplaybook</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u8FD0\u884Cplaybook\u7684\u65B9\u5F0F
    ansible-playbook <span class="token operator">&lt;</span>filename.yml<span class="token operator">&gt;</span> <span class="token punctuation">..</span>. <span class="token punctuation">[</span>options<span class="token punctuation">]</span>

\u5E38\u89C1\u9009\u9879
    <span class="token parameter variable">--check</span> <span class="token parameter variable">-C</span>       \u53EA\u68C0\u6D4B\u53EF\u80FD\u4F1A\u53D1\u751F\u7684\u6539\u53D8\uFF0C\u4F46\u4E0D\u771F\u6B63\u6267\u884C\u64CD\u4F5C 
                     <span class="token punctuation">(</span>\u53EA\u68C0\u67E5\u8BED\u6CD5,\u5982\u679C\u6267\u884C\u8FC7\u7A0B\u4E2D\u51FA\u73B0\u95EE\u9898,-C\u65E0\u6CD5\u68C0\u6D4B\u51FA\u6765<span class="token punctuation">)</span>
                     <span class="token punctuation">(</span>\u6267\u884Cplaybook\u751F\u6210\u7684\u6587\u4EF6\u4E0D\u5B58\u5728,\u540E\u9762\u7684\u7A0B\u5E8F\u5982\u679C\u4F9D\u8D56\u8FD9\u4E9B\u6587\u4EF6,\u4E5F\u4F1A\u5BFC\u81F4\u68C0\u6D4B\u5931\u8D25<span class="token punctuation">)</span>
    --list-hosts     \u5217\u51FA\u8FD0\u884C\u4EFB\u52A1\u7684\u4E3B\u673A
    --list-tags      \u5217\u51FAtag  <span class="token punctuation">(</span>\u5217\u51FA\u6807\u7B7E<span class="token punctuation">)</span>
    --list-tasks     \u5217\u51FAtask <span class="token punctuation">(</span>\u5217\u51FA\u4EFB\u52A1<span class="token punctuation">)</span>
    <span class="token parameter variable">--limit</span> \u4E3B\u673A\u5217\u8868 \u53EA\u9488\u5BF9\u4E3B\u673A\u5217\u8868\u4E2D\u7684\u4E3B\u673A\u6267\u884C
    <span class="token parameter variable">-v</span> <span class="token parameter variable">-vv</span> <span class="token parameter variable">-vvv</span>      \u663E\u793A\u8FC7\u7A0B

\u793A\u4F8B
    ansible-playbook hello.yml <span class="token parameter variable">--check</span> \u53EA\u68C0\u6D4B
    ansible-playbook hello.yml --list-hosts  \u663E\u793A\u8FD0\u884C\u4EFB\u52A1\u7684\u4E3B\u673A
    ansible-playbook hello.yml <span class="token parameter variable">--limit</span> websrvs  \u9650\u5236\u4E3B\u673A
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="playbook-vs-shellscripts" tabindex="-1"><a class="header-anchor" href="#playbook-vs-shellscripts" aria-hidden="true">#</a> Playbook VS ShellScripts</h3><h3 id="\u4F7F\u7528playbook\u5B89\u88C5httpd" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528playbook\u5B89\u88C5httpd" aria-hidden="true">#</a> \u4F7F\u7528playbook\u5B89\u88C5httpd</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token environment constant">SHELL</span>\u811A\u672C
<span class="token comment">#!/bin/bash</span>
<span class="token comment"># \u5B89\u88C5Apache</span>
yum <span class="token function">install</span> <span class="token parameter variable">--quiet</span> <span class="token parameter variable">-y</span> httpd
<span class="token comment"># \u590D\u5236\u914D\u7F6E\u6587\u4EF6</span>
<span class="token function">cp</span> /tmp/httpd.conf /etc/httpd/conf/httpd.conf
cp/tmp/vhosts.conf /etc/httpd/conf.d/
<span class="token comment"># \u542F\u52A8Apache\uFF0C\u5E76\u8BBE\u7F6E\u5F00\u673A\u542F\u52A8</span>
<span class="token function">service</span> httpd start
<span class="token function">chkconfig</span> httpd on
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>Playbook\u5B9A\u4E49
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;\u5B89\u88C5Apache&quot;</span>
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=httpd       yum\u6A21\u5757<span class="token punctuation">:</span>\u5B89\u88C5httpd
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;\u590D\u5236\u914D\u7F6E\u6587\u4EF6&quot;</span>
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> <span class="token key atrule">src=/tmp/httpd.conf dest=/etc/httpd/conf/  copy\u6A21\u5757</span><span class="token punctuation">:</span> \u62F7\u8D1D\u6587\u4EF6
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;\u590D\u5236\u914D\u7F6E\u6587\u4EF6&quot;</span>
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/tmp/vhosts.conf dest=/etc/httpd/conf.d/  
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;\u542F\u52A8Apache\uFF0C\u5E76\u8BBE\u7F6E\u5F00\u673A\u542F\u52A8&quot;</span>
      <span class="token key atrule">service</span><span class="token punctuation">:</span> <span class="token key atrule">name=httpd state=started enabled=yes   service\u6A21\u5757</span><span class="token punctuation">:</span> \u542F\u52A8\u670D\u52A1 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u793A\u4F8B-playbook-\u521B\u5EFA\u7528\u6237" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B-playbook-\u521B\u5EFA\u7528\u6237" aria-hidden="true">#</a> \u793A\u4F8B:Playbook \u521B\u5EFA\u7528\u6237</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>\u793A\u4F8B\uFF1Asysuser.yml
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> create mysql user
      <span class="token key atrule">user</span><span class="token punctuation">:</span> name=mysql system=yes uid=36
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> create a group
      <span class="token key atrule">group</span><span class="token punctuation">:</span> name=httpd system=yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="playbook\u793A\u4F8B-\u5B89\u88C5httpd\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#playbook\u793A\u4F8B-\u5B89\u88C5httpd\u670D\u52A1" aria-hidden="true">#</a> Playbook\u793A\u4F8B \u5B89\u88C5httpd\u670D\u52A1</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>\u793A\u4F8B\uFF1Ahttpd.yml
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> websrvs
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install httpd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=httpd state=present
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install configure file
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=files/httpd.conf dest=/etc/httpd/conf/
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=httpd state=started enabled=yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="playbook\u793A\u4F8B-\u5B89\u88C5nginx\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#playbook\u793A\u4F8B-\u5B89\u88C5nginx\u670D\u52A1" aria-hidden="true">#</a> Playbook\u793A\u4F8B \u5B89\u88C5nginx\u670D\u52A1</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>\u793A\u4F8B nginx.yml
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add group nginx
      <span class="token key atrule">user</span><span class="token punctuation">:</span> name=nginx state=present
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add user nginx
      <span class="token key atrule">user</span><span class="token punctuation">:</span> name=nginx state=present group=nginx
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Nginx
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=nginx state=present
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Start Nginx
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx state=started enabled=yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="playbook\u4E2Dhandlers\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#playbook\u4E2Dhandlers\u4F7F\u7528" aria-hidden="true">#</a> <strong>Playbook\u4E2Dhandlers\u4F7F\u7528</strong></h3><p>handlers\u548Cnotify\u7ED3\u5408\u4F7F\u7528\u89E6\u53D1\u6761\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Handlers \u5B9E\u9645\u4E0A\u5C31\u662F\u4E00\u4E2A\u89E6\u53D1\u5668
\u662Ftask\u5217\u8868\uFF0C\u8FD9\u4E9Btask\u4E0E\u524D\u8FF0\u7684task\u5E76\u6CA1\u6709\u672C\u8D28\u4E0A\u7684\u4E0D\u540C,\u7528\u4E8E\u5F53\u5173\u6CE8\u7684\u8D44\u6E90\u53D1\u751F\u53D8\u5316\u65F6\uFF0C\u624D\u4F1A\u91C7\u53D6\u4E00\u5B9A\u7684\u64CD\u4F5C

Notify\u6B64action\u53EF\u7528\u4E8E\u5728\u6BCF\u4E2Aplay\u7684\u6700\u540E\u88AB\u89E6\u53D1\uFF0C
\u8FD9\u6837\u53EF\u907F\u514D\u591A\u6B21\u6709\u6539\u53D8\u53D1\u751F\u65F6\u6BCF\u6B21\u90FD\u6267\u884C\u6307\u5B9A\u7684\u64CD\u4F5C\uFF0C\u4EC5\u5728\u6240\u6709\u7684\u53D8\u5316\u53D1\u751F\u5B8C\u6210\u540E\u4E00\u6B21\u6027\u5730\u6267\u884C\u6307\u5B9A\u64CD\u4F5C\u3002
\u5728notify\u4E2D\u5217\u51FA\u7684\u64CD\u4F5C\u79F0\u4E3Ahandler\uFF0C\u4E5F\u5373notify\u4E2D\u8C03\u7528handler\u4E2D\u5B9A\u4E49\u7684\u64CD\u4F5C
\u5F53\u4F60\u7684\u914D\u7F6E\u6587\u4EF6\u53D1\u751F\u6539\u53D8\u7684\u65F6\u5019\uFF0C\u4F46\u662F\u4F60\u7684\u670D\u52A1\u5E76\u6CA1\u6709\u68C0\u6D4B\u5230\u914D\u7F6E\u6587\u4EF6\u53D1\u751F\u6539\u53D8\u800C\u91CD\u542F\u670D\u52A1\uFF0C\u6B64\u65F6\u7684hanlers\u5C31\u4F1A\u68C0\u6D4B\u4F60\u7684\u66F4\u6539\u914D\u7F6E\u6587\u4EF6\u4E0B\u6240\u6807\u8BC6\u7684notify\u6765\u91CD\u542F\u670D\u52A1\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Playbook\u4E2Dhandlers\u4F7F\u7528</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># cat playbook.yaml </span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server 
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install httpd 
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=httpd state=present 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install config 
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/root/work/httpd.conf dest=/etc/httpd/conf/ backup=yes          <span class="token comment"># \u539F\u5148\u7684\u7AEF\u53E3\u662F80 \u88AB\u6211\u6539\u6210\u4E868080\u4E4B\u540E\u6807\u8BC6notify</span>
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> restart service                 <span class="token comment">#\u6807\u8BC6\u5FC5\u987B\u548Chandlers\u4E00\u6837</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy config 
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/root/work/index.html dest=/var/www/html/
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start service 
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=httpd state=started enabled=yes 

  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>								   <span class="token comment">#\u7A7A\u4E00\u884C\u5206\u5F00\u5199 \u91C7\u53D6\u63AA\u65BD\uFF0C\u91C7\u53D6\u4F7F\u7528service\u91CD\u542F\u670D\u52A1\u7684\u63AA\u65BD</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restart service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=httpd state=restarted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u89E6\u53D1\u591A\u4E2Anotify\u7684handlers\u7528\u6CD5</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> websrvs
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add group nginx
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> user
      <span class="token key atrule">user</span><span class="token punctuation">:</span> name=nginx state=present
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add user nginx
      <span class="token key atrule">user</span><span class="token punctuation">:</span> name=nginx state=present group=nginx
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Nginx
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=nginx state=present
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> config
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/root/config.txt dest=/etc/nginx/nginx.conf
      <span class="token key atrule">notify</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Restart Nginx 			<span class="token comment"># \u91CD\u542F\u670D\u52A1</span>
        <span class="token punctuation">-</span> Check Nginx Process		 <span class="token comment"># \u68C0\u67E5\u8FDB\u7A0B\u662F\u5426\u542F\u52A8</span>
  
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Restart Nginx
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx state=restarted enabled=yes
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Check Nginx process
      <span class="token key atrule">shell</span><span class="token punctuation">:</span> killall <span class="token punctuation">-</span>0 nginx <span class="token punctuation">&gt;</span> /tmp/nginx.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="playbook\u4E2Dtags\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#playbook\u4E2Dtags\u4F7F\u7528" aria-hidden="true">#</a> <strong>Playbook\u4E2Dtags\u4F7F\u7528</strong></h3><p><code>tage: \u6DFB\u52A0\u6807\u7B7E</code></p><ul><li>\u53EF\u4EE5\u6307\u5B9A\u67D0\u4E00\u4E2A\u4EFB\u52A1\u6DFB\u52A0\u4E00\u4E2A\u6807\u7B7E,\u6DFB\u52A0\u6807\u7B7E\u4EE5\u540E,\u60F3\u6267\u884C\u67D0\u4E2A\u52A8\u4F5C\u53EF\u4EE5\u505A\u51FA\u6311\u9009\u6765\u6267\u884C</li><li><code>\u591A\u4E2A\u52A8\u4F5C\u53EF\u4EE5\u4F7F\u7528\u540C\u4E00\u4E2A\u6807\u7B7E</code></li><li>\u6267\u884Cplaybookl\u7684\u65F6\u5019\uFF0C\u5047\u8BBE\u524D\u9762\u7684\u90FD\u6267\u884C\u8FC7\u4E86\uFF0C\u53EA\u662F\u5355\u72EC\u7684\u670D\u52A1\u6CA1\u8D77\u6765\uFF0C\u53EF\u4EE5\u52A0\u4E2Atags\uFF0C\u6267\u884C\u7684\u65F6\u5019\u5355\u72EC -t [ tags ] \u5C31\u53EF\u4EE5\u53EA\u6267\u884Ctags\u7684\u90A3\u90E8\u5206\u3002</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># cat playbook.yaml  </span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server 
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install httpd 
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=httpd state=present 
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> installed 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install config 
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/root/work/httpd.conf dest=/etc/httpd/conf/ backup=yes
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> restart service
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy config 
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/root/work/index.html dest=/var/www/html/
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start service 
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=httpd state=started enabled=yes 
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> restart 

  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restart service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=httpd state=restarted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EA\u6267\u884Ctags\u7684 restart\u90E8\u5206</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible-playbook -t restart playbook.yaml  </span>

PLAY <span class="token punctuation">[</span>server<span class="token punctuation">]</span> *******************************************************************************************************************************************************************************

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> **********************************************************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.113<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.112<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>start service<span class="token punctuation">]</span> ************************************************************************************************************************************************************************
changed: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.113<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.112<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span>

PLAY RECAP **********************************************************************************************************************************************************************************
<span class="token number">192.168</span>.1.110              <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
<span class="token number">192.168</span>.1.112              <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
<span class="token number">192.168</span>.1.113              <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="playbook\u4E2D\u53D8\u91CF\u7684\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#playbook\u4E2D\u53D8\u91CF\u7684\u4F7F\u7528" aria-hidden="true">#</a> <strong>Playbook\u4E2D\u53D8\u91CF\u7684\u4F7F\u7528</strong></h3><p>\u53D8\u91CF\u540D\uFF1A\u4EC5\u80FD\u7531\u5B57\u6BCD\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF\u7EC4\u6210\uFF0C\u4E14\u53EA\u80FD\u4EE5\u5B57\u6BCD\u5F00\u5934</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u53D8\u91CF\u6765\u6E90\uFF1A
    <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> ansible setup facts \u8FDC\u7A0B\u4E3B\u673A\u7684\u6240\u6709\u53D8\u91CF\u90FD\u53EF\u76F4\u63A5\u8C03\u7528 <span class="token punctuation">(</span>\u7CFB\u7EDF\u81EA\u5E26\u53D8\u91CF<span class="token punctuation">)</span>
       setup\u6A21\u5757\u53EF\u4EE5\u5B9E\u73B0\u7CFB\u7EDF\u4E2D\u5F88\u591A\u7CFB\u7EDF\u4FE1\u606F\u7684\u663E\u793A
                \u53EF\u4EE5\u8FD4\u56DE\u6BCF\u4E2A\u4E3B\u673A\u7684\u7CFB\u7EDF\u4FE1\u606F\u5305\u62EC:\u7248\u672C\u3001\u4E3B\u673A\u540D\u3001cpu\u3001\u5185\u5B58
       ansible all <span class="token parameter variable">-m</span> setup <span class="token parameter variable">-a</span> <span class="token string">&#39;filter=&quot;ansible_nodename&quot;&#39;</span>     \u67E5\u8BE2\u4E3B\u673A\u540D
       ansible all <span class="token parameter variable">-m</span> setup <span class="token parameter variable">-a</span> <span class="token string">&#39;filter=&quot;ansible_memtotal_mb&quot;&#39;</span>  \u67E5\u8BE2\u4E3B\u673A\u5185\u5B58\u5927\u5C0F
       ansible all <span class="token parameter variable">-m</span> setup <span class="token parameter variable">-a</span> <span class="token string">&#39;filter=&quot;ansible_distribution_major_version&quot;&#39;</span>  \u67E5\u8BE2\u7CFB\u7EDF\u7248\u672C
       ansible all <span class="token parameter variable">-m</span> setup <span class="token parameter variable">-a</span> <span class="token string">&#39;filter=&quot;ansible_processor_vcpus&quot;&#39;</span> \u67E5\u8BE2\u4E3B\u673Acpu\u4E2A\u6570
    
    <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> \u5728/etc/ansible/hosts<span class="token punctuation">(</span>\u4E3B\u673A\u6E05\u5355<span class="token punctuation">)</span>\u4E2D\u5B9A\u4E49\u53D8\u91CF
        \u666E\u901A\u53D8\u91CF\uFF1A\u4E3B\u673A\u7EC4\u4E2D\u4E3B\u673A\u5355\u72EC\u5B9A\u4E49\uFF0C\u4F18\u5148\u7EA7\u9AD8\u4E8E\u516C\u5171\u53D8\u91CF<span class="token punctuation">(</span>\u5355\u4E2A\u4E3B\u673A <span class="token punctuation">)</span>
        \u516C\u5171<span class="token punctuation">(</span>\u7EC4<span class="token punctuation">)</span>\u53D8\u91CF\uFF1A\u9488\u5BF9\u4E3B\u673A\u7EC4\u4E2D\u6240\u6709\u4E3B\u673A\u5B9A\u4E49\u7EDF\u4E00\u53D8\u91CF<span class="token punctuation">(</span>\u4E00\u7EC4\u4E3B\u673A\u7684\u540C\u4E00\u7C7B\u522B<span class="token punctuation">)</span>
    
    <span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span> \u901A\u8FC7\u547D\u4EE4\u884C\u6307\u5B9A\u53D8\u91CF\uFF0C\u4F18\u5148\u7EA7\u6700\u9AD8
       ansible-playbook \u2013e <span class="token assign-left variable">varname</span><span class="token operator">=</span>value
    
    <span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span> \u5728playbook\u4E2D\u5B9A\u4E49
       vars:
        - var1: value1
        - var2: value2
    
    <span class="token operator"><span class="token file-descriptor important">5</span>&gt;</span> \u5728\u72EC\u7ACB\u7684\u53D8\u91CFYAML\u6587\u4EF6\u4E2D\u5B9A\u4E49
    
    <span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span> \u5728role\u4E2D\u5B9A\u4E49

\u53D8\u91CF\u547D\u540D:
    \u53D8\u91CF\u540D\u4EC5\u80FD\u7531\u5B57\u6BCD\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF\u7EC4\u6210\uFF0C\u4E14\u53EA\u80FD\u4EE5\u5B57\u6BCD\u5F00\u5934

\u53D8\u91CF\u5B9A\u4E49\uFF1Akey<span class="token operator">=</span>value
    \u793A\u4F8B\uFF1Ahttp_port<span class="token operator">=</span><span class="token number">80</span>

\u53D8\u91CF\u8C03\u7528\u65B9\u5F0F\uFF1A
    <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> \u901A\u8FC7<span class="token punctuation">{</span><span class="token punctuation">{</span> variable_name <span class="token punctuation">}</span><span class="token punctuation">}</span> \u8C03\u7528\u53D8\u91CF\uFF0C\u4E14\u53D8\u91CF\u540D\u524D\u540E\u5FC5\u987B\u6709\u7A7A\u683C\uFF0C\u6709\u65F6\u7528\u201C<span class="token punctuation">{</span><span class="token punctuation">{</span> variable_name <span class="token punctuation">}</span><span class="token punctuation">}</span>\u201D\u624D\u751F\u6548

    <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> ansible-playbook \u2013e \u9009\u9879\u6307\u5B9A
       ansible-playbook test.yml <span class="token parameter variable">-e</span> <span class="token string">&quot;hosts=www user=magedu&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u4E3B\u673A\u6E05\u5355\u4E2D\u5B9A\u4E49\u53D8\u91CF,\u5728ansible\u4E2D\u4F7F\u7528\u53D8\u91CF</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim /etc/ansible/hosts</span>
<span class="token punctuation">[</span>appsrvs<span class="token punctuation">]</span>
<span class="token number">192.168</span>.38.17 <span class="token assign-left variable">http_port</span><span class="token operator">=</span><span class="token number">817</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>www
<span class="token number">192.168</span>.38.27 <span class="token assign-left variable">http_port</span><span class="token operator">=</span><span class="token number">827</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>web

\u8C03\u7528\u53D8\u91CF
ansible appsrvs <span class="token parameter variable">-m</span> <span class="token function">hostname</span> -a<span class="token string">&#39;name={{name}}&#39;</span>  \u66F4\u6539\u4E3B\u673A\u540D\u4E3A\u5404\u81EA\u88AB\u5B9A\u4E49\u7684\u53D8\u91CF 

\u9488\u5BF9\u4E00\u7EC4\u8BBE\u7F6E\u53D8\u91CF
<span class="token punctuation">[</span>appsrvs:vars<span class="token punctuation">]</span>
<span class="token assign-left variable">make</span><span class="token operator">=</span><span class="token string">&quot;-&quot;</span>

ansible appsrvs <span class="token parameter variable">-m</span> <span class="token function">hostname</span> <span class="token parameter variable">-a</span> <span class="token string">&#39;name={{name}}{{mark}}{{http_port}}&#39;</span>  ansible\u8C03\u7528\u53D8\u91CF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C06\u53D8\u91CF\u5199\u8FDB\u5355\u72EC\u7684\u914D\u7F6E\u6587\u4EF6\u4E2D\u5F15\u7528</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim vars.yaml </span>
<span class="token key atrule">pack</span><span class="token punctuation">:</span> vsftpd 
<span class="token key atrule">service</span><span class="token punctuation">:</span> vsftpd 

\u5F15\u7528\u53D8\u91CF
<span class="token key atrule">vars_files</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> vars.yaml 

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u4F7F\u7528vars\u53D8\u91CF\u5B89\u88C5\u548C\u542F\u52A8httpd" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528vars\u53D8\u91CF\u5B89\u88C5\u548C\u542F\u52A8httpd" aria-hidden="true">#</a> \u4F7F\u7528vars\u53D8\u91CF\u5B89\u88C5\u548C\u542F\u52A8httpd</h3><ul><li><strong>\u6267\u884C\u547D\u4EE4\u7684\u65F6\u5019\u8D4B\u503C\u53D8\u91CF</strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim playbook.yaml </span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install httpd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> pkname <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> pkname <span class="token punctuation">}</span><span class="token punctuation">}</span> state=started enabled=yes

<span class="token comment">#\u4F7F\u7528\u6267\u884C\u547D\u4EE4\u7684\u65F6\u5019\u7ED9\u53D8\u91CF\u8D4B\u503C</span>
<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible-playbook  -e  &#39;pkname=httpd&#39; playbook.yaml  </span>

PLAY <span class="token punctuation">[</span>server<span class="token punctuation">]</span> <span class="token important">*****************************************************************************************************************</span>

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> <span class="token important">********************************************************************************************************</span>
<span class="token key atrule">ok</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.112<span class="token punctuation">]</span>
<span class="token key atrule">ok</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.113<span class="token punctuation">]</span>
<span class="token key atrule">ok</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.110<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>Install httpd<span class="token punctuation">]</span> <span class="token important">**********************************************************************************************************</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.110<span class="token punctuation">]</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.112<span class="token punctuation">]</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.113<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>start service<span class="token punctuation">]</span> <span class="token important">**********************************************************************************************************</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.112<span class="token punctuation">]</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.113<span class="token punctuation">]</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.110<span class="token punctuation">]</span>

PLAY RECAP <span class="token important">********************************************************************************************************************</span>
<span class="token key atrule">192.168.1.110</span>              <span class="token punctuation">:</span> ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
<span class="token key atrule">192.168.1.112</span>              <span class="token punctuation">:</span> ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
<span class="token key atrule">192.168.1.113</span>              <span class="token punctuation">:</span> ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong><code>\u901A\u8FC7vars.yaml\u6307\u5B9A\u4E00\u4E2A\u53D8\u91CF\u6587\u4EF6</code></strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim vars.yaml </span>
<span class="token key atrule">pkname1</span><span class="token punctuation">:</span> httpd
<span class="token key atrule">pkname2</span><span class="token punctuation">:</span> vim

<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim playbook.yaml </span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars_files</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> vars.yaml 
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install httpd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> pkname1 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span> <span class="token punctuation">{</span>pkname1<span class="token punctuation">}</span> <span class="token punctuation">}</span> state=started enabled=yes
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install vim
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> pkname2 <span class="token punctuation">}</span><span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong><code>\u76F4\u63A5\u5728playbooke\u7684\u91CC\u9762\u5B9A\u4E49\u53D8\u91CF</code></strong></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim playbook.yaml </span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">pkname1</span><span class="token punctuation">:</span> httpd
    <span class="token punctuation">-</span> <span class="token key atrule">pkname2</span><span class="token punctuation">:</span> vim
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install httpd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> pkname1 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> pkname1 <span class="token punctuation">}</span><span class="token punctuation">}</span> state=started enabled=yes
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install vim
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> pkname2 <span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible-playbook playbook.yaml  </span>

PLAY <span class="token punctuation">[</span>server<span class="token punctuation">]</span> <span class="token important">*****************************************************************************************************************</span>

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> <span class="token important">********************************************************************************************************</span>
<span class="token key atrule">ok</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.113<span class="token punctuation">]</span>
<span class="token key atrule">ok</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.112<span class="token punctuation">]</span>
<span class="token key atrule">ok</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.110<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>Install httpd<span class="token punctuation">]</span> <span class="token important">**********************************************************************************************************</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.110<span class="token punctuation">]</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.112<span class="token punctuation">]</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.113<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>start service<span class="token punctuation">]</span> <span class="token important">**********************************************************************************************************</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.112<span class="token punctuation">]</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.113<span class="token punctuation">]</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.110<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>Install vim<span class="token punctuation">]</span> <span class="token important">************************************************************************************************************</span>
<span class="token key atrule">ok</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.110<span class="token punctuation">]</span>
<span class="token key atrule">ok</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.112<span class="token punctuation">]</span>
<span class="token key atrule">ok</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.113<span class="token punctuation">]</span>

PLAY RECAP <span class="token important">********************************************************************************************************************</span>
<span class="token key atrule">192.168.1.110</span>              <span class="token punctuation">:</span> ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
<span class="token key atrule">192.168.1.112</span>              <span class="token punctuation">:</span> ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
<span class="token key atrule">192.168.1.113</span>              <span class="token punctuation">:</span> ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong><code>\u901A\u8FC7\u4FEE\u6539\u4E3B\u673A\u6E05\u5355\u7684\u53D8\u91CF</code></strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim /etc/ansible/hosts </span>
<span class="token punctuation">[</span>server<span class="token punctuation">]</span>

<span class="token number">192.168</span>.1.110 <span class="token assign-left variable">http_port</span><span class="token operator">=</span><span class="token number">81</span>
<span class="token number">192.168</span>.1.112 <span class="token assign-left variable">http_port</span><span class="token operator">=</span><span class="token number">82</span>

<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim hostname.yaml </span>
---
- hosts: server
  remote_user: root
  tasks:
    - name: <span class="token function">hostname</span>
      hostname: <span class="token assign-left variable">name</span><span class="token operator">=</span>www<span class="token punctuation">{</span><span class="token punctuation">{</span>http_port<span class="token punctuation">}</span><span class="token punctuation">}</span>.magedu.com

<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible-playbook  hostname.yaml </span>
PLAY <span class="token punctuation">[</span>server<span class="token punctuation">]</span> *****************************************************************************************************************

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> ********************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.112<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>hostname<span class="token punctuation">]</span> ***************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.112<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span>

PLAY RECAP ********************************************************************************************************************
<span class="token number">192.168</span>.1.110              <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
<span class="token number">192.168</span>.1.112              <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   

<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible all -m shell -a &quot;hostname&quot;</span>
<span class="token number">192.168</span>.1.110 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
www81.magedu.com
<span class="token number">192.168</span>.1.112 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
www82.magedu.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim /etc/ansible/hosts </span>
<span class="token punctuation">[</span>server<span class="token punctuation">]</span>

<span class="token number">192.168</span>.1.110 <span class="token assign-left variable">http_port</span><span class="token operator">=</span><span class="token number">81</span>
<span class="token number">192.168</span>.1.112 <span class="token assign-left variable">http_port</span><span class="token operator">=</span><span class="token number">82</span>

<span class="token punctuation">[</span>server:vars<span class="token punctuation">]</span>
<span class="token assign-left variable">nodename</span><span class="token operator">=</span>www
<span class="token assign-left variable">domainname</span><span class="token operator">=</span>magedu.com

<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim hostname.yaml  </span>
---
- hosts: server
  remote_user: root

  tasks:
    - name: <span class="token function">hostname</span>
      hostname: <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>nodename<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">{</span>http_port<span class="token punctuation">}</span><span class="token punctuation">}</span>.<span class="token punctuation">{</span><span class="token punctuation">{</span>domainname<span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible</span>
ansible             ansible-connection  ansible-doc         ansible-inventory   ansible-pull        
ansible-config      ansible-console     ansible-galaxy      ansible-playbook    ansible-vault       

<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible-playbook hostname.yaml  </span>
PLAY <span class="token punctuation">[</span>server<span class="token punctuation">]</span> *************************************************************************************************************************************

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> ****************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.112<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>hostname<span class="token punctuation">]</span> ***********************************************************************************************************************************
changed: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.112<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span>

PLAY RECAP ****************************************************************************************************************************************
<span class="token number">192.168</span>.1.110              <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
<span class="token number">192.168</span>.1.112              <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="invertory\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#invertory\u53C2\u6570" aria-hidden="true">#</a> <strong>invertory\u53C2\u6570</strong></h3><p>invertory\u53C2\u6570\uFF1A\u7528\u4E8E\u5B9A\u4E49ansible\u8FDC\u7A0B\u8FDE\u63A5\u76EE\u6807\u4E3B\u673A\u65F6\u4F7F\u7528\u7684\u53C2\u6570\uFF0C\u800C\u975E\u4F20\u9012\u7ED9playbook\u7684\u53D8\u91CF</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>    ansible_ssh_host
    ansible_ssh_port
    ansible_ssh_user
    ansible_ssh_pass
    ansbile_sudo_pass

\u793A\u4F8B\uFF1A
    <span class="token function">cat</span> /etc/ansible/hosts
    <span class="token punctuation">[</span>websrvs<span class="token punctuation">]</span>
    <span class="token number">192.168</span>.0.1 <span class="token assign-left variable">ansible_ssh_user</span><span class="token operator">=</span>root <span class="token assign-left variable">ansible_ssh_pass</span><span class="token operator">=</span>magedu
    <span class="token number">192.168</span>.0.2 <span class="token assign-left variable">ansible_ssh_user</span><span class="token operator">=</span>root <span class="token assign-left variable">ansible_ssh_pass</span><span class="token operator">=</span>magedu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>invertory\u53C2\u6570</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>inventory\u53C2\u6570
ansible\u57FA\u4E8Essh\u8FDE\u63A5inventory\u4E2D\u6307\u5B9A\u7684\u8FDC\u7A0B\u4E3B\u673A\u65F6\uFF0C\u8FD8\u53EF\u4EE5\u901A\u8FC7\u53C2\u6570\u6307\u5B9A\u5176\u4EA4\u4E92\u65B9\u5F0F\uFF1B
\u8FD9\u4E9B\u53C2\u6570\u5982\u4E0B\u6240\u793A\uFF1A
ansible_ssh_host
The name of the <span class="token function">host</span> to connect to, <span class="token keyword">if</span> different from the <span class="token builtin class-name">alias</span> you wishto give to it.

ansible_ssh_port
The <span class="token function">ssh</span> port number, <span class="token keyword">if</span> not <span class="token number">22</span>

ansible_ssh_user
The default <span class="token function">ssh</span> user name to use.

ansible_ssh_pass
The <span class="token function">ssh</span> password to use <span class="token punctuation">(</span>this is insecure, we strongly recommendusing --ask-pass or SSH keys<span class="token punctuation">)</span>

ansible_sudo_pass
The <span class="token function">sudo</span> password to use <span class="token punctuation">(</span>this is insecure, we strongly recommendusing --ask-sudo-pass<span class="token punctuation">)</span>

ansible_connection
Connection <span class="token builtin class-name">type</span> of the host. Candidates are local, <span class="token function">ssh</span> or paramiko.
The default is paramiko before Ansible <span class="token number">1.2</span>, and <span class="token string">&#39;smart&#39;</span> afterwards <span class="token function">which</span>
detects whether usage of <span class="token string">&#39;ssh&#39;</span> would be feasible based on whether
ControlPersist is supported.

ansible_ssh_private_key_file
Private key <span class="token function">file</span> used by ssh. Useful <span class="token keyword">if</span> using multiple keys and you don<span class="token string">&#39;t want to use SSH agent.

ansible_shell_type
The shell type of the target system. By default commands are formatted
using &#39;</span><span class="token function">sh</span><span class="token string">&#39;-style syntax by default. Setting this to &#39;</span>csh<span class="token string">&#39; or &#39;</span>fish<span class="token string">&#39; will cause
commands executed on target systems to follow those shell&#39;</span>s syntax instead.

ansible_python_interpreter
The target <span class="token function">host</span> python path. This is useful <span class="token keyword">for</span> systems with <span class="token function">more</span>
than one Python or not located at <span class="token string">&quot;/usr/bin/python&quot;</span> such as <span class="token punctuation">\\</span>*BSD, or where /usr/bin/python

is not a <span class="token number">2</span>.X series Python. We <span class="token keyword">do</span> not use the <span class="token string">&quot;/usr/bin/env&quot;</span> mechanism as that requires the remote user&#39;s

path to be <span class="token builtin class-name">set</span> right and also assumes the <span class="token string">&quot;python&quot;</span> executable is named python,where the executable might

be named something like <span class="token string">&quot;python26&quot;</span><span class="token builtin class-name">.</span>
ansible<span class="token punctuation">\\</span>_<span class="token punctuation">\\</span>*<span class="token punctuation">\\</span>_interpreter

Works <span class="token keyword">for</span> anything such as ruby or perl and works just like ansible_python_interpreter.

This replaces shebang of modules <span class="token function">which</span> will run on that host.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6A21\u677Ftemplates" tabindex="-1"><a class="header-anchor" href="#\u6A21\u677Ftemplates" aria-hidden="true">#</a> <strong>\u6A21\u677Ftemplates</strong></h3><h3 id="jinja2\u7684\u8BED\u6CD5" tabindex="-1"><a class="header-anchor" href="#jinja2\u7684\u8BED\u6CD5" aria-hidden="true">#</a> jinja2\u7684\u8BED\u6CD5</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u6587\u672C\u6587\u4EF6\uFF0C\u5D4C\u5957\u6709\u811A\u672C\uFF08\u4F7F\u7528\u6A21\u677F\u7F16\u7A0B\u8BED\u8A00\u7F16\u5199\uFF09 \u501F\u52A9\u6A21\u677F\u751F\u6210\u771F\u6B63\u7684\u6587\u4EF6
Jinja2\u8BED\u8A00\uFF0C\u4F7F\u7528\u5B57\u9762\u91CF\uFF0C\u6709\u4E0B\u9762\u5F62\u5F0F
    \u5B57\u7B26\u4E32\uFF1A\u4F7F\u7528\u5355\u5F15\u53F7\u6216\u53CC\u5F15\u53F7
    \u6570\u5B57\uFF1A\u6574\u6570\uFF0C\u6D6E\u70B9\u6570
    \u5217\u8868\uFF1A<span class="token punctuation">[</span>item1, item2, <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
    \u5143\u7EC4\uFF1A<span class="token punctuation">(</span>item1, item2, <span class="token punctuation">..</span>.<span class="token punctuation">)</span>
    \u5B57\u5178\uFF1A<span class="token punctuation">{</span>key1:value1, key2:value2, <span class="token punctuation">..</span>.<span class="token punctuation">}</span>
    \u5E03\u5C14\u578B\uFF1Atrue/false
\u7B97\u672F\u8FD0\u7B97\uFF1A+, -, *, /, //, %, **
\u6BD4\u8F83\u64CD\u4F5C\uFF1A<span class="token operator">==</span>, <span class="token operator">!=</span>, <span class="token operator">&gt;</span>, <span class="token operator">&gt;=</span>, <span class="token operator">&lt;</span>, <span class="token operator">&lt;=</span>
\u903B\u8F91\u8FD0\u7B97\uFF1Aand\uFF0Cor\uFF0Cnot
\u6D41\u8868\u8FBE\u5F0F\uFF1AFor\uFF0CIf\uFF0CWhen
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Jinja2\u76F8\u5173</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u5B57\u9762\u91CF
    <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> \u8868\u8FBE\u5F0F\u6700\u7B80\u5355\u7684\u5F62\u5F0F\u5C31\u662F\u5B57\u9762\u91CF\u3002\u5B57\u9762\u91CF\u8868\u793A\u8BF8\u5982\u5B57\u7B26\u4E32\u548C\u6570\u503C\u7684 Python\u5BF9\u8C61\u3002\u5982\u201CHello World\u201D
    \u53CC\u5F15\u53F7\u6216\u5355\u5F15\u53F7\u4E2D\u95F4\u7684\u4E00\u5207\u90FD\u662F\u5B57\u7B26\u4E32\u3002
    <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> \u65E0\u8BBA\u4F55\u65F6\u4F60\u9700\u8981\u5728\u6A21\u677F\u4E2D\u4F7F\u7528\u4E00\u4E2A\u5B57\u7B26\u4E32\uFF08\u6BD4\u5982\u51FD\u6570\u8C03\u7528\u3001\u8FC7\u6EE4\u5668\u6216\u53EA\u662F\u5305\u542B\u6216\u7EE7\u627F\u4E00\u4E2A\u6A21\u677F\u7684\u53C2\u6570\uFF09\uFF0C\u59824242.23
    <span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span> \u6570\u503C\u53EF\u4EE5\u4E3A\u6574\u6570\u548C\u6D6E\u70B9\u6570\u3002\u5982\u679C\u6709\u5C0F\u6570\u70B9\uFF0C\u5219\u4E3A\u6D6E\u70B9\u6570\uFF0C\u5426\u5219\u4E3A\u6574\u6570\u3002\u5728Python \u91CC\uFF0C <span class="token number">42</span> \u548C <span class="token number">42.0</span> \u662F\u4E0D\u4E00\u6837\u7684
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Jinja2:\u7B97\u672F\u8FD0\u7B97</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u7B97\u672F\u8FD0\u7B97
Jinja \u5141\u8BB8\u4F60\u7528\u8BA1\u7B97\u503C\u3002\u8FD9\u5728\u6A21\u677F\u4E2D\u5F88\u5C11\u7528\u5230\uFF0C\u4F46\u4E3A\u4E86\u5B8C\u6574\u6027\u5141\u8BB8\u5176\u5B58\u5728
\u652F\u6301\u4E0B\u9762\u7684\u8FD0\u7B97\u7B26
    +\uFF1A\u628A\u4E24\u4E2A\u5BF9\u8C61\u52A0\u5230\u4E00\u8D77\u3002
       \u901A\u5E38\u5BF9\u8C61\u662F\u7D20\u8D28\uFF0C\u4F46\u662F\u5982\u679C\u4E24\u8005\u662F\u5B57\u7B26\u4E32\u6216\u5217\u8868\uFF0C\u4F60\u53EF\u4EE5\u7528\u8FD9 \u79CD\u65B9\u5F0F\u6765\u8854\u63A5\u5B83\u4EEC\u3002
       \u65E0\u8BBA\u5982\u4F55\u8FD9\u4E0D\u662F\u9996\u9009\u7684\u8FDE\u63A5\u5B57\u7B26\u4E32\u7684\u65B9\u5F0F\uFF01\u8FDE\u63A5\u5B57\u7B26\u4E32\u89C1 ~ \u8FD0\u7B97\u7B26\u3002 {{ 1 + 1 }} \u7B49\u4E8E 2
    -\uFF1A\u7528\u7B2C\u4E00\u4E2A\u6570\u51CF\u53BB\u7B2C\u4E8C\u4E2A\u6570\u3002 {{ 3 - 2 }} \u7B49\u4E8E 1
    /\uFF1A\u5BF9\u4E24\u4E2A\u6570\u505A\u9664\u6CD5\u3002\u8FD4\u56DE\u503C\u4F1A\u662F\u4E00\u4E2A\u6D6E\u70B9\u6570\u3002 {{ 1 / 2 }} \u7B49\u4E8E {{ 0.5 }}
    //\uFF1A\u5BF9\u4E24\u4E2A\u6570\u505A\u9664\u6CD5\uFF0C\u8FD4\u56DE\u6574\u6570\u5546\u3002 {{ 20 // 7 }} \u7B49\u4E8E 2
    %\uFF1A\u8BA1\u7B97\u6574\u6570\u9664\u6CD5\u7684\u4F59\u6570\u3002 {{ 11 % 7 }} \u7B49\u4E8E 4
    *\uFF1A\u7528\u53F3\u8FB9\u7684\u6570\u4E58\u5DE6\u8FB9\u7684\u64CD\u4F5C\u6570\u3002 {{ 2 * 2 }} \u4F1A\u8FD4\u56DE 4 \u3002
       \u4E5F\u53EF\u4EE5\u7528\u4E8E\u91CD \u590D\u4E00\u4E2A\u5B57\u7B26\u4E32\u591A\u6B21\u3002{{ \u2018=\u2019 * 80 }} \u4F1A\u6253\u5370 80 \u4E2A\u7B49\u53F7\u7684\u6A2A\u6761
    **\uFF1A\u53D6\u5DE6\u64CD\u4F5C\u6570\u7684\u53F3\u64CD\u4F5C\u6570\u6B21\u5E42\u3002 {{ 2**3 }} \u4F1A\u8FD4\u56DE 8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jinja2\u7684\u57FA\u672C\u7528\u6CD5" tabindex="-1"><a class="header-anchor" href="#jinja2\u7684\u57FA\u672C\u7528\u6CD5" aria-hidden="true">#</a> Jinja2\u7684\u57FA\u672C\u7528\u6CD5</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u6BD4\u8F83\u64CD\u4F5C\u7B26
== \u6BD4\u8F83\u4E24\u4E2A\u5BF9\u8C61\u662F\u5426\u76F8\u7B49
!= \u6BD4\u8F83\u4E24\u4E2A\u5BF9\u8C61\u662F\u5426\u4E0D\u7B49
&gt; \u5982\u679C\u5DE6\u8FB9\u5927\u4E8E\u53F3\u8FB9\uFF0C\u8FD4\u56DE true
&gt;= \u5982\u679C\u5DE6\u8FB9\u5927\u4E8E\u7B49\u4E8E\u53F3\u8FB9\uFF0C\u8FD4\u56DE true
&lt; \u5982\u679C\u5DE6\u8FB9\u5C0F\u4E8E\u53F3\u8FB9\uFF0C\u8FD4\u56DE true
&lt;= \u5982\u679C\u5DE6\u8FB9\u5C0F\u4E8E\u7B49\u4E8E\u53F3\u8FB9\uFF0C\u8FD4\u56DE true

\u903B\u8F91\u8FD0\u7B97\u7B26
\u5BF9\u4E8E if \u8BED\u53E5\uFF0C\u5728 for \u8FC7\u6EE4\u6216 if \u8868\u8FBE\u5F0F\u4E2D\uFF0C\u5B83\u53EF\u4EE5\u7528\u4E8E\u8054\u5408\u591A\u4E2A\u8868\u8FBE\u5F0F
and
    \u5982\u679C\u5DE6\u64CD\u4F5C\u6570\u548C\u53F3\u64CD\u4F5C\u6570\u540C\u4E3A\u771F\uFF0C\u8FD4\u56DE true
or
    \u5982\u679C\u5DE6\u64CD\u4F5C\u6570\u548C\u53F3\u64CD\u4F5C\u6570\u6709\u4E00\u4E2A\u4E3A\u771F\uFF0C\u8FD4\u56DE true
not
    \u5BF9\u4E00\u4E2A\u8868\u8FBE\u5F0F\u53D6\u53CD\uFF08\u89C1\u4E0B\uFF09
(expr)
    \u8868\u8FBE\u5F0F\u7EC4

[&#39;list&#39;, &#39;of&#39;, &#39;objects&#39;]:
\u4E00\u5BF9\u4E2D\u62EC\u53F7\u62EC\u8D77\u6765\u7684\u4E1C\u897F\u662F\u4E00\u4E2A\u5217\u8868\u3002\u5217\u8868\u7528\u4E8E\u5B58\u50A8\u548C\u8FED\u4EE3\u5E8F\u5217\u5316\u7684\u6570\u636E\u3002
\u4F8B\u5982 \u4F60\u53EF\u4EE5\u5BB9\u6613\u5730\u5728 for\u5FAA\u73AF\u4E2D\u7528\u5217\u8868\u548C\u5143\u7EC4\u521B\u5EFA\u4E00\u4E2A\u94FE\u63A5\u7684\u5217\u8868
    &lt;ul&gt;
    {% for href, caption in [(&#39;index.html&#39;, &#39;Index&#39;), (&#39;about.html&#39;, &#39;About&#39;), (&#39;downloads.html&#39;,
&#39;Downloads&#39;)] %}
        &lt;li&gt;&lt;a href=&quot;{{ href }}&quot;&gt;{{ caption }}&lt;/a&gt;&lt;/li&gt;
    {% endfor %}
    &lt;/ul&gt;
    (&#39;tuple&#39;, &#39;of&#39;, &#39;values&#39;):

\u5143\u7EC4\u4E0E\u5217\u8868\u7C7B\u4F3C\uFF0C\u53EA\u662F\u4F60\u4E0D\u80FD\u4FEE\u6539\u5143\u7EC4\u3002
\u5982\u679C\u5143\u7EC4\u4E2D\u53EA\u6709\u4E00\u4E2A\u9879\uFF0C\u4F60\u9700\u8981\u4EE5\u9017\u53F7\u7ED3\u5C3E\u5B83\u3002
\u5143\u7EC4\u901A\u5E38\u7528\u4E8E\u8868\u793A\u4E24\u4E2A\u6216\u66F4\u591A\u5143\u7D20\u7684\u9879\u3002\u66F4\u591A\u7EC6\u8282\u89C1\u4E0A\u9762\u7684\u4F8B\u5B50
    {&#39;dict&#39;: &#39;of&#39;, &#39;key&#39;: &#39;and&#39;, &#39;value&#39;: &#39;pairs&#39;}:

Python \u4E2D\u7684\u5B57\u5178\u662F\u4E00\u79CD\u5173\u8054\u952E\u548C\u503C\u7684\u7ED3\u6784\u3002
\u952E\u5FC5\u987B\u662F\u552F\u4E00\u7684\uFF0C\u5E76\u4E14\u952E\u5FC5\u987B\u53EA\u6709\u4E00\u4E2A \u503C\u3002
\u5B57\u5178\u5728\u6A21\u677F\u4E2D\u5F88\u5C11\u4F7F\u7528\uFF0C\u7F55\u7528\u4E8E\u8BF8\u5982 xmlattr() \u8FC7\u6EE4\u5668\u4E4B\u7C7B
    true / false:
    true \u6C38\u8FDC\u662F true \uFF0C\u800C false \u59CB\u7EC8\u662F false
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="template-\u7684\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#template-\u7684\u4F7F\u7528" aria-hidden="true">#</a> <strong>template \u7684\u4F7F\u7528</strong></h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>template\u529F\u80FD\uFF1A\u6839\u636E\u6A21\u5757\u6587\u4EF6\u52A8\u6001\u751F\u6210\u5BF9\u5E94\u7684\u914D\u7F6E\u6587\u4EF6
   <span class="token operator">&gt;</span> template\u6587\u4EF6\u5FC5\u987B\u5B58\u653E\u4E8Etemplates\u76EE\u5F55\u4E0B\uFF0C\u4E14\u547D\u540D\u4E3A .j2 \u7ED3\u5C3E
   <span class="token operator">&gt;</span> yaml/yml \u6587\u4EF6\u9700\u548Ctemplates\u76EE\u5F55\u5E73\u7EA7\uFF0C\u76EE\u5F55\u7ED3\u6784\u5982\u4E0B\uFF1A
    ./
     \u251C\u2500\u2500 temnginx.yml
     \u2514\u2500\u2500 templates
        \u2514\u2500\u2500 nginx.conf.j2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>template\u793A\u4F8B</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>\u793A\u4F8B\uFF1A\u5229\u7528template \u540C\u6B65nginx\u914D\u7F6E\u6587\u4EF6
\u51C6\u5907templates/nginx.conf.j2\u6587\u4EF6
<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim playbook.yaml  </span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars_files</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> vars.yaml
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install httpd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> pkname1 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy templatest
      <span class="token key atrule">template</span><span class="token punctuation">:</span> src=nginx.conf.j2 dest=/etc/nginx/nginx.conf 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> pkname1 <span class="token punctuation">}</span><span class="token punctuation">}</span> state=started enabled=yes
      
<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible-playbook  playbook.yaml  </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>template\u7684j2\u6587\u4EF6\u7684\u53D8\u91CF\u66FF\u6362</code></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim templates/nginx.conf.j2 </span>
<span class="token comment"># For more information on configuration, see:</span>
<span class="token comment">#   * Official English Documentation: http://nginx.org/en/docs/</span>
<span class="token comment">#   * Official Russian Documentation: http://nginx.org/ru/docs/</span>

user nginx<span class="token punctuation">;</span>
worker_processes <span class="token punctuation">{</span><span class="token punctuation">{</span>ansible_processor_vcpus**2 <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>    <span class="token comment">#\u8BBE\u7F6Eauto\u6539\u6210ansible_processor_vcpus**2 16\u7EBF\u7A0B Playbook\u4E2Dtemplate\u7B97\u672F\u8FD0\u7B97</span>
error_log /var/log/nginx/error.log<span class="token punctuation">;</span>
pid /run/nginx.pid<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>playbook\u7684j2\u66FF\u6362\u548Chandlers\u4F7F\u7528</code></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment">#  vim playbook.yaml  </span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars_files</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> vars.yaml
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install httpd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> pkname1 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy templatest
      <span class="token key atrule">template</span><span class="token punctuation">:</span> src=nginx.conf.j2 dest=/etc/nginx/nginx.conf
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> restart nginx
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> pkname1 <span class="token punctuation">}</span><span class="token punctuation">}</span> state=started enabled=yes

  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restart nginx
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx state=restarted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>\u6267\u884Cplaybook\u7684\u7ED3\u679C</code></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible-playbook playbook.yaml  </span>

PLAY <span class="token punctuation">[</span>server<span class="token punctuation">]</span> *****************************************************************************************************************************************

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> *****************************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.112<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>Install httpd<span class="token punctuation">]</span> *****************************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.112<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>copy templatest<span class="token punctuation">]</span> *****************************************************************************************************************************************
changed: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.112<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>start service<span class="token punctuation">]</span> *****************************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span>
ok: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.112<span class="token punctuation">]</span>

RUNNING HANDLER <span class="token punctuation">[</span>restart nginx<span class="token punctuation">]</span> *****************************************************************************************************************************************
changed: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.110<span class="token punctuation">]</span>
changed: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.112<span class="token punctuation">]</span>

PLAY RECAP *****************************************************************************************************************************************
<span class="token number">192.168</span>.1.110              <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">5</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
<span class="token number">192.168</span>.1.112              <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">5</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="playbook\u4E2D\u4F7F\u7528when" tabindex="-1"><a class="header-anchor" href="#playbook\u4E2D\u4F7F\u7528when" aria-hidden="true">#</a> <strong>Playbook\u4E2D\u4F7F\u7528when</strong></h3><p>\u6761\u4EF6\u6D4B\u8BD5:\u5982\u679C\u9700\u8981\u6839\u636E\u53D8\u91CF\u3001facts\u6216\u6B64\u524D\u4EFB\u52A1\u7684\u6267\u884C\u7ED3\u679C\u6765\u505A\u4E3A\u67D0task\u6267\u884C\u4E0E\u5426\u7684\u524D\u63D0\u65F6\u8981\u7528\u5230\u6761\u4EF6\u6D4B\u8BD5,\u901A\u8FC7when\u8BED\u53E5\u5B9E\u73B0\uFF0C\u5728task\u4E2D\u4F7F\u7528\uFF0Cjinja2\u7684\u8BED\u6CD5\u683C\u5F0F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>when\u8BED\u53E5
    \u5728task\u540E\u6DFB\u52A0when\u5B50\u53E5\u5373\u53EF\u4F7F\u7528\u6761\u4EF6\u6D4B\u8BD5\uFF1Bwhen\u8BED\u53E5\u652F\u6301Jinja2\u8868\u8FBE\u5F0F\u8BED\u6CD5
\u793A\u4F8B\uFF1A
tasks:
  - name: <span class="token string">&quot;shutdown RedHat flavored systems&quot;</span>
    command: /sbin/shutdown <span class="token parameter variable">-h</span> now
    when: ansible_os_family <span class="token operator">==</span> <span class="token string">&quot;RedHat&quot;</span>  \u5F53\u7CFB\u7EDF\u5C5E\u4E8E\u7EA2\u5E3D\u7CFB\u5217,\u6267\u884Ccommand\u6A21\u5757 
 
when\u8BED\u53E5\u4E2D\u8FD8\u53EF\u4EE5\u4F7F\u7528Jinja2\u7684\u5927\u591A<span class="token string">&quot;filter&quot;</span>\uFF0C
\u4F8B\u5982\u8981\u5FFD\u7565\u6B64\u524D\u67D0\u8BED\u53E5\u7684\u9519\u8BEF\u5E76\u57FA\u4E8E\u5176\u7ED3\u679C<span class="token punctuation">(</span>failed\u6216\u8005success<span class="token punctuation">)</span>\u8FD0\u884C\u540E\u9762\u6307\u5B9A\u7684\u8BED\u53E5\uFF0C
\u53EF\u4F7F\u7528\u7C7B\u4F3C\u5982\u4E0B\u5F62\u5F0F\uFF1A
tasks:
  - command: /bin/false
    register: result
    ignore_errors: True
  - command: /bin/something
    when: result<span class="token operator">|</span>failed
  - command: /bin/something_else
    when: result<span class="token operator">|</span>success
  - command: /bin/still/something_else
    when: result<span class="token operator">|</span>skipped

\u6B64\u5916\uFF0Cwhen\u8BED\u53E5\u4E2D\u8FD8\u53EF\u4EE5\u4F7F\u7528facts\u6216playbook\u4E2D\u5B9A\u4E49\u7684\u53D8\u91CF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u793A\u4F8B\uFF1Awhen\u6761\u4EF6\u5224\u65AD</p><ul><li>\u5229\u7528when\u7684\u6761\u4EF6\u5224\u65AD\uFF0C\u5224\u65AD\u53D8\u91CF\u4E3A\u4E3B\u673A\u540D\u7684\u5206\u522B\u5B89\u88C5httpd\u548C\u5B89\u88C5nginx</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim playbook.yaml  </span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install httpd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=httpd state=present
      <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_hostname == &quot;www81&quot;
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install nginx
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=nginx state=present
      <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_hostname == &quot;www82&quot;
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restart httpd
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=httpd state=started enabled=yes
      <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_hostname == &quot;www81&quot;
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restart nginx
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx state=started enabled=yes
      <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_hostname == &quot;www82&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u5229\u7528when\u5224\u65AD\u53D8\u91CF\u4E3B\u673A\u7248\u672C\u4E3A7\u6216\u80056\u7684\u8FDB\u884C\u66F4\u6539\u914D\u7F6E\u6587\u4EF6</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>\u793A\u4F8B\uFF1A
<span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install conf file to centos7
    <span class="token key atrule">template</span><span class="token punctuation">:</span> src=nginx.conf.c7.j2 dest=/etc/nginx/nginx.conf
    <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_distribution_major_version == &quot;7&quot;
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install conf file to centos6
    <span class="token key atrule">template</span><span class="token punctuation">:</span> src=nginx.conf.c6.j2 dest=/etc/nginx/nginx.conf
    <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_distribution_major_version == &quot;6&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u8FED\u4EE3-with-items\u3001loop" tabindex="-1"><a class="header-anchor" href="#\u8FED\u4EE3-with-items\u3001loop" aria-hidden="true">#</a> <strong>\u8FED\u4EE3\uFF1Awith_items\u3001loop</strong></h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u8FED\u4EE3\uFF1A\u5F53\u6709\u9700\u8981\u91CD\u590D\u6027\u6267\u884C\u7684\u4EFB\u52A1\u65F6\uFF0C\u53EF\u4EE5\u4F7F\u7528\u8FED\u4EE3\u673A\u5236
    &gt; \u5BF9\u8FED\u4EE3\u9879\u7684\u5F15\u7528\uFF0C\u56FA\u5B9A\u53D8\u91CF\u540D\u4E3A&quot;item&quot;
    &gt; \u8981\u5728task\u4E2D\u4F7F\u7528with_items\u7ED9\u5B9A\u8981\u8FED\u4EE3\u7684\u5143\u7D20\u5217\u8868
    &gt; \u5217\u8868\u683C\u5F0F\uFF1A
         \u5B57\u7B26\u4E32
         \u5B57\u5178
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u793A\u4F8B</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>\u793A\u4F8B\uFF1A \u521B\u5EFA\u7528\u6237
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add several users
  <span class="token key atrule">user</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present groups=wheel   <span class="token comment">#{{ item }} \u7CFB\u7EDF\u81EA\u5B9A\u4E49\u53D8\u91CF</span>
  <span class="token key atrule">with_items</span><span class="token punctuation">:</span>       <span class="token comment"># \u5B9A\u4E49{{ item }} \u7684\u503C\u548C\u4E2A\u6570</span>
    <span class="token punctuation">-</span> testuser1
    <span class="token punctuation">-</span> testuser2

\u4E0A\u9762\u8BED\u53E5\u7684\u529F\u80FD\u7B49\u540C\u4E8E\u4E0B\u9762\u7684\u8BED\u53E5\uFF1A
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add user testuser1
  <span class="token key atrule">user</span><span class="token punctuation">:</span> name=testuser1 state=present groups=wheel
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add user testuser2
  <span class="token key atrule">user</span><span class="token punctuation">:</span> name=testuser2 state=present groups=wheel
  
with_items\u4E2D\u53EF\u4EE5\u4F7F\u7528\u5143\u7D20\u8FD8\u53EF\u4E3Ahashes
\u793A\u4F8B\uFF1A
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add several users
  <span class="token key atrule">user</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item.name <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present groups=<span class="token punctuation">{</span><span class="token punctuation">{</span> item.groups <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;testuser1&#39;</span><span class="token punctuation">,</span> <span class="token key atrule">groups</span><span class="token punctuation">:</span> <span class="token string">&#39;wheel&#39;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;testuser2&#39;</span><span class="token punctuation">,</span> <span class="token key atrule">groups</span><span class="token punctuation">:</span> <span class="token string">&#39;root&#39;</span> <span class="token punctuation">}</span>

ansible\u7684\u5FAA\u73AF\u673A\u5236\u8FD8\u6709\u66F4\u591A\u7684\u9AD8\u7EA7\u529F\u80FD\uFF0C\u5177\u4F53\u8BF7\u53C2\u89C1\u5B98\u65B9\u6587\u6863
http<span class="token punctuation">:</span>//docs.ansible.com/playbooks_loops.html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u65E7\u5FAA\u73AF\u8BED\u53E5</p><p><code>\u5728Ansible 2.5\u4EE5\u524D\uFF0Cplaybook\u901A\u8FC7\u4E0D\u540C\u7684\u5FAA\u73AF\u8BED\u53E5\u4EE5\u5B9E\u73B0\u4E0D\u540C\u7684\u5FAA\u73AF\uFF0C\u8FD9\u4E9B\u8BED\u53E5\u4F7F\u7528with_\u4F5C\u4E3A\u524D\u7F00\u3002\u8FD9\u4E9B\u8BED\u6CD5\u76EE\u524D\u4ECD\u7136\u517C\u5BB9\uFF0C\u4F46\u5728\u672A\u6765\u7684\u67D0\u4E2A\u65F6\u95F4\u70B9\uFF0C\u4F1A\u9010\u6B65\u5E9F\u5F03\u3002</code></p><p>Playbook\u4F7F\u7528\u5FAA\u73AF\u8FED\u4EE3\u793A\u4F8B</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#ansible2.9.5 \u907F\u514D\u5FAA\u73AF\u91CD\u590D\u4F7F\u7528\u5EFA\u8BAE\u4F7F\u7528loop</span>
<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible --version </span>
ansible 2.9.25
  config file = /etc/ansible/ansible.cfg
  configured module search path = <span class="token punctuation">[</span><span class="token string">&#39;/root/.ansible/plugins/modules&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/usr/share/ansible/plugins/modules&#39;</span><span class="token punctuation">]</span>
  ansible python module location = /usr/lib/python3.6/site<span class="token punctuation">-</span>packages/ansible
  executable location = /usr/bin/ansible
  python version = 3.6.8 (default<span class="token punctuation">,</span> Dec  5 2019<span class="token punctuation">,</span> 15<span class="token punctuation">:</span>45<span class="token punctuation">:</span>45) <span class="token punctuation">[</span>GCC 8.3.1 20191121 (Red Hat 8.3.1<span class="token punctuation">-</span>5)<span class="token punctuation">]</span>

<span class="token comment">#with_items\u5FAA\u73AF</span>
<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim playbook.yaml  </span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add serverl users
      <span class="token key atrule">user</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present  <span class="token comment"># \u5B9A\u4E49{{ item }} \u7684\u53D8\u91CF</span>
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> testuser1111
        <span class="token punctuation">-</span> testuser2222
        
        
<span class="token comment">#loop\u5FAA\u73AF</span>
<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim playbook.yaml  </span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add serverl users
      <span class="token key atrule">user</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present   <span class="token comment"># \u5B9A\u4E49{{ item }} \u7684\u53D8\u91CF</span>
      <span class="token key atrule">loop</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> testuser1111
        <span class="token punctuation">-</span> testuser2222
        
 <span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible-playbook  playbook.yaml  </span>

PLAY <span class="token punctuation">[</span>server<span class="token punctuation">]</span> <span class="token important">*****************************************************************************************************************************************</span>

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> <span class="token important">*****************************************************************************************************************************************</span>
<span class="token key atrule">ok</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.112<span class="token punctuation">]</span>
<span class="token key atrule">ok</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.110<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>add serverl users<span class="token punctuation">]</span> <span class="token important">*****************************************************************************************************************************************</span>
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.110<span class="token punctuation">]</span> =<span class="token punctuation">&gt;</span> (item=testuser1111)
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.112<span class="token punctuation">]</span> =<span class="token punctuation">&gt;</span> (item=testuser1111)
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.110<span class="token punctuation">]</span> =<span class="token punctuation">&gt;</span> (item=testuser2222)
<span class="token key atrule">changed</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.112<span class="token punctuation">]</span> =<span class="token punctuation">&gt;</span> (item=testuser2222)

PLAY RECAP <span class="token important">*****************************************************************************************************************************************</span>
<span class="token key atrule">192.168.1.110</span>              <span class="token punctuation">:</span> ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
<span class="token key atrule">192.168.1.112</span>              <span class="token punctuation">:</span> ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>items\u8FED\u4EE3\u793A\u4F8B</p><p>\u5C06\u591A\u4E2A\u6587\u4EF6\u8FDB\u884Ccopy\u5230\u88AB\u63A7\u7AEF</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> testsrv
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  tasks
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Create rsyncd config
    <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> dest=/etc/<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> rsyncd.secrets
  <span class="token punctuation">-</span> rsyncd.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>items\u8FED\u4EE3\u793A\u4F8B</p><p>\u5B89\u88C5\u591A\u4E2A\u8F6F\u4EF6\u4F7F\u7528item\u8FED\u4EE3</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> websrvs
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> yum install httpd
     <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present
     <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> apr
       <span class="token punctuation">-</span> apr<span class="token punctuation">-</span>util
       <span class="token punctuation">-</span> httpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u8FED\u4EE3\u5D4C\u5957\u5B50\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#\u8FED\u4EE3\u5D4C\u5957\u5B50\u53D8\u91CF" aria-hidden="true">#</a> \u8FED\u4EE3\u5D4C\u5957\u5B50\u53D8\u91CF</h3><p>\u4F7F\u7528item\u5FAA\u73AF\u8FED\u4EE3\u521B\u5EFA\u7EC4\uFF0C\u518D\u4F7F\u7528\u5B50\u53D8\u91CF\u5C06\u521B\u5EFA\u7684\u7528\u6237\u52A0\u5165\u5230\u7EC4\u91CC\u9762\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim playbook.yaml </span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add some groups
      <span class="token key atrule">group</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token punctuation">}</span> state=present
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> group1
        <span class="token punctuation">-</span> group2
        <span class="token punctuation">-</span> group3
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add some users
      <span class="token key atrule">user</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span>item.name<span class="token punctuation">}</span><span class="token punctuation">}</span> group<span class="token punctuation">{</span><span class="token punctuation">{</span>item.group<span class="token punctuation">}</span><span class="token punctuation">}</span> state=present
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;user1&#39;</span><span class="token punctuation">,</span><span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">&#39;group1&#39;</span><span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;user2&#39;</span><span class="token punctuation">,</span><span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">&#39;group2&#39;</span><span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;user3&#39;</span><span class="token punctuation">,</span><span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">&#39;group3&#39;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="template-for-if-when\u5FAA\u73AF" tabindex="-1"><a class="header-anchor" href="#template-for-if-when\u5FAA\u73AF" aria-hidden="true">#</a> <strong>template for if when\u5FAA\u73AF</strong></h3><p>for\u5FAA\u73AF\u7B80\u5355\u5E94\u7528</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim testfor.yaml </span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token number">81</span>
      <span class="token punctuation">-</span> <span class="token number">83</span>
      <span class="token punctuation">-</span> <span class="token number">82</span>
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mkdir file
      <span class="token key atrule">file</span><span class="token punctuation">:</span> path=/data1 state=directory
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy conf
      <span class="token key atrule">template</span><span class="token punctuation">:</span> src=for1.conf.j2 dest=/data1/for1.conf
      
<span class="token comment"># \u81EA\u5B9A\u4E49templates</span>
<span class="token punctuation">[</span>root@linux<span class="token punctuation">-</span>node1 ansible<span class="token punctuation">]</span><span class="token comment"># cat templates/for1.conf.j2 </span>
<span class="token punctuation">{</span>% for port in ports %<span class="token punctuation">}</span>
server<span class="token punctuation">{</span>
        listen <span class="token punctuation">{</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">{</span>% endfor %<span class="token punctuation">}</span>

<span class="token comment">#\u548Cshellfor\u5FAA\u73AF\u7C7B\u4F3C</span>

<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible server -m shell -a &quot;cat /data1/*&quot;</span>
10.100.35.13 <span class="token punctuation">|</span> CHANGED <span class="token punctuation">|</span> rc=0 <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span>
server<span class="token punctuation">{</span>
	listen 81
<span class="token punctuation">}</span>
server<span class="token punctuation">{</span>
	listen 83
<span class="token punctuation">}</span>
server<span class="token punctuation">{</span>
	listen 82
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>\u5267\u672C\u4E2D\u662F\u5355\u4E2A\u952E\u503C\u5BF9</code></strong></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim testfor.yaml </span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">listen_port</span><span class="token punctuation">:</span> <span class="token number">81</span>
      <span class="token punctuation">-</span> <span class="token key atrule">listen_port</span><span class="token punctuation">:</span> <span class="token number">83</span>
      <span class="token punctuation">-</span> <span class="token key atrule">listen_port</span><span class="token punctuation">:</span> <span class="token number">82</span>
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mkdir file
      <span class="token key atrule">file</span><span class="token punctuation">:</span> path=/data1 state=directory
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy conf
      <span class="token key atrule">template</span><span class="token punctuation">:</span> src=for1.conf.j2 dest=/data1/for1.conf

<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim templates/for1.conf.j2 </span>
<span class="token punctuation">{</span>% for port in ports %<span class="token punctuation">}</span>
server<span class="token punctuation">{</span>
        listen <span class="token punctuation">{</span><span class="token punctuation">{</span>port.listen_port<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">{</span>% endfor  %<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>\u5267\u672C\u4E2D\u662F\u591A\u4E2A\u952E\u503C\u5BF9</code></strong></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim testfor.yaml </span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">web1</span><span class="token punctuation">:</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">81</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> www.zjy1.com
        <span class="token key atrule">rootdir</span><span class="token punctuation">:</span> /data1/zjy1
      <span class="token punctuation">-</span> <span class="token key atrule">web2</span><span class="token punctuation">:</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">82</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> www.zjy2.com
        <span class="token key atrule">rootdir</span><span class="token punctuation">:</span> /data1/zjy2
      <span class="token punctuation">-</span> <span class="token key atrule">web3</span><span class="token punctuation">:</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">83</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> www.zjy3.com
        <span class="token key atrule">rootdir</span><span class="token punctuation">:</span> /data1/zjy3
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mkdir file
      <span class="token key atrule">file</span><span class="token punctuation">:</span> path=/data1 state=directory
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy conf
      <span class="token key atrule">template</span><span class="token punctuation">:</span> src=for1.conf.j2 dest=/data1/for1.conf

<span class="token comment"># template\u81EA\u5B9A\u4E49\u591A\u4E2A\u503C</span>
<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim templates/for1.conf.j2 </span>
<span class="token punctuation">{</span>% for p in ports %<span class="token punctuation">}</span>
server<span class="token punctuation">{</span>
        listen <span class="token punctuation">{</span><span class="token punctuation">{</span>p.port<span class="token punctuation">}</span><span class="token punctuation">}</span>
        servername <span class="token punctuation">{</span><span class="token punctuation">{</span>p.name<span class="token punctuation">}</span><span class="token punctuation">}</span>
        documentroot<span class="token punctuation">{</span><span class="token punctuation">{</span>p.rootdir<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">{</span>% endfor  %<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>\u5267\u672C\u4E2D\u662F\u591A\u4E2A\u952E\u503C\u5BF9\u3002\u52A0if\u5224\u65AD(\u6BD4\u5982\u628Aname\u6CE8\u91CA\u6389)</code></strong></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># vim testfor.yaml </span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> server
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">web1</span><span class="token punctuation">:</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">81</span>
        <span class="token comment"># name: www.zjy1.com</span>
        <span class="token key atrule">rootdir</span><span class="token punctuation">:</span> /data1/zjy1
      <span class="token punctuation">-</span> <span class="token key atrule">web2</span><span class="token punctuation">:</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">82</span>
        <span class="token comment">#  name: www.zjy2.com</span>
        <span class="token key atrule">rootdir</span><span class="token punctuation">:</span> /data1/zjy2
      <span class="token punctuation">-</span> <span class="token key atrule">web3</span><span class="token punctuation">:</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">83</span>
        <span class="token comment"># name: www.zjy3.com</span>
        <span class="token key atrule">rootdir</span><span class="token punctuation">:</span> /data1/zjy3
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mkdir file
      <span class="token key atrule">file</span><span class="token punctuation">:</span> path=/data1 state=directory
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy conf
      <span class="token key atrule">template</span><span class="token punctuation">:</span> src=for1.conf.j2 dest=/data1/for1.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5224\u65AD\u81EA\u5B9A\u4E49templates\uFF0C\u52A0\u4E0Aif\u5224\u65AD\u8BED\u53E5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@linux-node1 ansible<span class="token punctuation">]</span><span class="token comment"># cat templates/for4.conf.j2 </span>
<span class="token punctuation">{</span>% <span class="token keyword">for</span> <span class="token for-or-select variable">p</span> <span class="token keyword">in</span> ports %<span class="token punctuation">}</span>
server<span class="token punctuation">{</span>
        listen <span class="token punctuation">{</span><span class="token punctuation">{</span> p.port <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span>% <span class="token keyword">if</span>  p.name is defined %<span class="token punctuation">}</span>
        servername <span class="token punctuation">{</span><span class="token punctuation">{</span> p.name <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span>% endif %<span class="token punctuation">}</span>
        documentroot <span class="token punctuation">{</span><span class="token punctuation">{</span> p.rootdir <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">{</span>% endfor %<span class="token punctuation">}</span>

<span class="token punctuation">[</span>root@ansible work<span class="token punctuation">]</span><span class="token comment"># ansible server -m shell -a &quot;cat /data1/*&quot;</span>
<span class="token number">10.100</span>.35.12 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
server<span class="token punctuation">{</span>
	listen <span class="token number">81</span>
	documentroot/data1/zjy1   <span class="token comment">#if\u7684\u5224\u65AD\u8BED\u53E5\u751F\u6548\u4E86</span>
<span class="token punctuation">}</span>
server<span class="token punctuation">{</span>
	listen <span class="token number">82</span>
	documentroot/data1/zjy2
<span class="token punctuation">}</span>
server<span class="token punctuation">{</span>
	listen <span class="token number">83</span>
	documentroot/data1/zjy3
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,118);function v(e,m){return p(),l("div",null,[c,n("ul",null,[u,n("li",null,[n("p",null,[r,a("\uFF1A\u53D8\u91CF\uFF0C\u53D8\u91CF\u66FF\u6362"+i(e.variable_name),1)])]),d]),k])}const y=t(o,[["render",v],["__file","3.html.vue"]]);export{y as default};
