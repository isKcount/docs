import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,f as e}from"./app.ca0279c0.js";const p={},c=e(`<h1 id="ceph\u90E8\u7F72-14-2-0-nautilus\u7248" tabindex="-1"><a class="header-anchor" href="#ceph\u90E8\u7F72-14-2-0-nautilus\u7248" aria-hidden="true">#</a> Ceph\u90E8\u7F72(14.2.0 nautilus\u7248)</h1><h2 id="ceph-\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#ceph-\u4ECB\u7ECD" aria-hidden="true">#</a> Ceph \u4ECB\u7ECD</h2><p>\u5728\u8FC7\u53BB\u51E0\u5E74\u4E2D\uFF0C\u6570\u636E\u5B58\u50A8\u9700\u6C42\u6025\u5267\u589E\u957F\u3002\u7814\u7A76\u8868\u660E\uFF0C\u5927\u578B\u7EC4\u7EC7\u4E2D\u7684\u6570\u636E\u6B63\u4EE5\u6BCF\u5E7440%\u523060%\u7684\u901F\u5EA6\u589E \u957F\uFF0C\u8BB8\u591A\u516C\u53F8\u6BCF\u5E74\u7684\u6570\u636E\u90FD\u7FFB\u4E86\u4E00\u756A\u3002\u56FD\u9645\u6570\u636E\u516C\u53F8(IDC)\u7684\u5206\u6790\u5E08\u4F30\u8BA1\uFF0C\u52302000\u5E74\uFF0C\u5168\u7403\u5171 \u6709 54.4 exabytes \u7684\u6570\u636E\u3002\u52302007\u5E74\uFF0C\u8FD9\u4E00\u6570\u5B57\u8FBE\u5230 295 \u827E\u5B57\u8282\uFF0C\u52302020\u5E74\uFF0C\u5168\u7403\u9884\u8BA1\u5C06 \u8FBE\u5230 44 zettabytes \u3002\u4F20\u7EDF\u7684\u5B58\u50A8\u7CFB\u7EDF\u65E0\u6CD5\u7BA1\u7406\u8FD9\u6837\u7684\u6570\u636E\u589E\u957F;\u6211\u4EEC\u9700\u8981\u4E00\u4E2A\u50CFCeph\u8FD9\u6837\u7684\u7CFB \u7EDF\uFF0C\u5B83\u662F \u5206\u5E03\u5F0F\u7684 \uFF0C \u53EF\u6269\u5C55\u7684 \uFF0C\u6700\u91CD\u8981\u7684\u662F\uFF0C\u5728\u7ECF\u6D4E\u4E0A\u662F\u53EF\u884C\u7684\u3002Ceph\u662F\u4E13\u95E8\u4E3A\u5904\u7406\u5F53\u4ECA \u548C \u672A\u6765\u7684\u6570\u636E\u5B58\u50A8 \u9700\u6C42\u800C\u8BBE\u8BA1\u7684\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1ZB=1024EB 1EB=1024PB 1PB=1024TB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="ceph\u5B89\u88C5-14-2-0-nautilus\u7248" tabindex="-1"><a class="header-anchor" href="#ceph\u5B89\u88C5-14-2-0-nautilus\u7248" aria-hidden="true">#</a> Ceph\u5B89\u88C5(14.2.0 nautilus\u7248)</h2><table><thead><tr><th>\u4E3B\u673A\u540D\u79F0</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>ceph1</td><td>192.168.0.20</td><td>OSD\uFF0CMGR\uFF0CMON</td><td>\u786C\u76D8*3\uFF08CentOS7.6\uFF09</td></tr><tr><td>ceph2</td><td>192.168.0.116</td><td>OSD\uFF0CMGR</td><td>\u786C\u76D8*3\uFF08CentOS7.6\uFF09</td></tr><tr><td>ceph3</td><td>192.168.0.140</td><td>OSD\uFF0CMGR</td><td>\u786C\u76D8*3\uFF08CentOS7.6\uFF09</td></tr></tbody></table><h3 id="_1-\u5B89\u88C5epel\u6E90" tabindex="-1"><a class="header-anchor" href="#_1-\u5B89\u88C5epel\u6E90" aria-hidden="true">#</a> 1.\u5B89\u88C5epel\u6E90</h3><p><code>//\u96C6\u7FA4\u6240\u6709\u8282\u70B9\u9009\u62E9\u4E00\u4E2A\u5B89\u88C5\u7248\u672C\u5373\u53EF</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum <span class="token function">install</span> epel-release <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> http://mirrors.aliyun.com/ceph/rpm-luminous/el7/noarch/ceph-release-1-1.el7.noarch.rpm  <span class="token comment"># L\u7248\u672C</span>
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> http://mirrors.aliyun.com/ceph/rpm-mimic/el7/noarch/ceph-release-1-1.el7.noarch.rpm  <span class="token comment"># M\u7248\u672C</span>
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> http://mirrors.aliyun.com/ceph/rpm-nautilus/el7/noarch/ceph-release-1-1.el7.noarch.rpm  <span class="token comment"># N\u7248\u672C Ceph-CSI\u9700\u8981N\u7248\u53CA\u4EE5\u4E0A\u7248\u672C</span>
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> http://mirrors.aliyun.com/ceph/rpm-octopus/el7/noarch/ceph-release-1-1.el7.noarch.rpm  <span class="token comment"># O\u7248\u672C</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u914D\u7F6E\u4E3B\u673A\u6620\u5C04" tabindex="-1"><a class="header-anchor" href="#_2-\u914D\u7F6E\u4E3B\u673A\u6620\u5C04" aria-hidden="true">#</a> 2.\u914D\u7F6E\u4E3B\u673A\u6620\u5C04</h3><p><code>//\u5728\u6240\u6709\u7684\u8282\u70B9\u4E0A\u9762\u914D\u7F6E\u4E3B\u673A\u540D\u79F0\u548C\u4E3B\u673A\u6620\u5C04</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl </span>
   Static hostname: ceph1
         Icon name: computer-vm
           Chassis: vm
        Machine ID: de03a5f3bf5a4b7e9df939c9dc5b428d
           Boot ID: f9e3a46fbd1a4512a1e4271efad386ec
    Virtualization: kvm
  Operating System: CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
       CPE OS Name: cpe:/o:centos:centos:7
            Kernel: Linux <span class="token number">3.10</span>.0-1160.15.2.el7.x86_64
      Architecture: x86-64
      
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/hosts </span>
::1     localhost       localhost.localdomain   localhost6      localhost6.localdomain6
<span class="token number">127.0</span>.0.1       localhost       localhost.localdomain   localhost4      localhost4.localdomain4
<span class="token number">127.0</span>.0.1       ceph-0001       ceph-0001
 

<span class="token number">192.168</span>.0.20 ceph1 
<span class="token number">192.168</span>.0.116 ceph2 
<span class="token number">192.168</span>.0.140 ceph3 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-\u914D\u7F6E\u514D\u5BC6" tabindex="-1"><a class="header-anchor" href="#_3-\u914D\u7F6E\u514D\u5BC6" aria-hidden="true">#</a> 3.\u914D\u7F6E\u514D\u5BC6</h3><p><code>//\u5728\u63A7\u5236\u8282\u70B9\u4E0A\u914D\u7F6E\u5BF9\u6240\u6709\u673A\u5668\u7684\u514D\u5BC6\u64CD\u4F5C</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ssh-keygen </span>
Generating public/private rsa key pair.
Enter <span class="token function">file</span> <span class="token keyword">in</span> <span class="token function">which</span> to save the key <span class="token punctuation">(</span>/root/.ssh/id_rsa<span class="token punctuation">)</span>: 
/root/.ssh/id_rsa already exists.
Overwrite <span class="token punctuation">(</span>y/n<span class="token punctuation">)</span>? y
Enter passphrase <span class="token punctuation">(</span>empty <span class="token keyword">for</span> no passphrase<span class="token punctuation">)</span>: 
Enter same passphrase again: 
Your identification has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.
Your public key has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:V/E84SuSSepxM+tFvU8r0NzAcUq9XJsBkrzDEZVtE+Y root@ceph1
The key&#39;s randomart image is:
+---<span class="token punctuation">[</span>RSA <span class="token number">2048</span><span class="token punctuation">]</span>----+
<span class="token operator">|</span>          .o<span class="token operator">=</span>o*o.<span class="token operator">|</span>
<span class="token operator">|</span>           +.OoO.<span class="token operator">|</span>
<span class="token operator">|</span>          o * @EB<span class="token operator">|</span>
<span class="token operator">|</span>         o B <span class="token operator">=</span> B <span class="token operator">|</span>
<span class="token operator">|</span>        S O * <span class="token operator">=</span>  <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token builtin class-name">.</span> + B + o <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> o <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span><span class="token operator">|</span>
<span class="token operator">|</span>         <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> o.<span class="token operator">|</span>
<span class="token operator">|</span>          <span class="token builtin class-name">.</span>   <span class="token punctuation">..</span>.<span class="token operator">|</span>
+----<span class="token punctuation">[</span>SHA256<span class="token punctuation">]</span>-----+

<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id ceph2 </span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id ceph3 </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-\u7BA1\u7406\u8282\u70B9\u5B89\u88C5\u90E8\u7F72\u5DE5\u5177\u5E76\u65B0\u5EFA\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#_4-\u7BA1\u7406\u8282\u70B9\u5B89\u88C5\u90E8\u7F72\u5DE5\u5177\u5E76\u65B0\u5EFA\u96C6\u7FA4" aria-hidden="true">#</a> 4.\u7BA1\u7406\u8282\u70B9\u5B89\u88C5\u90E8\u7F72\u5DE5\u5177\u5E76\u65B0\u5EFA\u96C6\u7FA4</h3><p><code>//\u7BA1\u7406\u8282\u70B9\u5B89\u88C5\u90E8\u7F72\u5DE5\u5177\uFF08\u4EE5\u4E0B\u6B65\u9AA4\u4EC5\u5728\u7BA1\u7406\u8282\u70B9\u6267\u884C\u5373\u53EF\uFF09</code></p><p>\u4E3B\u8981\u5B89\u88C5ceph-deploy\u5DE5\u5177\uFF0C\u7528\u6765\u521B\u5EFA\u96C6\u7FA4\uFF0C\u5728\u4F7F\u7528ceph-deploy\u547D\u4EE4\u62A5\u9519\u7684\u65F6\u5019\uFF0C\u9700\u8981\u7528\u5230\u51E0\u4E2Apython\u7684\u4F9D\u8D56\u5305\uFF0C\u6240\u4EE5\u9700\u8981\u628A\u4F9D\u8D56\u5305\u5B89\u88C5\u4E0A\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># yum install ceph-deploy python-setuptools python2-subprocess32 ceph-common -y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u65B0\u5EFA\u96C6\u7FA4\u6307\u5B9AMon\u8282\u70B9\u5E76\u751F\u6210ceph.conf\u548Ckeyring</p><p>cluster-network\u7528\u4E8E\u96C6\u7FA4\u5185\u90E8\u901A\u4FE1\u4E3A\u53EF\u9009\u7F51\u7EDC \u751F\u4EA7\u73AF\u5883\u5E94\u8BBE\u7F6E\u4E3A\u5176\u4ED6\u79C1\u6709\u7F51\u6BB5\u5730\u5740</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># mkdir my-cluster </span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># cd my-cluster </span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph-deploy new ceph1 ceph2 ceph3 --cluster-network 192.168.0.0/24 --public-network 192.168.0.0/24</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-\u90E8\u7F72\u96C6\u7FA4\u8282\u70B9\u5B89\u88C5ceph" tabindex="-1"><a class="header-anchor" href="#_5-\u90E8\u7F72\u96C6\u7FA4\u8282\u70B9\u5B89\u88C5ceph" aria-hidden="true">#</a> 5.\u90E8\u7F72\u96C6\u7FA4\u8282\u70B9\u5B89\u88C5Ceph</h3><p><code>//\u96C6\u7FA4\u8282\u70B9\u5B89\u88C5Ceph\u8F6F\u4EF6\u5305\uFF08\u4EE5\u4E0B\u6B65\u9AA4\u4EC5\u5728\u7BA1\u7406\u8282\u70B9\u6267\u884C\u5373\u53EF\uFF09</code></p><p>\u540Cyum -y install ceph ceph-radosgw,\u8FD9\u6761\u547D\u4EE4\u76F8\u5F53\u4E8E\u6BCF\u4E2A\u96C6\u7FA4\u90FD\u8981\u6267\u884C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph-deploy install --no-adjust-repos ceph1 ceph2 ceph3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_6-\u521D\u59CB\u5316mon\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#_6-\u521D\u59CB\u5316mon\u8282\u70B9" aria-hidden="true">#</a> 6.\u521D\u59CB\u5316Mon\u8282\u70B9</h3><p><code>//\u521B\u5EFA\u5E76\u521D\u59CB\u5316Mon\u8282\u70B9\uFF0CMon\u8FDB\u7A0B\u76D1\u542C\u57286789\u7AEF\u53E3\uFF08\u4EE5\u4E0B\u6B65\u9AA4\u4EC5\u5728\u7BA1\u7406\u8282\u70B9\u6267\u884C\u5373\u53EF\uFF09</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph-deploy mon create-initial</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u63A8\u9001\u914D\u7F6E\u6587\u4EF6\u548Cadmin\u79D8\u94A5\u5230\u5176\u4ED6\u4E3B\u673A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph-deploy admin ceph1 ceph2 ceph3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4EC5\u63A8\u9001\u914D\u7F6E</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph-deploy config push ceph1 ceph2 ceph3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_7-\u5728\u76EE\u6807\u4E3B\u673A\u90E8\u7F72mgr" tabindex="-1"><a class="header-anchor" href="#_7-\u5728\u76EE\u6807\u4E3B\u673A\u90E8\u7F72mgr" aria-hidden="true">#</a> 7.\u5728\u76EE\u6807\u4E3B\u673A\u90E8\u7F72Mgr</h3><p><code>//\u4ECE12\u7248\u672C\u5F00\u59CB\u4E4B\u540E\u90FD\u9700\u8981\u90E8\u7F72Mgr\uFF08\u4EE5\u4E0B\u6B65\u9AA4\u4EC5\u5728\u7BA1\u7406\u8282\u70B9\u6267\u884C\u5373\u53EF\uFF09</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph-deploy mgr create ceph1 ceph2 ceph3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-\u5173\u95ED\u4E0D\u5B89\u5168\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_8-\u5173\u95ED\u4E0D\u5B89\u5168\u6A21\u5F0F" aria-hidden="true">#</a> 8.\u5173\u95ED\u4E0D\u5B89\u5168\u6A21\u5F0F</h3><p><code>//\u8FD9\u65F6\u5019\u67E5\u770B\u96C6\u7FA4\u7684\u72B6\u6001\u4F1A\u62A5\u9519\uFF0CWRN\u5E76\u4E0D\u662FOK\uFF0C\u662F\u56E0\u4E3A\u5F00\u542F\u4E86\u5B89\u5168\u6A21\u5F0F\uFF08\u4EE5\u4E0B\u6B65\u9AA4\u4EC5\u5728\u7BA1\u7406\u8282\u70B9\u6267\u884C\u5373\u53EF\uFF09</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u67E5\u770B\u96C6\u7FA4\u72B6\u6001</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph -s</span>

<span class="token comment"># \u96C6\u7FA4warnning\u5904\u7406</span>
<span class="token comment"># mon is allowing insecure global_id reclaim</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph config set mon auth_allow_insecure_global_id_reclaim false</span>

<span class="token comment"># Module &#39;restful&#39; has failed dependency: No module named &#39;pecan&#39;</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># pip3 install pecan werkzeug</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart ceph-mon.target</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart ceph-mgr.target</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-\u521B\u5EFAosd" tabindex="-1"><a class="header-anchor" href="#_9-\u521B\u5EFAosd" aria-hidden="true">#</a> 9.\u521B\u5EFAOSD</h3><p><code>//\u521B\u5EFA9\u4E2AOSD\uFF08\u4EE5\u4E0B\u6B65\u9AA4\u4EC5\u5728\u7BA1\u7406\u8282\u70B9\u6267\u884C\u5373\u53EF\uFF09</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u5217\u51FA\u96C6\u7FA4\u8282\u70B9\u4E0A\u7684\u6240\u6709\u53EF\u7528\u78C1\u76D8</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph-deploy disk list ceph1 ceph2 ceph3</span>

<span class="token comment"># \u64E6\u9664\u96C6\u7FA4\u8282\u70B9\u4E0A\u7528\u6765\u7528\u4F5COSD\u8BBE\u5907\u7684\u78C1\u76D8(disk zap)</span>
<span class="token comment"># \u751F\u4EA7\u73AF\u5883\u4E0B\u53EF\u4EE5\u5355\u72EC\u6307\u5B9Ablock-db\u548Cblock-wal\u8BBE\u5907\u4EE5\u4F18\u5316\u6027\u80FD</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># for dev in /dev/vdb /dev/vdc /dev/vdd</span>
<span class="token operator">&gt;</span> <span class="token keyword">do</span> 
<span class="token operator">&gt;</span> ceph-deploy disk zap ceph1 <span class="token variable">$dev</span>
<span class="token operator">&gt;</span> ceph-deploy osd create ceph1 <span class="token parameter variable">--bluestore</span> <span class="token parameter variable">--data</span> <span class="token variable">$dev</span> 
<span class="token operator">&gt;</span> ceph-deploy disk zap ceph2 <span class="token variable">$dev</span>
<span class="token operator">&gt;</span> ceph-deploy osd create ceph2 <span class="token parameter variable">--bluestore</span> <span class="token parameter variable">--data</span> <span class="token variable">$dev</span> 
<span class="token operator">&gt;</span> ceph-deploy disk zap ceph3 <span class="token variable">$dev</span>
<span class="token operator">&gt;</span> ceph-deploy osd create ceph3 <span class="token parameter variable">--bluestore</span> <span class="token parameter variable">--data</span> <span class="token variable">$dev</span> 
<span class="token operator">&gt;</span> <span class="token keyword">done</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-\u5F00\u542Fdashboard" tabindex="-1"><a class="header-anchor" href="#_10-\u5F00\u542Fdashboard" aria-hidden="true">#</a> 10.\u5F00\u542FDashboard</h3><p><code>//\u67E5\u770BCeph\u7248\u672C\uFF0Cnautilus\u7248\u53CA\u4EE5\u540E\u9700\u8981\u5728\u6240\u6709\u8FD0\u884Cmgr\u7684\u8282\u70B9\u5B89\u88C5ceph-mgr-dashboard</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph mgr versions</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># yum install -y ceph-mgr-dashboard</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u770BMGR\u6A21\u5757\u548C\u5E2E\u52A9\u4FE1\u606F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph mgr module --help</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph mgr module ls</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u7528\u6216\u7981\u7528MGR dashboard\u6A21\u5757</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph mgr module enable dashboard</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph mgr module disable dashboard</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521B\u5EFA\u81EA\u7B7E\u540D\u8BC1\u4E66\u6216\u8005\u7981\u7528ssl</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph dashboard create-self-signed-cert</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph config set mgr mgr/dashboard/ssl false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BBE\u7F6EMGR dashboard\u6A21\u5757\u7684ip\u548Cport(\u53EF\u9009)</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph config set mgr mgr/dashboard/server_addr 0.0.0.0</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph config set mgr mgr/dashboard/server_port 8443</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BBE\u7F6E\u767B\u5F55\u8BA4\u8BC1</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># echo &quot;1&quot; &gt; password.txt</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph dashboard ac-user-create admin -i password.txt administrator</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph dashboard ac-user-show admin</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart ceph-mgr.target</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5217\u51FAMGR\u6A21\u5757\u63D0\u4F9B\u7684\u670D\u52A1\u7AEF\u70B9</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph mgr services</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5F00\u542F\u5BF9\u8C61\u7F51\u5173\u7BA1\u7406\u529F\u80FD</p><p>\u521B\u5EFArgw\u7528\u6237</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@ceph1 ~]# radosgw-admin user create --uid=&lt;value&gt; --display-name=&lt;value&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u914D\u7F6E\u5BF9\u8C61\u7F51\u5173\u8BA4\u8BC1</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph dashboard set-rgw-api-access-key $access_key</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph dashboard set-rgw-api-secret-key $secret_key</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u914D\u7F6E\u5BF9\u8C61\u7F51\u5173\u4E3B\u673A\u540D\u548C\u7AEF\u53E3</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph dashboard set-rgw-api-host &lt;value&gt;</span>
<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph dashboard set-rgw-api-port &lt;int&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://i.bmp.ovh/imgs/2022/02/a86d7dc906dc25a6.png" style="zoom:80%;"><h3 id="_11-\u914D\u7F6E\u5BA2\u6237\u7AEF" tabindex="-1"><a class="header-anchor" href="#_11-\u914D\u7F6E\u5BA2\u6237\u7AEF" aria-hidden="true">#</a> 11.\u914D\u7F6E\u5BA2\u6237\u7AEF</h3><p>\u5BA2\u6237\u7AEF\u4E0A\u64CD\u4F5C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># yum -y install centos-release-ceph-nautilus.noarch</span>
<span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># yum -y install ceph-common</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-\u5728ceph\u7684\u670D\u52A1\u7AEF\u914D\u7F6E\u5BC6\u94A5" tabindex="-1"><a class="header-anchor" href="#_12-\u5728ceph\u7684\u670D\u52A1\u7AEF\u914D\u7F6E\u5BC6\u94A5" aria-hidden="true">#</a> 12.\u5728ceph\u7684\u670D\u52A1\u7AEF\u914D\u7F6E\u5BC6\u94A5\uFF1A</h3><p><code>//\u521B\u5EFA\u7528\u6237\uFF08\u4EE5\u4E0B\u6B65\u9AA4\u4EC5\u5728\u7BA1\u7406\u8282\u70B9\u6267\u884C\u5373\u53EF\uFF09</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ceph<span class="token punctuation">]</span><span class="token comment"># ceph auth get-or-create client.rbdtest mon &#39;allow r&#39; osd &#39;allow class-read object_prefix rbd_children,allow rwx pool=rbd&#39; | tee /etc/ceph/ceph.client.rbdtest.keyring</span>


<span class="token punctuation">[</span>root@ceph1 ceph<span class="token punctuation">]</span><span class="token comment"># cat ceph.conf </span>
<span class="token punctuation">[</span>global<span class="token punctuation">]</span>
fsid <span class="token operator">=</span> 235b6c2c-91c6-4535-b5aa-9337e934ed56
public_network <span class="token operator">=</span> <span class="token number">192.168</span>.0.0/24
cluster_network <span class="token operator">=</span> <span class="token number">192.168</span>.0.0/24
mon_initial_members <span class="token operator">=</span> ceph1, ceph2, ceph3
mon_host <span class="token operator">=</span> <span class="token number">192.168</span>.0.203,192.168.0.226,192.168.0.172
auth_cluster_required <span class="token operator">=</span> cephx
auth_service_required <span class="token operator">=</span> cephx
auth_client_required <span class="token operator">=</span> cephx
rbd_default_features <span class="token operator">=</span> <span class="token number">1</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>//\u5C06\u5BC6\u94A5\u4F20\u8F93\u5230\u5BA2\u6237\u7AEF\u4E2D\uFF08\u4EE5\u4E0B\u6B65\u9AA4\u4EC5\u5728\u7BA1\u7406\u8282\u70B9\u6267\u884C\u5373\u53EF\uFF09</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ceph<span class="token punctuation">]</span><span class="token comment"># scp  ceph.client.rbdtest.keyring  root@192.168.0.51:/etc/ceph/</span>
<span class="token punctuation">[</span>root@ceph1 ceph<span class="token punctuation">]</span><span class="token comment"># scp  ceph.conf  root@192.168.0.51:/etc/ceph/   </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-\u5BA2\u6237\u7AEF\u9A8C\u8BC1\u5BC6\u94A5" tabindex="-1"><a class="header-anchor" href="#_13-\u5BA2\u6237\u7AEF\u9A8C\u8BC1\u5BC6\u94A5" aria-hidden="true">#</a> 13.\u5BA2\u6237\u7AEF\u9A8C\u8BC1\u5BC6\u94A5</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@client ceph<span class="token punctuation">]</span><span class="token comment"># ceph -s --name client.rbdtest</span>
  cluster:
    id:     235b6c2c-91c6-4535-b5aa-9337e934ed56
    health: HEALTH_OK
 
  services:
    mon: <span class="token number">3</span> daemons, quorum ceph3,ceph1,ceph2 <span class="token punctuation">(</span>age 8m<span class="token punctuation">)</span>
    mgr: ceph1<span class="token punctuation">(</span>active, since 8m<span class="token punctuation">)</span>, standbys: ceph3, ceph2
    osd: <span class="token number">9</span> osds: <span class="token number">9</span> up <span class="token punctuation">(</span>since 2h<span class="token punctuation">)</span>, <span class="token number">9</span> <span class="token keyword">in</span> <span class="token punctuation">(</span>since 2h<span class="token punctuation">)</span>
 
  data:
    pools:   <span class="token number">1</span> pools, <span class="token number">64</span> pgs
    objects: <span class="token number">20</span> objects, <span class="token number">14</span> MiB
    usage:   <span class="token number">9.1</span> GiB used, <span class="token number">171</span> GiB / <span class="token number">180</span> GiB avail
    pgs:     <span class="token number">64</span> active+clean
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h3 id="\u9519\u8BEF\u89E3\u51B3" tabindex="-1"><a class="header-anchor" href="#\u9519\u8BEF\u89E3\u51B3" aria-hidden="true">#</a> \u9519\u8BEF\u89E3\u51B3</h3></blockquote><p>\u9047\u5230\u4E00\u4E2A\u9519\u8BEF\u662F\uFF0C\u68C0\u67E5ceph\u7684\u96C6\u7FA4\u5065\u5EB7\u7684\u65F6\u5019\u51FA\u73B0WARN\u7684\u9519\u8BEF\uFF0C\u68C0\u67E5\u5065\u5EB7\u53D1\u73B0\u9700\u8981\u5728\u2019sata-pool\u2019\u4E0A\u5F00\u542F\u5E94\u7528\u6388\u6743\uFF08\u8FD9\u91CC\u7684 rbd \u662F\u6211\u4EEC\u624B\u52A8\u5EFA\u7684 pool\uFF09</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ceph<span class="token punctuation">]</span><span class="token comment"># ceph -s </span>
  cluster:
    id:     235b6c2c-91c6-4535-b5aa-9337e934ed56
    health: HEALTH_WARN
            application not enabled on <span class="token number">1</span> pool<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
 
  services:
    mon: <span class="token number">3</span> daemons, quorum ceph3,ceph1,ceph2 <span class="token punctuation">(</span>age 2h<span class="token punctuation">)</span>
    mgr: ceph1<span class="token punctuation">(</span>active, since 110m<span class="token punctuation">)</span>, standbys: ceph3, ceph2
    osd: <span class="token number">9</span> osds: <span class="token number">9</span> up <span class="token punctuation">(</span>since 115m<span class="token punctuation">)</span>, <span class="token number">9</span> <span class="token keyword">in</span> <span class="token punctuation">(</span>since 115m<span class="token punctuation">)</span>
 
  data:
    pools:   <span class="token number">1</span> pools, <span class="token number">64</span> pgs
    objects: <span class="token number">20</span> objects, <span class="token number">14</span> MiB
    usage:   <span class="token number">9.1</span> GiB used, <span class="token number">171</span> GiB / <span class="token number">180</span> GiB avail
    pgs:     <span class="token number">64</span> active+clean

<span class="token punctuation">[</span>root@ceph1 ceph<span class="token punctuation">]</span><span class="token comment"># ceph health</span>
HEALTH_WARN application not enabled on <span class="token number">1</span> pool<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph health detail</span>
HEALTH_WARN application not enabled on <span class="token number">1</span> pool<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
POOL_APP_NOT_ENABLED application not enabled on <span class="token number">1</span> pool<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    application not enabled on pool <span class="token string">&#39;rbd&#39;</span>
    use <span class="token string">&#39;ceph osd pool application enable &lt;pool-name&gt; &lt;app-name&gt;&#39;</span>, where <span class="token operator">&lt;</span>app-name<span class="token operator">&gt;</span> is <span class="token string">&#39;cephfs&#39;</span>, <span class="token string">&#39;rbd&#39;</span>, <span class="token string">&#39;rgw&#39;</span>, or freeform <span class="token keyword">for</span> custom applications.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7\u5F00\u542F\u5E94\u7528\u6388\u6743</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ceph1 ~<span class="token punctuation">]</span><span class="token comment"># ceph osd pool application enable rbd rbd</span>
  abled application <span class="token string">&#39;rbd&#39;</span> on pool <span class="token string">&#39;rbd&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\u518D\u770B dashboard \uFF0C\u5DF2\u7ECF\u6CA1\u6709\u62A5\u9519\u4E86\uFF0C\u800C\u4E14block \u4E5F\u80FD\u8BC6\u522B\u5230\u4E86\u3002 \u8FD9\u91CC\u6211\u4EEC\u4F7F\u7528\u4E86rbd\uFF08\u5757\u8BBE\u5907\uFF09\uFF0Cpool \u53EA\u80FD\u5BF9\u4E00\u79CD\u7C7B\u578B\u8FDB\u884C enable\uFF0C\u53E6\u5916\u4E24\u79CD\u7C7B\u578B\u662Fcephfs\uFF08\u6587\u4EF6\u7CFB\u7EDF\uFF09\uFF0Crgw\uFF08\u5BF9\u8C61\u5B58\u50A8\uFF09</p>`,82),t=[c];function i(o,l){return s(),a("div",null,t)}const u=n(p,[["render",i],["__file","01.Ceph\u90E8\u7F72.html.vue"]]);export{u as default};
